<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>performance - Gitolite</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/gitolite.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Gitolite</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">what/why <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../overview/">overview</a>
</li>
                            
<li >
    <a href="../concepts/">concepts, conventions, terminology</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">install and setup <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../quick_install/">(unix/ssh experts) quick install and setup</a>
</li>
                            
<li >
    <a href="../install/">normal ssh mode install and setup</a>
</li>
                            
<li >
    <a href="../fool_proof_setup/">(if all else fails) fool-proof, step-by-step, install and setup</a>
</li>
                            
<li >
    <a href="../http/">HTTP mode install</a>
</li>
                            
<li >
    <a href="../migr/">migrating from v2</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">use <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">basic</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../basic-admin/">basic administration</a>
</li>
            
<li >
    <a href="../conf/">the "conf" file (part 1)</a>
</li>
            
<li >
    <a href="../conf-2/">the "conf" file (part 2)</a>
</li>
            
<li >
    <a href="../rc/">the "rc" file</a>
</li>
            
<li >
    <a href="../user/">your users' view</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">advanced</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../git-config/">setting git-config values</a>
</li>
            
<li >
    <a href="../options/">gitolite options</a>
</li>
            
<li >
    <a href="../wild/">ad hoc user-created ("wild") repos</a>
</li>
            
<li >
    <a href="../vref/">virtual refs (part 1)</a>
</li>
            
<li >
    <a href="../vref-2/">virtual refs (part 2)</a>
</li>
            
<li >
    <a href="../deleg/">delegation of admin duties</a>
</li>
            
<li >
    <a href="../gitweb-daemon/">gitweb and git-daemon</a>
</li>
            
<li >
    <a href="../mirroring/">mirroring</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">customise</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../non-core/">core and "non-core" gitolite</a>
</li>
            
<li >
    <a href="../dev-notes/">writing your own non-core code</a>
</li>
            
<li >
    <a href="../triggers/">gitolite triggers</a>
</li>
            
<li >
    <a href="../list-non-core/">list of non-core programs shipped with gitolite</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../cookbook/">(quick! how do I...) the cookbook</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HELP! <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../emergencies/">emergency!!</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">ssh</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../ssh/">ssh</a>
</li>
            
<li >
    <a href="../glssh/">how gitolite uses ssh</a>
</li>
            
<li >
    <a href="../sts/">ssh troubleshooting</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../regex/">regular expressions</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">other docs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../odds-and-ends/">miscellaneous features</a>
</li>
                            
<li >
    <a href="../namespaces/">using git namespaces</a>
</li>
                            
<li >
    <a href="../locking/">locking binary files</a>
</li>
                            
<li >
    <a href="../testing/">testing gitolite</a>
</li>
                            
<li >
    <a href="../package/">packaging gitolite</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">more about gitolite</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../files/">gitolite files & directories</a>
</li>
            
<li >
    <a href="../rc-33/">the 3.3 format rc file</a>
</li>
            
<li class="active">
    <a href="./">performance</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">contrib</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../contrib/ssh-and-http/">Using both ssh and http</a>
</li>
            
<li >
    <a href="../contrib/putty/">Putty and Msysgit</a>
</li>
            
<li >
    <a href="../contrib/sskm/">Self-service key management</a>
</li>
            
<li >
    <a href="../contrib/ukm/">User key management</a>
</li>
            
<li >
    <a href="../contrib/README-emacs/">Emacs major mode</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../no-way/">no way!</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../rc-33/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../contrib/ssh-and-http/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#gitolite-performance">gitolite performance</a></li>
        <li class="main "><a href="#tips-for-performance-worriers">tips for performance worriers</a></li>
        <li class="main "><a href="#why-theres-really-no-need-to-worry">why there's really no need to worry!</a></li>
        <li class="main "><a href="#the-only-thing-that-will-take-more-time">the only thing that will take more time</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="gitolite-performance">gitolite performance<a class="headerlink" href="#gitolite-performance" title="Permanent link"></a></h1>
<hr />
<p>TOP TIP: If you have more than 2000 or so repos, then you should be using v3.2
or later; there was a bit of code that went in there that makes a <em>huge</em>
difference for really large sites.</p>
<h1 id="tips-for-performance-worriers">tips for performance worriers<a class="headerlink" href="#tips-for-performance-worriers" title="Permanent link"></a></h1>
<p>Gitolite is pretty efficient in most cases, and generally nothing needs to be
done.  If you think you have a performance problem, let me know on the mailing
list.  Meanwhile, here are some tips:</p>
<ul>
<li>
<p>Look in the gitolite log file after any operation that you think ran
    slowly.  In particular, pushing to the admin repo, or a user creating a
    new wild repo, might be a little slow, and the log file will tell you a
    bit more detail on what took time.</p>
</li>
<li>
<p>If you don't use gitweb or git-daemon, or use them but are perfectly happy
    to control access to them from outside gitolite, you can comment out the
    corresponding lines in the ENABLE list the rc file.</p>
</li>
<li>
<p>If you can't get rid of those scripts, and they are still taking too long,
    you can make them run in the background.  They'll eventually finish but
    the user doesn't have to wait.  See src/triggers/bg.  <em>This should not
    normally be needed; if you feel you need it, please talk to me so I can
    understand why and maybe help</em>.</p>
</li>
<li>
<p>If you're more concerned about your users' time when they create a new
    wild repo (and not so much about the admin push taking time), you can fix
    a couple of scripts and send me a patch :)</p>
<p>Here's the scoop:</p>
<p>Scripts invoked via <code>POST_CREATE</code> <em>do</em> get information about what repo has
just been created.  However, the gitweb and daemon scripts are not set to
take advantage of this, only the git-config one is.  So use the git-config
script as an example, and/or read the <a class="wikilink" href="../triggers/">triggers</a> page, and fix the other
two programs.</p>
<p>(This should be easy enough for the daemon update, but the gitweb update
may be a little more tricky, since it may involve <em>deleting</em> lines from
the "projects.list" file.)</p>
</li>
</ul>
<h1 id="why-theres-really-no-need-to-worry">why there's really no need to worry!<a class="headerlink" href="#why-theres-really-no-need-to-worry" title="Permanent link"></a></h1>
<p>In general, gitolite has a constant overhead of about 0.2 seconds on my
laptop.  There really is nothing to optimise, but you can comment out some
triggers as the previous section said.</p>
<p>Here's the big-O stuff:</p>
<ul>
<li>N = number of normal repos, each with its own set of rules.  In <code>repo r1
    r2 r3</code>, N = 3.  Add up all such lines.</li>
<li>G = number of groups or repo regexes.  In <code>repo @g1 @g2 foo/[a-z]*</code>, G =
    3.</li>
<li>M = number of members.  In <code>@g1 = r1 r2 &lt;nl&gt; @g2 = r3 r4 r5</code>, M = 5.</li>
<li>A = average number of rule lines in each "repo" block.  Usually about 5,
    maybe 10 sometimes.  You may have more.</li>
</ul>
<p>Gitolite overheads compared to a normal ssh push are:</p>
<ol>
<li>perl startup time.  Fairly constant and fairly small.  I have generally
    found it pretty hard to measure, especially with a hot cache.</li>
<li>rule parse time.  Details below</li>
<li>rule interpretation time.  Fairly constant, or at least subject to much
    smaller variations than #2.</li>
</ol>
<p>"rule parse time" is where it makes a difference.  There are 2 files gitolite
parses on each "access": <code>~/.gitolite/conf/gitolite.conf-compiled.pm</code> and
<code>~/repositories/your_repo.git/gl-conf</code>.  The former contains O(N + M + G*A)
lines.  In addition, the gl-conf files contains about "A" lines (remember we
called it an average), which is negligible.</p>
<p>In practice, you can't measure this at a scale that a developer running a "git
push" might even pretend to notice, unless you have more than, say, 5000 repos
or so.  On my testbed of 11,100 repos, where the compiled.pm is almost 0.7 MB,
it takes less than 0.2 seconds to do this.</p>
<p>And on a busy system, when that file will be pretty much always in cache, it's
even less.</p>
<h1 id="the-only-thing-that-will-take-more-time">the only thing that will take more time<a class="headerlink" href="#the-only-thing-that-will-take-more-time" title="Permanent link"></a></h1>
<p>Literally, the only thing that will take time is something like "ssh git@host
info" because it finds all possible repos and for each of them it tries to
check the access.  On that same test bed, therefore, this ends up reading all
11,100 "gl-conf" files.</p>
<p>On my laptop this takes about 14 seconds.  In contrast, a normal git operation
(clone, pull, push, etc) is so small it is hard to measure without software.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

var __index = {"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Hosting Git Repositories","text":"<p>Gitolite allows you to setup git hosting on a central server, with fine-grained access control and many more powerful features.</p>"},{"location":"index.html#installsetup","title":"install/setup","text":"<p>If you're installing via your package manager, make sure you get the right one -- it's often called <code>gitolite3</code>.</p> <p>Source code is at https://github.com/sitaramc/gitolite.</p> <p>If your Unix-fu and ssh-fu are good, take a look at the quick install page.  Otherwise follow the documentation flow, skipping whatever you think you don't need.</p>"},{"location":"index.html#documentation","title":"documentation","text":"<p> (April 2014): There's a book on gitolite out.  I've received some emails over the years asking where to donate for gitolite to show your appreciation, and I've always refused politely.  Well, if you insist... buy the book :-) </p> <p>In general, the sections (see links in the navigation bar at the top) should be fairly self-explanatory, and reading through the documentation as it flows (i.e., using the \"Next\" link at the top right of each page) should work fine. There are some forward references here and there, but you can ignore those links on a first pass.</p> <p>In addition:</p> <p>There's a fool proof setup guide with detailed help showing one fool-proof way to install, as long as you follow instructions faithfully!</p> <p>Once you've installed and setup, there's the cookbook with recipes for common tasks.</p>"},{"location":"index.html#troubleshooting","title":"TROUBLESHOOTING","text":"<p>The emergencies page helps with all sorts of install/setup issues, recovering from lost keys and other self-inflicted wounds, lists some common (and some uncommon!) errors and non-standard configs that may trip you up.</p>"},{"location":"index.html#contactsupport","title":"contact/support","text":""},{"location":"index.html#security-issues","title":"security issues","text":"<p>If you think you found a possible security issue, please email me (sitaramc@gmail.com) directly.</p>"},{"location":"index.html#mailing-lists","title":"mailing list(s)","text":"<p>For all other communications, please use the mailing list.  This has some advantages over sending direct to me (if I'm not available, someone else might respond; someone else may have additional info that I may not have thought of, or experiences to share; the issue becomes searchable for future reference; and finally, it keeps me honest!)</p> <p>NOTE: The first email from a new member is held until I can clear it; subsequent emails from the same email address do not get held up.</p> <p>Mailing list for support and general discussion:</p> <ul> <li>Subscribe: gitolite+subscribe@googlegroups.com</li> <li>Post: gitolite@googlegroups.com</li> </ul> <p>(If you're unwilling to join the mailing list, you can still send me direct mail if it's something simple, obvious, or quick.  But if the issue needs multiple mails and/or some discussion, I prefer the mailing list.)</p> <p>There's also a low traffic, one-way, mailing list for release and security announcements:</p> <ul> <li>Subscribe: gitolite-announce+subscribe@googlegroups.com</li> </ul> <p>If you wish to send me code, please see the file called CONTRIBUTING in the source distribution.</p>"},{"location":"index.html#irc","title":"IRC","text":"<p>Our IRC channel is <code>#gitolite</code> on libera.chat.  I live in India (UTC+0530 time zone), but there are a few regulars (thanks, guys, you know who you are!) from other times zones.  That said, it's not heavy traffic and you may have to wait a while for an answer, depending on the time of day and day of week.</p> <p>There are also many gitolite-knowledgeable people on the git channel <code>#git</code>.</p>"},{"location":"index.html#license","title":"license","text":"<p>The gitolite software is copyright Sitaram Chamarty and is licensed under the GPL v2; please see the file called COPYING in the source distribution.</p> <p>This documentation, which is maintained separately from the main gitolite source code, is copyright Sitaram Chamarty and is provided under a Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.</p> <p>However, certain parts are contributed by others who may have chosen other licenses; their names and license will be mentioned in the respective files.</p> <p>Documentation for a software product will naturally contain code examples.  I believe that the principle of fair use should cover use of those snippets; see especially factors 3 and 4 in the list of factors here.</p> <p>If you're not convinced that it would be fair use, then you may consider those code snippets, as well as associated \"comments\" if any, to be under the GPLv2 license.  Licensing is about intent, and the intent of these examples is that you use them wherever and however you can use gitolite itself.</p> <p>Note:</p> <p>GIT is a trademark of Software Freedom Conservancy and my use of \"Gitolite\" is under license.</p>"},{"location":"basic-admin.html","title":"basic administration","text":"<p>If you really, really, really want to manage gitolite directly on the server, i.e., without cloning the gitolite-admin repo, you can -- here's how.  This is likely to be of interest mainly to puppet/chef type installations.</p> <p>Day-to-day management of a gitolite site is done by cloning the special 'gitolite-admin' repo, making appropriate changes to it, and pushing it back to the server.  The concepts and terminology page has a section with some details on what happens after the push.</p> <p>In other words, do NOT add new repos or users manually on the server!</p>"},{"location":"basic-admin.html#clone-the-gitolite-admin-repo","title":"clone the gitolite-admin repo","text":"<p>To clone the admin repo, go to the workstation where the public key used in 'setup' came from, and run this:</p> <pre><code>git clone git@host:gitolite-admin\n</code></pre> <p>NOTE that (1) you must not include the <code>repositories/</code> part (gitolite handles that internally), and (2) you may include the \".git\" at the end but it is optional.</p> <p>If this step fails, be sure to look at the two pages linked from the ssh page before asking for help.  A very basic first step is to run the <code>info</code> command (<code>ssh git@host info</code>); this page tells you what to expect.</p>"},{"location":"basic-admin.html#addremove-users","title":"add/remove users","text":"<p>NOTE: This section only applies to ssh mode.  If you've installed gitolite in http mode, adding and removing users is outside the scope of gitolite.</p> <p>Strictly speaking, gitolite doesn't know where users come from.  (If that surprises you, go back to the concepts page and read the section on \"authentication and authorisation\"). However, gitolite does help with ssh-based authentication, by making it easy to add and remove users from <code>~/.ssh/authorized_keys</code>.</p> <p>To add or remove users, you have to clone the gitolite-admin repository, then add or remove ssh pubkey files from the \"keydir/\" directory in the clone. Then commit those changes and push.</p> <p>Here's how to add users to gitolite.  \"alice\" is the administrator and is adding \"bob\" and \"carol\".</p> <p></p> <p>All this is done from the admin (Alice)'s workstation.  The steps are:</p> <ol> <li> <p>Run <code>git clone git@server:gitolite-admin</code>.</p> </li> <li> <p>Obtain pubkeys from each user; email, USB, DHL, pigeon post, owl mail, any     method you like.</p> <p>Rename each received file to the name of the user, add a \".pub\" at the end, copy it into <code>keydir/</code> in the gitolite-admin repo you cloned.</p> </li> <li> <p>Run <code>git add keydir</code>, then <code>git commit</code>, then <code>git push</code>.</p> </li> </ol> <p>You do NOT need to add Carol or Bob as real (Unix) users.  You do NOT add their keys directly anywhere on the server, and you most definitely do NOT fiddle with the authorized_keys file on the server directly!</p> <p>To remove a user, <code>git rm keydir/alice.pub</code>.</p> <p>Commit and push the changes.  On receiving the push, gitolite will carry out the changes specified.</p> <p>NOTE: your users' public key is typically <code>$HOME/.ssh/id_rsa.pub</code> on her workstation.  Please make sure it is in openssh's default format.</p>"},{"location":"basic-admin.html#multiple-keys-per-user","title":"multiple keys per user","text":"<p>You can put pubkeys in subdirectories within \"keydir/\", because the user name is simply the base name of the public key file name.  That is, 'keydir/alice.pub', 'keydir/home/alice.pub', 'keydir/laptop/alice.pub', (or even 'keydir/work/desktop/alice.pub' -- any number of subdirectory levels are OK) all resolve to user \"alice\".</p> <p>This is the simplest and most understandable way to allow multiple keys per user.</p> <p>Please see appendix 2 at the bottom of this document for an older way that will continue to be supported but has proved hard to explain!</p> <p>(Finally, if you insist on wanting to actually put all the keys for a user into a single, multi-line, pubkey file, it is possible.  For details, see the program <code>src/triggers/post-compile/ssh-authkeys-split</code> in the source.)</p>"},{"location":"basic-admin.html#add-remove-and-rename-repos","title":"add, remove, and rename repos","text":"<p>Note: this page describes how to add new repos.  To bring already existing repos under gitolite's control, click here.</p> <p>To add a new repo, you have to clone the gitolite-admin repository, then edit the <code>conf/gitolite.conf</code> file. In that file, add the repo, along with at least one user with some permissions.</p> <p>You can add the new repo in its own paragraph,</p> <pre>\nrepo bar\n    RW+     =   alice\n</pre> <p>or you can add it to an existing repo line, if the new repo is intended to have the same access rules:</p> <pre>\nrepo foo bar\n    RW+     =   alice\n</pre> <p>Either way, commit and push the changes.  Gitolite will create a bare, empty, repo on the server that is ready to be cloned and pushed to.</p> <p>As you can see, the \"repo\" line can have any number of repo names or repo group names in it. However, it can only be one line; this will not work:</p> <pre>\nrepo foo\nrepo bar    # WRONG; 'foo' is now forgotten\n    RW+     =   alice\n</pre> <p>If you have too many to fit on one line comfortably, you can create and use a repo group:</p> <pre>\n@myrepos    =   foo\n@myrepos    =   bar\n    .\n    .\n    .\n@myrepos    =   zzq\n\nrepo @myrepos\n    RW+     =   alice\n</pre>"},{"location":"basic-admin.html#removingrenaming-a-repo","title":"removing/renaming a repo","text":"<p>Removing a repo is not so straightforward.  You certainly must remove the appropriate lines from the <code>conf/gitolite.conf</code> file, but gitolite will not automatically delete the repo from the server.  You have to log on to the server and do the dirty deed yourself :-)</p> <p>It is best to make the change in the conf file, push it, and then go to the server and do what you need to.</p> <p>Renaming a repo is also not automatic.  Here's what you do (and the order is important):</p> <ul> <li>Go to the server and rename the repo at the Unix command line.  Don't     forget to retain the \".git\" extension on the directory name.</li> <li>Change the name in the conf/gitolite.conf file in your gitolite-admin repo     clone, and add/commit/push.</li> </ul>"},{"location":"basic-admin.html#appendix-1-bringing-existing-repos-into-gitolite","title":"appendix 1: bringing existing repos into gitolite","text":"<p>Warning!</p> <p>Gitolite will clobber any existing <code>update</code> hook in your repos when you do this.  Please see either the cookbook or the non-core page for information on how to make your existing update hook work with gitolite.</p> <p>Gitolite may clobber any existing \"git-daemon-export-ok\" file in your repo; see the page on allowing access to gitweb and git-daemon for how to enable that via gitolite.</p> <p>With that out of the way, here's how to do this:</p> <p>Warning!</p> <p>This warning applies to versions before v3.6.10.</p> <p>Depending on how your gitolite.conf is setup, and how much time you take between moving the repositories and completing the rest of the instructions below, it may be possible for a user to read or write the repos you are in the process of migrating.</p> <p>To prevent writing, you can disable write access to all repos before you start this process.  Preventing reading is much harder, but at the same time, most configurations will not have this problem.  If in doubt, ask on the mailing list.</p> <p>Either way, don't forget to re-enable access at the end of this process!</p> <p>First, on the server:</p> <ul> <li> <p>Move the repos to <code>$HOME/repositories</code>.</p> </li> <li> <p>Make sure that:</p> <ul> <li>They are all bare repos.</li> <li>All the repo names end in \".git\".</li> <li>All the files and directories are owned and writable by the gitolite     hosting user (especially true if you copied them as root).</li> <li>There are no symbolic links left over from wherever the files were     brought from.</li> </ul> </li> <li> <p>Run the following three commands:</p> <pre><code>gitolite compile\ngitolite setup --hooks-only\ngitolite trigger POST_COMPILE\n</code></pre> </li> <li> <p>If the repos are wildcard repos that already match some repo regex     in the conf file, you need to manually create the gl-creator file, like     so:</p> <pre><code>echo username &gt; ~/repositories/path/to/repo.git/gl-creator\n</code></pre> <p>I haven't yet found this to be common enough to bother wrapping it in a nice interface or command.</p> </li> </ul> <p>However, if the repos are normal repos, then, back on your workstation:</p> <ul> <li>Add them to the <code>conf/gitolite.conf</code> in your clone of the admin repo, then     commit and push the change.</li> </ul>"},{"location":"basic-admin.html#appendix-2-old-style-multi-keys","title":"appendix 2: old style multi-keys","text":"<p>There is another way that involves creating key files like <code>alice@home.pub</code> and <code>alice@laptop.pub</code>, but there is a complication because gitolite also allows full email addresses as user names.  (i.e., <code>sitaramc@gmail.com.pub</code> denotes the user called <code>sitaramc@gmail.com</code>).</p> <p>This older method of enabling multi-keys was developed to deal with that.  It will continue to work and be supported in code, simply because I prefer it. But I will not accept questions or doc patches for it, because it seems it is too difficult to understand for a lot of people.  This table of sample pubkey filenames and the corresponding derived usernames is all you get:</p> <ul> <li> <p>plain username, no multikey</p> <pre><code>sitaramc.pub                            sitaramc\n</code></pre> </li> <li> <p>plain username, with multikeys</p> <pre><code>sitaramc@laptop.pub                     sitaramc\nsitaramc@desktop.pub                    sitaramc\n</code></pre> </li> <li> <p>email address as username, no multikey</p> <pre><code>sitaramc@gmail.com.pub                  sitaramc@gmail.com\n</code></pre> </li> <li> <p>email address as username, with multikeys</p> <pre><code>sitaramc@gmail.com@laptop.pub           sitaramc@gmail.com\nsitaramc@gmail.com@desktop.pub          sitaramc@gmail.com\n</code></pre> </li> </ul>"},{"location":"build-docs.html","title":"building the documentation","text":"<p>I changed from my homemade system to mkdocs, mainly due to the search facility.  (I'm sure there are any number of other static site generators out there, but this one seemed to have the smallest footprint and was easiest to install and get going).</p>"},{"location":"build-docs.html#building-the-docs","title":"building the docs","text":"<ul> <li>Make sure the tree is not dirty.</li> <li>Run <code>bin/build</code>; takes a few seconds and grabs the screen, sorry!</li> <li>Deploy <code>site/</code></li> </ul>"},{"location":"build-docs.html#what-doesnt-work-in-mkdocs","title":"what doesn't work in mkdocs","text":""},{"location":"build-docs.html#bad-language-guesses","title":"bad language guesses","text":"<p>It seems to be too hard to make it turn off its \"guess the language\" pseudo-smartness when you use a plain indented code block.  And looking at the mailing list archives does not give me much hope this will be fixed.  So you're left with strange colors on some random words in many code blocks!</p> <p>(I could fence each of them with an explicit language but I'm reluctant to do that; plain markdown's plain indented code should be left plain, ideally!)</p>"},{"location":"build-docs.html#no-hidden-docs","title":"no hidden docs","text":"<p>Every document must appear in the document menu (top nav bar), even if it is several levels deep.  The only way to have a document rendered without putting it on the nav bar is not to even list a page hierarchy, which makes them all come out in alphabetical order, which is useless for a project of this size.</p> <p>The mailing list has some workarounds, but at the moment I am not using them. I'd already added all the documents willy-nilly anyway.</p> <p>Except, ironically, this document; this will never be rendered -- you'll only see it in the source repo.</p>"},{"location":"build-docs.html#foo-bar-split-across-lines","title":"<code>foo bar</code> split across lines","text":"<p>If a <code>foo bar</code> is split across lines due to vim formatting, the bloody output also shows it split there.  My constant OCD to reformat all paras has taken a hit, due to all these manually UN-formatted paragraphs.</p>"},{"location":"build-docs.html#toc-levels","title":"TOC levels","text":"<p>The 'cinder' theme gives you 3 levels, but does not scroll the side nav at all (i.e., if you have too many entries, you just won't see the ones that were below the window bottom)!  Sticking with default theme for now.</p>"},{"location":"build-docs.html#code-highlight","title":"code highlight","text":"<ol> <li> <p>the \"codehilite\" extension seems too complicated looking at the steps     described in     https://pythonhosted.org/Markdown/extensions/code_hilite.html</p> </li> <li> <p>in any case they don't recognise gitolite syntax.</p> </li> </ol> <p>So we just use the</p> <pre><code>&lt;pre style=\"color: #ffffff; background-color: #000000;\"&gt;\n...code...\n&lt;/pre&gt;\n</code></pre> <p>syntax and let our preprocessor fix things up using vim.  Kludgy, slow, annoying (all those xterms -- I need to implement caching for this), but it gets the job done with a minimum of fuss.</p>"},{"location":"build-docs.html#short-anchors","title":"short anchors","text":"<p>can only be created like:</p> <pre><code>&lt;h1 id=\"dl\"&gt;download&lt;/h1&gt;\n</code></pre> <p>Using</p> <pre><code># &lt;a id=\"dl\" /&gt;download\n</code></pre> <p>causes some weird artefacts in the generated page.</p> <p>At present I'm not using them at all; just using the long forms.</p>"},{"location":"cache.html","title":"gitolite and the (redis) cache","text":"<p>(requires v3.6.1)</p> <p>WARNING: this has not been tested in a while.  YMMV</p> <p>Gitolite can optionally use the Redis in-memory key-value database for a little speed boost for really large sites.</p> <p>If you look in the [gitolite performance][perf] page, you will see, right at the bottom, that pretty much the only thing in gitolite that may be slow is the [info][] command. The cache feature fixes that problem :-)</p> <p>Using Redis as the backend database is actually a bit of overkill; technically this could just as well have been done using a DBM file or SQlite or something like that, but since this is only a cache, an in-memory database works out better.  However, Redis does have one real advantage: cache [timeout][]s!</p> <p>Support for this feature is limited to verifiable gitolite bugs, if you find any; I can't help you with redis itself.</p>"},{"location":"cache.html#how-does-caching-work","title":"how does caching work?","text":"<p>To use this feature, just install Redis, then the perl driver \"Redis.pm\". Install or upgrade Gitolite to the latest master, then uncomment (or add, if it doesn't exist) the following line in the rc file:</p> <pre><code>CACHE       =&gt;  'Redis',\n</code></pre> <p>If you're adding it, please add it within the \\%RC hash, but outside the ENABLE list.  (If in doubt, add it just after the UMASK entry).</p> <p>Then perform some gitolite operation (anything that requires any form of access checking).  Redis should start automatically and the right things should happen; see below if it does not.</p>"},{"location":"cache.html#troubleshooting-caching","title":"troubleshooting caching","text":"<p>If you ever kill the redis-server be sure to also remove the socket file <code>~/.redis-gitolite.sock</code>.  Conversely if you ever remove the sock file be sure to kill the process also.  Otherwise you get weird behaviour, including possible hangs.  (If things don't seem to work, the first thing to do is to kill all 'redis-server's on that userid and remove <code>~/.redis-gitolite.*</code>, then try again.)</p> <p>Note: To the best of my knowledge, this cannot result in wrong data being passed to gitolite, causing a security breach.  If anyone has time I'd appreciate a review of the code.</p>"},{"location":"cache.html#caching-details","title":"caching details","text":""},{"location":"cache.html#what-is-cached","title":"what is cached","text":"<p>At present, gitolite caches only one specific function: the \"access()\" function.  This is available from the shell as the 'gitolite access ...' command, as well as from perl via the \"Easy.pm\" interface; see [dev-notes][] for more.  It is easily the \"workhorse\" of gitolite.</p> <p>The cache is flushed completely when the gitolite.conf file is \"compiled\". You might see some things running a bit slower -- at least until things settle down.</p> <p>Finally, if you run 'perms', the cache entries for that specific repo are also flushed.</p>"},{"location":"cache.html#how-long-is-it-cached-timeout","title":"how long is it cached {#timeout}","text":"<p>Redis has a timeout feature that can delete entries after a certain period of time has elapsed since they were created or updated.  Gitolite sets a timeout of 90000 seconds (just over a day) normally.  However, if you're using the GROUPLIST_PGM feature (see [here][ldap] for details), then this timeout becomes 900 seconds (only 15 minutes).  This is because a user's group membership, and thus her access rights, can change without gitolite being aware of the change.</p> <p>If you're not using the GROUPLIST_PGM feature, you don't have to do anything. But if you are using it, then a cache timeout of 15 minutes may be too much or too little for you -- I cannot judge that.  You can tell gitolite what timeout you want for your setup, by adding (or uncommenting) an RC variable called CACHE_TTL; its value is the number of seconds for the timeout.</p>"},{"location":"concepts.html","title":"concepts, conventions, and terminology","text":"<p>(I assume you're at least somewhat familiar with git itself.  If not, the \"before you start...\" page has a list of topics that you need to be familiar with, in order to use gitolite.)</p> <p>This page will help newcomers get used to what we're talking about elsewhere. It also explains the special <code>gitolite-admin</code> repo and how it is used to do te day-to-day management of a gitolite server.</p>"},{"location":"concepts.html#authentication-and-authorisation","title":"authentication and authorisation","text":"<p>Gitolite does not do authentication.  It only does authorisation.</p> <p>So let's loosely define these words:</p> <p>Authentication is the process of verifying that you are who you claim   to be.  An authentication system will establish that I am the user   \"sitaram\" on my work system.  The one behind gmail will similarly   establish that I am \"sitaramc\".  And so on...</p> <p>Authorisation is the process of asking what you want to do and   deciding if you're allowed to do it or not.</p> <p>When you install gitolite, your users will authenticate themselves to your server's \"sshd\" (ssh daemon) or to your web server.  If authentication succeeds, sshd or httpd will pass control to gitolite, which then performs the authorisation check -- i.e., figure out whether to allow you to do whatever it is you want to whatever repo you decided to touch.</p>"},{"location":"concepts.html#ssh-mode-and-http-mode","title":"ssh mode and http mode","text":"<p>Git allows authenticated remote access using these two mechanisms: ssh and http.  Gitolite supports both.</p> <p>Ssh mode is much easier to install and setup; most systems already have whatever you need, and -- except for creating the \"hosting user\" -- you don't need to do anything as root.  However, your users have to generate an ssh keypair for themselves (using \"ssh-keygen\") if they don't already have a keypair, and they have to send you the public key (the file ending in \".pub\"), which you add to gitolite.</p> <p>Http mode requires a bit more work in terms of setting things up.  Once setup, however, it may be a little easier for your users.  Authentication is by username + password, which, although much less secure than ssh keypairs, is conceptually easier for users.</p>"},{"location":"concepts.html#the-hosting-user","title":"The \"hosting user\"","text":"<p>If you're wondering how it distinguishes between different users when they are all logging into \"git\", this page has answers!</p> <p>When you install gitolite in ssh mode, you pick one specific user on the Unix system to be the \"hosting user\".  This is the user whose name goes into the repo URLs your users will be cloning, for example <code>ssh://git@server/repo</code>, or the simpler form <code>git@server:repo</code>.</p> <p>Usually, this is \"git\", and that is what we assume in this documentation. However, it can actually be any user on the system, and I think both the Fedora RPM and the Debian DEB use \"gitolite\", so adjust instructions and examples accordingly.  Unless otherwise stated, everything that we do \"on the server\" is done in this userid (for ssh mode installations).</p> <p>Of course you can have any number of \"hosting users\", but that's rare.</p>"},{"location":"concepts.html#the-logical-repo-name","title":"the \"logical repo name\"","text":"<p>Gitolite refers to repos using a logical repo name, which is whatever name you specified in the gitolite.conf file (described later).  The actual repo will be in <code>$HOME/repositories</code>, and will have a \".git\" suffix.  So, for example, the logical repo name \"foo\" will be <code>$HOME/repositories/foo.git</code> on disk, and \"bar/baz\" will be <code>$HOME/repositories/bar/baz.git</code>.  The logical repo name is what you must use for all interactions with gitolite (within the conf file, repo name arguments to gitolite commands or API functions, etc.) unless specifically documented otherwise.</p> <p>One exception: you're allowed to add the \".git\" extension in git commands (clone, fetch, push, ls-remote, archive) if you wish, because git itself allows it, and we'd like to be as transparent as possible.  The <code>$HOME/repositories</code> prefix should never be specified.  If you do specify it, and things appear to work, something is wrong!.</p>"},{"location":"concepts.html#the-special-gitolite-admin-repo","title":"the special gitolite-admin repo","text":"<p>Gitolite manages git repos.  Among them is a repo called \"gitolite-admin\", which is a very special repository that helps you add and remove users and repos, as well as define access rules for them. Most day-to-day management of gitolite is done by cloning this repository, making changes to it, and pushing the changes back to the server.</p> <p>Specifically, it contains a directory called \"keydir\", in which you place files with names like \"alice.pub\", \"bob.pub\", etc.  These are the public keys of you and your users.  (Of course this applies only to ssh mode).</p> <p>It also contains a file called \"conf/gitolite.conf\", in which you add access rules specifying who gets what level of access to each repo.  Here's a simple example:</p> <pre>\n# these lines were already in the file\nrepo foo\n    RW+     =   alice\n    RW      =   bob\n\n# these lines were added just now\nrepo bar\n    RW+     =   bob\n    R       =   alice\n</pre> <p>Here's what happens when you commit the changes/additions to these files and push them to the server.  Since we've already seen the ssh/sshd part of this process (in the overview page), we'll start off from \"git-receive-pack\":</p> <p></p> <ol> <li> <p>The <code>gitolite-admin</code> repo has a special <code>post-update</code> hook, installed by     gitolite, which is invoked by <code>git-receive-pack</code>.  This is how gitolite gets     in on the action.</p> </li> <li> <p>Gitolite looks at the keys in keydir, and updates ssh's authorized keys     file using those keys, so ssh knows who the valid users are.  A ton of     detail about this is in the ssh pages.</p> </li> <li> <p>It then updates some internal files in <code>~/.gitolite</code></p> </li> <li> <p>For new repositories (repos that do not exist in <code>~/repositories</code>, but are     mentioned in <code>conf/gitolite.conf</code>), it creates the repository.</p> </li> <li> <p>For each repository, it updates a special file inside the repository that     contains the rules pertaining to that repository.</p> </li> </ol> <p>And that, boys and girls, is how gitolite does its thing.  That is also why you should NEVER touch any of those files yourself, unless you know what you're doing!</p>"},{"location":"conf-2.html","title":"the \"conf\" file (<code>conf/gitolite.conf</code>)","text":"(part 2)"},{"location":"conf-2.html#access-control-rule-matching","title":"access control rule matching","text":"<p>Access control rule matching is pretty simple.  From the previous section, you know what \"permission\", \"refex\", \"user\", and \"repo\" are.  Here's how the rules are used to decide whether to allow or deny a request.</p> <p>Access is checked once only for \"read\" operations, but twice for \"write\"s.</p> <p>(Note that the <code>deny-rules</code> option, mentioned below, is explained in more detail in a later section.)</p> <p>Check #1: the first check happens as soon as gitolite-shell receives control (from sshd or httpd).  gitolite-shell will pass control to git-upload-pack or git-receive-pack only if this check succeeds.</p> <ul> <li>collect all the rules pertaining to this repo and this user</li> <li>ignore all the refexes; they don't apply to the first access check</li> <li>if the <code>deny-rules</code> option is not in effect for this repo, discard     all the <code>-</code> (deny) rules</li> <li>look at the rules in sequence:<ul> <li>if you find a <code>-</code>, access is denied</li> <li>for a \"read\" operation (clone, fetch, ...), if you find a rule     containing <code>R</code>, access is allowed</li> <li>for a \"write\" operation (push), if you find a rule containing <code>W</code>,     access is allowed</li> <li>if there are no more rules left, access is denied</li> </ul> </li> </ul> <p>Check #2: the second check only happens for \"push\" operations.  It is invoked by <code>git-receive-pack</code> running the gitolite-installed <code>update</code> hook. If access is denied, the update hook fails, and git then aborts the push for this ref.  (See <code>man githooks</code> for more.)</p> <p>In the following description, we use the word <code>operation</code> instead of <code>W</code>, because the actual operation could be a plain, fast-forward, push (<code>W</code>) or a rewind/delete (<code>+</code>).  Other, less commonly used, values are \"C\", \"D\", or \"M\"; see here.</p> <ul> <li>collect all the rules pertaining to this repo and this user</li> <li>discard all the rules where the refex does not match the ref (branch or     tag) being pushed</li> <li>look at the rules in sequence:<ul> <li>if you find a <code>-</code>, access is denied</li> <li>if you find a rule containing the operation you are performing, access     is allowed</li> <li>if there are no more rules left, access is denied</li> </ul> </li> </ul>"},{"location":"conf-2.html#an-example","title":"an example","text":"<p>Just to be clear, let's work out an example of what happens when dilbert tries to push a branch called \"xyz\".</p> <p>We'll pretend the rule list looks like this:</p> <pre>\n# managers should be able to read any repo\nrepo @all\n    R                       =   @managers\n\n# ...other rules for other repos...\n\nrepo foo bar\n\n    RW+                     =   alice @teamleads\n    -   master              =   dilbert @devteam\n    -   refs/tags/v[0-9]    =   dilbert @devteam\n    RW+ dev/                =   dilbert @devteam\n    RW                      =   dilbert @devteam\n    R                       =   @managers\n</pre> <p>After adding a default refex and expanding the supplied ones (see the refex section earlier), this is what it looks like.  We've added line numbers for convenience; we'll see why later.</p> <pre>\n 1 # managers should be able to read any repo\n 2 repo @all\n 3     R                       =   @managers\n 4 \n 5     # ...other rules for other repos...\n 6 \n 7 repo foo bar\n 8 \n 9     RW+ refs/.*             =   alice @teamleads\n10     -   refs/heads/master   =   dilbert @devteam\n11     -   refs/tags/v[0-9]    =   dilbert @devteam\n12     RW+ refs/heads/dev/     =   dilbert @devteam\n13     RW  refs/.*             =   dilbert @devteam\n14     R                       =   @managers\n</pre> <p>This represents a set of rules that are basically this:</p> <pre><code>repo    user        perm    ref                 (from line)\n\n foo     @managers  R                                3\n foo     alice      RW+      refs/.*                 9\n foo     @teamleads RW+      refs/.*                 9\n foo     dilbert    -        refs/heads/master       10\n foo     @devteam   -        refs/heads/master       10\n foo     dilbert    -        refs/tags/v[0-9]        11\n foo     @devteam   -        refs/tags/v[0-9]        11\n foo     dilbert    RW+      refs/heads/dev/         12\n foo     @devteam   RW+      refs/heads/dev/         12\n foo     dilbert    RW       refs/.*                 13\n foo     @devteam   RW       refs/.*                 13\n foo     @managers  R                                14\n</code></pre> <p>Which of these rules apply for dilbert?  We'll assume he's not a team lead, as that would defeat the whole purpose of this example!  We know he's not a manager, as that would defeat the whole purpose of the comic! Finally, we assume he's also not part of \"@devteam\", (otherwise why would you name him separately in all those lines?).</p> <p>So we discard all those rules, which leaves us, for repo \"foo\" and user \"dilbert\":</p> <pre><code>perm    ref                 (from line)\n\n-        refs/heads/master       10\n-        refs/tags/v[0-9]        11\nRW+      refs/heads/dev/         12\nRW       refs/.*                 13\n</code></pre> <p>So what happens when dilbert tries to push a branch called \"xyz\"?</p> <p>At check #1, the data gitolite has is that \"oper\" is \"W\" (and ref of course is unknown).  We discard lines 10 and 11 (the <code>deny-rules</code> option is off by default, so we ignore <code>-</code> rules).  Line 12 supplies a perm of \"RW+\", which contains \"W\" (the \"oper\") so access is allowed.</p> <p>At check #2, the data gitolite has is that \"oper\" is \"W\" and ref is <code>refs/heads/xyz</code>.  We discard the first three rules, since the ref does not match any of those refexes.  That leaves just line 13.</p> <p>If the push were a fast-forward push, the \"oper\" would be \"W\", and since it is contained in the perm for rule 13, access is allowed.</p> <p>However, if he were to try a rewind-push, then the \"oper\" would be \"+\", which is not contained in \"RW\", it wouldn't match, then control would go back for the next rule, and since there aren't any more, access would be denied.</p>"},{"location":"conf-2.html#tracing-the-access-control-decision","title":"tracing the access control decision","text":"<p>(v3.6.1) Gitolite can help you trace this logic quickly and easily. Here's one example run, with the above rules.  This one tests whether dilbert can push to repo foo (check #1).  Note that the syntax for specifying an unknown ref in this command is 'any'.</p> <pre><code>$ gitolite access -s foo dilbert W any\nlegend:\n    d =&gt; skipped deny rule due to ref unknown or 'any',\n    r =&gt; skipped due to refex not matching,\n    p =&gt; skipped due to perm (W, +, etc) not matching,\n    D =&gt; explicitly denied,\n    A =&gt; explicitly allowed,\n    F =&gt; denied due to fallthru (no rules matched)\n\n  d        gitolite.conf:10         -   refs/heads/master   =   dilbert @devteam\n  d        gitolite.conf:11         -   refs/tags/v[0-9]    =   dilbert @devteam\n  A        gitolite.conf:12         RW+ refs/heads/dev/     =   dilbert @devteam\n\nrefs/heads/dev/\n</code></pre> <p>Now see what happens when we try check #2 (we've omitted the legend in the output, since it's always the same):</p> <pre><code>$ gitolite access -s foo dilbert W xyz\n\n  r        gitolite.conf:10         -   refs/heads/master   =   dilbert @devteam\n  r        gitolite.conf:11         -   refs/tags/v[0-9]    =   dilbert @devteam\n  r        gitolite.conf:12         RW+ refs/heads/dev/     =   dilbert @devteam\n  A        gitolite.conf:13         RW  refs/.*             =   dilbert @devteam\n\nrefs/.*\n</code></pre> <p>And if you try a force push:</p> <pre><code>$ gitolite access -s foo dilbert + refs/heads/xyz\n\n  r        gitolite.conf:10         -   refs/heads/master   =   dilbert @devteam\n  r        gitolite.conf:11         -   refs/tags/v[0-9]    =   dilbert @devteam\n  r        gitolite.conf:12         RW+ refs/heads/dev/     =   dilbert @devteam\n  p        gitolite.conf:13         RW  refs/.*             =   dilbert @devteam\n  F           (fallthru)\n\n+ refs/heads/xyz foo dilbert DENIED by fallthru\n</code></pre> <p>I hope that was useful!  Be sure you correlated the output of 'gitolite access -s' with the rule workflow pictures and corresponding descriptions to cement your understanding.</p>"},{"location":"conf-2.html#read-access-respecting-deny-rules","title":"read access respecting deny rules","text":"<p>Normally, deny rules are ignored by access check #1 (the one that runs before git-upload-pack or git-receive-pack is called by gitolite-shell); they apply only to check #2 (the update hook check).</p> <p>But sometimes you want this \"pre-git\" access check to respect deny rules; i.e., use the flow of check #2, not check #1.  You tell gitolite to do this by setting the \"deny-rules\" option for the repo; when you do that, the flow of check #2 is used for both stages, before git and in the update hook.</p>"},{"location":"conf-2.html#example-1","title":"example 1","text":"<p>Here's an example. Here, we have lots of repos, which should all be accessible by gitweb or daemon, so we want the convenience provided by lines 6 and 7 (we don't want to put line 7 in each repo).  However, we also have some secret repos (maybe the gitolite-admin repo and some others that we will list), which we want to prevent gitweb or daemon from seeing.</p> <p>How do we do that?</p> <p>The naive approach -- putting in a deny rule just for those repos -- doesn't work.  In fact nothing else seems to work either; you'll have to replace the <code>@all</code> with an exhaustive list of all repos other than the secret repos.</p> <pre>\n1 @secret = gitolite-admin secret-repo/..*\n2 repo @secret\n3     -   =   gitweb daemon\n4 \n5 \n6 repo @all\n7     R   =   gitweb daemon\n8 \n9 # ...other repos and rules...\n</pre> <p>That's... painful!</p> <p>What you really want is for that repo to always use check #2, even when it doesn't actually have a ref to test for.</p> <pre>\n1 @secret = gitolite-admin secret-repo/..*\n2 repo @secret\n3     -   =   gitweb daemon\n4     option deny-rules = 1\n5 \n6 repo @all\n7     R   =   gitweb daemon\n8 \n9 # ...other repos and rules...\n</pre> <p>This is done by adding one line, line 4 in this example.  This sets a gitolite \"option\" that says you want \"deny rules\" to be applicable even for read access.</p> <p>Once you do that, all you need to do is to ensure that the first rule encountered by these two \"users\" for those repos is a deny rule, so that it can take effect first.  In this example, the placement of lines 2, 3 vis-a-vis lines 6, 7 matters -- don't switch them!</p>"},{"location":"conf-2.html#example-2","title":"example 2","text":"<p>In this example the \"open\" repos are fewer in number, so it is the opposite situation to the above in terms of our ability to enumerate all the repos.</p> <pre>\n@open = git gitolite foss/..* [...]\n\nrepo @all\n    -   =   gitweb daemon\n    option deny-rules = 1\n\nrepo @open\n    R   =   gitweb daemon\n    option deny-rules = 0\n</pre> <p>To see why this works, you need to understand that for options and config lines, a later setting overrides earlier ones.  So we set it to 1 for all repos, then selectively set it to 0 for some.</p> <p>This means the \"deny-rules\" option applies to all the repos except the \"open\" repos, and so the first rule encountered by gitweb and daemon is a deny rule, so they are denied read access.  The \"open\" repos, on the other hand, get the normal default behaviour, which is to ignore deny rules for read access, and thus they only see the \"R\" permission.</p>"},{"location":"conf-2.html#appendix-1-different-types-of-write-operations","title":"appendix 1: different types of write operations","text":"<p>Git supplies enough information to the update hook to be able to distinguish several types of writes.</p> <p>The most common are:</p> <ul> <li><code>RW</code> -- create a ref or fast-forward push a ref.  No rewinds or deletes.</li> <li><code>RW+</code> -- create, fast-forward push, rewind push, or delete a ref.</li> </ul> <p>Sometimes you want to allow people to push, but not create a ref.  Or rewind, but not delete a ref.  The <code>C</code> and <code>D</code> qualifiers help here.</p> <ul> <li> <p>If a rule specifies <code>RWC</code> or <code>RW+C</code>, then rules that do NOT have the C     qualifier will no longer permit creating a ref in that repo.</p> <p>Please do not confuse this with the standalone <code>C</code> permission that allows someone to create a repo</p> </li> <li> <p>If a rule specifies <code>RWD</code> or <code>RW+D</code>, then rules that do NOT have the D     qualifier will no longer permit deleting a ref in that repo.</p> </li> </ul> <p>Note: These two can be combined, so you can have <code>RWCD</code> and <code>RW+CD</code> as well.</p> <p>One very rare need is to reject merge commits (a commit series that is not a straight line of commits).  The <code>M</code> qualifier helps here:</p> <ul> <li>When a rule has <code>M</code> appended to the permissions, rules that do NOT have     it will reject a commit sequence that contains a merge commit (i.e., they     only accept a straight line series of commits).</li> </ul>"},{"location":"conf-2.html#summary-of-permissions","title":"summary of permissions","text":"<p>The full set of permissions, in regex syntax, is <code>-|R|RW+?C?D?M?</code>.  This expands to one of <code>-</code>, <code>R</code>, <code>RW</code>, <code>RW+</code>, <code>RWC</code>, <code>RW+C</code>, <code>RWD</code>, <code>RW+D</code>, <code>RWCD</code>, or <code>RW+CD</code>, all but the first two optionally followed by an <code>M</code>.</p>"},{"location":"conf-2.html#appendix-2-gitolite-access-check-flow","title":"appendix 2: gitolite access check flow","text":"<p>Here's lots more detail on the access check process, with flow diagrams.</p> <p>When do the access checks happen and what are the four pieces of data (repo, user, operation, ref) in each case?</p> read write <p>In these pictures the access checks are marked in yellow.</p> <p>The picture on the left is for a read (git clone, fetch, ls-remote).  There is only one access check for a read operation.  If access is denied, the operation aborts.  Otherwise, gitolite-shell invokes git-upload-pack.</p> <p>Notice the information available to the access check.  The \"oper\" (operation) is \"R\", indicating a read operation.  The \"ref\" is listed as \"unknown\", although we could also call it \"irrelevant\"!</p> <p>Access check #1 proceeds with those 4 bits of information, and either passes or fails.  If it passes, gitolite passes control to \"git-upload-pack\" and its job is done.</p> <p>The flow for a push operation (the picture on the right) is very similar upto the first access check. The \"oper\" is \"W\" now, although the \"ref\" is still unknown. Even though this is a push, at this stage in the protocol nothing on the server knows what branch or tag or combination of them are coming down the wire, since we haven't executed git-receive-pack yet!</p> <p>If it succeeds, gitolite passes control to \"git-receive-pack\", but its job is not done yet.  Git will eventually invoke the update hook (see 'man githooks'). Gitolite has already grabbed this hook, which receives from git the ref name being pushed, as well as enough information to compute whether this push is a \"fast-forward push\" or a \"rewind push\".  Based on this, gitolite sets the \"oper\" field to \"W\" or \"+\", respectively.</p> <p>Access check #2 proceeds with this information.  The result is sent back to git-receive-pack (in the form of an exit code; again, see 'man githooks'), and the push fails or succeeds based on that.</p>"},{"location":"conf-2.html#putting-it-all-together","title":"putting it all together","text":"<p>At this point, we have the following pieces of information:</p> <ul> <li> <p>A set of rules, each containing 4 pieces of data: repo, user, perm, refex.     They are in the sequence they were found in the conf file.</p> <p>We discard all rules that do not apply to this repo and this user, which means our set of rules have only two fields: perm, refex.</p> <p>As a quick reminder, perm is one of R, RW, RW+, or <code>-</code>.</p> </li> <li> <p>Four elements that make up the access being attempted: repo, user, oper,     ref.</p> <p>Again, as a reminder, the \"oper\" is one letter.  For \"check #1\" it is either R or W, and for check #2 it can be W or +.</p> </li> </ul> <p>Note on permissions and \"oper\": there are other types of permissions, but for our discussion these are enough.  The others are rare, and anyway it is easy to extrapolate to them.</p> <p>With that background, here's the flow.  The one on the left is for check #1 (ref is unknown) while the one on the right is for check #2 (ref is known).</p> ref unknown ref known <p>As you can see, deny rules are ignored by check #1 -- they're not tested in any way.  For check #2, if there is a deny rule whose refex matched the ref, access is denied (as you'd expect).</p>"},{"location":"conf-2.html#appendix-3-embedding-test-code-in-your-conf","title":"appendix 3: embedding test code in your conf","text":"<p>As of v3.6.7, it is possible to embed test code within gitolite.conf.  This can be useful if your conf file is complicated, and you need a way to make sure that any changes are not messing with your most important restrictions.</p> <p>Full details, including preparation and caveats, are in <code>contrib/utils/testconf</code>, but here's a teaser example:</p> <pre><code>repo foo\n    RW+     =   u1\n    RW      =   u2\n\n=begin testconf\ngitolite access -q foo u1 + any || echo FAILED\ngitolite access -q foo u2 + any &amp;&amp; echo FAILED\ngitolite access -q foo u2 W any || echo FAILED\n=end\n</code></pre>"},{"location":"conf.html","title":"the \"conf\" file (<code>conf/gitolite.conf</code>)","text":"(part 1) <p>You might recall from the basic administration page that this file is part of the gitolite-admin repo.  You need to clone that repo, make and commit changes to this file, and push the commits back.</p> <p>The <code>conf/gitolite.conf</code> file (often called just \"the conf file\" for short) is one of the two most important files in gitolite.  It specifies repo names and access rules, as well as repo options of various kinds and git-config values.</p> <p>Pretty much all day-to-day management, except managing users, happens from this file.</p> <p>We'll use the following example to describe it's features.  (A tip of the hat to Teemu Matilainen's gitolite vim-syntax file for the colors.)</p> <pre>\n@staff              =   dilbert alice           # groups\n@projects           =   foo bar\n\nrepo @projects baz                              # repos\n    RW+             =   @staff                  # rules\n    -       master  =   ashok\n    RW              =   ashok\n    R               =   wally\n\n    option deny-rules           =   1           # options\n    config hooks.emailprefix    = '[%GL_REPO] ' # git-config\n</pre>"},{"location":"conf.html#basic-syntax","title":"basic syntax","text":"<p>As the example above shows, the syntax is fairly straightforward and simple.</p> <ul> <li>In general, everything is space separated; there are no commas,     semicolons, etc., in the syntax.</li> <li>Comments are in the usual shell-ish style.</li> <li>User names and repo names are as simple as possible; they must     start with an alphanumeric, but after that they can also contain <code>.</code>, <code>_</code>,     or <code>-</code>. Usernames can optionally be followed by an <code>@</code> and a domainname     containing at least one <code>.</code> (this allows you to use an email address as     someone's username).</li> <li>Group names are like simple usernames (i.e., not email addresses) but     start with an <code>@</code> sign.</li> <li>Reponames can contain <code>/</code> characters (this allows you to put your repos in     a tree-structure for convenience).</li> <li>There are no continuation lines by default.  You do not need them; the     section on groups will tell you how you can break up large lists of     names in a group definition into multiple lines. (But if you must     have them, you can optionally enable them; look for \"continuation-lines\"     in <code>~/.gitolite.rc</code>).</li> </ul>"},{"location":"conf.html#include-files","title":"include files","text":"<p>Gitolite allows you to break up the configuration into multiple files and include them in the main file for convenience.  For example:</p> <pre><code>include \"foo.conf\"\n</code></pre> <p>will include the contents of the file \"conf/foo.conf\".</p> <ul> <li> <p>You can also use a glob (<code>include \"*.conf\"</code>), or put your include files     into subdirectories of \"conf\" (<code>include \"foo/bar.conf\"</code>), or both     (<code>include \"repos/*.conf\"</code>).</p> </li> <li> <p>Included files are always searched from the gitolite-admin repo's <code>conf/</code>     directory, unless you supplied an absolute path.  (Note: in the interests     of cloning the admin-repo sanely you should avoid absolute paths!)</p> </li> <li> <p>If you end up recursing, files that have been already processed once are     skipped, with a warning.</p> </li> <li> <p>It is not a fatal error for an include file to be missing.  If it is a     glob, you won't even get a warning.</p> </li> </ul> <p>Advanced users: <code>subconf</code>, a command that is very closely related to <code>include</code>, is documented here.</p> <p>Please note that whenever you see \"the <code>conf/gitolite.conf</code> file\" or \"the conf file\" in gitolite documentation, it means the combined text after the include processing is done.</p>"},{"location":"conf.html#group-definitions","title":"group definitions","text":"<p>You can group repos or users for convenience.  The syntax is the same for both and does not distinguish; until you use the group name it could really be either.</p> <p>Here's an example:</p> <pre>\n@developers     =   dilbert alice wally\n</pre> <p>Group definitions accumulate; this is the same as the above:</p> <pre>\n@developers     =   dilbert\n@developers     =   alice\n@developers     =   wally\n</pre> <p>You can use one group in another group definition; the values will be expanded immediately (meaning later additions will not appear in the second group):</p> <pre>\n@developers     =   dilbert alice\n@interns        =   ashok\n@staff          =   @interns @developers\n@developers     =   wally\n\n# wally is NOT part of @staff\n</pre> <p>Here's a very simple but complete example of using groups:</p> <pre>\n@developers     =   dilbert alice wally\n@foss-repos     =   git gitolite\n\nrepo @foss-repos\n    RW+         =   @developers\n</pre>"},{"location":"conf.html#special-group-all","title":"special group <code>@all</code>","text":"<p><code>@all</code> is a special group name that is often convenient to use if you really mean \"all repos\" or \"all users\".</p>"},{"location":"conf.html#warnings-on-undefined-groups","title":"warnings on undefined groups","text":"<p>Gitolite cannot truly catch undefined groups because the conf parser is 1-pass, and you're allowed to define a group after it is used, like so:</p> <pre>\nrepo foo\n    RW  =   @foo\n@foo = u1 u2\n</pre> <p>(v3.5.3+) However, in a simplistic attempt to help people tearing their hair out because of a typo, gitolite will warn if a group is not defined when it is used.  So if you defined it later, either ignore the warning or move the definition up.</p> <p>Note that these warnings do NOT appear if you're getting user group info from LDAP.</p>"},{"location":"conf.html#getting-user-group-info-from-ldap","title":"getting user group info from LDAP","text":"<p>Gitolite's groups are pretty convenient, but some organisations already have similar (or sufficient) information in their LDAP store.</p> <p>Gitolite can tap into that information, with a little help.  Write a program which, given a username, queries your LDAP store and returns a space-separated list of groups that the user is a member of.  Then put the full path to this program in an rc variable called <code>GROUPLIST_PGM</code>, like so:</p> <pre><code>GROUPLIST_PGM           =&gt;  '/home/git/bin/ldap-query-groups',\n</code></pre> <p>Now you can use those groupnames in access rules in gitolite, because the user is a member of those groups as well as any normal gitolite groups you may have added him to in the conf file.</p> <p>Caution: your program must do its own logging if you want the audit trail of \"why/how did this user get access to this repo at this time?\" to resolve properly.  Gitolite does not do any logging of the results of the queries because for people who don't need it that would be a huge waste.</p>"},{"location":"conf.html#access-rules","title":"access rules","text":"<p>Some of the pictures are thanks (enormous thanks!) to someone who contributed them but does not want to be named (go figure!).  She even converted them to ditaa format when I asked; these are not as pretty as what she sent me originally but they're vim-editable in source form :-)</p> <p>This section talks about how gitolite's access rules work.  It's a very important section, and well worth spending some time on.</p> <p>Gitolite's access rules are designed to be easy to use for common situations, such as some of the examples you saw earlier.  However, they also pack a lot of power and flexibility.</p> <p>Access rules decide whether a particular access is allowed or denied.  An access is defined by four pieces of data: \"reponame, username, operation, and ref\".  Each rule also has four similar pieces of data, and of course there are several rules -- some people have thousands! -- in the conf file. This section will try and explain how these rules are used to decide if a given operation is to be allowed or denied.</p>"},{"location":"conf.html#what-does-a-rule-look-like","title":"what does a rule look like?","text":"<p>You've seen some simple rules so far, for example in the basic administration page.  Here's a slightly more complex one, just for illustration.</p> <pre>\nrepo foo bar\n\n    RW+                     =   alice @teamleads\n    -   master              =   dilbert @devteam\n    -   refs/tags/v[0-9]    =   dilbert @devteam\n    RW+ dev/                =   dilbert @devteam\n    RW                      =   dilbert @devteam\n    R                       =   @managers\n</pre> <p>A \"repo\" line names one or more repos, and is followed by one or more rule lines. All the rules from then till the next \"repo\" line apply to the repo(s) specified in the repo line -- in this example, the 'foo' and 'bar' repos.  If there are no rule, config, or option lines before the next \"repo\" line, the repo line is silently ignored.</p> <p>Each rule line has a \"permission\" field, zero or more \"refex\"es, and one or more user or user group name after the equal sign.</p> <p>The \"repo\" line can also have repo groups, as we have seen in the section on groups above.  Also, it can have regular expressions that match multiple repos.</p> <p>Before describing the various fields more formally, here's a description of what this specific rule list is saying:</p> <ul> <li> <p>alice and the team leads can do whatever they want (i.e., push, rewind, or     delete any branch or tag).</p> </li> <li> <p>dilbert and the dev team has these restrictions</p> <ol> <li>they can do anything to branches whose names start with \"dev/\"</li> <li>they can create or fast-forward push, but not rewind or delete, any     branch except master</li> <li>they can create (but not update/delete) any tag except tags starting     with \"v\" followed by a digit.</li> </ol> </li> <li> <p>managers can read the repo but they can't push anything.</p> </li> </ul> <p>More formally, a rule line has the following fields:</p>"},{"location":"conf.html#the-permission-field","title":"the permission field","text":"<p>The permission field gives the type of access this rule line permits. The most commonly used permissions are:</p> <ul> <li>R, to allow read operations only</li> <li>RW, to allow fast-forward push of a branch, or create new branch/tag</li> <li>RW+, to allow pretty much anything -- fast-forward, rewind or delete     branches or tags</li> <li><code>-</code> (the minus sign), to deny access.</li> </ul> <p>There are also other, less commonly used, types of permissions.</p>"},{"location":"conf.html#the-refex-field","title":"the \"refex\" field","text":"<p>You cannot write rules for all possible branch and tag names (i.e., refs) that users will push.  The only sensible way to do this is to use regular expressions instead.</p> <p>A refex is a word I made up to mean \"a regex that matches a ref\".</p> <p>In addition:</p> <ul> <li> <p>If no refex is supplied, it defaults to <code>refs/.*</code>, for example in a rule     like this:</p> <pre><code>RW              =   alice\n</code></pre> </li> <li> <p>A refex not starting with <code>refs/</code> (or <code>VREF/</code>) is assumed to     start with <code>refs/heads/</code>.  This means normal branches can be conveniently     written like this:</p> <pre><code>RW  master      =   alice\n# becomes 'refs/heads/master' internally\n</code></pre> <p>while tags will need to be fully qualified</p> <pre><code>RW  refs/tags/v[0-9]    =   bob\n</code></pre> </li> <li> <p>A refex is implicitly anchored at the start, but not at the end.  In     regular expression lingo, a <code>^</code> is assumed at the start (but no <code>$</code> at the     end is assumed).  So a refex of <code>master</code> will match all these refs:</p> <pre><code>refs/heads/master\nrefs/heads/master1\nrefs/heads/master2\nrefs/heads/master/full\n</code></pre> <p>More commonly, a refex of <code>refs/tags/v[0-9]</code> will match all versioned tags (i.e., not just <code>v1</code> but also <code>v12</code>, <code>v1.2</code>, <code>v12345</code>, etc.)</p> <p>If you want to restrict the match to just the one specific ref, add a $ at the end, for example:</p> <pre><code>RW  master$     =   alice\n</code></pre> </li> </ul> <p>You can also use virtual refs to perform extra checks and controls that you can't do with just the normal ref (like refs/heads/master) being pushed.  The most common example is restricting pushes by dir/file name, but there are lots of other possibilities.</p>"},{"location":"conf.html#useruser-group-list","title":"user/user group list","text":"<p>Like the repos on the repo line, you can have any number of user names and/or user group names on the rule line.  (However, please note that there is no concept of regular expressions for user names).</p> <p>SECTION SUMMARY: at this point you know that each rule basically specifies a repo, user, permission, and a \"refex\".</p>"},{"location":"conf.html#rule-accumulation","title":"rule accumulation","text":"<p>All the rules for a repo need not be specified in one place.  For example, you might see something like this, perhaps at the top or bottom of the conf file:</p> <pre>\n# managers should be able to read any repo\nrepo @all\n    R   =   @managers\n</pre> <p>or perhaps this:</p> <pre>\n# anyone can clone open source repos\nrepo @FOSS\n    R   =   @all\n</pre> <p>Clearly, both these constructs affect repos which may have their own rules elsewhere.</p> <p>If a bunch of projects share some naming convention, you can specify any rules that are common to all of them by specifying the set of repos that are affected as a regular expression.  Notice that the regex can be defined directly in the repo line, or it can be defined in a group and the group used in the repo line; it's all the same to gitolite.</p> <pre>\nrepo FOSS/..*\n    # ...rules for repos under FOSS/\n\n@secret     =   secret/..* private/..*\nrepo @secret\n    # ...rules for repos under secret/ and private/\n</pre> <p>Finally, although not very common, you can certainly do things like this:</p> <pre>\nrepo foo\n    # ...some rules...\n\n# ...other repos and rules...\n\nrepo foo\n    # ...more rules for foo...\n</pre> <p>Note that the \"other repos and rules\" may indirectly include repo \"foo\" (for example it there were rules for \"repo @all\", or some other group that \"foo\" was a member of).</p> <p>When access is being checked for an operation against a repo, all the rules that pertain to that repo are collected, in the order they were seen in the conf file.</p> <p>Gitolite then discards those rules that do not apply to the user whose access is being checked.  (A rule applies to a user if the user's name appears in the rule (after the equal sign), or if he is a member of any of the group names that appear in the rule.)</p>"},{"location":"conf.html#defining-user-and-repo","title":"defining \"user\" and \"repo\"","text":"<p>To be very specific, when we speak of \"user\" and \"repo\" in rules,</p> <ul> <li>\"user\" means \"user or a group that he/she is a member of\", and</li> <li>\"repo\" means \"repo, or a group that it is a member of, or a regex that     matches it, or a group that contains a regex that matches it\".</li> </ul>"},{"location":"cookbook.html","title":"gitolite cookbook","text":"(a.k.a. \"stop all that rambling and just tell me what I need to do!\") <p>Documentation is meant to be as complete as possible, which means it attempts to cover all situations and scenarios.  That makes it harder to read.</p> <p>However, if you make some assumptions, remove the rationale, justification, exceptions and special cases, etc., and generally just say what is to be done rather than explain why, many tasks can be described very easily.</p> <p>Or, if the main documentation already does that, a cookbook may help you find it faster, simply because it's organised differently.</p> <p>Maybe this will help.  If you run into problems, please check the main documentation before asking for help.</p>"},{"location":"cookbook.html#administration","title":"administration","text":""},{"location":"cookbook.html#separating-key-admin-from-repo-admin","title":"separating \"key admin\" from \"repo admin\"","text":"<p>In gitolite, the person who controls the keys is the most critical in terms of security -- because he can always add his own key in your name :-)</p> <p>Traditionally, the same person also administers repos and permissions.  But sometimes you want to separate them.</p> <p>To separate those roles, put the following in conf/gitolite.conf, and let the repo-manager manage everything through \"actual.conf\":</p> <pre>\nrepo gitolite-admin\n    RW+ = key-manager repo-manager\n\n    RW+ VREF/NAME/                    = key-manager\n    -   VREF/NAME/keydir/             = @all\n    -   VREF/NAME/conf/gitolite.conf  = @all\n\ninclude \"actual.conf\"\n</pre>"},{"location":"cookbook.html#access","title":"access","text":""},{"location":"cookbook.html#looking-up-repo-access-from-external-tools","title":"looking up repo access from external tools","text":"<p>There are two supported interfaces for this, one in perl and one in shell. Other languages should probably use the shell mode.  (The shell mode has a very convenient \"batch\" mode if you need to check many repos at once).</p> <p>Perl interface: A good intro to this, including a link to code, using gitweb as an example can be found by looking for 'repo-specific authorisation in gitweb' in the page on allowing access to gitweb and git-daemon. Some notes:</p> <ul> <li>be sure to read the comments in the code to learn exactly how to adapt it     to your needs</li> <li>in place of the <code>can_read</code> function in that code, you can of course use     <code>can_write</code>.  In fact, reading the comments in \"Easy.pm\" (look for it in     the source) shows you several other interesting tests you can make, like     <code>is_admin</code>, <code>in_group</code>, and <code>owns</code>.</li> </ul> <p>Shell interface: If you want to do this from shell, it's even easier. The same \"Easy.pm\" source contains comments that show shell equivalents for each of the functions it exports, but here's a sample:</p> <pre><code>if gitolite access -q reponame username W\nthen\n    ...\n</code></pre> <p>You can even test for access to specific branches:</p> <pre><code>if gitolite access -q reponame username W master\nthen\n    ...\n</code></pre> <p>If your gitolite is older than v3.6, you must use the full ref name; just 'master' won't do.</p>"},{"location":"cookbook.html#allowing-access-by-other-programs","title":"allowing access by other programs","text":"<p>Giving external tools (like apache) access to gitolite repositories involves making sure that the unix owner/group and permissions settings allow this. This is all described in the UMASK section in the page on the rc file, because that's the only setting that gitolite controls; every thing else is pure Unix.</p>"},{"location":"cookbook.html#commands","title":"commands","text":""},{"location":"cookbook.html#adding-your-own-commands","title":"adding your own commands","text":"<p>To add a command, say <code>foo</code>, do this:</p> <ol> <li> <p>add this line in the rc file, within the <code>%RC</code> block, if it's not already     present, or uncomment it if it's already present and commented out:</p> <pre><code>LOCAL_CODE =&gt; \"$ENV{HOME}/local\",\n</code></pre> </li> <li> <p>copy the program <code>foo</code> into <code>$HOME/local/commands</code>.  (Don't forget the     <code>chmod +x</code>!)</p> </li> </ol>"},{"location":"cookbook.html#making-commands-available-to-remote-users","title":"making commands available to remote users","text":"<p>Once you do the above, <code>foo</code> is available as <code>gitolite foo</code>.  To make it available to remote users (as <code>ssh git@host foo</code>), add the line:</p> <pre><code>`foo`,\n</code></pre> <p>(including the comma at the end) to the ENABLE list in the rc file.</p>"},{"location":"cookbook.html#hooks","title":"hooks","text":"<p>Note: the main documentation for this feature starts here.</p>"},{"location":"cookbook.html#adding-your-own-update-hooks","title":"adding your own update hooks","text":"<p>You have some update hooks (for example crlf checking) that you want to include in gitolite.  Assuming the hook itself is tested and works as a normal git update hook does (i.e., conforms to what <code>man githooks</code> says an update hook should do), here's how to do this:</p> <ol> <li> <p>add this line in the rc file, within the <code>%RC</code> block, if it's not already     present, or uncomment it if it's already present and commented out:</p> <pre><code>LOCAL_CODE =&gt; \"$ENV{HOME}/local\",\n</code></pre> </li> <li> <p>copy your update hook to a subdirectory called VREF under this directory,     giving it a suitable name (let's say \"crlf\"):</p> <pre><code># log on to gitolite hosting user on the server, then:\ncd $HOME\nmkdir -p local/VREF\ncp your-crlf-update-hook local/VREF/crlf\nchmod +x local/VREF/crlf\n</code></pre> </li> <li> <p>in your gitolite-admin clone, edit conf/gitolite.conf and     add lines like this:</p> <pre><code>    -   VREF/crlf       =   @all\n</code></pre> <p>to each repo that should have that \"update\" hook.</p> <p>Alternatively, you can simply add this at the end of the gitolite.conf file:</p> <p><pre>\nrepo @all\n    -   VREF/crlf       =   @all\n</pre></p> <p>Either way, add/commit/push the change to the gitolite-admin repo.</p> </li> </ol>"},{"location":"cookbook.html#adding-other-non-update-hooks","title":"adding other (non-update) hooks","text":"<p>Say you want other hooks, like a post-receive hook.  Here's how:</p> <ol> <li> <p>add this line in the rc file, within the <code>%RC</code> block, if it's not already     present, or uncomment it if it's already present and commented out:</p> <pre><code>LOCAL_CODE =&gt; \"$ENV{HOME}/local\",\n</code></pre> </li> <li> <p>put your hooks into that directory, in a sub-sub-directory called     \"hooks/common\":</p> <pre><code># log on to gitolite hosting user on the server, then:\ncd $HOME\nmkdir -p local/hooks/common\ncp your-post-receive-hook local/hooks/common/post-receive\nchmod +x local/hooks/common/post-receive\n</code></pre> </li> <li> <p>run <code>gitolite setup</code> to have the hooks propagate to existing repos (repos     created after this will get them anyway).</p> </li> </ol>"},{"location":"cookbook.html#variation-maintain-these-hooks-in-the-gitolite-admin-repo","title":"variation: maintain these hooks in the gitolite-admin repo","text":"<p>Important security note:</p> <p>If you enable this, anyone who can push changes to the admin repo will effectively be able to run any arbitrary command on the server.  See gitolite admin and shell access for more background.</p> <p>If you want to maintain these update hooks (VREFs) or non-update hooks (post-update, pre-receive, post-receive) in the gitolite-admin repo, instead of having to log on to the server and make changes, the procedure is almost the same except for the following differences:</p> <ol> <li> <p>add this line in the rc file, within the <code>%RC</code> block, if it's not already     present, or uncomment it if it's already present and commented out:</p> <pre><code>LOCAL_CODE =&gt; \"$rc{GL_ADMIN_BASE}/local\",\n</code></pre> <p>Notice \"local\" is not in <code>$HOME</code> like in the previous examples!</p> </li> <li> <p>the hooks/scripts are to be added inside your gitolite-admin clone, not on     the server.  That is, whereever the above two sections say <code>cd $HOME</code>,     you should read it as \"cd /path/to/your/gitolite-admin-clone\".</p> <p>(The directory <code>local</code> will be within this clone of course, not in <code>$HOME</code>.)</p> </li> <li> <p>add/commit/push as usual.</p> </li> </ol> <p>For update hooks, you will of course need to add VREF rule lines to appropriate repos in the conf file.  For non-update hooks, you don't need to run 'gitolite setup' on the server; the push takes care of that.</p>"},{"location":"cookbook.html#v36-variation-repo-specific-hooks","title":"(v3.6+) variation: repo-specific hooks","text":"<p>Until now, the non-update hooks you specified apply to all repos.  Here's how to apply them only to certain repos:</p> <ol> <li> <p>add this line in the rc file, within the <code>%RC</code> block, if it's not already     present, or uncomment it if it's already present and commented out:</p> <pre><code>LOCAL_CODE =&gt; \"$rc{GL_ADMIN_BASE}/local\",\n</code></pre> </li> <li> <p>uncomment the 'repo-specific-hooks' line in the rc file or add it to the     ENABLE list if it doesn't exist.</p> <p>If your rc file does not have an ENABLE list, you need to add this to the POST_COMPILE and the POST_CREATE lists.  Click here for more on all this.</p> </li> <li> <p>put your hooks into your gitolite-admin clone, as follows:</p> <pre><code># on your workstation\ncd /path/to/your/gitolite-admin-clone\nmkdir -p local/hooks/repo-specific\n</code></pre> <p>Now add your hooks to that directory, but instead of using the git \"standard\" names (pre-receive, post-receive, post-update), you use descriptive names (e.g. \"deploy\", \"RSS-post\", etc).</p> <p>For pre-receive or pre-auto-gc you should not use more than one hook. If you really need more than one, ask on the mailing list.</p> </li> <li> <p>add them to the repos you want them to be active in, in your conf file.     For example:</p> <pre><code>repo foo\n    option hook.post-update     =   jenkins\nrepo bar @baz\n    option hook.post-update     =   deploy RSS-post\n</code></pre> </li> <li> <p>add, commit, and push the admin repo.</p> </li> </ol>"},{"location":"cookbook.html#triggers","title":"triggers","text":""},{"location":"cookbook.html#adding-your-own-triggers","title":"adding your own triggers","text":"<p>First, write your trigger code, using the documentation here. Note especially the sections \"common arguments\" and \"trigger-specific arguments\".  Look in the shipped triggers for ideas.</p> <p>Note:</p> <p>If your trigger is a perl module, as opposed to a standalone script or executable, please see the section on adding a perl module as a trigger.</p> <p>Let's say your trigger is called <code>foo</code>, and it will be a <code>PRE_GIT</code> trigger.</p> <ol> <li> <p>add this line in the rc file, within the <code>%RC</code> block, if it's not already     present, or uncomment it if it's already present and commented out:</p> <pre><code>LOCAL_CODE =&gt; \"$ENV{HOME}/local\",\n</code></pre> </li> <li> <p>copy the program <code>foo</code> into <code>$HOME/local/triggers</code>.  (Don't forget the     <code>chmod +x</code>!)</p> </li> <li> <p>edit <code>~/.gitolite.rc</code> again, and look for a <code>PRE_GIT</code> section.  If it     exists, add <code>'foo',</code> (note the trailing comma!) to it.  If it does not     exist, add this block just before the <code>ENABLE</code> section:</p> <pre><code>PRE_GIT =&gt;\n[\n    'foo'\n],\n</code></pre> <p>(again, note the trailing comma at the end of the block!)</p> <p>After saving the file, test that this worked by running <code>gitolite query-rc PRE_GIT</code>; your <code>foo</code> should be in the output list.  If it's not, back up and double check your work.</p> </li> </ol> <p>That should be it.</p>"},{"location":"cookbook.html#vrefs","title":"VREFs","text":""},{"location":"cookbook.html#adding-your-own-vrefs","title":"adding your own VREFs","text":"<p>Adding VREFs is the same as adding the update hook, so please see the section on \"adding your own update hooks\" above.</p>"},{"location":"cookbook.html#example-vrefs","title":"example VREFs","text":"<p>However, writing a proper VREF is not the same as writing a normal git \"update hook\".  A proper VREF does more than just take 3 arguments, do something, and exit with a non-zero exit code for failure.</p> <p>A VREF is called with at least 4 more arguments after the 3 that git itself defines for an update hook, plus usually at least one or two more.  It also returns a lot more meaningful results via STDOUT.</p> <p>Here are some examples.  I also advise you to keep a browser tab open to the doc on VREF arguments as you look at these.</p> <p>Important:</p> <p>VREFs only come into play for push operations.  When we say \"access\" in this section, we mean only write access.  If you want to restrict it even for reads, you can do this in a <code>PRE_GIT</code> trigger; there's an example in <code>contrib/triggers/IP-check</code> in the gitolite source tree that may be useful as a template.</p>"},{"location":"cookbook.html#example-1-restricting-by-day-of-week","title":"example 1: restricting by day of week","text":"<p>Here's the conf extract to say \"junior devs can only push on weekdays\":</p> <pre>\nrepo foo\n    -   VREF/DAY/Sat    =   @junior-devs\n    -   VREF/DAY/Sun    =   @junior-devs\n</pre> <p>The code for this VREF is ridiculously simple:</p> <pre>\n#!/bin/bash\necho VREF/DAY/`date +%a`\n</pre> <p>On encountering the VREF rules (i.e., when a junior dev tries to push to this repo), gitolite calls the \"DAY\" VREF-maker.  The code within the VREF maker simply echoes something like \"VREF/DAY/Mon\", where the last part is whatever the actual day of the week happens to be.</p> <p>This output is then treated as a virtual ref and matched against the rules. On a Monday to Friday, nothing happens, because the VREFs generated do not match any deny rules (or indeed any rules at all).  On weekends, they do match, and the push is denied.</p>"},{"location":"cookbook.html#example-2-restricting-by-source-ip-address","title":"example 2: restricting by source IP address","text":"<p>This one restricts junior developers to push to this repo only from a specific network block.  The conf file here is slightly different.  We know that the VREF-maker will return with some network address (as you'll see in the code later), so we set it up so that the correct network block is allowed and anything else is disallowed:</p> <pre>\nrepo foo\n    RW+ VREF/FROM/192.168.48.0/23   =   @junior-devs\n    -   VREF/FROM                   =   @junior-devs\n</pre> <p>The code is not that complex.  We take the user's actual IP address (this is available as the first word in <code>$SSH_CONNECTION</code> for ssh users, and for smart-http users, gitolite fakes it and creates that variable!).  We then treat the \"23\" in the VREF rule, which appears to the code as <code>$9</code>, as the number of bits in the network address, then compute the network address for the users IP with that number of bits.</p> <p>This network address is then sent back.  (The <code>$9</code> is added back at the end, but this is only to enable it to match the VREF rule).</p> <pre>\n#!/bin/bash\n\n# exit if no arguments were supplied to the VREF.  This covers the\n# second VREF rule in the conf above\n[ -n \"$8\" ] || exit 0\n\nfrom=${SSH_CONNECTION%% *}\n\neval `ipcalc -n $from/$9`       # sets env var \"NETWORK\"\n\necho VREF/FROM/$NETWORK/$9\n</pre> <p>For a source IP of 192.168.49.97, this runs <code>ipcalc -n 192.168.49.97/23</code>, which gives the network address 192.168.48.0.  The echo then just sends back VREF/FROM/192.168.48.0/23.  This VREF matches the RW+ line.</p> <p>But if the IP is, say, 192.168.45.67, running <code>ipcalc -n 192.168.45.67/23</code> gives you 192.168.44.0.  The echo then send back VREF/FROM/192.18.44.0/23, which won't match the RW+ line, but will match the next one and thus deny the push.</p> <p>(One thing that may not be obvious in this specific example is that you have to be careful when constructing the VREF rule.  For any VREF/FROM/A/B, the result of running <code>ipcalc -n A/B</code> must be A, otherwise this won't work.  That is, the bits of the network address after the network bits must be zero).</p>"},{"location":"cookbook.html#wild-repos","title":"wild repos","text":""},{"location":"cookbook.html#making-exceptions-for-specific-instances-of-a-wild-repo","title":"making exceptions for specific instances of a wild repo","text":"<p>Sometimes you want to specify rules or config for specific instances of a wild repo, while still leaving it to be created by a user in the normal way.</p> <p>This will not work:</p> <pre>\nrepo foo/..*\n    C                   =   blah blah\n    RW+                 =   CREATOR\n    RW                  =   WRITERS\n    R                   =   READERS\n\n# this does NOT work\nrepo foo/special-1\n    RW+                 =   sitaram\n    option  foo.bar     =   baz\n</pre> <p>The repo will be created as a normal (not wild) repo as soon as you push, which means you can't run the perms command on it to add people to the READERS and WRITERS roles, or do other things that wild repos allow.</p> <p>The mental nudge you need to deal with this is to think what you would do if you had to write the same rule for more than one repo, say, any repo starting with \"foo/special-\" followed by a number.  You'd use a pattern.  And a pattern prevents an ordinary repo from being created.</p> <p>So do this:</p> <pre>\n# this will work\nrepo foo/special-[1]\n    RW+                 =   sitaram\n    option  foo.bar     =   baz\n</pre> <p>Using a pattern for just one repo might sound like a kludge, but it's perfectly valid and supported.</p> <p>Note that you do NOT need a \"C\" rule in there, since the pattern is a subset of the previous one (<code>foo/..*</code>), everything there applies to this repo also. If you're not sure why that is, you may need to read up on rule accumulation.</p>"},{"location":"cookbook.html#moving-stuff-around","title":"moving stuff around","text":""},{"location":"cookbook.html#moving-a-gitolite-install-from-one-machine-to-another","title":"moving a gitolite install from one machine to another","text":"<p>See moving servers.</p>"},{"location":"deleg.html","title":"delegating access control responsibilities","text":"<p>Delegation allows you to divide up a large conf file into smaller groups of repos (called subconfs) and hand over responsibility to manage them to sub-admins.  Gitolite can prevent one sub-admin from being able to set access rules for any other sub-admin's repos.</p> <p>Delegation is achieved by combining two gitolite features: subconf and the NAME VREF.</p>"},{"location":"deleg.html#example","title":"example","text":"<p>Here's a sample conf that does delegation:</p> <pre>\n@webbrowsers        = firefox lynx browsers/..*\n@webservers         = apache nginx servers/..*\n@malwares           = conficker storm ms/..*\n    # side note: if anyone objects, we claim ms stands for \"metasploit\" ;-)\n\n# the admin repo access probably had these 2 lines to start with:\nrepo gitolite-admin\n    RW+                                     = sitaram\n# now add these lines to the config for the admin repo\n    RW                                      = alice bob mallory\n    RW  VREF/NAME/conf/subs/webbrowsers     = alice\n    RW  VREF/NAME/conf/subs/webservers      = bob\n    RW  VREF/NAME/conf/subs/malwares        = mallory\n    -   VREF/NAME/                          = alice bob mallory\n\n# pull in these files using the \"subconf\" command\nsubconf \"subs/*.conf\"\n</pre> <p>If you've read the VREF part, or at least understood how NAME VREFs work, it should be clear that, in terms of changes to the gitolite-admin repo:</p> <ul> <li>The user sitaram has no restrictions of any kind</li> <li>Users alice, bob, and mallory can only touch files within their assigned     areas within conf/subs.  If they try to change any other file (keydir,     conf/gitolite.conf, or something in one of the other sub-admin's areas),     then the last rule kicks in and the push gets rejected.</li> </ul> <p>Now all we need is to see what this \"subconf\" thing is all about.</p>"},{"location":"deleg.html#the-subconf-command","title":"the subconf command","text":"<p>Subconf is exactly like the include command in syntax:</p> <pre>\nsubconf \"foo.conf\"\n</pre> <p>but while reading the included file (as well as anything included from it), gitolite sets the \"current subconf name\" to \"foo\".</p> <p>A \"subconf\" imposes some restrictions on what repos can be managed.</p> <p>For example, while the subconf name is \"foo\", as in the above example, gitolite will only process \"repo\" lines for:</p> <ul> <li>A repo called \"foo\".</li> <li>A group called \"@foo\", as long as the group is defined in the main conf     file (i.e., outside \"foo.conf\").</li> <li>A member of a group called \"@foo\" (again, defined outside).</li> <li>A repo that matches a member of a group called \"@foo\" if that member is a     regular expression.</li> </ul> <p>Here's an example.  If the main conf file contains</p> <pre>\n@foo    =   aa bb cc/..*\n</pre> <p>then the subconf can only accept repo statements that refer to 'foo', '@foo', 'aa', 'bb', or any repo whose name starts with 'cc/'.</p> <p>Note: the subconf name \"master\" is special; it is the default subconf in effect for the main conf file and has no restrictions.</p>"},{"location":"deleg.html#how-the-subconf-name-is-derived","title":"how the \"subconf name\" is derived","text":"<p>For subconf lines that look just like include statements, i.e.,</p> <pre>\nsubconf \"foo/bar.conf\"\nsubconf \"frob/*.conf\"\n    # assume frob has files aa.conf, bb.conf\n</pre> <p>the subconf name as each file is being processed is the base name of the file. This means it would be \"bar\" for the first line, \"aa\" when processing \"frob/aa.conf\", and \"bb\" when processing \"frob/bb.conf\".</p> <p>A variation of subconf exists that can explicitly state the subconf name:</p> <pre>\nsubconf foo \"frob/*.conf\"\n</pre> <p>In this variation, regardless of what file in \"frob/\" is being read, the subconf name in effect is \"foo\".</p>"},{"location":"deleg.html#security-notes","title":"security notes","text":""},{"location":"deleg.html#group-names","title":"group names","text":"<p>You can use \"@group\"s defined in the main config file but do not attempt to redefine or extend them in your own subconf file.  If you must extend a group (say <code>@foo</code>) defined in the main config file, do this:</p> <pre>\n@myfoo  =   @foo\n# now do whatever you want with @myfoo\n</pre> <p>Group names you define in your subconf will not clash even if the exact same name is used in another subconf file, so you need not worry about that.</p>"},{"location":"deleg.html#delegating-pubkeys","title":"delegating pubkeys","text":"<p>Short answer: not gonna happen.</p> <p>The delegation feature is meant only for access control rules, not pubkeys. Adding/removing pubkeys is a much more significant event than changing branch level permissions for people already on staff, and only the main admin should be allowed to do it.</p> <p>Gitolite's \"userids\" all live in the same namespace.  This is unlikely to change, so please don't ask -- it gets real complicated to do otherwise. Allowing sub-admins to add users means username collisions, which also means security problems (admin-A creates a pubkey for Admin-B, thus gaining access to all of Admin-B's stuff).</p> <p>If you feel the need to delegate even that, please just go the whole hog and give them separate gitolite instances (i.e., running on different servers, or at least under different gitolite hosting users on the same server)!</p>"},{"location":"dev-notes.html","title":"writing your own \"non-core\" programs","text":"<p>This page is about writing hooks, commands, triggers, VREFS, and sugar scripts.  Installing them, including \"where and how\", is described here.</p> <p>Note: the non-core page is the starting point for all information about customising gitolite.</p>"},{"location":"dev-notes.html#environment-variables-and-other-inputs","title":"environment variables and other inputs","text":"<p>In general, the following environment variables should always be available:</p> <pre><code>GL_BINDIR\nGL_REPO_BASE\nGL_ADMIN_BASE\n</code></pre> <p><code>GL_BINDIR</code> is loosely equivalent to GIT_EXEC_PATH in git.  <code>GL_REPO_BASE</code> is always <code>$HOME/repositories</code>, and <code>GL_ADMIN_BASE</code> is <code>$HOME/.gitolite</code>. (You might ask why, if they're fixed values, do we need those variables.  Good question... next!)</p> <p>In addition, commands invoked by a remote client also have <code>GL_USER</code>, while hooks have <code>GL_USER</code> as well as <code>GL_REPO</code> (which is the logical reponame).</p> <p>A special form of the option syntax can be used to set repo-specific environment variables.</p> <p>Finally, note that triggers get a lot of relevant information from gitolite as arguments; see here for details.</p>"},{"location":"dev-notes.html#apis","title":"APIs","text":""},{"location":"dev-notes.html#the-shell-api","title":"the shell API","text":"<p>The following commands exist to help you write shell scripts that interact easily with gitolite.  Each of them responds to <code>-h</code> so please run that for more info.</p> <ul> <li> <p><code>gitolite access</code> to check access rights given repo, user, type of access     (R, W, ...) and refname (optional).  Example use: src/commands/desc.</p> </li> <li> <p><code>gitolite creator</code> to get/check the creator of a repo.  Example use:     src/commands/desc.</p> </li> <li> <p><code>gitolite git-config</code> to check gitolite options or git config variables     directly from gitolite's \"compiled\" output, (i.e., without looking at the     actual <code>repo.git/config</code> file or using the <code>git config</code> command).  Example     use: src/triggers/post-compile/update-gitweb-access-list.</p> </li> <li> <p><code>gitolite query-rc</code> to check the value of an RC variable.  Example use:     src/commands/desc.</p> </li> </ul> <p>In addition, you can also look at the comments in src/lib/Gitolite/Easy.pm (the perl API module) for ideas.</p>"},{"location":"dev-notes.html#the-perl-api","title":"the perl API","text":"<p>...is implemented by <code>Gitolite::Easy</code>; the comments in src/lib/Gitolite/Easy.pm serve as documentation.</p> <p>Note that some of the perl functions called by Easy.pm will change the current directory to something else, without saving and restoring the directory. Patches (to Easy.pm only) welcome.</p>"},{"location":"dev-notes.html#writing-your-own","title":"writing your own...","text":""},{"location":"dev-notes.html#commands","title":"...commands","text":"<p>Commands are standalone programs, in any language you like.  They simply receive the arguments you append.  In addition, the env var <code>GL_USER</code> is available if it is being run remotely.  src/commands/desc is the best example at present.</p>"},{"location":"dev-notes.html#hooks","title":"...hooks","text":""},{"location":"dev-notes.html#anything-but-the-update-hook","title":"anything but the update hook","text":"<p>If you want to add any hook other than the update hook, 'man githooks' is all you need.</p>"},{"location":"dev-notes.html#update-hook","title":"update hook","text":"<p>If you want to add additional <code>update</code> hook functionality, do this:</p> <ul> <li> <p>Write and test your update hook separately from gitolite.</p> </li> <li> <p>Now add the code as a VREF (see here for details).  Let's say     you called it \"foo\".</p> </li> <li> <p>To call your new update hook to all accesses for all repos, add this to     the end of your conf file:</p> <p><pre>\nrepo @all\n    -       VREF/foo        =   @all\n</pre></p> </li> </ul> <p>As you probably guessed, you can make your additional update hooks more selective, applying them only to some repos / users / combinations.</p> <p>Note: a normal update hook expects 3 arguments (ref, old SHA, new SHA).  A VREF will get those three, followed by at least 4 more.  Your VREF should just ignore the extra args.</p>"},{"location":"dev-notes.html#trigger-programs","title":"...trigger programs","text":"<p>Trigger programs run at specific points in gitolite's execution, with specific arguments being passed to them.  See the triggers page for details.</p> <p>You can write programs that are both manually runnable as well as callable by trigger events, especially if they don't need any arguments.</p>"},{"location":"dev-notes.html#sugar","title":"...\"sugar\"","text":"<p>Syntactic sugar helpers are NOT complete, standalone, programs.  They must include a perl sub called <code>sugar_script</code> that takes in a listref, and returns a listref.  The listrefs point to a list that contains the entire conf file (with all include processing already done).  You create a new list with contents modified as you like and return a ref to it.</p> <p>There are a couple of examples in src/syntactic-sugar.</p>"},{"location":"dev-notes.html#appendix-1-repo-specific-environment-variables","title":"appendix 1: repo-specific environment variables","text":"<p>A special form of the option syntax can be used to set repo-specific environment variables that are visible to gitolite triggers and any git hooks you may install.</p> <p>For example, let's say you installed a post-update hook that initiates a CI job.  By default, of course, this hook will be active for all gitolite-managed repos.  However, you only want it to run for some specific repos, say r1, r2, and r4.</p> <p>To do that, first add this to the gitolite.conf:</p> <pre>\nrepo r1 r2 r4\n    option ENV.CI = 1\n</pre> <p>This creates an environment variable called <code>GL_OPTION_CI</code> with the value 1, before any trigger or hook is invoked.</p> <p>Note: option names must start with <code>ENV.</code>, followed by a seqence of characters composed of alphas, numbers, and the underscore character.</p> <p>Now the hook running the CI job can easily decide what to do:</p> <pre><code># exit if $GL_OPTION_CI is not set\n[ -z $GL_OPTION_CI ] &amp;&amp; exit\n\n... rest of CI job code as before ...\n</code></pre> <p>Of course you can also do the opposite; i.e. decide that the listed repos should not run the CI job but all other repos should:</p> <pre>\nrepo @all\n    option ENV.CI = 1\n\nrepo r1 r2 r4\n    option ENV.CI = \"\"\n</pre> <p>(The hook code remains the same as before.)</p> <p>Before this feature was added, you could still do this, by using the <code>gitolite git-config</code> command inside the hook code to test for options and configs set for the repo, like: <pre><code>if gitolite git-config -q reponame gitolite-options.option-name\nthen\n    ...\n</code></pre> <p>The new method is much more convenient, as you can see.</p>"},{"location":"dev-notes.html#appendix-2-log-file-format","title":"appendix 2: log file format","text":"<p>Here's a brief description of gitolite's log file format.  All fields are tab separated.</p> <p>There are two kinds of lines in the log file:</p> <ul> <li> <p>third field non-empty: actual log lines.  These are documented below.</p> </li> <li> <p>third field empty (i.e., two tabs after the second field): extra output to     help diagnose problems. These are NOT documented and may change without     notice.  They can be turned off completely by setting the RC variable     <code>LOG_EXTRA</code> to 0.</p> </li> </ul> <p>For all types of log lines, the first two fields are:</p> <ul> <li> <p>field 1: local time, in <code>YYYY-MM-DD.HH:MM:SS</code> format</p> </li> <li> <p>field 2: transaction ID or \"TID\".  This is actually the PID of the     outermost command that was initiated (usually \"gitolite-shell\").  It helps     to keep log lines pertaining to one \"run\" together, even if several     sub-commands are spawned (like for example from triggers, or even the     update hook itself).</p> </li> </ul> <p>The third and later fields are all dependent on what type of log line it is.</p> <p>The various log line formats are:</p> <ul> <li> <p>start</p> <p>This line denotes the beginning of a gitolite operation.</p> <ul> <li> <p>field 3: 'ssh' or 'http'</p> </li> <li> <p>field 4: <code>ARGV=&lt;comma-separated list of command line arguments&gt;</code></p> <p>Usually this is just the gitolite username (the argument to gitolite-shell, as supplied by the forced command in the authorized keys file).  If you're giving shell access to some users, this would be <code>-s,username</code>.  That's two command line arguments (\"-s\" and the username), comma separated.</p> </li> <li> <p>field 5: <code>SOC=&lt;original command from client&gt;</code></p> <p>This is the command exactly as the git client sent it, or the user typed it.  Typically this is one of these:</p> <pre><code>git-upload-pack 'reponame'\ngit-receive-pack 'reponame'\n</code></pre> <p>(including the single quotes, because that's what the client sent).</p> <p>Gitolite commands are also recorded as is, so this could be something like <code>info</code> or perhaps <code>perms -l reponame</code> etc.</p> </li> <li> <p>field 6: <code>FROM=&lt;ip address&gt;</code></p> </li> </ul> </li> <li> <p>pre-git</p> <p>This log line appears when the first access check succeeds (i.e., before git-upload-pack or git-receive-pack is called).</p> <ul> <li>field 3: 'pre_git'</li> <li>field 4: reponame</li> <li>field 5: username</li> <li>field 6: 'R' or 'W'</li> <li>field 7: 'any'</li> <li>field 8: the refex that allowed access</li> </ul> </li> <li> <p>update</p> <p>This log line appears when the second access check succeeds (i.e., when the update hook decides to allow the push).</p> <ul> <li>field 3: 'update'</li> <li>field 4: reponame</li> <li>field 5: username</li> <li>field 6: 'W', '+', 'C', 'D', 'WM', '+M', 'CM', or 'DM'</li> <li>field 7: ref name (like 'refs/heads/master')</li> <li>field 8: old SHA</li> <li>field 9: new SHA</li> <li>field 10: the refex that allowed access</li> </ul> <p>The values in field 6 reflect the possible write types, but note that there is a difference between what the log file contains and what the gitolite.conf file contains (e.g., <code>+</code> versus <code>RW+</code>).  There's another subtle difference for those who are not thinking clearly: the <code>RW+</code> in the conf file is a permission, but it would show up as a <code>+</code> in the log file only if an actual force push had happened, otherwise it would be just <code>W</code>.</p> <p>By the way, notice that fields 7 to 9 are exactly what git itself supplies the update hook (see 'man githooks').</p> <p>There is a special version of this line that appears when someone bypasses gitolite's access control to push directly on the server.  The 'reponame' (field 4) is replaced by the full path of the repo being pushed to, the username (field 5) is replaced by the Unix userid in parentheses, and the operation code (field 6) is 'bypass'.</p> </li> <li> <p>create</p> <p>This log line appears when a wild repo was auto-created by a user.</p> <ul> <li>field 3: 'create'</li> <li>field 4: reponame</li> <li>field 5: username</li> <li>field 6: 'R' or 'W'</li> </ul> <p>Field 6 is 'perms-c' if the wild repo is created using the perms command's '-c' option.</p> </li> <li> <p>end</p> <p>This indicates the end of the transaction.  Normally, you should not see any more lines with the same TID after this line.</p> <ul> <li>field 3: 'END'</li> </ul> </li> <li> <p>warnings and errors</p> <p>Typically seen when access is denied.</p> <ul> <li>field 3: 'warn' or 'die'</li> <li>field 4: message.  Parts of the message (like reponame, username, etc)     are not split out into fields, though.</li> </ul> </li> <li> <p>cli</p> <p>This logs gitolite sub-commands run directly on the server, like <code>gitolite setup</code> etc.</p> <ul> <li>field 3: 'cli'</li> <li>field 4: 'gitolite'</li> <li>field 5 to end: arguments supplied to gitolite command, one per field</li> </ul> </li> </ul>"},{"location":"dev-notes.html#appendix-3-sending-log-lines-to-syslog","title":"appendix 3: sending log lines to syslog","text":"<p>Gitolite allows you to send log entries to syslog.  To do that, uncomment one of the commented out values for LOG_DEST in the rc file.  If your rc file does not have any such lines, add one of the following lines just after the LOG_EXTRA line:</p> <pre><code># use this to log only to syslog\nLOG_DEST                        =&gt; 'syslog',\n\n# use this to log to syslog and the normal gitolite log\nLOG_DEST                        =&gt; 'syslog,normal',\n</code></pre> <p>Please note:</p> <ul> <li> <p>The first two fields described in the previous section (time, TID) are     different.  Syslog takes care of putting in the time, and the TID is     appended to the ident, so instead of just 'gitolite', you get     'gitolite[$GL_TID]'.</p> <p>This means actual log lines will look something like this, since syslog appends the actual PID to the ident as well:</p> <pre><code>Jun  3 09:26:11 sita-lt gitolite[14950][14950]: ssh ARGV=admin  SOC=git-receive-pack 'gitolite-admin'   FROM=::1\nJun  3 09:26:11 sita-lt gitolite[14950][14950]: pre_git gitolite-admin  admin   W   any refs/.*\nJun  3 09:26:11 sita-lt gitolite[14950][14991]: update  gitolite-admin  admin   W   refs/heads/master   [snip]\nJun  3 09:26:13 sita-lt gitolite[14950][14950]: END\n</code></pre> </li> <li> <p>Normal log messages use the 'info' priority, while LOG_EXTRA messages     (see previous section) use the 'debug' priority.</p> <p>It may be useful to send the debug output to a different output file. Unlike in the normal gitolite logs, where there is an extra tab character (or, an empty field, depending on how you look at it), the syslog lines do not let you easily distinguish between the main log lines and the LOG_EXTRA lines.</p> </li> </ul>"},{"location":"emergencies.html","title":"help for emergencies","text":"**\"Don't Panic!\"** <p>IMPORTANT</p> <p>Almost nothing in gitolite requires <code>root</code> (with some obvious exceptions). Unless the documentation says \"do this from <code>root</code>\", assume it is to be done from the hosting user account.</p>"},{"location":"emergencies.html#installsetup-issues","title":"install/setup issues","text":"<p>Most install/setup issues in ssh mode are caused by lack of ssh knowledge. Ssh is a complex beast, and can cause problems for people who are not familiar with its quirks.</p> <p>Be prepared to spend some time reading the ssh documentation that comes with gitolite.</p>"},{"location":"emergencies.html#lost-admin-keyaccess","title":"lost admin key/access","text":"<p>If you lost your gitolite admin key or access, here's what you do.  We'll assume your username is \"alice\" (i.e., alice has RW or RW+ permissions on the gitolite-admin repo).</p> <ul> <li> <p>Make yourself a new keypair and copy the public key to the server as     'alice.pub'.</p> </li> <li> <p>Log on to the server, and run <code>gitolite setup -pk alice.pub</code>.</p> </li> </ul> <p>That's it; the new alice.pub file replaces whatever existed in the repo before.</p>"},{"location":"emergencies.html#bypassing-gitolite","title":"bypassing gitolite","text":"<p>You may have lost access because of a conf file error, in which case the above trick (which merely changes a pubkey) won't help.  What you want is to make changes to the gitolite-admin repo (or perhaps just rewind) and push that. Here's how to do that:</p> <ul> <li> <p>Log on to the server.</p> </li> <li> <p>Clone the admin repo using the full path:</p> <pre><code>git clone $HOME/repositories/gitolite-admin.git temp\n</code></pre> </li> <li> <p>'cd' to this clone and make whatever changes you want -- add/replace a     key, 'git revert' or 'git reset --hard' to an older commit, etc.  Anything     you need to fix the problem, really.</p> </li> <li> <p>Run <code>gitolite push</code> (or possibly <code>gitolite push -f</code>).  Note that's     'gitolite push', not 'git push'.</p> </li> </ul> <p> NOTE: gitolite does no access checking when you do this! </p>"},{"location":"emergencies.html#botched-something","title":"botched something?","text":""},{"location":"emergencies.html#fixing-botched-repos","title":"fixing botched repos","text":"<p>If you copied some repos from somewhere else, or mucked with the hooks for some reason, or deleted any gitolite-specific files, or tried any other \"behind the scenes\" stunts, the quickest, sanest, way to fix everything up is:</p> <ul> <li> <p>Make sure any new repos you copied in are mentioned in the gitolite.conf     in some 'repo' line and the change pushed.</p> </li> <li> <p>Run the following three commands:</p> <pre><code>gitolite compile\ngitolite setup --hooks-only\ngitolite trigger POST_COMPILE\n</code></pre> </li> </ul> <p>If the repo you botched is a wild repo, there's a bit more to be done.  Wild repos store the creator name in a file called gl-creator, and the data managed by the perms command in a file called \"gl-perms\".  If these files got deleted, you may have to manually recreate them.  The format is very simple and guessable by looking at those files on any other wild repo.</p>"},{"location":"emergencies.html#cleaning-out-a-botched-install","title":"cleaning out a botched install","text":"<p>Here's a list of files and directories to deal with:</p> <ul> <li> <p>Gitolite sources -- can be found by running <code>which gitolite</code>.  If it's     a symlink, go to its target directory.</p> <p>If the <code>which</code> command does not work, you'll have to find this info from looking at the 'command=' option in pubkey lines in <code>~/.ssh/authorized_keys</code>.</p> </li> <li> <p>Gitolite admin directory -- <code>$HOME/.gitolite</code>.  Save the 'logs'     directory if you want to preserve them for any reason.</p> </li> <li> <p>The rc file -- <code>$HOME/.gitolite.rc</code>.  If you made any changes to it     you can save it as some other name instead of deleting it.</p> </li> <li> <p>The gitolite-admin repo -- <code>$HOME/repositories/gitolite-admin.git</code>.     You can clone it somewhere to save it before blowing it away if you wish.</p> </li> <li> <p>Git repositories -- <code>$HOME/repositories</code>.  The install process will     not touch any existing repos except 'gitolite-admin.git', so you do not     have to blow away (or move) your work repos to fix a botched install.</p> <p>Only when you update the conf to include those repos and push the changes will those repos be touched.  And even then all that happens is that the update hook, if any, is replaced with gitolite's own hook.</p> </li> <li> <p>Ssh stuff -- exercise caution when doing this, but in general it     should be safe to delete all lines between the \"gitolite start\" and     \"gitolite end\" markers in <code>$HOME/.ssh/authorized_keys</code>.</p> <p>Gitolite does not touch any other files in the ssh directory.</p> </li> </ul>"},{"location":"emergencies.html#common-errors","title":"common errors","text":"<ul> <li> <p><code>WARNING: keydir/&lt;yourname&gt;.pub duplicates a non-gitolite key, sshd will ignore it</code></p> <p>You used a key that is already set to give you shell access.  You cannot use the same key to get shell access as well as access gitolite repos.</p> <p>Solution: use a different keypair for gitolite.  There's a wee bit more on this in the setup section of the install page.  Also see why bypassing causes a problem and both the pages linked from ssh for background.</p> </li> <li> <p><code>Empty compile time value given to use lib at hooks/update line 6</code></p> <p>(followed by <code>Can't locate Gitolite/Hooks/Update.pm in @INC</code> a couple of lines later).</p> <p>You're bypassing gitolite.  You cloned the repo using the full path (i.e., including the <code>repositories/</code> prefix), either directly on the server, or via ssh with a key that gives you shell access.</p> <p>Solution: same as for the previous bullet.</p> <p>NOTE: If you really must do it, and this is on the server and is a one-time thing, you can try <code>gitolite push</code> instead of <code>git push</code>. BUT... this defeats all gitolite access control, so if you're going to do this often, maybe you don't need gitolite!</p> </li> </ul>"},{"location":"emergencies.html#uncommon-errors","title":"uncommon errors","text":"<p>(This page intentionally left blank)</p>"},{"location":"emergencies.html#non-standard-configs-thatll-trip-you-up","title":"non-standard configs that'll trip you up","text":"<ul> <li> <p>IMPORTANT: although a default openssh config will not do this (AFAIK),     do not allow the user to set environment variables if you care about     security at all.</p> </li> <li> <p>If your 'git' binary is in a non-PATH location, or you have more than one     version and want a specific one to be picked up, you will have to add a     line like this at the end of the rc file (outside the <code>%RC</code> hash, but     before the <code>1;</code> line):</p> <pre><code>$ENV{PATH} = \"/your/git/path:$ENV{PATH}\";\n</code></pre> </li> <li> <p>If you have your sshd configured to put the authorized_keys file     somewhere other than the default (which is in .ssh in the hosting     user's home directory), you'll probably have to roll your own ssh     handling, either disabling 'ssh-authkeys' in the rc file, or building on     that somehow (maybe a post-processing step that copies the relevant auth     keys lines from the default file to the other).</p> </li> <li> <p>If you have sshd setup to not allow incoming ssh for the hosting user,     gitolite won't work.  Check things like <code>Allowusers</code> setting in     <code>/etc/ssh/sshd_config</code> etc. to make sure.</p> </li> <li> <p>If you have the home directory in a partition that is mounted noexec,     gitolite won't work.  I believe it would be sufficient if the \".gitolite\"     directory were moved to a different mount and symlinked, but please test     thoroughly.  A failure to execute a hook does not throw up any errors or     warnings for you to notice!</p> </li> <li> <p>If the default shell is something like /bin/false, and/or not listed in     /etc/shells, there might be problems.</p> </li> </ul>"},{"location":"emergencies.html#things-that-are-not-gitolite-problems","title":"things that are not gitolite problems","text":"<p>There are several things that appear to be gitolite problems but are not.  I cannot help with most of these (although the good folks on irc or the mailing list -- see contact -- might be able to; they certainly appear to have a lot more patience than I do, bless 'em!)</p> <ul> <li> <p>Client side software</p> <ul> <li>putty/plink</li> <li>jgit/Eclipse</li> <li>Mac OS client or server</li> <li>putty/plink</li> <li>windows as a server</li> <li>...probably some more I forgot; will update this list as I remember...</li> <li>did I mention putty/plink?</li> </ul> </li> <li> <p>Ssh</p> <p>The superstar of the \"not a gitolite problem\" category is actually ssh.</p> <p>Surprised?  It's a common misunderstanding; see this section in the concepts page, and then this page for details.</p> <p>Everything I know is in that latter link, and the two more pages it points to.  Please email me about ssh ONLY if you find something wrong or missing in those pages.</p> </li> <li> <p>Git</p> <p>I wish I had a dollar for each time someone did a first push on a new repo, got an error because there were \"no refs in common (etc.)\", and asked me why gitolite was not allowing the push.</p> <p>Gitolite is designed to look like just another bare repo server to a client (except requiring public keys -- no passwords allowed).  It is completely transparent when there is no authorisation failure (i.e., when the access is allowed, the remote client has no way of knowing gitolite was even installed!)</p> <p>Even \"on disk\", apart from reserving the <code>update</code> hook for itself, gitolite does nothing to your bare repos unless you tell it to (for example, adding 'gitweb.owner' and such to the config file).</p> <p>BEFORE you think gitolite is the problem, try the same thing with a normal bare repo.  In most cases you can play with it just by doing something like this:</p> <pre><code>mkdir /tmp/throwaway\ncd    /tmp/throwaway\ngit clone --mirror &lt;some repo you have a URL for&gt; bare.git\ngit clone bare.git worktree\ncd worktree\n&lt;...try stuff&gt;\n</code></pre> </li> </ul>"},{"location":"files.html","title":"gitolite files and directories","text":""},{"location":"files.html#directories","title":"directories","text":"<p>Gitolite creates and uses the following files and directories:</p> <ul> <li><code>~/repositories</code> -- the actual (bare) repositories are here</li> <li><code>~/.gitolite.rc</code> -- configuration parameters that must be done directly on     the server</li> <li><code>~/.gitolite</code> -- gitolite's \"working\" directory.  This contains everything     else that gitolite needs.  (Warning: you're not supposed to fiddle with     the files and directories within; instead, make changes in a clone of the     gitolite-admin repository and push, and those appear magically here).</li> </ul> <p>Once the install/setup is done, any (or all) of these may be moved elsewhere and replaced by symlinks.  The most common reason for locating <code>~/repositories</code> somewhere else is disk space, but FHS compliance could also be a reason.</p> <p>In addition, the following are of interest:</p> <ul> <li><code>~/.ssh</code> -- if you're using ssh (as opposed to http), since this is where     the <code>authorized_keys</code> file is kept</li> </ul>"},{"location":"files.html#special-files","title":"special files","text":"<p>You may want to backup the contents of <code>~/.gitolite/logs</code> if you care about auditability etc.</p>"},{"location":"files.html#inside-a-gitolite-repo","title":"inside a \"gitolite repo\"","text":"<p>A gitolite repo is just like a normal bare repo on any normal git server. There are a few extra files placed in the repo directory whose names start with \"gl-\", and there is also an update hook placed in the hooks subdirectory, but that's about it, for the most part.</p> <p>In other words, you can treat a gitolite-managed repo just like any other bare repo as long as you leave those files alone.</p>"},{"location":"files.html#gitolite-software","title":"gitolite software","text":"<p>The above list does not include the gitolite software itself.</p> <p>Gitolite offers you 3 ways to install software.  After cloning the gitolite sources, run the install command in it with a <code>-h</code> argument to see what they are.  Where the actual software is found depends on that.</p>"},{"location":"fool_proof_setup.html","title":"fool-proof, step-by-step, install and setup","text":"<p>This page is useful if the normal install instructions did not work for you.</p>"},{"location":"fool_proof_setup.html#pre-requisites-etc","title":"pre-requisites, etc","text":"<p>These are the pre-requisites:</p> <ul> <li>Any Linux machine on which git has already been installed.</li> <li>Probably any BSD or legacy system like Solaris will also work, but I have     not tested them.<ul> <li>I do not consider Apple devices to be Unix enough; it should work, but     please do not ask me for help if it does not.</li> </ul> </li> </ul> <p>This page has several restrictions and constraints that seem unnecessary to people who do understand ssh. That's the whole point -- I'm compensating for lack of ssh knowledge by removing things that trip people up.</p> <p>If even this page does not help you install gitolite, I probably cannot help you.  Either you did not follow the instructions carefully (maybe some task has to be run on your workstation, but you ran it on the server, or you ran something as root when it should be as the hosting user, etc.), or your environment is far too different from standard Unix, or you have some other problem.  In any case, it is not something I can help with.  Sorry.</p>"},{"location":"fool_proof_setup.html#assumptions","title":"assumptions","text":"<ul> <li> <p>Your name is Ron.  Substitute accordingly in the instructions below.</p> </li> <li> <p>You have a workstation.</p> </li> <li> <p>You have a server called <code>server</code>.</p> </li> <li> <p>You have root access on this server.</p> </li> </ul>"},{"location":"fool_proof_setup.html#installation-tasks","title":"installation tasks","text":"<ol> <li> <p>Create a new userid on the server, say <code>git</code>.  This will be the hosting     user.  (\"hosting user\" means when you're done installing, your users     will use URLs like <code>git@server:reponame</code> or <code>ssh://git@server/reponame</code>).</p> <p>Make sure this is a NEW userid.</p> <p>If the name you want already exists, then:</p> <ul> <li>Log in as root.</li> <li>If you have any data on that user's HOME directory save it somewhere     else.</li> <li>Delete the userid.</li> <li>Completely wipe out (erase) the home directory of the user (since on     most systems merely deleting the user does not remove the home     directory).</li> <li>Re-create the userid again.</li> </ul> </li> <li> <p>If you don't already have one, make yourself an ssh keypair on your     workstation.</p> <p>Do NOT add this public key to the authorised keys file on the newly created hosting user!</p> <p>Your ONLY access to the new (<code>git</code>) userid should be by logging onto the server as root, then running <code>su - git</code>.</p> </li> <li> <p>Now copy the pubkey from your workstation (<code>~/.ssh/id_rsa.pub</code>) to the     server as <code>/tmp/ron.pub</code>.  (Your name is Ron, remember?)</p> </li> <li> <p>Log on to the server as root.</p> </li> <li> <p>Switch to the <code>git</code> user:</p> <pre><code>su - git\n</code></pre> </li> <li> <p>Clone the gitolite source code</p> <pre><code>git clone https://github.com/sitaramc/gitolite\n</code></pre> </li> <li> <p>Install it</p> <pre><code>cd $HOME\nmkdir -p bin\ngitolite/install -to $HOME/bin\n</code></pre> </li> <li> <p>Set it up</p> <pre><code>cd $HOME\n$HOME/bin/gitolite setup -pk /tmp/ron.pub\n</code></pre> </li> <li> <p>Now go to your workstation and type in</p> <pre><code>git ls-remote git@server:gitolite-admin\n</code></pre> <p>This should return something like</p> <pre><code>9dd8aab60bac5e54ccf887a87b4f3d35c96b05e4    HEAD\n9dd8aab60bac5e54ccf887a87b4f3d35c96b05e4    refs/heads/master\n</code></pre> <p>(do I have to mention that your SHAs will be different?)</p> </li> </ol>"},{"location":"fool_proof_setup.html#administration-tasks","title":"administration tasks","text":"<p>Most day-to-day administration is done by making changes to a clone of the gitolite-admin repo and pushing.  (There are some things that are done by editing <code>$HOME/.gitolite.rc</code> on the server, but those are too advanced for this tutorial so we will ignore that).</p> <ol> <li> <p>To start administering gitolite, clone the gitolite-admin repo:</p> <pre><code>git clone git@server:gitolite-admin\n</code></pre> </li> <li> <p>Now go to the new directory this creates, and look around:</p> <pre><code>cd gitolite-admin\nls -A\n</code></pre> <p>which gives you</p> <pre><code>conf/  .git/  keydir/\n</code></pre> <p>Ignoring the \".git\" and exploring further:</p> <pre><code>ls -A conf keydir\n</code></pre> <p>which says:</p> <pre><code>conf:\ngitolite.conf\n\nkeydir:\nron.pub\n</code></pre> </li> <li> <p>Let's say you want to add your colleague Alice.  She has sent you her ssh     public key by email (the file is called <code>id_rsa.pub</code>).  Save this file as     /tmp/alice.pub, then do this:</p> <pre><code># still in your gitolite-admin clone, from the previous step\ncp /tmp/alice.pub keydir\ngit add keydir\ngit commit -m 'new user alice'\ngit push\n</code></pre> </li> <li> <p>Well, that might not be sufficient.  There aren't any new repos for alice     to play with, yet.  So here's what you do: edit \"conf/gitolite.conf\" and     add something like to the end:</p> <pre><code>repo foo\n    RW+     =   alice\n    R       =   ron\n</code></pre> <p>Save the file, then <code>git add conf; git commit -m 'new repo foo'; git push</code>.</p> <p>This will automatically create a brand new repo called \"foo\" on the server, and alice will be able to clone from it, or push anything to it.</p> </li> </ol>"},{"location":"g2migr-example.html","title":"migration example","text":"<p>This shows what a typical migration would look like, using a test setup.</p>"},{"location":"g2migr-example.html#existing-setup","title":"existing setup","text":"<p>The existing gitolite is the latest in the \"g2\" (v2.x) branch.</p> <p>First, the rc file has the following lines different from the default:</p> <pre><code>-$GL_WILDREPOS = 0;\n+$GL_WILDREPOS = 1;\n\n-$GL_GITCONFIG_KEYS = \"\";\n+$GL_GITCONFIG_KEYS = \".*\";\n</code></pre> <p>Next, the conf/gitolite.conf file in <code>~/.gitolite</code>:</p> <pre>\nrepo    gitolite-admin\n        RW+             =   tester u1\n\nrepo    testing\n        RW+     =   @all\n\nrepo foo\n        RW+             =   u1 u2\n        RW+ NAME/       =   u1\n        RW+ NAME/u2     =   u2\n\nrepo bar\n        RW  =   u2\n\nrepo baz/..*\n        C   =   u3 u4\n        RW+         =   CREATOR\n        config foo.bar = baz\n</pre> <p>(Note that this conf file has NAME/ rules, which have changed significantly in v3; see [here][g2i-name] for details).</p> <p>These are the repos already existing</p> <pre><code>$ find repositories -name \"*.git\" | sort\nrepositories/bar.git\nrepositories/baz/u3.git\nrepositories/baz/u4.git\nrepositories/baz/uthree.git\nrepositories/foo.git\nrepositories/gitolite-admin.git\nrepositories/testing.git\n</code></pre> <p>The config entries exist for all the baz/ repos:</p> <pre><code>$ grep -2 foo `find repositories -name \"config\" `\nrepositories/baz/uthree.git/config-[gitweb]\nrepositories/baz/uthree.git/config- owner = u3\nrepositories/baz/uthree.git/config:[foo]\nrepositories/baz/uthree.git/config- bar = baz\n--\nrepositories/baz/u4.git/config-[gitweb]\nrepositories/baz/u4.git/config-     owner = u4\nrepositories/baz/u4.git/config:[foo]\nrepositories/baz/u4.git/config-     bar = baz\n--\nrepositories/baz/u3.git/config-[gitweb]\nrepositories/baz/u3.git/config-     owner = u3\nrepositories/baz/u3.git/config:[foo]\nrepositories/baz/u3.git/config-     bar = baz\n</code></pre>"},{"location":"g2migr-example.html#preparing-for-the-migration","title":"preparing for the migration","text":""},{"location":"g2migr-example.html#getting-v3","title":"getting v3","text":"<p>Fortunately this is easy here; I just happened to have the repo already fetched so I just had to switch branches.  You may have to 'git clone ...' from github.</p> <pre><code>$ cd gitolite\n$ git checkout master\nBranch master set up to track remote branch master from origin.\nSwitched to a new branch 'master'\n</code></pre>"},{"location":"g2migr-example.html#run-check-g2-compat","title":"run check-g2-compat","text":"<p>This is a quick and dirty program to catch some of the big issues.</p> <pre><code>$ cd\n$ gitolite/check-g2-compat\nINFO        This program only checks for uses that make the new v3 completely unusable\n            or that might end up giving *more* access to someone if migrated as-is.\n            It does NOT attempt to catch all the differences described in the docs.\n\nINFO        'see docs' usually means the pre-migration checklist in\n            \"g2migr.html\"; to get there, start from the main migration\n            page at https://sitaramc.github.com/gitolite/migr/\n\nchecking rc file...\nNOTE        GL_ADMINDIR is in the right place; assuming you did not mess with\n            GL_CONF, GL_LOGT, GL_KEYDIR, and GL_CONF_COMPILED\n\nchecking conf file(s)...\nSEVERE      NAME rules; see docs\n\nchecking repos...\nWARNING     found 3 gl-creater files; see docs\n\n...all done...\n</code></pre>"},{"location":"g2migr-example.html#the-actual-migration","title":"the actual migration","text":"<p>Here's the actual migration, step by step</p>"},{"location":"g2migr-example.html#step-1","title":"step 1","text":"<pre><code>$ ls -a bin\n.                gl-admin-push    gl-install       gl-setup-authkeys  gl-VREF-DUPKEYS\n..               gl-auth-command  gl-mirror-push   gl-system-install  gl-VREF-EMAIL_CHECK\ngitolite_env.pm  gl-compile-conf  gl-mirror-shell  gl-time            gl-VREF-FILETYPE\ngitolite.pm      gl-conf-convert  gl-query-rc      gl-tool            gl-VREF-MERGE_CHECK\ngitolite_rc.pm   gl-dryrun        gl-setup         gl-VREF-COUNT      sshkeys-lint\n$ rm -rf bin;mkdir bin\n\n$ grep GL_PACKAGE .gitolite.rc\n$GL_PACKAGE_CONF = \"/home/git/share/gitolite/conf\";\n$GL_PACKAGE_HOOKS = \"/home/git/share/gitolite/hooks\";\n$ rm -rf share\n\n$GL_PACKAGE_HOOKS = \"/home/git/share/gitolite/hooks\";\n$ rm -rf share\n\n$ mv .gitolite.rc old.grc\n</code></pre> <p>(still on step 1, this is substep 3) notice we are cloning on the server, using a full path to the repo.</p> <pre><code>$ git clone repositories/gitolite-admin.git old.ga\nCloning into 'old.ga'...\ndone.\n$ rm -rf repositories/gitolite-admin.git/\n</code></pre> <p>Since I'm not interested in preserving the logs and don't have any custom hooks:</p> <pre><code>$ rm -rf .gitolite\n</code></pre>"},{"location":"g2migr-example.html#step-2","title":"step 2","text":"<p>I have no variables that must be preset, since the report by <code>check-g2-compat</code> is clear.</p>"},{"location":"g2migr-example.html#step-3","title":"step 3","text":"<p>Here we install the new gitolite.  Remember we already got the new software (in order to run 'check-g2-compat').</p> <p>Just check that bin is empty, then run 'install -ln' from the gitolite source tree:</p> <pre><code>$ ls -al bin\ntotal 8\ndrwxrwxr-x 2 git git 4096 Apr 24 10:57 .\ndrwx------ 8 git git 4096 Apr 24 10:59 ..\n$ gitolite/install -ln\n$ ls -al bin\ntotal 8\ndrwxrwxr-x 2 git git 4096 Apr 24 11:01 .\ndrwx------ 8 git git 4096 Apr 24 10:59 ..\nlrwxrwxrwx 1 git git   30 Apr 24 11:01 gitolite -&gt; /home/git/gitolite/src/gitolite\n</code></pre> <p>OK that went well.  Now setup gitolite.  You don't need a key here; just use a random name:</p> <pre><code>$ gitolite setup -a admin\nInitialized empty Git repository in /home/git/repositories/gitolite-admin.git/\n</code></pre>"},{"location":"g2migr-example.html#step-4","title":"step 4","text":"<p>Now go to your old clone, and push it:</p> <pre><code>$ cd old.ga\n$ gitolite push -f\n    ...usual git progress output deleted...\nremote: FATAL: git config foo.bar not allowed\nremote: check GIT_CONFIG_KEYS in the rc file\nTo /home/git/repositories/gitolite-admin.git\n + 7eb8163...1474770 master -&gt; master (forced update)\n</code></pre> <p>Aaha!  I forgot to set <code>GIT_CONFIG_KEYS</code> (new name for <code>GL_GITCONFIG_KEYS</code>) in the new rc file so fix that:</p> <pre><code>$ vim ~/.gitolite.rc\n(edit and set it to `.*` for now)\n</code></pre> <p>and push again:</p> <pre><code>$ gitolite push -f\nEverything up-to-date\n</code></pre> <p>Damn.  We have to make a dummy commit to allow the push to do something.</p> <p>But wait!  We forgot fix the [NAME/][g2i-name] rules, so may as well fix those, add, and push:</p> <pre><code>$ vim conf/gitolite.conf\n# change all NAME/ to VREF/NAME/\n# append a '- VREF/NAME/ = @all' at the end\n# save\ngit add conf\n\n$ git commit -m name-rules\n    ... some output for add...\n\n$ gitolite push -f\nCounting objects: 1, done.\nWriting objects: 100% (1/1), 181 bytes, done.\nTotal 1 (delta 0), reused 0 (delta 0)\nUnpacking objects: 100% (1/1), done.\nTo /home/git/repositories/gitolite-admin.git\n   1474770..4c2b41d  master -&gt; master\n</code></pre>"},{"location":"g2migr-example.html#step-5","title":"step 5","text":"<p>The only thing left is to fix up the gl-creater files:</p> <pre><code>$ cd $HOME/repositories\n$ find . -type d -name \"*.git\" -prune | while read r\n&gt; do\n&gt;     mv $r/gl-creater $r/gl-creator\n&gt; done 2&gt;/dev/null\n</code></pre> <p>And we're done!</p>"},{"location":"g2migr-example.html#checking-things-out","title":"checking things out","text":"<p>Let's see what repos u3 has:</p> <pre><code># as user 'u3'\nssh git@server info\nhello u3, this is git@server running gitolite3 v3.0-11-g090b0f5 on git 1.7.7.6\n\n     C      baz/..*\n R W        baz/u3\n R W        baz/uthree\n R W        gitolite-admin\n R W        testing\n</code></pre> <p>That's a combination of 'info' and 'expand', by the way.  There is no expand command any more.</p> <p>How about adding a new repo and checking if the config entries made it?</p> <pre><code># as user u4\n$ git ls-remote git@server:baz/ufour\nInitialized empty Git repository in /home/git/repositories/baz/ufour.git/\n$ grep -A1 foo `find repositories -name \"config\" `\nrepositories/baz/u3.git/config:[foo]\nrepositories/baz/u3.git/config- bar = baz\n--\nrepositories/baz/u4.git/config:[foo]\nrepositories/baz/u4.git/config- bar = baz\n--\nrepositories/baz/ufour.git/config:[foo]\nrepositories/baz/ufour.git/config-      bar = baz\n--\nrepositories/baz/uthree.git/config:[foo]\nrepositories/baz/uthree.git/config-     bar = baz\n</code></pre> <p>And there it is, in the second block of lines...</p> <p>And now we're really done.</p>"},{"location":"git-config.html","title":"specifying \"git-config\" keys and values","text":"<p>(Original version thanks to teemu dot matilainen at iki dot fi.)</p> <p>Important: This won't work unless the rc file has the right settings; please see <code>$GIT_CONFIG_KEYS</code> in the rc file doc.</p>"},{"location":"git-config.html#basic-syntax","title":"basic syntax","text":"<p>The syntax is simple:</p> <pre><code>config sectionname.keyname = value\n</code></pre> <p>For example:</p> <pre>\nrepo gitolite\n    config hooks.mailinglist = gitolite-commits@example.tld\n    config hooks.emailprefix = \"[gitolite] \"\n    config foo.bar = \"\"\n</pre> <p>This does either a plain \"git config section.key value\" (for the first 2 examples above) or \"git config --unset-all section.key\" (for the last example).  Other forms of the <code>git config</code> command (<code>--add</code>, the <code>value_regex</code>, etc) are not supported.</p>"},{"location":"git-config.html#an-important-warning-about-deleting-a-config-line","title":"an important warning about deleting a config line","text":"<p>Simply deleting the config line from the <code>conf/gitolite.conf</code> file will not delete the variable from <code>repo.git/config</code>.  You have to use the syntax in the last example to make gitolite execute a <code>--unset-all</code> operation on the given key.</p>"},{"location":"git-config.html#substituting-the-repo-name-and-the-creator-name","title":"substituting the repo name and the creator name","text":"<p>You can also use the special values <code>%GL_REPO</code> and <code>%GL_CREATOR</code> in the string.  The former is available to all repos, while the latter is only available to wild repos.</p> <pre>\nrepo foo bar baz\n    config hooks.mailinglist = %GL_REPO-commits@example.tld\n    config hooks.emailprefix = \"[%GL_REPO] \"\n</pre>"},{"location":"git-config.html#v367-expanding-a-group-name","title":"(v3.6.7+) expanding a group name","text":"<p>If you add</p> <pre><code>EXPAND_GROUPS_IN_CONFIG     =&gt;  1,\n</code></pre> <p>to the rc file (suggested location: just after the <code>GIT_CONFIG_KEYS</code> line), then the value of a config line will have groupnames expanded.  For example:</p> <pre>\n@admins = sitaramc@gmail.com jdoe@example.com\n...\nrepo foo\n    ...\n    config hooks.mailinglist = @admins\n</pre> <p>will behave as if the two email addresses were explicitly listed in the config line.  However, if there is no such group, the text will be left as-is.  Also, for safety, only word characters (alphanumerics and underscore) are expected as part of the group name.</p>"},{"location":"git-config.html#overriding-config-values","title":"overriding config values","text":"<p>You can repeat the 'config' line as many times as you like, and the last occurrence will be the one in effect.  This allows you to override settings just for one project, as in this example:</p> <pre>\nrepo @all\n    config hooks.mailinglist = %GL_REPO-commits@example.tld\n    config hooks.emailprefix = \"[%GL_REPO] \"\n\n... later ...\n\nrepo customer-project\n    # different mailing list\n    config hooks.mailinglist = announce@customer.tld\n</pre> <p>The \"delete config variable\" syntax can also be used, if you wish:</p> <pre>\nrepo secret     # no emails for this one please\n    config hooks.mailinglist = \"\"\n    config hooks.emailprefix = \"\"\n</pre> <p>As you can see, the general idea is to place the most generic ones (<code>repo @all</code>, or repo regex like <code>repo foo.*</code>) first, and place more specific ones later to override the generic settings.</p>"},{"location":"git-config.html#compensating-for-unsafe_patt-and-other-patterns","title":"compensating for UNSAFE_PATT (and other patterns)","text":"<p>An important feature in gitolite is that you can share the admin load with more people, without having to give all of them shell access on the server.  Thus there are some restrictions designed to prevent someone who can push the gitolite-admin repo, from somehow managing to run arbitrary commands on the server.</p> <p>This section is about one of these restrictions.</p> <p>Gitolite, by default, does not allow the following characters in the value of a config variable: <code>` ~ # $ &amp; ( ) | ; &lt; &gt;</code>.  This is due to unspecified paranoia; see this discussion for some context.  This restriction is enforced by a regex called <code>UNSAFE_PATT</code>, whose default value is <code>[`~#\\$\\&amp;()|;&lt;&gt;]</code>.</p> <p>But let's say you need to do this, which fails due to the semicolon.</p> <pre>\n    config hooks.showrev = \"git show -C %s; echo\"\n</pre> <p>There are two ways to fix this.</p> <p>If all your admins already have shell access, you can override this by placing a modified version in the rc file.  For our example, you'd just put the following line at the very end of your rc file, just before the <code>1;</code> line (notice there is no semicolon in the regex here):</p> <pre><code>$UNSAFE_PATT          = qr([`~#\\$\\&amp;()|&lt;&gt;]);\n</code></pre> <p>Similarly, you can remove other characters from that regex (to allow those characters in your config values).</p> <p>If all your admins do not have shell access, you need a more fine-grained method:</p> <ul> <li> <p>In the rc file, add the following within the '%RC' hash (for example, just     after the UMASK line would do fine):</p> <pre><code>SAFE_CONFIG =&gt; {\n    SHOWREV         =&gt;  \"git show -C %s; echo\"\n},\n</code></pre> </li> <li> <p>In your gitolite.conf file, add this instead of the line we saw earlier:</p> </li> </ul> <pre>\n    config hooks.showrev = %SHOWREV\n</pre> <p>This mechanism allows you to add any number of specific violations to the <code>UNSAFE_PATT</code> rule instead of denaturing the regex itself and potentially allowing something that could be (ab)used by a repo admin to obtain shell access at some later point in time.</p> <p>A similar problem arises with email addresses, which contain the <code>&lt;</code> and <code>&gt;</code> characters.  Here's how to deal with that easily:</p> <ul> <li> <p>In the rc file:</p> <pre><code>SAFE_CONFIG =&gt; {\n    LT              =&gt;  '&lt;',\n    GT              =&gt;  '&gt;',\n},\n</code></pre> </li> <li> <p>In the gitolite.conf file:</p> </li> </ul> <pre>\n    config hooks.mailinglist = \"Sitaram Chamarty %LTsitaramc@gmail.com%GT\"\n</pre> <p>Admittedly, that looks a wee bit ugly, but it gets the job done without having to remove angle brackets from UNSAFE_PATT.</p>"},{"location":"gitolite-and-ssh-certs.html","title":"gitolite and ssh certificates","text":"<p>Please see the Appendix at the bottom for background and earlier discussions of this topic on the mailing list.</p>"},{"location":"gitolite-and-ssh-certs.html#objectives","title":"objectives","text":"<ul> <li>should not interfere in any way with existing ssh setup for other services     on the same machine, whether they are using certificates or not</li> <li>if the site is already using ssh certs, should piggy-back on existing     setup, (whether it is homegrown, or something like teleport) and impose     minimal demands on them<ul> <li>specifically, we should not require separate certificates for     gitoliite, or require people to create separate keys for gitolite, etc.</li> </ul> </li> <li>finally, it should not require any changes to gitolite core<ul> <li>this     may be useful as additional context for this</li> </ul> </li> </ul> <p>Note:</p> <p>Gitolite has an additional constraint on top of whatever any ssh cert management system can natively handle.  The system user is \"git\", and the \"forced command\" requires an argument that represents the user's \"gitolite username\".</p> <p>The simplest way to deal with this, for, say, user \"alice\", is to present the pubkey to the CA system, asking for principals \"gitolite\" and \"gitolite-user:alice\" to be added to the certificate.</p> <p>The principal \"gitolite\" is used to allow login.  The principal \"gitolite-user:alice\" is not actually used for any login, but is extracted from the logged in certificate and passed to \"gitolite-shell\" as the gitolite username.</p> <p>Any other method seems to violate one of our objectives.</p> <p>Specifically...</p> <p>...notice that if you already use ssh certs, you only have to: (1) add the \"Match User git\" section to sshd config (2) add the two supporting files (see last bullet in the \"detailed steps\" section), and (3) ask the CA to add two principals to the certificates they issue, if the user is a gitolite user (see below)</p>"},{"location":"gitolite-and-ssh-certs.html#host-certs-and-user-certs","title":"host certs and user certs","text":"<p>There are two parts to certificate usage.  One deals with the \"host key\" and its fingerprint; this is the piece that sometimes shows messages like this:</p> <pre><code>The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.\n[...etc...]\n</code></pre> <p>or, worse, this:</p> <pre><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\n[...and so on...]\n</code></pre> <p>User certs (authenticating the user) is where there are several ways of doing things.  What follows is one very simple way of using ssh certs, but this is by no means prescriptive and you may have a better way that I did not think of.</p>"},{"location":"gitolite-and-ssh-certs.html#detailed-steps","title":"detailed steps","text":"<p>This takes a \"default\" ssh setup and does just enough to get this working.</p> <ul> <li> <p>create CA keys.  Note that normally the CA keys are on a different     machine, and pubkeys to be signed have to be copied to that machine, then     the certs produced copied back.  We're ignoring all those details here.</p> <p><pre>\ncd /etc/ssh\nssh-keygen -f user_ca -C user_ca\nssh-keygen -f host_ca -C host_ca\n</pre></p> </li> <li> <p>sign the (already existing) host key</p> <p><pre>\ncd /etc/ssh\nssh-keygen -s host_ca -I CA-server -h -n testpc ssh_host_rsa_key\n# (...similarly ed25519, ecdsa, etc...)\n</pre></p> </li> <li> <p>add the following to sshd config.  Most systems now allow you to add     related entries in a separate file within, typically,     <code>/etc/ssh/sshd_config.d/</code> so you may be able to do that also.</p> <p>Don't forget to restart sshd after this.</p> <p><pre>\n# host cert: make the server \"offer\" this host-key-certificate when a user\n# tries to login\nHostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub\n# ...similarly other host key certs...\n<p># user certs: make host trust user certificates\nTrustedUserCAKeys /etc/ssh/user_ca.pub\n# we have only one CA for now so we just use the CA pub key as is, but\n# in real life this could be a separate file with multiple CA pubkeys,\n# one per line</p>\n<p># just for the git user, force command \"/usr/local/bin/gl-wrapper\"\n# from within an AuthorizedPrincipalsFile.\nMatch User git\n    # once you have migrated everyone to certs, uncomment this line and\n    # restart sshd\n    # AuthorizedKeysFile none\n    #\n    # expose auth info: this creates an env var $SSH_USER_AUTH pointing\n    # to a file that contains the certificate used, from which we\n    # extract the gitolite-user\n    ExposeAuthInfo yes\n    #\n    AuthorizedPrincipalsFile /etc/ssh/gitolite-apf\n    # this file contains just one line:\n    #       restrict,command=\"/usr/local/bin/gl-wrapper\" gitolite\n    # gl-wrapper will parse $SSH_USER_AUTH and extract the gitolite\n    # username from it, then call gitolite-shell\n    #\n    # you may have to edit the path of gitolite-shell within\n    # /usr/local/bin/gl-wrapper\n</p>\n\n<li>\n<p>make the \"client\" accept this CA as a host CA.  This will be the same for\n    every client, since sites usually only have one CA.</p>\n<p><pre>\ncd /etc/ssh\n(echo -n \"@cert-authority testpc \"; cat host_ca.pub) &gt; ssh_known_hosts\n</pre></p>\n</li>\n<li>\n<p>sign user pubkeys and produce certs to be given back to them.</p>\n<p>This is how you setup a gitolite user.  You need to assign both the\ngeneric \"gitolite\" principal, so that the user can log in to \"git\", and\nalso a specific one to identify the person's gitolite username.</p>\n<p><pre>\nssh-keygen -s user_ca -I user-1 -n gitolite,gitolite-user:alice alice.pub\nssh-keygen -s user_ca -I user-2 -n gitolite,gitolite-user:carol carol.pub\n</pre></p>\n<p>Note the principal <code>gitolite-user:alice</code> -- this gets parsed to \"alice\" as\nwe will see later.</p>\n</li>\n<li>\n<p>install supporting file and script:</p>\n<ul>\n<li>\n<p><code>/etc/ssh/gitolite-apf</code> should contain just one line:</p>\n<p><pre>\nrestrict,command=\"/usr/local/bin/gl-wrapper\" gitolite\n</pre></p>\n</li>\n<li>\n<p><code>/usr/local/bin/gl-wrapper</code> should contain this (and should be\n    executable):</p>\n<p><pre>\n#!/bin/bash\n<p># $SSH_USER_AUTH is set by sshd because we enabled `ExposeAuthInfo`.\n# It contains the cert used to login, which we parse to get the\n# gitolite username from the output.  The parsing is a bit simplistic\n# but works fine.\ngl_user=$(cat $SSH_USER_AUTH |\n    grep '^publickey' |\n    cut -f2- -d' ' |\n    ssh-keygen -L -f - |\n    grep -E -o gitolite-user:'\\S+' |\n    cut -f2 -d:\n    )</p>\n<p>exec /home/git/gitolite/src/gitolite-shell $gl_user\n# BE SURE TO CHANGE THE ABOVE PATH!\n</p>\n\n\n\n<p>Sidenote</p>\n<p>If it seems like parsing the output of what in git parlance would be\ncalled \"porcelain\" is not a good idea, I'm in good company.\nhttps://en.wikibooks.org/wiki/OpenSSH/Cookbook/Certificate-based_Authentication#Forced_Commands_with_User_Certificates\ndoes exactly the same thing :)</p>"},{"location":"gitolite-and-ssh-certs.html#appendix-background-and-discussion","title":"Appendix -- background and discussion","text":"<p>There have been a few emails over the years about this on the mailing list,\nand I tried to understand how ssh certs work and so on back then, culminating\nin this email.\nThat was still too open-ended, because there's more than one way to do it and\nnone of them is canonical in any sense.  And even though there were other\nemails from folks who tried it themselves, none of those seemed to hit all the\nimportant points either.</p>\n<p>One of the mechanisms discussed in that earlier email was \"without root\naccess\".  Sadly, the only way to do this is to dedicate the entire ssh-cert\nmechanism for the exclusive use of gitolite.  This is not very useful, since\nat least some of the reasons that make ssh certs better than ssh pubkeys, do\nnot apply to gitolite (the admin repo is a single source of auditable truth\nfor who can access what, and removing a user is trivially achieved by deleting\nhis key from <code>keydir/</code>).  Thus, if you're using certs only for gitolite I'm\nnot even sure it is worth doing.</p>\n<p>This means the best mechanism will integrate cleanly with any existing use of\nssh certs in the organisation, which is what this method focuses on.</p>\n<p>We're also not considering revocation.  Any org using ssh certs should think\nabout this from a larger perspective, not just gitolite, along with the\ndecision on how the pubkeys are actually going to be signed.  The popular\nstrategy seems to be to use a web-based system tied into some corporate\n\"userid\" to authenticate the user and issue him a cert, either with a\npreviously stored pubkey or a freshly pasted/uploaded one, and make the cert\nvery short-lived (typically 5-15 minutes, though sometimes I have heard of\ncerts valid for 8-9 hours).</p>"},{"location":"gitweb-daemon.html","title":"allowing access to gitweb and git-daemon","text":"<p>Gitolite does not install or configure gitweb/git-daemon -- that is a one-time setup you must do separately.</p>"},{"location":"gitweb-daemon.html#gitweb","title":"gitweb","text":"<p>The following repos are deemed to be readable by gitweb:</p> <ul> <li>Any repos readable by the special user <code>gitweb</code>.</li> <li> <p>Any repos containing one or more of the following types of lines:     (actually, any config variable starting with <code>gitweb</code>).</p> <pre><code>config gitweb.owner         =   owner name\nconfig gitweb.description   =   some description\nconfig gitweb.category      =   some category\n</code></pre> <p>Side note: the following shorter forms are available as syntactic sugar for the above longer forms:</p> <pre><code>owner       =   owner name\ndesc        =   some description\ncategory    =   some category\n</code></pre> </li> </ul> <p>The list of gitweb-readable repos is written to a file whose name is given by the rc file variable <code>GITWEB_PROJECTS_LIST</code>.  The default value of this variable, if it is not specified or empty, is <code>$HOME/projects.list</code>.</p> <p>In addition, each of the config variables described above is written to the repo to which it pertains, so that gitweb can use them.</p>"},{"location":"gitweb-daemon.html#changing-the-umask","title":"changing the UMASK","text":"<p>Gitweb (or cgit, redmine, etc.) typically runs under a different userid, and the default permissions that gitolite sets make them unreadable.</p> <p>See the section on the <code>UMASK</code> variable in the page for the rc file.</p>"},{"location":"gitweb-daemon.html#repo-specific-authorisation-in-gitweb","title":"repo-specific authorisation in gitweb","text":"<p>Gitweb has a feature whereby it will call a (perl) function that you supply, passing it the full path to the repo being accessed.  If the remote user is authenticated, the username will be available, so your function can take those two pieces of information and return true or false to allow or deny the repository access.</p> <p>If you want to use gitolite's access rules in making this determination, you will first have to ensure that the HTTP username (i.e., the username known to apache/gitweb) is the same as the gitolite username.  If you're using gitolite's http mode, this is probably already true, but if you're using the more widely used ssh mode, you'll have to make sure they match.</p> <p>You then need to add this code to your gitweb.conf.</p>"},{"location":"gitweb-daemon.html#git-daemon","title":"git-daemon","text":"<p>Any repo readable by the special user <code>daemon</code> is deemed to be readable by git-daemon.  For each of these repos, an empty file called <code>git-daemon-export-ok</code> is created in the repository (i.e., the <code>repo.git</code> directory inside <code>$HOME/repositories</code>).</p>"},{"location":"gitweb-daemon.html#tips","title":"tips","text":"<p>Setting descriptions en-masse usually does not make sense, but you can certainly do things like</p> <pre><code>repo @all\n    R       =   gitweb daemon\n</code></pre> <p>assuming you have other means of setting 'gitweb.description' and 'gitweb.owner'.</p> <p>Also see this for a twist on that.</p>"},{"location":"glssh.html","title":"how gitolite uses ssh","text":"<p>Although other forms of authentications exist (see the section on authentication versus authorisation), ssh is the one that most git users use.</p> <p>Therefore, gitolite is (usually) heavily dependent on ssh.</p> <p>Most people didn't realise this, and even if they did they don't know ssh well enough to help themselves.  If you don't understand how ssh public key authentication works, or how the <code>~/.ssh/authorized_keys</code> file can be used to restrict users, etc., you will have endless amounts of trouble getting gitolite to work, because you'll be attacking the wrong problem.</p> <p>So please please please understand this before tearing your hair out and blaming git/gitolite for whatever is going wrong with your setup :-)</p>"},{"location":"glssh.html#ssh-basics","title":"ssh basics","text":"<p>Let's start with some basics, focusing only on the pieces relevant to <code>gitolite</code>.  If this is not detailed enough, please use google and learn more from somewhere, or maybe buy the OReilly ssh book.</p> <ul> <li> <p>You can login to an ssh server by typing a password, but ssh can also use     public-private keys (also called \"key pairs\") for authentication.     <code>gitolite</code> requires you to use this mechanism for your users -- they     cannot log in using passwords.  Hopefully by the time you finish reading     this page you will understand why :-)</p> <p>The way you set this up is you generate a key pair on your workstation, and give the server the public key.  (I need not add that the \"private\" key must be, well, kept private!)</p> </li> <li> <p>Generating a key pair on your workstation is done by running the     command <code>ssh-keygen -t rsa</code>.  This produces two files in <code>~/.ssh</code>.  One is     <code>id_rsa</code>; this is the private key -- never let it out of your     machine.  The other is <code>id_rsa.pub</code>, which is the corresponding public     key.  This public key is usually just one long line of text.</p> <ul> <li>On Windows machines with msysgit installed, you should do this from   within a \"git bash\" window.  The command will report the full path where   the files have been written; make a note of this, and use those files in   any of the description that follows.</li> </ul> </li> <li> <p>Adding your public key to the server's <code>~/.ssh/authorized_keys</code>     file is how ssh uses pubkeys to authenticate users.  Let's say     sita@work.station is trying to log in as git@serv.er.  What you have to do     is take the <code>~/.ssh/id_rsa.pub</code> file for user sita on work.station and     append its contents (remember it's only one line) to     <code>~/.ssh/authorized_keys</code> for user git on serv.er.</p> <p>The <code>authorized_keys</code> file can have multiple public keys (from many different people) added to it so any of them can log in to git@serv.er.</p> <p>In the normal case (not gitolite, but your normal everyday shell access), there's a command that does this, <code>ssh-copy-id</code>, which also fixes up permissions etc., as needed, since sshd is a little picky about allowing pubkey access if permissions on the server are loose.  Or you can do it manually, as long as you know what you're doing and you're careful not to erase or overwrite the existing contents of <code>~/.ssh/authorized_keys</code> on the server!</p> <p>But with gitolite, it does this for you; see adding and removing users for more.</p> <ul> <li>Troubleshooting pubkey authentication failures: if you are unable to   get ssh access to the server after doing all this, you'll have to look   in <code>/var/log/secure</code> or <code>/var/log/auth.log</code> or some such file on the   server to see what specific error <code>sshd</code> is complaining about.</li> </ul> </li> <li> <p>Restricting users to specific commands is very important for gitolite.     If you read <code>man sshd</code> and look for <code>authorized_keys file format</code>, you'll     see a lot of options you can add to the public key line, which restrict     the incoming user in various ways.  In particular, note the <code>command=</code>     option, which means \"regardless of what the incoming user is asking to do,     forcibly run this command instead\".</p> <p>Also note that when there are many public keys (i.e., lines) in the <code>authorized_keys</code> file, each line can have a different set of options and <code>command=</code> values.</p> <p>Without this <code>command=</code> option, the ssh daemon will simply give you a shell, which is not what we want for our gitolite keys (although we may well have other keys which we use to get a shell).</p> <p>This is the backbone of what makes gitolite work; please make sure you understand this.</p> </li> </ul>"},{"location":"glssh.html#how-does-gitolite-use-all-this-ssh-magic","title":"how does gitolite use all this ssh magic?","text":"<p>These are two different questions you ought to be having by now: </p> <ul> <li>How does it distinguish between me and someone else, since we're all     logging in as the same remote user \"git\".</li> <li>How does it restrict what I can do within a repository.</li> </ul>"},{"location":"glssh.html#restricting-shell-accessdistinguishing-one-user-from-another","title":"restricting shell access/distinguishing one user from another","text":"<p>The answer to the first question is the <code>command=</code> we talked about before.  If you look in the <code>authorized_keys</code> file, you'll see entries like this (I chopped off the ends of course; they're pretty long lines):</p> <pre><code>command=\"[path]/gitolite-shell sitaram\",[more options] ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA18S2t...\ncommand=\"[path]/gitolite-shell usertwo\",[more options] ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEArXtCT...\n</code></pre> <p>First, it finds out which of the public keys in this file match the incoming login.  That's crypto stuff, and I won't go into it.  Once the match has been found, it will run the command given on that line; e.g., if I logged in, it would run <code>[path]/gitolite-shell sitaram</code>.  So the first thing to note is that such users do not get \"shell access\", which is good!</p> <p>Before running the command, however, sshd sets up an environment variable called <code>SSH_ORIGINAL_COMMAND</code> which contains the actual git command that your workstation sent out.  This is the command that would have run if you did not have the <code>command=</code> part in the authorised keys file.</p> <p>When <code>gitolite-shell</code> gets control, it looks at the first argument (\"sitaram\", \"usertwo\", etc) to determine who you are.  It then looks at the <code>SSH_ORIGINAL_COMMAND</code> variable to find out which repository you want to access, and whether you're reading or writing.</p> <p>Now that it has a user, repository, and access requested (read/write), gitolite looks at its config file, and either allows or rejects the request.</p> <p>But this cannot differentiate between different branches within a repo; that has to be done separately.</p>"},{"location":"glssh.html#restricting-branch-level-actions","title":"restricting branch level actions","text":"<p>[If you look inside the git source tree, there's a file among the \"howto\"s in there called <code>update-hook-example.txt</code>, which was the inspiration for this part of gitolite.]</p> <p>Git allows you to specify many \"hooks\", which get control as various events happen -- see <code>git help hooks</code> for details.  One of those hooks is the <code>update</code> hook, which, if it is present, is invoked just before a branch or a tag is about to be updated.  The hook is passed the name of the branch or tag, the old SHA1 value, and the new SHA1 value, as arguments.  Hooks that are called before an action happens are allowed to prevent that action from happening by returning an error code.</p> <p>When gitolite is told to create a new repository (by the admin), it installs a special update hook.  This hook takes all the information presented, looks at the config file, and decides to allow or reject the update.</p> <p>And that's basically it.</p>"},{"location":"http.html","title":"installing on a smart http git server","text":"<p>Note:</p> <p>\"smart http\" refers to the feature that came with git 1.6.6, late 2009 or so.  The base documentation for this is <code>man git-http-backend</code>.  Do NOT read <code>Documentation/howto/setup-git-server-over-http.txt</code> and think that is the same or even relevant -- that is from 2006 and is quite different (and arguably obsolete).</p>"},{"location":"http.html#warnings-and-important-notes","title":"WARNINGS and important notes","text":"<ul> <li> <p>Please read authentication versus authorisation first, and make     sure you understand what is gitolite's responsibility and what isn't.</p> </li> <li> <p>I have tested this only on stock Fedora (whatever is the current version);     YDMV.</p> </li> </ul>"},{"location":"http.html#assumptions","title":"assumptions","text":"<ul> <li>Apache 2.x and git installed.</li> <li>Httpd runs under the \"apache\" userid; adjust instructions below if not.</li> <li>Similarly for \"/var/www\" and other file names/locations.</li> </ul>"},{"location":"http.html#instructions","title":"instructions","text":"<p>In place of detailed instructions, there is a script called <code>t/smart-http.root-setup</code>.  Do NOT run this script as is -- it is actually meant for my testing setup and deletes stuff.  However, it does provide an excellent (and working!) narration of what you need to do to install gitolite in smart http mode.</p> <p>Make a copy of the script, go through it carefully, (possibly removing lines that delete files etc.), change values per your system, and only then run it.</p> <p>Note:</p> <p>The <code>GIT_PROJECT_ROOT</code> variable (see \"man git-http-backend\") is no longer optional.  Make sure you set it to some place outside apache's <code>DOCUMENT_ROOT</code>.</p>"},{"location":"http.html#allowing-unauthenticated-access","title":"allowing unauthenticated access","text":"<p>If you want users to see repos without performing any HTTP authentication, you should first decide what repos they should have unauthenticated access to:</p> <pre><code>repo foo bar baz        # or maybe '@all'?\n    R   =   nobody\n</code></pre> <p>Then in the rc file (<code>~/.gitolite.rc</code>), in the section marked \"rc variables used by various features\", add this (including the trailing comma):</p> <pre><code>HTTP_ANON_USER      =&gt;  'nobody',\n</code></pre> <p>Updated 2019-10-19</p> <p>The above does not seem to work any more.  The way it was supposed to work was that the user could supply a userid, or not.  If he did not, then gitolite would notice (the environment variable <code>REMOTE_USER</code> would be empty) and would then use whatever was specified above (in this case, <code>nobody</code>).</p> <p>This does not seem to happen any more.  Apache seems to insist on a userid, period.  Unfortunately I am very far from being an expert in apache configuration, so, if someone can make this work without requiring any userid at all, please let me know.</p>"},{"location":"http.html#making-repositories-available-to-both-ssh-and-http-mode-clients","title":"Making repositories available to both ssh and http mode clients","text":"<p>This section has been contributed by Thomas Hager (duke at sigsegv dot at), and is available here.</p>"},{"location":"http.html#usage","title":"usage","text":"<p>Warning:</p> <p>Http mode does not seem capable of setting an exit code when things fail, unlike ssh mode.  Therefore, using an http-hosted gitolite in scripts may need more care and thought.</p>"},{"location":"http.html#client-side","title":"client side","text":"<p>Git URLs look like <code>https://user:password@server/git/reponame.git</code>.</p> <p>The custom commands, like \"info\", \"expand\" should be handled as follows.  The command name will come just after the <code>/git/</code>, followed by a <code>?</code>, followed by the arguments, with <code>+</code> representing a space.  Here are some examples:</p> <pre>\n# ssh git@server info\ncurl https://user:password@server/git/info\n# ssh git@server info repopatt\ncurl https://user:password@server/git/info?repopatt\n# ssh git@server info repopatt user1 user2\ncurl https://user:password@server/git/info?repopatt+user1+user2\n</pre> <p>With a few nice shell aliases, you won't even notice the horrible convolutions here ;-)  See t/smart-http for a couple of useful ones.</p>"},{"location":"http.html#server-side","title":"server side","text":"<p>The <code>gitolite</code> command (for example, <code>gitolite compile</code>, <code>gitolite query-rc</code>, and so on) can be run on the server, but it's not straightforward.  Assuming you installed exactly as given in this page, you should</p> <ul> <li>get a shell by using, say, <code>su -s /bin/bash - apache</code></li> <li>run <code>export HOME=$HOME/gitolite-home</code></li> <li>run <code>export PATH=$PATH:$HOME/bin</code></li> </ul> <p>and then you can run <code>gitolite &lt;subcommand&gt;</code></p>"},{"location":"install.html","title":"install and setup","text":"<p>IMPORTANT</p> <p>Almost nothing in gitolite requires <code>root</code> (with some obvious exceptions). Unless the documentation says \"do this from <code>root</code>\", assume it is to be done from the hosting user account.</p> <p>This page is about an ssh mode installation.  It should work for most people, but if you are an absolute newbie to Unix etc., you may want to click here for a very detailed, step-by-step, hopefully fool-proof set of instructions.</p> <p>If ssh is not your thing, there's a different page for http mode installation.</p>"},{"location":"install.html#before-you-start-pre-requisites","title":"before you start... (pre-requisites)","text":""},{"location":"install.html#your-skills","title":"your skills","text":"<ul> <li> <p>Please DO read the concepts and terminology page before doing     anything here.</p> </li> <li> <p>If you're installing gitolite, you're a \"system admin\", like it or not.     Since most people use the ssh mode, ssh is therefore a necessary     skill.  Please take the time to learn at least enough to get passwordless     access working.</p> </li> <li> <p>You also need to be somewhat familiar with git itself.  You cannot     administer a whole bunch of git repositories if you don't know the basics     of git.</p> <p>Please make sure you understand at least the following concepts: bare versus non-bare repos, cloning a repo, making changes and committing them, pushing commits to a 'remote', the special remote called 'origin', difference between a fast-forward push and a rewind push, 'refs' (i.e., branches and tags).</p> <p>It also helps to understand git's hooks mechanism, git-config, and so on.</p> </li> <li> <p>Some familiarity with Unix and shells is probably required.</p> </li> <li> <p>Regular expressions are a big part of gitolite in many places but     familiarity is not necessary to do basic access control.</p> </li> </ul>"},{"location":"install.html#your-server","title":"your server","text":"<ul> <li>Any Unix system with a posix compatible \"sh\" and a sane file system.</li> <li>Git version 1.6.6 or later.</li> <li>Perl 5.8.8 or later (see https://lwn.net/Articles/348084/ if this does     not seem to be enough).</li> <li> <p>Openssh (almost any version).  Optional if you're using smart http.</p> <ul> <li>IMPORTANT: although a default openssh config will not do this (AFAIK),     do not allow the user to set environment variables if you care about     security at all.</li> </ul> </li> <li> <p>A dedicated Unix userid to be the hosting user, usually \"git\" but it can     be any user, even your own normal one.  (If you're using an RPM/DEB the     install probably created one called \"gitolite\").</p> </li> </ul>"},{"location":"install.html#you-and-your-users-clients","title":"you and your users' clients","text":"<ul> <li>Openssh client.</li> <li>Git 1.6.6 or later.  Almost any git client will work, as long as it knows     how to use ssh keys and send the right one along.</li> </ul>"},{"location":"install.html#cautions-and-caveats","title":"cautions and caveats","text":"<p>Please take note of the following points:</p> <ul> <li> <p>If you're bringing existing repos into gitolite, please see     this first.</p> </li> <li> <p>Gitolite expects all the directories and files it manages/uses to be owned     by the hosting user and not have strange permissions and ownerships.</p> </li> <li> <p>Gitolite does NOT like it if you fiddle with files and directories it cares about in any way except as directed in the documentation.</p> </li> <li> <p>Gitolite depends on several system-installed packages: openssh, git, perl,     sh being the main ones.  They should all be configured sensibly and with     most of the normal defaults.  (For example, if your sshd config says the     authorized keys file should be placed in some directory other than the     default, expect trouble).</p> </li> </ul>"},{"location":"install.html#trying-out-gitolite-safely","title":"trying out gitolite safely","text":"<p>If you're not sure if gitolite is right for you or your system, it's easy to take it for a trial run, in ssh mode, and play with all of its features (except mirroring).  This is very safe, and does not affect anything on your system permanently.</p> <p>WARNING: this will clobber these files and directories in your <code>$HOME</code>.  Ideally, you should use a throwaway userid.</p> <p>Just create a throw-away userid, log in to it, then run these commands:</p> <pre><code>git clone https://github.com/sitaramc/gitolite\ncd gitolite\nprove t/ssh*\n</code></pre> <p>You will get an error that forces you to read <code>t/README</code> and set an env var before the test can proceed.  This is intentional; I've had people who don't pay attention to the \"data loss\" warning, and then complain that it was not prominent enough.  Forcing them to read a much smaller page appears to focus their attention better!</p> <p>If it doesn't work, re-read this page to see if you may have missed something that gitolite requires, or ask for support.</p> <p>If it works, you get a gitolite installation with 7 gitolite users (\"admin\", and \"u1\" through \"u6\").</p> <p>Don't forget that the client and the server are all on the same user on the same machine; we're simulating 7 gitolite users using ssh keys!  (How? Maybe <code>~/.ssh/config</code> will give you a hint).</p> <p>URLs look like <code>user:repo</code>, so for example you can clone the admin repo by <code>git clone admin:gitolite-admin</code>.  Remote commands look like <code>ssh u1 info</code>.</p> <p>So start by cloning the admin repo, and try out whatever you want!</p>"},{"location":"install.html#install-and-setup_1","title":"install and setup","text":"<p>This section talks about installing the software manually (i.e., not using a package manager) and setting it up.  The install step gets the code to where you want it.  The setup step creates the files and directories gitolite needs, including the special gitolite-admin repo, and makes you an administrator so you can manage it remotely.</p> <p>If you install gitolite using a package manager, you should check your distro-standard mechanisms or distro-supplied documentation for how to complete the installation.</p> <p>Important:</p> <p>On package manager installs: make sure you get gitolite v3.x. The correct package you want may be called \"gitolite3\", even though \"gitolite\" also exists.  If you want to know what the latest gitolite version is, the gitolite CHANGELOG will tell you.</p>"},{"location":"install.html#a-graphical-overview","title":"(a graphical overview)","text":"<p>Here's a graphical overview of what files/directories are affected by each step in the install+setup process.  Alice is installing gitolite, with herself as the administrator.</p> <p></p> <p>The files names you see there are only for information.  You do not have to do anything to them yourself; in fact you should not!  You only need the command for each numbered step shown:</p> <ol> <li>Copy the admin's pubkey to the server as \"alice.pub\".</li> <li>Run <code>git clone https://github.com/sitaramc/gitolite</code> or equivalent.</li> <li>Run <code>gitolite/install -ln</code>.</li> <li>Run <code>gitolite setup -pk alice.pub</code>.</li> </ol> <p>Note also that you only need ONE real user on the server.  In our example it is git.  In particular, you do NOT create Unix userids for your gitolite users.</p>"},{"location":"install.html#prepare-for-the-install","title":"prepare for the install","text":"<p>The simplest, most foolproof, way of ensuring that your gitolite install + setup will succeed is to use a brand new userid as the hosting user.  If that is not possible, make sure the following do NOT exist in that user's home directory: <code>~/.gitolite.rc</code>, <code>~/.gitolite</code>, <code>~/repositories</code>, and <code>~/.ssh/authorized_keys</code>.</p> <p>Before you go trashing that authorized keys file, please make sure you know the password to the 'git' user, or know the root password on the machine!</p> <p>The authorized keys file can exist, actually, as long as none of the keys you intend to use with gitolite are present in it.  But again, if you're not an ssh guru, you should probably play safe.</p>"},{"location":"install.html#get-the-software","title":"get the software","text":"<p>Get the software using git-clone:</p> <pre>\ngit clone https://github.com/sitaramc/gitolite\n</pre> <p>You can use this as is, or you can check out the latest tag to make sure you're running a tagged version instead of just the current 'master'.</p>"},{"location":"install.html#install","title":"install","text":"<p>Gitolite has one server side command: <code>gitolite</code>.  You don't need to place it anywhere special; in the worst case you can run it with the full path.</p> <p>\"Installation\" consists of deciding where to put it:</p> <ol> <li>Keep the sources anywhere and use the full path to run the <code>gitolite</code>     command.</li> <li>Keep the sources anywhere and symlink just the <code>gitolite</code> program to     some directory on your <code>$PATH</code>.</li> <li>Copy the sources somewhere and use that path to run the <code>gitolite</code>     command.</li> </ol> <p>Option 2 is the best for general use, but here's the scoop on all of them:</p> <pre>\n# option 1\ngitolite/install\n\n# option 2\ngitolite/install -ln\n# defaults to $HOME/bin (which is assumed to exist)\n#   ** or **\n# or use a specific directory (please supply FULL path):\ngitolite/install -ln /usr/local/bin\n\n# option 3\n# (again, please supply a FULL path)\ngitolite/install -to /usr/local/gitolite/bin\n</pre> <p>Creating a symlink doesn't need a separate program but 'install' also runs <code>git describe</code> to create a VERSION file, which can be very important if you want support :-)</p>"},{"location":"install.html#setup","title":"setup","text":"<p>For the first-time setup, you need to have a public key file (usually from the admin's workstation) ready.  If the main gitolite admin's username is \"alice\", this file should be named \"alice.pub\" and copied to the server.</p> <p>Once that is done, run:</p> <pre><code>gitolite setup -pk alice.pub\n</code></pre> <p>If that completes without any warnings, you are done.  If it had a warning, you probably supplied a key which already has shell access to the server. That won't work; you'll have to generate and use a different key pair for gitolite access and use host aliases to distinguish between the two. While you're there, read both the ssh pages.  Twice.</p>"},{"location":"install.html#upgrades","title":"upgrades","text":"<ul> <li>Update your clone of the gitolite source.</li> <li>Repeat the install command you used earlier (make sure you use the same     arguments as before).</li> <li>Run <code>gitolite setup</code>.</li> </ul> <p>After you upgrade gitolite, you may also want to upgrade your rc file (<code>~/.gitolite.rc</code>).  See the rc file documentation for that.</p>"},{"location":"install.html#moving-servers","title":"moving servers","text":"<p>Nothing in any of the gitolite install/setup/etc will ever touch the data in any repository except the gitolite-admin repo.  The only thing it will normally touch is the <code>update</code> hook.  So one fool-proof way of \"moving\" servers is this:</p> <ol> <li> <p>Clone the latest gitolite-admin repo from the old server to your     workstation.  Make sure you have an admin key that has RW+ rights to the     gitolite-admin repo; you will need this later.</p> </li> <li> <p>Install gitolite on the new server, using the same key for the admin as     for the old server.</p> </li> <li> <p>Copy the rc file from the old server, overwriting this one.</p> </li> <li> <p>Disable the old server so people won't push to it.</p> </li> <li> <p>Copy all the repos over from the old server.  Make sure the files end up     with the right ownership and permissions; if not, chown/chmod them.</p> <p>The gitolite-admin repo already exists on the new server (it's just a bare bones conf file).  Do NOT overwrite it.  (Not because it contains anything useful, but because the next step will then fail!)</p> </li> <li> <p>Go to the clone you made in step 1, add a new remote (or change an     existing one) to point to the new server, then <code>git push -f</code> to it.</p> </li> <li> <p>Run <code>gitolite setup</code> on the server.</p> </li> </ol>"},{"location":"internals.html","title":"gitolite internals","text":"<p>This page is for people who may want to hack on core gitolite itself. This is not the page for people who merely want to customise their site (i.e., write their own VREFs, triggers, etc.); for that please start with the non-core page.</p> <p>This document assumes you're familiar with the material in the how does it work section in the \"overview\" document, as well as the concepts page.  If you're not familiar with ssh, and in particular how programs like gitolite use ssh to simulate many users over one Unix user, the ssh page has useful info.</p>"},{"location":"internals.html#what-is-core","title":"what is \"core\"","text":"<p>The core code consists mainly of <code>src/gitolite</code>, <code>src/gitolite-shell</code>, and all the perl modules in <code>src/lib/Gitolite</code> except <code>src/lib/Gitolite/Triggers</code>.</p> <p>That said, there are parts of non-core that, in a default (ssh) install, are used frequently enough to be important (for example if you are reviewing gitolite):</p> <ul> <li>commands in <code>src/commands</code>: access, git-config, info, mirror, option,     owns, perms</li> <li>triggers in <code>src/lib/Gitolite/Triggers</code>: Mirroring.pm, Shell.pm</li> <li>triggers in <code>src/triggers</code> and <code>src/triggers/post-compile</code>: ssh-authkeys,     ssh-authkeys-shell-users, update-git-configs, set-default-roles, </li> </ul>"},{"location":"internals.html#entry-points","title":"entry points","text":""},{"location":"internals.html#gitolite","title":"gitolite","text":"<p>Most server-side operations that gitolite supports are invoked via the <code>gitolite</code> command.  This includes initial setup and maintenance, some built-in commands (run 'gitolite -h' to see them), and finally the commands in <code>src/commands</code> (run 'gitolite help' to get a list).</p>"},{"location":"internals.html#gitolite-shell","title":"gitolite-shell","text":"<p>All remote access is via the <code>gitolite-shell</code> command, (invoked, of course, by sshd).  This includes both git operations (clone, fetch, push) as well as gitolite commands that have been enabled for remote invocation.</p> <p>For git operations, gitolite-shell does the initial access check (\"is the user even allowed to read/write this repo at all?\") and then calls git proper.</p> <p>Most of the code in this is housekeeping; the real action happens in one of the modules.</p>"},{"location":"internals.html#the-conf-module","title":"the Conf module","text":"<p>The <code>Conf</code> module and its child modules deal with the gitolite.conf file.</p> <p><code>Conf</code> is where the 'compile' command lands.  The parser for the conf file is also in this module; each \"recognised\" line is passed to appropriate functions in <code>Conf::Store</code>.</p> <p>Please note the parser is a very simple line-oriented parser using simple regexes; the DSL for the gitolite.conf file is intentionally very simple.</p>"},{"location":"internals.html#confexplode","title":"<code>Conf::Explode</code>","text":"<p>This deals with \"exploding\" the main gitolite.conf file into a single perl list with all 'include' files recursively expanded.</p>"},{"location":"internals.html#confsugar","title":"<code>Conf::Sugar</code>","text":"<p>This calls <code>Conf::Explode</code> to get the full set of conf lines, then applies a series of \"syntactic sugar\" transformations to them.  This keeps the main parser simple, while allowing the administrator to take some shortcuts in writing the rules.</p> <p>Some transformations are built-in and hardcoded, but a site can add their own site-local transformations if they like.</p>"},{"location":"internals.html#confstore","title":"<code>Conf::Store</code>","text":"<p><code>Conf::Store</code> is one of the two workhorses of gitolite.  It exports functions related to processing parsed lines and storing the parsed output for later use.  It also exports functions that deal with creating and setting up new repos.</p> <p>The output of the compile step is essentially a set of perl hashes in <code>Data::Dumper</code> format.  Rules that apply to more than one repo (i.e., the repo name was a regex pattern or a group name) go into a \"common\" output file (<code>~/.gitolite/conf/gitolite.conf-compiled.pm</code>), while rules that apply to specific repos go into their own files (<code>~/repositories/$REPONAME.git/gl-conf</code>).</p> <p>From a security perspective, dealing with 'subconf' (see delegation for details) happens in this module.</p>"},{"location":"internals.html#confload","title":"<code>Conf::Load</code>","text":"<p><code>Conf::Load</code> is the other of the two workhorses of gitolite.</p> <p>The most important function it exports is <code>access</code>, which is used by <code>gitolite-shell</code> as well as by the update hook code to check for permissions. This code has a few optimisations, including very simple, localised, caching of parsed conf files when needed.</p> <p>TODO: How the <code>access</code> function does its thing will be written up in more detail as I find time, but TLDR: it calls <code>rules</code> which builds up a list of the rules that apply.  Also see this until I manage to write it up in more detail.</p> <p>Other functions are <code>git_config</code>, which returns a list of config values specified in the conf file.</p> <p>Finally, this is where all the \"list-\" commands that 'gitolite -h' shows you (e.g., 'gitolite list-repos') land up.</p>"},{"location":"internals.html#the-rc-module","title":"the Rc module","text":"<p>The rc file (<code>~/.gitolite.rc</code>) is processed here.  In addition, it also declares a bunch of constants (like the all-important regex patterns to validate user inputs of various kinds; all ending in <code>_PATT</code>).</p> <p>The only complicated part of this is how the <code>non_core_expand</code> function takes the <code>$non_core</code> variable (currently 63 lines long!) and converts it into a set of arrays, one for each of the triggers types.  You can see the effect of this logic by uncommenting something in the ENABLE list in the rc file, then running <code>gitolite query-rc PRE_GIT</code>, etc.</p> <p>(From a security point of view this is irrelevant.  Any inputs it receives come from totally trusted sources -- either the gitolite source code or the rc file).</p> <p>Finally, the trigger function is also exported by this module.  This is the function that actually runs all the programs tied to each trigger.</p>"},{"location":"internals.html#the-hooks-module","title":"the Hooks module","text":"<p>This is where the code for the update hook (all repos) and the post-update hook (gitolite-admin repo only) can be found.</p> <p>The post-update hook code is fairly straightforward, consisting essentially of three shell commands.</p> <p>The update hook code has a lot more \"action\", since this is where all access checking for 'git push' goes.  Even that would not be much if it weren't for VREFs, because then it's just one call to the access function (from the <code>Conf::Load</code> module).</p> <p>The only other thing of note in this module is how the \"attempted access\" is determined.  Externally, we only know it's a \"push\" (i.e., a \"W\" in gitolite permission terms).  We need to compare the old and the new SHAs in various ways to determine if it's a rewind, or a delete, or a create, etc., which may make a difference to the access.</p> <p>TODO: expand on VREF handling.  For now please read vref to get the general idea of what it does, while I find time to write up the how.</p>"},{"location":"internals.html#the-rest","title":"the rest...","text":"<p>...is TBD (to be done).  Briefly, the Test module is for testing, the Common module contains a whole bunch of common routines used all over -- many of them not gitolite specific at all, Cache is not to be used for now (sorry, bitrotted by now I think... I may need to take it out behind the woodshed one of these days).</p>"},{"location":"internals.html#security-notes","title":"security notes","text":"<p>All security issues should be reported directly to me (sitaramc@gmail.com), and not to the mailing list.</p> <p>(In the following text, the words MUST, SHOULD, etc. are loosely as defined in RFC 2119).</p> <ol> <li> <p>Gitolite MUST protect everything in <code>~/repositories</code> from people who do     not have command line access to the user hosting the service, and do not     have \"push\" access rights to the gitolite-admin repository.</p> <p>Specifically, gitolite MUST prevent such users from doing anything except the following:</p> <ul> <li>perform git operations they are allowed to by gitolite.conf</li> <li>run gitolite commands that are enabled for remote use</li> </ul> </li> <li> <p>People who have command line access are considered to be \"in\"; nothing in     gitolite attempts to protect from them (it's impossible anyway!)</p> <p>But someone who does not have command line access, but does have push access rights to the gitolite-admin repo (a \"gitolite admin\"), is a special case.</p> <p>Gitolite SHOULD prevent a gitolite admin from using that to pivot to executing arbitrary commands on the server.  (This is why, for example, the gitolite-admin repo can't have arbitrary \"config\" lines.)</p> <p>However, many sites don't care about this distinction -- all their gitolite admins already have shell access.</p> <p>Thus, a violation of this is important and should be fixed, but not considered critical.</p> </li> <li> <p>Gitolite SHOULD try to make sure that the gitolite commands shipped with     gitolite do not indirectly enable violation of the restrictions in the     first bullet.  The seriousness of failing this depends on the command in     question (is the command enabled in the default setup, or even if it is     not, is it a popular and widely used command, etc.)</p> </li> <li> <p>Gitolite SHOULD protect the local sysadmin from his own errors to some     extent.  For example, it should be possible to write a new \"command\" in     shell, without worrying about shell meta-characters sneaking in and     executing something; gitolite should prevent this from happening.</p> </li> <li> <p>As you probably knew already, gitolite does not do authentication;     it only deals with authorisation.  Still, gitolite MAY help the     administrator to setup authentication (as the default setup does when used     in ssh mode), but it is not mandatory.  In particular, use in http-mode     leaves gitolite completely out of the authentication picture.</p> </li> </ol> <p>In order to achieve these goals, gitolite expects the files and directories on the server to have sane permissions and ownerships.  A decent POSIX file system, and a reasonable sshd config are also expected.</p> <p>Finally, a note on a couple of related items:</p> <ul> <li> <p>Gitolite's stance on DOS (by authenticated users) is that if it is     fixable, it will be fixed, but it is not a critical issue, as long as the     log files cannot be tampered with.</p> <p>A DOS by un-authenticated users is completely out of scope.</p> </li> <li> <p>Gitolite cannot benefit from perl's taint mode, which was made for a     different threat model.</p> <p>Gitolite's threat model implicitly trusts anyone who has shell access to the server, including all programs already on the server.  It's only remote users that are considered a threat.</p> <p>Perl's taint mode treats anything outside the program itself as suspect. So, the rc file, the compiled config, the various internal files gitolite stores housekeeping information in, etc., would all need to be untainted.</p> <p>Since gitolite gets \"suspicious\" input only in one place, it's easier to check that rigorously enough rather than use taint mode.</p> </li> </ul>"},{"location":"internals.html#appendix-a-accessing-the-documentation-offline","title":"appendix A: accessing the documentation offline","text":"<p>The source code for the documentation is in https://github.com/sitaramc/gitolite-doc.  Rendering it requires some work (TBD: details).</p> <p>For most purposes, it's simpler to clone https://github.com/sitaramc/sitaramc.github.com and use the 'gitolite' subdirectory within as your pre-rendered document base.  Open it in a JS-enabled browser and you can even do searches.</p>"},{"location":"list-non-core.html","title":"non-core features shipped with gitolite","text":"<p>Important Notes on \"non-core\" features:</p> <ol> <li> <p>The \"non-core\" gitolite page is the starting point for all     information about ... non-core gitolite :)</p> </li> <li> <p>This page decribes many of the non-core features that come with gitolite.     If a non-core feature is shipped with gitolite, but information about it     is not found in this page, it can be found within the source code; please     look there.</p> <p>Commands, however, have some extra magic, which is not available to the other types of non-core programs:</p> <ul> <li> <p>Running the command with a single <code>-h</code> option (i.e., <code>gitolite &lt;command&gt; -h</code>     or <code>ssh git@host &lt;command&gt; -h</code>), will display a suitable     message.  Please report a bug to me if one of them doesn't.</p> </li> <li> <p>Running 'help', (either as <code>gitolite help</code> on the server, or     <code>ssh git@host help</code> remotely), will give you a list of commands you are     allowed to run.</p> </li> </ul> </li> <li> <p>Non-core code is meant to be localised for your site if     you don't like what the shipped version does.  You can even maintain it     within your gitolite-admin repo if you wish.</p> </li> </ol>"},{"location":"list-non-core.html#commands","title":"commands","text":"<p>This is a list of commands that are available in gitolite, with brief descriptions and, if available, a link to more detailed information.  Note that in most cases running it with <code>-h</code> will give you enough to work with.</p> <p>Also note that not all of these commands are available remotely.</p> <p>(The more common/important commands are in bold).</p> <ul> <li>access -- print or test access rights for repo/user</li> <li>config (v3.6.3+) -- allow limited remote use of 'git config'</li> <li>create -- create a wild repo</li> <li>creator -- print or test creator name for wild repo</li> <li>D -- lets you Delete wild repos created using the C permission :)</li> <li>desc -- show/set description for wild repo</li> <li>fork -- fork a repo on the server.  This uses the <code>-l</code> option to git     clone, so it runs really fast</li> <li>git-config -- print (or text existence of) 'config' values in the repo.     (Don't forget that <code>option foo.bar = 1</code> is merely syntactic sugar for     <code>config gitolite-options.foo.bar = 1</code>, so this can be used to query     gitolite options also</li> <li>help -- see note 1 at the top of this page</li> <li>htpasswd -- sets your htpasswd</li> <li>info -- print git/gitolite version, list repos you have access to</li> <li>lock -- lock binary files for exclusive use (in combination     with the 'lock' VREF)</li> <li>mirror -- manually mirror a repo to a copy</li> <li>motd (v3.6.1+) -- set/remove a message of the day, per repo or for the whole     system</li> <li>option (v3.6.3+) -- allow repo owner to set options for a repo</li> <li>perms -- list or set permissions for wild repo</li> <li>push -- push a gitolite repo locally, bypassing gitolite</li> <li>readme (v3.6.1+) -- show, remove or set the README.html file for repo.</li> <li>rsync -- resumable downloads of git bundles (bundles are auto-created as     needed)</li> <li>sshkeys-lint -- look for potential problems in ssh keys</li> <li>sskm -- self-service key management</li> <li>sudo -- allows an admin (i.e., someone who has push rights to the     'gitolite-admin' repo) to run any remote command as some other user.  This     is useful, for example, when a user claims he is unable to access a repo,     and you need to check the 'info' output for him, etc.  However, it does     not work the other way, sorry!</li> <li>symbolic-ref -- run <code>git symbolic-ref</code> on a repo, remotely</li> <li>who-pushed -- determine who pushed a given commit</li> <li>writable -- disable/enable writes to specific repo (or all repos, if     you're an admin)</li> </ul>"},{"location":"list-non-core.html#syntactic-sugar","title":"syntactic sugar","text":"<p>The following \"sugar\" programs are available:</p> <ul> <li>continuation-lines -- allow C-style backslash escaped continuation lines     in the conf file</li> <li>keysubdirs-as-groups -- use the last component of the sub-directory name     within keydir as a group name</li> <li>macros -- simple line-wise macro processor</li> </ul>"},{"location":"list-non-core.html#triggers","title":"triggers","text":"<p>Here's a list of features that are enabled by triggers, or a combination of a trigger and something else, like a command.</p> <ul> <li>Alias -- allow repos to have aliases</li> <li>AutoCreate -- deny auto-create of wild repos on R or RW access</li> <li>bg -- allow long running post-compile/post-create jobs to be     backgrounded</li> <li>CpuTime -- CPU and elapsed times for gitolite+git</li> <li>Mirroring -- mirroring all or some repos</li> <li>Motd (v3.6.1+) -- allows printing a message of the day to     STDERR in ssh mode</li> <li>partial-copy -- simulated read control for branches (in combination     with the partial-copy VREF)</li> <li>RefexExpr -- (in combination with VREF/refex-expr) logical expressions     over refexes, like \"refex-1 and not refex-2\".  (Example: changing file     'foo' but not on 'master' branch)</li> <li>renice -- renice the git operation</li> <li>RepoUmask -- repo-specific umask settings</li> <li>Shell -- see \"giving shell access to gitolite users\" in the ssh     troubleshooting and tips page.  (Internally enables the     'ssh-authkeys-shell-users' trigger also).</li> <li>ssh-authkeys-split -- split pubkey files with multiple keys into     separate files with one pubkey each</li> <li>update-description-file -- if you want the 'description' file to be     updated instead of the 'gitweb.description' config entry (e.g. cgit users)</li> <li>upstream -- manage local, gitolite-controlled, copies of read-only     upstream repos</li> </ul> <p>In addition, the following post-compile trigger scripts are enabled by default, so are included here only for completeness and in case you wish to disable them:</p> <ul> <li>ssh-authkeys -- process keys in keydir/ and add/update appropriate lines     to the authorized keys file</li> <li>update-git-configs -- run <code>git config</code> in each repo to add/update entries     as needed</li> <li>update-git-daemon-access-list -- create/delete the 'git-daemon-export-ok'     files in each repo as needed</li> <li>update-gitweb-access-list -- create the \"projects.list\" file that gitweb     uses to determine what repos to show/not show</li> </ul>"},{"location":"list-non-core.html#vrefs","title":"VREFs","text":"<p>VREFs are a complex topic and have their own page with lots more details.  However, here's a list of VREFs shipped with gitolite:</p> <ul> <li>COUNT -- restrict pushes by number of changed or new files pushed</li> <li>EMAIL-CHECK -- check if all new commits are authored by the person pushing</li> <li>lock -- lock binary files for exclusive use (in combination     with the 'lock' command)</li> <li>MAX_NEWBIN_SIZE -- restrict by size of new binary files (helps catch     people checking in random PDFs, JARs, WARs, etc.)</li> <li>NAME -- restrict pushes by dir/file name</li> <li>partial-copy -- simulated read control for branches (in combination     with the partial-copy trigger)</li> <li>refex-expr -- (in combination with the refex-expr trigger) logical     expressions over refexes, like \"refex-1 and not refex-2\".  (Example:     changing file 'foo' but not on 'master' branch)</li> <li>VOTES -- voting on commits a la gerrit</li> </ul>"},{"location":"list-non-core.html#details-on-some-non-core-programs","title":"details on some non-core programs","text":"<p>These non-core programs needed more detail than could be provided in the source code, but did not fit anywhere else neatly enough.</p>"},{"location":"list-non-core.html#partial-copy-selective-read-control-for-branches","title":"partial-copy: selective read control for branches","text":"<p>Git (and therefore gitolite) cannot do selective read control -- allowing someone to read branch A but not branch B.  It's the entire repo or nothing.</p> <p>Gerrit Code Review can do that, but that is because they have their own git (as well as their own sshd, and so on).  If code review is part of your access control decision, you really should consider Gerrit anyway.</p> <p>The standard answer you get when you ask is \"use separate repos\" (where one contains all the branches, and one contains a subset of the branches).  This is nice in theory but in practice, when people are potentially pushing to both repos, you need to figure out how to keep them in sync.</p> <p>Gitolite can now help you do this.  Note that this is only for branches; you can't do this for files and directories.</p> <p>Here's how:</p> <ol> <li> <p>enable 'partial-copy' in the ENABLE list in the rc file.</p> </li> <li> <p>for each repo \"foo\" which has secret branches that a certain set of     developers (we'll use a group called <code>@temp-emp</code> as an example) are not     supposed to see, do this:</p> <p><pre>\nrepo foo\n    # rules should allow @temp-emp NO ACCESS\n<p>repo foo-partialcopy-1\n    # first, a deny rule that allows no access to secret-branch\n    -   secret-branch               =   @all\n    #\n    # other rules; see notes below\n    #\n    -   VREF/partial-copy           =   @all\n    config gitolite.partialCopyOf   =   foo\n</p>\n<p>IMPORTANT NOTES:</p>\n<ul>\n<li>\n<p>if you're using other VREFs, make sure this one is placed at the\n    end, after all the others.</p>\n</li>\n<li>\n<p>remember that any change allowed to be made to the partial-copy repo\n    will propagate to the main repo so make sure you use other rules to\n    restrict pushes to other branches and tags as needed.</p>\n</li>\n</ul>\n\n\n<p>And that should be it.  Please test it and let me know if it doesn't work!</p>\n<p>WARNINGS:</p>\n<ul>\n<li>\n<p>If you change the config to disallow something that used to be allowed,\n    you should delete the partial repo on the server and then run\n    <code>gitolite compile; gitolite trigger POST_COMPILE</code> to let it build again.</p>\n</li>\n<li>\n<p>Not tested with smart http; probably won't work.</p>\n</li>\n<li>\n<p>Also not tested with mirroring, or with wild card repos.</p>\n</li>\n</ul>"},{"location":"locking.html","title":"locking binary files","text":"<p>Locking is useful to make sure that binary files (office docs, images, ...) don't get into a merge state.  (If you think it's not a big deal, you have never manually merged independent changes to an ODT or something!)</p> <p>When git is used in a truly distributed fashion, locking is impossible. However, in most corporate setups, there is a single central server acting as the canonical source of truth and collaboration point for all developers.  In this situation it should be possible to at least prevent commits from being pushed that contains changes to files locked by someone else.</p> <p>The two \"lock\" programs (one a command that a user uses, and one a VREF that the admin adds to a repo's access rules) together attempt to achieve this.</p> <p>Of course, locking by itself is not quite enough.  You may still get into merge situations if you make changes in branches.  For best results you should actually keep all the binary files in their own branch, separate from the ones containing source code.</p>"},{"location":"locking.html#problem-description","title":"problem description","text":"<p>Our users are alice, bob, and carol.  Our repo is foo.  It has some \"odt\" files in the \"doc/\" directory.  We want to make sure these odt files never get into a \"merge\" situation.</p>"},{"location":"locking.html#adminsetup","title":"admin/setup","text":"<p>First, someone with shell access to the server must add 'lock' to the ENABLE list in the rc file.</p> <p>Next, the gitolite.conf file should have something like this:</p> <pre>\nrepo foo\n    ...other rules...\n    -   VREF/lock      =   @all\n</pre> <p>However, see below for the difference between \"RW\" and \"RW+\" from the point of view of this feature and adjust permissions accordingly.</p>"},{"location":"locking.html#user-view","title":"user view","text":"<p>Here's a summary:</p> <ul> <li>Any user with \"W\" permissions to any branch in the repo can \"lock\" any     file.  Once locked, no other user can push changes to that file, in any     branch, until it is unlocked.</li> <li>Any user with \"+\" permissions to any branch in the repo can \"break\" a lock     held by someone else if needed.</li> </ul> <p>For best results, everyone on the team should:</p> <ul> <li>Switch to the branch containing the binary files when wanting to make a     change.</li> <li>Run 'git pull' or eqvt, then lock the binary file(s) before editing them.</li> <li>Finish the editing task as quickly as possible, then commit, push, and     unlock the file(s) so others are not needlessly blocked.</li> <li>Understand that breaking a lock require additional, (out of band)     communication.  It is upto the team's policies what that entails.</li> </ul>"},{"location":"locking.html#detailed-example","title":"detailed example","text":"<p>Alice declares her intent to work on \"d1.odt\":</p> <pre><code>$ git pull\n$ ssh git@host lock -l foo doc/d1.odt\n</code></pre> <p>Similarly Bob starts on \"d2.odt\"</p> <pre><code>$ git pull\n$ ssh git@host lock -l foo doc/d2.odt\n</code></pre> <p>Carol makes some changes to d2.odt (without attempting to lock the file or checking to see if it is already locked) and pushes:</p> <pre><code>$ ooffice doc/d2.odt\n$ git add doc/d2.odt\n$ git commit -m 'added footnotes to d2 in klingon'\n$ git push\n&lt;...normal push progress output...&gt;\nremote: FATAL: W VREF/lock testing carol DENIED by VREF/lock\nremote: 'doc/d2.odt' locked by 'bob'\nremote: error: hook declined to update refs/heads/master\nTo u2:testing\n ! [remote rejected] master -&gt; master (hook declined)\nerror: failed to push some refs to 'carol:foo'\n</code></pre> <p>Carol backs out her changes, but saves them away for a \"manual merge\" later.</p> <pre><code>git reset HEAD^\ngit stash save 'klingon changes to d2.odt saved for possible manual merge later'\n</code></pre> <p>Note that this still represents wasted work in some sense, because Carol would have to somehow re-apply the same changes to the new version of d2.odt after pulling it down.  This is because she did not lock the file before making changes on her local repo.  Educating users in doing this is important if this scheme is to help you.</p> <p>She now decides to work on \"d1.odt\".  However, she has learned her lesson and decides to follow the protocol described above:</p> <pre><code>$ git pull\n$ ssh git@host lock -l foo doc/d1.odt\nFATAL: 'doc/d1.odt' locked by 'alice' since Sun May 27 17:59:59 2012\n</code></pre> <p>Oh damn; can't work on that either.</p> <p>Carol now decides to see what else there may be.  Instead of checking each file to see if she can lock it, she starts with a list of what is already locked:</p> <pre><code>$ ssh git@host lock -ls foo\n\n# locks held:\n\nalice   doc/d1.odt      (Sun May 27 17:59:59 2012)\nbob     doc/d2.odt      (Sun May 27 18:00:06 2012)\n\n# locks broken:\n</code></pre> <p>Aha, looks like only d1 and d2 are locked.  She picks d3.odt to work on.  This time, she starts by locking it:</p> <pre><code>$ ssh git@host lock -l foo doc/d3.odt\n$ ooffice doc/d3.odt\n&lt;...etc...&gt;\n</code></pre> <p>Meanwhile, in a parallel universe where d3.odt doesn't exist, and Alice has gone on vacation while keeping d1.odt locked, Carol breaks the lock.  Carol can do this because she has RW+ permissions for the repository itself.</p> <p>However, protocol in this team requires that she get email approval from the team lead before doing this and that Alice be in CC in those emails, so she does that first, and then she breaks the lock:</p> <pre><code>$ git pull\n$ ssh git@host lock --break foo doc/d1.odt\n</code></pre> <p>She then locks d1.odt for herself:</p> <pre><code>$ ssh git@host lock -l foo doc/d1.odt\n</code></pre> <p>When Alice comes back, she can tell who broke her lock and when:</p> <pre><code>$ ssh git@host lock -ls foo\n\n# locks held:\n\ncarol   doc/d1.odt      (Sun May 27 18:17:29 2012)\nbob     doc/d2.odt      (Sun May 27 18:00:06 2012)\n\n# locks broken:\n\ncarol   doc/d1.odt      (Sun May 27 18:17:03 2012)      (locked by alice at Sun May 27 17:59:59 2012)\n</code></pre>"},{"location":"migr.html","title":"migrating from gitolite v2","text":"<p>Gitolite v3 came out in April 2012.  Until now, my policy was that I would not support it except for critical issues, but I think by now (I am writing this in Feb 2017), it's time to cut it completely.</p> <p>As such, migration is also not supported.  Please perform a clean install of the latest gitolite and bring your existing repos into this new installation. Details below.</p> <p>The old, detailed, migration document is still available in the archive directory of the gitolite-doc repo, if you really need it, but you're on your own.  After five years, it makes little sense to maintain all that in the active document hierarchy.</p> <p>Despite all that, this document does list some of the more important issues, mainly those that cause a significant change in behaviour.</p>"},{"location":"migr.html#step-1-backups","title":"step 1: backups","text":"<ul> <li>take a backup of all <code>~/repositories</code> from the v2 server</li> <li>take an extra backup, in the form of a normal <code>git clone</code>, of the     <code>gitolite-admin</code> repository</li> <li>take a backup of <code>~/.gitolite.rc</code> and keep it handy</li> <li>(optional but suggested) take a backup of <code>~/.gitolite</code> and <code>~/.ssh</code></li> </ul>"},{"location":"migr.html#step-2-install-gitolite","title":"step 2: install gitolite","text":"<p>Important:</p> <p>If you are reusing the same hosting user on the same server, for the new setup, you will need to clean out the old one as much as you can so its artefacts don't interfere with the new installation.  This means all the files and directories you backed up above, including the optional ones.</p> <p>To install, use one or more of the links in the \"install\" section in the navigation bar at the top.</p> <p>Important:</p> <p>Do NOT change the <code>gitolite.conf</code> from the minimal one that a fresh install creates at this stage.</p> <p>Smoke test the installation by cloning the <code>testing</code> repo and pushing some minor change to it.</p>"},{"location":"migr.html#step-3-add-existing-repos","title":"step 3: add existing repos","text":"<p>Once the install is done, follow the instructions here to bring in existing repos.</p> <p>At the point where it talks about adding repos to the gitolite.conf file, you can copy relevant bits from your old gitolite-admin repo.</p>"},{"location":"migr.html#step-4-identify-any-remaining-changes-needed","title":"step 4: identify any remaining changes needed","text":"<p>If you're using any of the following features in your old (v2) setup, please make the appropriate changes as indicated.</p>"},{"location":"migr.html#name-rules","title":"NAME rules","text":"<p><code>NAME/</code> rules must be changed to <code>VREF/NAME/</code>.  Also, fallthru on all VREFs is \"success\" now, so any <code>NAME/</code> rules you have MUST change the rule list in some way to maintain the same restrictions.  The simplest is to add the following line to the end of each repo's rule list:</p> <pre><code>-   VREF/NAME/       =   @all\n</code></pre>"},{"location":"migr.html#subconf-command","title":"<code>subconf</code> command","text":"<p>(This is also affected by the previous issue, 'NAME rules'; please read that as well).</p> <p>If you're using delegation in your admin conf setup, please add the following lines to the end of the gitolite-admin rules in your conf/gitolite.conf file:</p> <pre><code>repo gitolite-admin\n    -   VREF/NAME/       =   @all\n\nsubconf \"fragments/*.conf\"\n</code></pre> <p>The first part compensates for fallthru now being a success when processing VREF rules (NAME rules are just one specific VREF).  Although, ideally, you should change your rule list so that you no longer require that line.</p> <p>The second part explicitly says when and where to include the subconf files. (Before subconf was invented, this used to happen implicitly at the end of the main conf file, and was hardcoded to that specific glob.)</p>"},{"location":"migr.html#mirroring","title":"mirroring","text":"<p>There are several important differences in mirroring; if you're using mirroring please start from a clean slate on all copies, using the v3 documentation on mirroring.</p> <p>If you're not willing to do that, you may be able to use the older, more detailed, documentation here to manage the migration.  However, I cannot support that (mainly due to lack of time).</p>"},{"location":"migr.html#rc-file-settings","title":"rc file settings","text":"<p>Many rc file settings have been dropped.  You should be able to get by without most of them, but some of them cause a significant change to behaviour:</p> <ul> <li> <p><code>GL_ALL_INCLUDES_SPECIAL</code>: @all always includes gitweb and daemon now.     Use deny-rules if you want to say <code>R = @all</code> but not have the repo(s) be     visible to gitweb or daemon.</p> </li> <li> <p><code>GL_NO_DAEMON_NO_GITWEB</code>: the default will clobber your projects.list file     and git-daemon-export-ok files.</p> <p>Comment out the 'daemon' and 'gitweb' lines in the ENABLE list in the rc file.  Gitweb and daemon can now be separately disabled, instead of both being tied to the same setting.</p> </li> <li> <p><code>GL_NO_SETUP_AUTHKEYS</code>:  default will clobber your authkeys file.</p> <p>Comment out all the line(s) that call ssh-authkeys in the rc file.</p> </li> <li> <p><code>ADMIN_POST_UPDATE_CHAINS_TO</code> and <code>UPDATE_CHAINS_TO</code>:</p> <p>For the former, add your script to the <code>POST_COMPILE</code> trigger chain.  For the latter, use a vref.  Don't forget to add a rule that references the new VREF!</p> </li> </ul>"},{"location":"migr.html#wild-repos","title":"wild repos","text":"<ul> <li> <p><code>gl-creater</code> files: these files need to be renamed to <code>gl-creator</code> (the     correct spelling at last, hooray!).  Suggested command sequence:</p> <p><pre>\ncd $HOME/repositories\nfind . -type d -name \"*.git\" -prune | while read r\ndo\n    mv $r/gl-creater $r/gl-creator\ndone 2&gt;/dev/null\n</pre></p> </li> <li> <p><code>gl-perms</code> files: setting perms of R and RW will no longer work; you have     to say READERS and WRITERS now.  Suggested command:</p> <p><pre>\nfind `gitolite query-rc GL_REPO_BASE` -name gl-perms |\n    xargs perl -pi -e 's/\\bR\\b/READERS/;s/\\bRW\\b/WRITERS/'\n</pre></p> </li> </ul>"},{"location":"mirroring.html","title":"mirroring using gitolite","text":"<p>v2 mirroring users:</p> <p>There are several important differences in mirroring; it's best to start from a clean slate on all copies, using this documentation.</p> <p>If you're not willing to do that, you may be able to use the older, more detailed, documentation here to manage the migration.  However, I cannot support that (mainly due to lack of time).</p> <p>terminology change</p> <p>NOTE This documentation is current with the just-released (as of 2pm UTC on 2020-08-04), v3.6.12.  For most people, until you upgrade, this documentation will have some terminology differences.</p>"},{"location":"mirroring.html#quick-intro","title":"quick intro","text":"<p>Mirroring is simple: you have one \"master\" server and one or more \"copy\" servers.  The copies get updates only from the master; to the rest of the world they are at best read-only.</p> <p>In the following picture, each box (A, B, C, ...) is a repo.  The master server for a repo is colored red, copies are green.  Users only push to a master server (red), and the master server then does a <code>git push --mirror</code> to the copies.  The arrows show this mirror push.</p> <p></p> <p>Here's a more complete description of what gitolite can do:</p> <ul> <li> <p>Different masters and sets of copies for different repos.</p> <p>This lets you do things like:</p> <ul> <li>Use the server closest to most of its developers as the master for     that repo.</li> <li>Mirror a repo to only some of the servers.</li> <li>Have repos that are purely local to a server (not mirrored at all).</li> <li>Push to a copy on demand or via cron (helps deal with bandwidth or     connectivity constraints).</li> </ul> <p>All this is possible whether or not the gitolite-admin repo is mirrored -- that is, all servers have the exact same gitolite-admin repo or not.</p> </li> <li> <p>Pushes to a copy can be transparently forwarded to the real master.</p> <p>Your developers need not worry about where a repo's master is -- they just write to their local mirror for all repos, even if their local mirror is only a copy for some.</p> </li> </ul>"},{"location":"mirroring.html#caveats","title":"caveats","text":"<ul> <li> <p>Mirroring by itself will never create a repo on a copy; it has to exist     and be prepared to receive updates from the master.</p> <p>The simplest way to ensure your repos exist on the copies also is to mirror the special gitolite-admin repo as well, and this is what most sites do.</p> </li> <li> <p>There is limited support for auto-creating wild card repos and sending     'perms' info across, with the following caveats at present.  (Some of this     text won't make sense unless you know what those features are).</p> <ul> <li> <p>WARNING: it does NOT make sense to mirror     wild repos in setups where the authentication data is not the same     (i.e., where \"alice\" on the master and \"alice\" on a copy maybe     totally different people).</p> </li> <li> <p>This has only been minimally tested.  For example, complex setups or     asymmetric configs on master and copy, etc. have NOT been tested.</p> </li> <li> <p>Permission changes will only propagate on the next 'git push'.  Of     course, if you know the name of the copy server, you can run</p> <pre><code>ssh git@host mirror push copy-server-name repo-name\n</code></pre> </li> <li> <p>Using 'perms' on a copy is allowed but will neither propagate nor     persist.  They will be overwritten by whatever perms the master has     (even if it is an empty set) on the next 'git push'.</p> </li> <li> <p>As with lots of extra features in gitolite, smart http support is not     on my radar.  Don't ask.</p> </li> </ul> <p>Please test it out and let me know if something surprising happens.  Be aware that I have been known to claim bugs are features if I don't have time to fix them immediately :-)</p> </li> <li> <p>Mirroring is only for git repos.  Ancillary files like gl-creator and     gl-perms in the repo directory are not mirrored; you must do that     separately.  Files in the admin directory (like log files) are also not     mirrored.</p> </li> <li> <p>If you ever do a bypass push, mirroring will not work.     Mirroring checks also will not work -- for example, you can push to a     copy, which is not usually a good idea.  So don't bypass gitolite if the     repo is mirrored!</p> </li> <li> <p>From v3.5.3 on, gitolite uses an asynchronous push to the copies, so that     the main push returns immediately, without waiting for the copy pushes to     complete.  Keep this in mind if you're writing scripts that do a push, and     then read one of the copies immediately -- you will need to add a few     seconds of sleep in your script.</p> </li> </ul>"},{"location":"mirroring.html#setting-up-mirroring","title":"setting up mirroring","text":"<p>This is in two parts: the initial setup and the rc file, followed by the conf file settings and syntax.</p>"},{"location":"mirroring.html#the-initial-setup-and-the-rc-file","title":"the initial setup and the rc file","text":"<p>For each server:</p> <ul> <li> <p>Install gitolite normally.  Make clones of the server's 'gitolite-admin'     repo on your workstation so you can admin them all from one place.</p> </li> <li> <p>Give the server a short, simple, \"hostname\" and set the HOSTNAME in the     rc file (i.e., <code>~/.gitolite.rc</code> on the server) to this name, for example     'mars'.  Note: this has nothing to do with the hostname of the server in     networking or DNS terms, or in OS terms.  This is internal to gitolite.</p> </li> <li> <p>Run ssh-keygen if needed and get an ssh key pair for the server.  Copy the     public key to a common area (accessible to your workstation for copying)     and name it after the host, but with 'server-' prefixed.  For example, the     pubkey for server 'mars' must be stored as 'server-mars.pub'.</p> </li> <li> <p>Copy all these pubkeys (i.e., one from each server) to all the admin     repo clones on your workstation and add them as usual.  This is an     <code>O(N^2)</code> operation ;-)</p> <p>Don't forget to push the changes!</p> <p>You may have guessed that the prefix 'server-' is special, and distinguishes a human user from a mirroring peer.</p> </li> <li> <p>Create \"host\" aliases to refer to all other machines.  See here     for what/how.</p> <p>The host alias for a host (in all other machines' <code>~/.ssh/config</code> files) MUST be the same as the <code>HOSTNAME</code> in the referred host's <code>~/.gitolite.rc</code>.  Gitolite mirroring requires this consistency in naming; things will NOT work otherwise.</p> <p>Normally you should be able to build one common file and append it to all the servers' <code>~/.ssh/config</code> files.</p> </li> <li> <p>The following MUST work for each pair of servers that must talk to     each other:</p> <pre><code># on server mars\nssh phobos info\n# the response MUST start with \"hello, server-mars...\"\n</code></pre> <p>Note the exact syntax used; variations like \"ssh git@phobos.example.com info\" are NOT sufficient.  That is why you need the ssh host aliases.</p> <p>Check this command from everywhere to everywhere else, and make sure you get expected results.  Do NOT proceed otherwise.</p> </li> <li> <p>Setup the gitolite.conf file on all the servers.  If the copies are to be     exact copies of the master, you need to do the complete configuration only     on the master; the copies can have just this because on the first push to     the master it will update all the copies anyway:</p> <p><pre>\nrepo gitolite-admin\n    RW+     =   some-local-admin\n# possibly other rules\n    option mirror.master    =   mars\n    option mirror.copies    =   phobos\n</pre></p> </li> <li> <p>When that is all done and tested, enable mirroring by going through     the rc file and uncommenting all the lines mentioning <code>Mirroring</code>.</p> </li> <li> <p>If you wish to allow your users to run the mirror command remotely     (usually not required), you need to enable it just like any other     command that is not enabled by default; see gitolite commands     for how.</p> </li> </ul>"},{"location":"mirroring.html#conf-file-settings-and-syntax","title":"conf file settings and syntax","text":"<p>Mirroring is defined by the following options.  You can have different settings for different repos, and of course some repos may not have any mirror options at all -- they are then purely local.</p> <pre>\nrepo foo\n    ...access rules...\n\n    option mirror.master        =   mars\n    option mirror.copies        =   phobos deimos\n    option mirror.redirectOK    =   all\n</pre> <p>The first line is easy, since a repo can have only one master.</p> <p>The second is a space separated list of hosts that are all copies.  You can have several copy lists, as long as the config key starts with 'mirror.copies' and is unique.  For example.</p> <pre>\n    option mirror.copies-1   =   phobos deimos\n    option mirror.copies-2   =   io europa\n    option mirror.copies-3   =   ganymede callisto\n</pre> <p>Do not repeat a key; then only the last line for that key will be effective.</p>"},{"location":"mirroring.html#v36-preventing-automatic-sync","title":"(v3.6+) preventing automatic sync","text":"<p>Sometimes you don't want a repo to be mirrored automatically (as soon as someone pushes to the master) to all the copies.  For whatever reasons, you have some copies for whom you would like to trigger the sync later (and you don't mind the fact that those copies are out of sync until then).</p> <p>To make that happen, use option lines like this instead of those shown above:</p> <pre>\n    option mirror.copies.nosync-1   =   phobos deimos\n</pre> <p>Except for the addition of a <code>.nosync</code> just after <code>copies</code>, all the other rules are the same as before.</p> <p>This setting will generate a warning that a \"manual mirror push [is] pending\" for each copy that has the <code>nosync</code> option.  If you're sure you don't need those warnings, you can upgrade to the latest gitolite, and use <code>nosync-quiet</code> as the option instead.</p> <pre>\n    option mirror.copies.nosync-quiet-1   =   phobos deimos\n</pre> <p>(Eventually, this will appear in v3.6.14)</p>"},{"location":"mirroring.html#v361-mirroring-failures","title":"(v3.6.1+) mirroring failures","text":"<p>Since mirror pushes happen asynchronously (i.e, the user who originally pushed does not have to wait for the mirrors to be synced), any mirror push failures are not immediately visible to a human being, although you will find them if you look in gitolite's log files.</p> <p>Note: since only a successful push can clear the error status, it follows that if a mirror push failed due to an invalid hostname, that status file will need to be manually deleted from the server.  Look in the bare repo directory on the server, for one or more files whose names start with 'gl-copy' and delete the appropriate one.</p> <p>Therefore, when the output of the mirror push to some copy contains the word \"fatal\", gitolite saves the output. This saved output is printed to STDERR when any user attempts to clone/fetch/push the repo on the master server for that repo.  The hope is that someone will alert an admin to look at the problem.  This will continue to happen until the error condition is cleared (i.e., a successful mirror push happens to that specific copy).</p> <p>If you don't want these unexpected reports confusing users (or programs!), simply create a new rc variable called HUSH_MIRROR_STATUS and set it to 1. (If you're not sure where in the rc file this should go, I suggest putting it right after the HOSTNAME variable).</p> <p>You can see the mirror status of any repo using the 'mirror status' command; the command line help for the mirror command ('gitolite mirror -h' or 'ssh git@host mirror -h') has details.</p>"},{"location":"mirroring.html#manually-synchronising-a-copy-repo","title":"manually synchronising a copy repo","text":"<p>You can use the <code>gitolite mirror push</code> command on a master to manually synchronise any of its copies.  Try it with <code>-h</code> to get usage info.</p> <p>Tip: if you want to do this to all the copies, try this:</p> <pre><code>for s in `gitolite mirror list copies reponame`\ndo\n    gitolite mirror push $s reponame\ndone\n</code></pre> <p>This command can also be run remotely; run <code>ssh git@host mirror -h</code> for details.</p> <p>Note: if your version of the mirror command does not support 'list copies', use <code>gitolite git-config -r reponame mirror.copies | cut -f3</code> instead.</p>"},{"location":"mirroring.html#redirected-pushes","title":"redirected pushes","text":"<p>Please read carefully; there are security implications if you enable this for mirrors NOT under your control.</p> <p>Normally, a master, (and only a master), pushes to a copy, and the copies are \"read-only\" to the users.  Gitolite allows a copy to receive pushes from a user and transparently redirect them to the master.</p> <p>This simplifies things for users in complex setups, letting them use their local mirror for both fetch and push access to all repos.</p> <p>Note:</p> <p>Just to be clear, the actual push will still happen only on the master, which needs to be up (the redirection is at the ssh level).  It's main use is in geographically distributed setups, where users are encouraged to use a nearer node as their \"fetch\" remote, but, without this feature, they'd have to use the actual master node as the \"push\" remote.  This allows users to use the same (nearby) node as the \"push\" remote also.</p> <p>It is also useful if the master dies, and the administrator redesignates some other node as the master.  In that situation, only users who had the original master as a remote need to update their remote URLs.</p> <p>The syntax for enabling this is one of these:</p> <pre>\n    option mirror.redirectOK    =   all\n    option mirror.redirectOK    =   phobos deimos\n</pre> <p>The first syntax trusts all valid copies to redirect user pushes, while the second one trusts only some copies.</p> <p>IMPORTANT NOTES</p> <ul> <li> <p>This only works for ssh-based setups; you cannot use this feature in http     mode.</p> </li> <li> <p>Authentication happens on the copy, but authorisation is on the     master.  The master is trusting the copy to authenticate the user     correctly, even though the actual push is going to the master.  This means     that user alice on the copy must be guaranteed to be the same as user     alice on the master.</p> </li> <li> <p>The part of the authorisation that happens before passing control to     git-receive-pack (see access rules) will happen on the copy as     well.</p> </li> <li> <p>You cannot redirect gitolite commands (like perms, etc).</p> </li> </ul>"},{"location":"mirroring.html#appendix-a-hostname-substitution","title":"appendix A: HOSTNAME substitution","text":"<p>Wherever gitolite sees the word <code>%HOSTNAME</code>, it will replace it with the HOSTNAME supplied in the rc file, if one was supplied.  This lets you maintain configurations for all servers in one repo, yet have them act differently on different servers, by saying something like:</p> <pre>\ninclude \"%HOSTNAME/*.conf\"\n</pre> <p>(See include for more on the 'include' command).</p> <p>You can use it in other places also, for example:</p> <pre>\n    RW+     VREF/NAME/subs/%HOSTNAME/       =   @%HOSTNAME-admins\n</pre> <p>(you still have to define @mars-admins, @phobos-admins, etc., but the actual VREF is now one line instead of one for each server!)</p>"},{"location":"mirroring.html#appendix-b-efficiency-versus-paranoia","title":"appendix B: efficiency versus paranoia","text":"<p>If you're paranoid enough to use mirrors, you should be paranoid enough to set this on each server, despite the possible CPU overhead:</p> <pre><code>git config --global receive.fsckObjects true\n</code></pre>"},{"location":"mirroring.html#appendix-c-moving-the-admin-repo-to-a-different-master","title":"appendix C: moving the admin repo to a different master","text":"<p>Moving only some repos (other than the gitolite-admin repo) to a different master is easy.  Just make the change in the gitolite.conf file, add, commit, and push.</p> <p>Even for the gitolite-admin repo, if the current master is ok, it's the same thing; just make the change and push to the current master.  Subsequent pushes will go to the new master, of course.</p> <p>But if the current master is already dead, there's a bit of a catch-22.  You can't push to the master because it is dead, and you can't push to any copy because they won't accept updates from anywhere but the server they think is the master.</p> <p>Here's how to resolve this:</p> <ol> <li> <p>On each copy:</p> <ul> <li> <p>Edit <code>~/.gitolite/conf/gitolite.conf</code> to change the master and copy     options for the gitolite-admin repo.</p> </li> <li> <p>Run <code>gitolite setup</code>.</p> </li> </ul> </li> <li> <p>Now clone the admin repo from the new master to your workstation, change     the options for the rest of the repos (if needed), then add/commit/push.</p> </li> </ol> <p>And that should be all you need to do.</p>"},{"location":"mirroring.html#appendix-d-fixing-a-broken-copy","title":"appendix D: fixing a broken copy","text":"<p>Let's say you had</p> <pre><code>option mirror.master        =   mars\noption mirror.copies        =   phobos deimos\n</code></pre> <p>and you then accidentally removed <code>phobos</code> and pushed.</p> <p>You quickly realise your error and put the line back, then push again, only to realise that phobos is now unreachable.  It took the previous push to heart and updated its internal state accordingly, and any subsequent attempts to touch the gitolite-admin repo on phobos results in the message:</p> <pre><code>FATAL: phobos: 'gitolite-admin' is mirrored but not here\n</code></pre> <p>This is basically saying, \"yes I see that repo in the config, but I (phobos) am neither the master nor one of the copies for it, so please don't ask me about it!\".  You're basically locked out of phobos now.</p> <p>The solution is this:</p> <ul> <li> <p>log on to phobos' gitolite shell account</p> </li> <li> <p>edit <code>~/.gitolite/conf/gitolite.conf</code> to fix the mirroring options for the     gitolite-admin repo.</p> </li> <li> <p>run <code>gitolite setup</code>.</p> </li> </ul> <p>That should do it.</p>"},{"location":"namespaces.html","title":"namespace support in gitolite","text":"<p>This feature is only available in the 'namespaces' branch until enough people test it and tell me it works fine.</p> <p>AVOID NASTY SURPRISES!  Please read the entire page before attempting to use or install this.  Most non-core features of gitolite do not work with namespaces, and, worse, many of them will fail silently.  There are also security issues you need to be aware of.</p>"},{"location":"namespaces.html#background","title":"background","text":"<p>In many projects, developers need to push their work to some central place for others to fetch.  Namespaces allow you to give each developer what looks like her own repo or set of repos, while combining all these logical repos into one physical repo on the server.  This saves a lot of disk space if they all share a lot of common history.</p> <p>The logical repos look like normal repos to a git client; all the magic is on the server side.  (But see the \"WARNINGS\" section).</p>"},{"location":"namespaces.html#terminology","title":"terminology","text":"<p>There is one repo that is special, and several others that depend upon it or use it.  Depending on context, we use one of the following names:</p> <ul> <li>Storage context: backing repo/real repo, and logical repos</li> <li>Workflow context: blessed repo and developer repos</li> </ul> <p>In addition, in the gitolite context you could say that the blessed repo is a normal (not \"wild\") repo and the logical repos are wild repos, since that is the most convenient way to set this up.  However, it is not mandatory -- you can have a wild repo as a backing repo, and/or a normal repo as a logical repo if you wish.</p>"},{"location":"namespaces.html#setup","title":"setup","text":"<p>First, add the following lines to the rc file, as indicated:</p> <pre><code># add this line as the *last* item in the PRE_GIT trigger list.  In\n# particular, it should be *after* the Mirroring::pre_git line if you're\n# using mirroring.\n'Namespaces::pre_git',\n\n# add this line as the *first* item in the POST_GIT trigger list.  In\n# particular, it should be *before* the Mirroring::post_git line if you're\n# using mirroring.\n'Namespaces::post_git',\n</code></pre> <p>Then use the following example conf below as a guide and roll your own.  This example is from a mail to the gitolite list by Javier Domingo (\"Mirroring forks\", 13-11-2012), modified slightly.</p> <pre>\n# backing repos, normal (non-wild), serving as blessed repos\nrepo    linux git gitolite [...other projects...]\n    RW+     =   integration-manager\n    R       =   @all\n\n# logical repos, wild, created by devs as needed\nrepo    CREATOR/[a-zA-Z0-9].*\n    C       =   @all\n    RW+     =   CREATOR\n    R       =   READERS @all\n    option namespace.pattern = %/* is @1 in @2\n</pre>"},{"location":"namespaces.html#use","title":"use","text":"<p>A developer doesn't have to do anything differently.  She will still run, e.g., <code>git clone git@host:alice/linux</code> to auto-create and clone a wild repo for herself, then add a remote to the \"backing\" repo, fetch it, start working, and eventually push her work to alice/linux.</p> <p>However, she might notice some differences.  To begin with, her first push of an enormous code base, to what she thought was an empty repo on the server, might go surprisingly fast :)</p> <p>Secondly, a lot of gitolite commands (and other features) won't work.  See the \"WARNINGS\" section below for more.</p>"},{"location":"namespaces.html#details","title":"details","text":"<p>The option line above has 3 parts separated by the words \"is\" and \"in\":</p> <pre><code>&lt;pattern&gt; is &lt;namespace&gt; in &lt;backing repo&gt;\n</code></pre> <p>When a user attempts to access a logical repo (say \"alice/linux\"), the namespace pattern for that repo is applied to the repo name as follows:</p> <ul> <li>a percent sign matches a single component in the repo name</li> <li>an asterisk matches one or more components</li> </ul> <p>Once the matching is done, each \"at-digit\" combination is replaced by the corresponding matched segment to derive the namespace and the backing repo name.</p> <p>Some examples may help:</p> <ul> <li> <p>Here's a simple one that separate the first component from the rest:</p> <p><pre>\n    option namespace.pattern = %/* is @1 in @2\n</pre></p> <p>A reponame of 'alice/linux' gives you a namespace of 'alice' and a backing reponame of 'linux'.  Similarly, 'alice/linux/2.2' gives you 'alice' and 'linux/2.2' (which means a repo of that name has to exist!); notice how the asterisk grabs up all the remaining components in the repo name.</p> </li> <li> <p>This one separates the first, the second, and all the rest, but combines     them in a different order:</p> <p><pre>\n    option namespace.pattern = %/%/* is @1/@3 in @2\n</pre></p> <p>A reponame of 'alice/linux/2.2' gives you 'alice/2.2' and 'linux', while a reponame of 'alice/linux/2.2/smp' gives you 'alice/2.2/smp' and 'linux'.</p> </li> <li> <p>Here's another example on the same lines:</p> <p><pre>\n    option namespace.pattern = %/%/%/* is @3/@2/@4 in @1\n</pre></p> <p>A reponame of 'linux/kernel/torvalds/linux-2.6' gives you a namespace of 'torvalds/kernel/linux-2.6' and a backing repo name of 'linux'.</p> </li> <li> <p>Here's an interesting example, given in full to explain better.  The basic     problem is that one of our backing repos is not a simple name (like 'git'     or 'linux'); it is 'sitaramc/gitolite'.</p> <p>In addition, any developer-owned repo that has 3 or more components is not a fork of anything at all, and should not be subject to namespace processing (i.e., it's just a normal repo)</p> <p><pre>\n# backing repos\nrepo sitaramc/gitolite linux git\n    ...access rules for backing repos...\n# logical repos\nrepo CREATOR/..*\n    C   =   @team\n    RW+ =   CREATOR\n    R   =   @all\n    option namespace.pattern-1 = %/gitolite is @1 in sitaramc/gitolite\n    option namespace.pattern-2 = %/% is @1 in @2\n    option namespace.pattern-3 = %/%/* is none in @1/@2/@3\n</pre></p> <p>Firstly, this shows how to specify more than one namespace pattern.  Each pattern is tried in lexically sorted order until a match is found. (Warning: \"lexically sorted\" means 'namespace.pattern-10' sorts before 'namespace.pattern-2'!)</p> <p>Secondly, the example shows that you can hardcode anything, like we did for the backing reponame in pattern 1.</p> <p>Thirdly, it shows how you can specify a pattern that disables namespacing, like the last pattern.  When the backing repo name ends up being exactly the same as the original repo name, gitolite notices this and treats it as a real repo, not as a logical repo.  (If this confuses you, ignore it and use some other pattern, say <code>CREATOR/personal/..*</code> for developers personal repos, and don't give them namespace pattern options).</p> <p>Here are some example results from this setup:</p> <pre><code>alice/gitolite              -&gt;  alice, sitaramc/gitolite (pattern 1)\nalice/linux                 -&gt;  alice, linux (pattern 2)\nalice/linux/2.2             -&gt;  (namespace processing disabled)\nalice/personal/foo          -&gt;  (namespace processing disabled)\n</code></pre> </li> <li> <p>Here's an example with some errors:</p> <p><pre>\n    option namespace.pattern-1 = %/gitolite is @1 in sitaramc/gitolite\n    option namespace.pattern-2 = %/% is @1 in @2\n    option namespace.pattern-3 = %/%/* is @1/@3 in @2\n</pre></p> <p>If you try 'alice/gitolite/foo' in this setup, it will only match the 3rd pattern.  The backing repo name will be 'gitolite', which probably doesn't exist, and git will complain.</p> <p>Also, without rule 3, trying a repo with more than 2 components won't work.  Gitolite will complain that no namespace options matched.  This would indicate a discrepancy between the <code>repo [...]</code> line governing those options and the options themselves; you need to fine tune one or the others to fix things.</p> </li> </ul>"},{"location":"namespaces.html#warnings","title":"WARNINGS","text":""},{"location":"namespaces.html#security","title":"SECURITY","text":"<p>First and most important, please read 'man gitnamespaces' for important security information about namespaces.</p> <p>Secondly, please note that gitolite's access control decisions are made based on the repo name that the user supplies, even if that is only a logical repo. E.g., in a sequence like this:</p> <pre><code>git clone git@server:alice/linux                        # 1\ncd alice\ngit remote add backing git@server:linux\ngit fetch backing                                       # 2\ngit checkout master\ngit push origin master                                  # 3\n</code></pre> <p>Lines 1 and 3 use the access list for the logical repo (\"alice/linux\") to allow or reject a push, while line 2, which is directly contacting the \"backing\" repo, use that repo's access rules.</p> <p>In particular, Alice does not need write access to the backing repo for the push to succeed!</p>"},{"location":"namespaces.html#gitolite-functionality","title":"gitolite functionality","text":"<p>Most things you're used to in gitolite won't work with logical repos.  From the client point of view, the only features guaranteed to work on logical repos are:</p> <ul> <li>normal git operations (clone, fetch, push)</li> <li>creating a new wild repo</li> <li>the perms command (except the \"-c\" flag)</li> </ul> <p>From a server/admin point of view, the following will not work for logical repos, and may even fail silently!:</p> <ul> <li>smart-http mode</li> <li>the 'config' line in gitolite.conf</li> <li>any 'option's affecting a physical repo, like RepoUmask</li> <li>anything that expects to be recorded somewhere in the bare repo directory.</li> <li>...and anything else not explicitly listed as \"working\" in this doc ;-)</li> </ul>"},{"location":"namespaces.html#gitolite-functionality-mirroring","title":"gitolite functionality -- mirroring","text":"<p>Mirroring works, but all the logical repos and the backing repo should have the same mirroring setup.  I.e., which server is the master, who are the copies, are redirects allowed, if so from where, etc., etc., etc., should all have the same values for all of them.  I cannot over-emphasise the importance of this for proper mirroring.</p>"},{"location":"namespaces.html#other-notes","title":"other notes","text":"<p>The \"backing repo\" needs to exist.  If it is itself a wild repo, it must be auto-created before a logical repo that hangs off of it is accessed.</p> <p>The logical repo must also be mentioned in the gitolite.conf file in some way, as you saw in the example.  Access control decisions are made based on this one, not the backing repo.</p> <p>One quirk is that, if the logical repo is a wild repo, then an actual repo with that name is created on disk.  Gitolite needs a place to keep its repo-specific permissions so it has to do that.  You will find, however, that the objects directory is pretty much empty, even after a lot of activity.</p>"},{"location":"no-way.html","title":"no way!","text":"<p>For the entertainment of the sensible majority, and as a way of thanking all of you, here are some examples of requests (demands in some cases) I have received over the last couple of years.</p> <ul> <li> <p>deleting environment variables copied from client session</p> <p>demand: add code to delete certain environment variables at startup because \"the openssh servers in the linux distribution that [he] use[s], are configured to copy <code>GIT_*</code> variables to the remote session\".</p> <p>This is wrong on so many levels it's almost plonk-able!</p> </li> <li> <p>using <code>cp</code> instead of <code>ln</code></p> <p>Guy has an NTFS file system mounted on Linux.  So... no symlinks (an NTFS file system on Windows works fine because msysgit/cygwin manage to simulate them.  NTFS mounted on Linux won't do that!)</p> <p>He wanted all the symlink stuff to be replaced by copies.</p> <p>No. Way.</p> </li> <li> <p>non-bare repos on the server</p> <p>Some guy gave me a complicated spiel about git-svn not liking bare repos or whatever.  I tuned off at the first mention of those 3 letters so I don't really know what the actual problem was.</p> <p>But it doesn't matter.  Even if someone (Ralf H) had not chipped in with a workable solution, I still would not do it.  A server repo should be bare. Period.</p> </li> <li> <p>incomplete ownership of <code>GL_REPO_BASE</code></p> <p>This guy had a repo-base directory where not all of the files were owned by the git user.  As a result, some of the hooks did not get created.  He claimed my code should detect OS-permissions issues while it's doing its stuff.</p> <p>No.  I refuse to have the code constantly look over its shoulder making sure fundamental assumptions are being met.</p> </li> <li> <p>empty template directory</p> <p>(See man git-init for what a template directory is).</p> <p>The same guy with the environment variables had an empty template directory because he \"does not like to have sample hooks in every repository\".  So naturally, the hooks directory does not get created when you run a <code>git init</code>.  He expects gitolite to compensate for it.</p> <p>Granted, it's only a 1-line change.  But again, this falls under \"constantly looking over your shoulder to double check fundamental assumptions\".  Where does it end?</p> <p>[update 2014-07: I believe I read somewhere that git itself may be removing those \"sample\" hooks.  If that also means the hooks directory will not be created when you \"git init --bare\", then I guess I'd have to do something!]</p> </li> </ul>"},{"location":"non-core.html","title":"\"non-core\" gitolite","text":"<p>Much of gitolite's functionality comes from programs and scripts that are not considered \"core\".  This keeps the core simpler, and allows you to enhance gitolite for your own site without too much fuss.</p> <p>Documentation for non-core gitolite is organised as follows:</p> <ul> <li> <p>This page describes the types of non-core programs and how/where to     install code that is specific to your site.</p> </li> <li> <p>The developer notes page tells you how to write your own     non-core programs.</p> </li> <li> <p>The list of non-core programs talks about what's already     shipped with gitolite, with a brief description of each.</p> </li> </ul>"},{"location":"non-core.html#core-versus-non-core","title":"core versus non-core","text":"<p>Gitolite has five types of non-core code:</p> <ul> <li>Commands can be run from the shell command line.  Among those, the ones     in the ENABLE list in the rc file can also be run remotely.</li> <li>Hooks are standard git hooks.</li> <li>Sugar scripts change the conf language for your convenience.  The word     sugar comes from \"syntactic sugar\".</li> <li>Triggers are to gitolite what hooks are to git.  I just chose a     different name to avoid confusion and constant disambiguation in the docs.</li> <li>VREFs are extensions to the access control check part of gitolite.</li> </ul>"},{"location":"non-core.html#locations","title":"locations...","text":""},{"location":"non-core.html#for-non-core-programs-shipped-with-gitolite","title":"...for non-core programs shipped with gitolite","text":"<pre>\n.\n\u251c\u2500\u2500 commands\n\u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Gitolite\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Conf\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Hooks\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Test\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 Triggers\n\u251c\u2500\u2500 syntactic-sugar\n\u251c\u2500\u2500 triggers\n\u2514\u2500\u2500 VREF\n</pre> <p><code>gitolite query-rc GL_BINDIR</code> will tell you where gitolite's code has been installed.  That directory should look like this.</p> <p>Among these, the directories in green are considered \"non-core\", while the ones in red are considered \"core\".  In addition, the two files \"gitolite\" and \"gitolite-shell\" in src are also considered \"core\"</p> <p>You might notice that there are two locations for triggers; that is simply because there are two types of them.  You might also notice that there is no place for hooks -- gitolite doesn't ship with any hooks that are non-core.</p>"},{"location":"non-core.html#for-your-non-core-programs","title":"...for your non-core programs","text":"<pre>\n.\n\u251c\u2500\u2500 commands\n\u251c\u2500\u2500 hooks\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 common\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 repo-specific\n\u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Gitolite\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 Triggers\n\u251c\u2500\u2500 syntactic-sugar\n\u251c\u2500\u2500 triggers\n\u2514\u2500\u2500 VREF\n</pre> <p>If you want to add your own non-core programs, or even override the shipped ones with your own, you can.</p> <p>Put your programs in some convenient directory and use the <code>LOCAL_CODE</code> rc variable to tell gitolite where that is.  Please supply the FULL path to this variable.  (You'll find the rc file already has examples lines, commented out, so it's easy to know where to put it and what syntax to use).</p> <p>Within that directory, you can use any or all of the subdirectories shown here.</p> <p>If you add a program in your local code directory with the same name as a shipped program, gitolite uses your version.</p> <p>Notice that there are two directories related to hooks here, neither of which exist in the shipped non-core code.  Also, the <code>hooks/common</code> directory is a bit special.  If you add new hooks to this, you must run <code>gitolite setup</code>, or at least <code>gitolite setup --hooks-only</code>, for it to take effect.</p>"},{"location":"non-core.html#using-the-gitolite-admin-repo-to-manage-non-core-code","title":"using the gitolite-admin repo to manage non-core code","text":"<p>Important security note:</p> <p>In this mode, anyone who can push changes to the admin repo will effectively be able to run any arbitrary command on the server.  See gitolite admin and shell access for more background.</p> <p>The location given in <code>LOCAL_CODE</code> could be anywhere on disk, like say <code>$ENV{HOME}/local</code>.</p> <p>However, some administrators find it convenient to use the admin repo to manage this code as well, getting the benefits of versioning them as well as making changes to them without having to log on to the server.</p> <p>To do this, simply point <code>LOCAL_CODE</code> to someplace inside <code>$GL_ADMIN_BASE</code> in the rc file.  I strongly suggest:</p> <pre>\nLOCAL_CODE  =&gt;  \"$rc{GL_ADMIN_BASE}/local\",\n</pre> <p>Then you create a directory called \"local\" in your gitolite clone, and create the directory structure (shown in the previous section) within that directory. Thus, when you push the admin repo, the files will land up, with the correct paths, in the location pointed to by LOCAL_CODE.</p> <p>(Note: when you do this, gitolite takes care of running <code>gitolite setup --hooks-only</code> when you change any hooks and push).</p>"},{"location":"non-core.html#types-of-non-core-programs","title":"types of non-core programs","text":""},{"location":"non-core.html#gitolite-commands","title":"gitolite \"commands\"","text":"<p>Gitolite comes with several commands that users can run.  Remote users run commands by saying:</p> <pre><code>ssh git@host command [args...]\n</code></pre> <p>while on the server you can run</p> <pre><code>gitolite command [args...]\n</code></pre> <p>Very few commands are designed to be run both ways, but it can be done, by checking for the presence of env var <code>GL_USER</code>.</p> <p>All commands respond to a single <code>-h</code> option with a suitable message.</p> <p>You can get a list of available commands by using the <code>help</code> command. Naturally, a remote user will see a much smaller list than the server user.</p> <p>You allow a command to be run from remote clients by adding its name to (or uncommenting it if it's already added but commented out) the ENABLE list in the rc file.</p>"},{"location":"non-core.html#hooks-and-gitolite","title":"hooks and gitolite","text":"<p>You can install any hooks except these:</p> <ul> <li> <p>(all repos) Gitolite reserves the <code>update</code> hook.  See the \"hooks\" section     in dev-notes if you want additional update hook     functionality.</p> </li> <li> <p>(gitolite-admin repo only) Gitolite reserves the <code>post-update</code> hook.</p> </li> </ul> <p>How/where to install them is described in detail in the \"locations\" section above, especially this and this.  The summary is that you put them in the \"hooks/common\" sub-directory within the directory whose name is given in the <code>LOCAL_CODE</code> rc variable, then run <code>gitolite setup</code>.</p>"},{"location":"non-core.html#repo-specific-hooks","title":"repo-specific hooks","text":"<p>Important security note:</p> <p>If you enable this, anyone who can push changes to the admin repo will effectively be able to run any arbitrary command on the server.  See gitolite admin and shell access for more background.</p> <p>If you want to add hooks only to specific repos, you can just do it manually if you wish -- just log on to the server and add hooks (except the update hook and, for the special gitolite-admin repo, the post-update hook -- touch these and all bets on gitolite's functionality are off).</p> <p>However, if you want to do that from within gitolite, and thus keep everything together, you can do that also.  Here's how.</p> <ul> <li> <p>Create a directory called <code>hooks/repo-specific</code> in whatever location you     decided to use for your non-core code (i.e., direct on the server, or     within the gitolite-admin repo).</p> </li> <li> <p>Add your hooks here, with descriptive names (i.e., not \"post-receive\",     etc., but maybe \"jenkins\" or \"deploy\" or whatever).</p> <ul> <li>As of v3.6.7, you can also put them in subdirectories for convenience     (like if you have too many repo specific hooks).  For instance, you     could put some hook code in <code>foo/bar</code>; the symlink in the repo's hooks     directory will be created as if you had called it <code>foo_bar</code>.</li> </ul> </li> <li> <p>Uncomment the 'repo-specific-hooks' line in the rc file or add it to the     ENABLE list if it doesn't exist.</p> <p>If your rc file does not have an ENABLE list, you need to add this to the POST_COMPILE and the POST_CREATE lists.  Click here for more on all this.</p> </li> <li> <p>Now add lines like this to your conf file:</p> <p><pre>\nrepo    foo\n    option hook.post-receive    =   deploy\n</pre></p> <p>The syntax should be fairly obvious, but just to be clear, in this case a symlink called \"post-receive\" will be placed in foo.git/hooks, pointing to the executable called \"deploy\" in hooks/repo-specific in the local-code area.</p> <p>WARNING: if the hook already exists, it is silently overwritten.</p> <p>WARNING: (v3.5.x or below) once the hook is placed, you can't remove it through gitolite.  That is, removing the option line won't do anything.  You'll have to go to the server and remove it manually.</p> </li> <li> <p>(v3.6+) You can assign multiple targets for each hook.  For     example, you could say</p> <p><pre>\nrepo    foo\n    option hook.post-receive    =   deploy mail-admins\n</pre></p> <p>where \"deploy\" and \"mail-admins\" are pieces of code that do whatever their names suggest, and both are, independently, candidates for being run from a post-receive hook.</p> <p>When you do this, gitolite does whatever is needed to run each of them as independent post-receive hooks (including sending them info over their STDIN as documented in 'man githooks').</p> <p>For pre-receive or pre-auto-gc you should not use more than one hook. If you really need more than one, ask on the mailing list.</p> </li> <li> <p>(v3.6+) You can change these hooks by saying:</p> <p><pre>\nrepo    foo\n    option hook.post-receive    =   deploy mail-admins\n</pre></p> <p>or delete all of them by saying:</p> <p><pre>\nrepo    foo\n    option hook.post-receive    =   \"\"\n</pre></p> </li> <li> <p>(v3.6.5+) You can add hooks incrementally.  For example:</p> <p><pre>\nrepo    @all\n    option hook.post-receive.00 =   mail-admins\n    option hook.post-receive.01 =   deploy\n# (and later)\nrepo    foo\n    option hook.post-receive.00 =   mail-users      #1\n    option hook.post-receive.01 =   \"\"              #2\n# (and maybe still later)\nrepo    @foss\n    option hook.post-receive.02 =   save-push-sigs\n</pre></p> <p>Assuming <code>foo</code> is a member of <code>@foss</code>, this declares 2 post-receive hooks for it: mail-users and save-push-sigs.  The suffix (in this example, \"00\", \"01\") can actually be any simple word.  Using a suffix keeps the option names unique, which allows you to override or delete specific options, as we did in the lines marked '#1' and '#2'.  The suffix also determines the order in which the options are used in applying hooks to the repo.  If the order doesn't matter to you, just make sure they're unique.</p> </li> </ul>"},{"location":"non-core.html#syntactic-sugar","title":"syntactic sugar","text":"<p>Sugar scripts help you change the perceived syntax of the conf language.  The base syntax of the language is very simple, so sugar scripts take something else and convert it into that.</p> <p>That way, the admin sees additional features (like allowing continuation lines), while the parser in the core gitolite engine does not change.</p> <p>If you want to write your own sugar scripts, please read the \"your own sugar\" section in dev-notes first then email me.</p> <p>You enable a sugar script by uncommenting the feature name in the ENABLE list in the rc file.</p>"},{"location":"non-core.html#triggers","title":"triggers","text":"<p>Triggers have their own page.</p>"},{"location":"non-core.html#vrefs","title":"VREFs","text":"<p>VREFs also have their own page.</p>"},{"location":"odds-and-ends.html","title":"miscellaneous features","text":"<p>This page has a bunch of features that didn't seem to fit anywhere.</p>"},{"location":"odds-and-ends.html#disabling-pushes-to-take-backups","title":"disabling pushes to take backups","text":"<p>The <code>writable</code> command allows you to disable pushes to all repos or just the named repo, in order to do file-system level things to the repo directory that require it not to change, like using normal backup software.</p> <p>Run <code>gitolite writable -h</code> for more info.</p>"},{"location":"odds-and-ends.html#putting-repositories-and-gitolite-elsewhere","title":"putting 'repositories' and '.gitolite' elsewhere","text":"<p>Gitolite insists that the \"repositories\" and \".gitolite\" directories be in <code>$HOME</code>.  If you want them somewhere else:</p> <ul> <li>do the install as normal,</li> <li>then move those directories to wherever you want and replace them with     symlinks pointing to the new location.</li> </ul>"},{"location":"odds-and-ends.html#using-pubkeys-obtained-from-elsewhere","title":"using pubkeys obtained from elsewhere","text":"<p>If you're not managing keys via the gitolite-admin repo, but getting them from somewhere else, you'll want to periodically \"update\" the keys.</p> <p>To do that, first edit your rc file and add something like this:</p> <pre><code>SSH_AUTHKEYS                =&gt;\n    [\n        'post-compile/ssh-authkeys',\n    ],\n</code></pre> <p>Then write a script that</p> <ul> <li>gets all the keys and dumps them into <code>$HOME/.gitolite/keydir</code> (or into a     subdirectory of it), and</li> <li>runs <code>gitolite trigger SSH_AUTHKEYS</code>.</li> </ul> <p>Run this from cron or however you want.</p>"},{"location":"odds-and-ends.html#giving-users-their-own-repos","title":"giving users their own repos","text":"<p>(Please see this for background on the ideas in this section).</p> <p>It's very easy to give users their own set of repos to create, with the username at the top level.  The simplest setup is:</p> <pre>\nrepo CREATOR/..*\n    C   =   @all\n    RW+ =   CREATOR\n    RW  =   WRITERS\n    R   =   READERS\n</pre> <p>Now users can create any repo under their own name simply by cloning it or pushing to it, then use the perms command to add other users to their WRITERS and READERS lists.</p> <p>Of course you can get much more creative if you add a few more roles.</p> <p>(I prefer using some prefix, say \"u\", as in <code>repo u/CREATOR/..*</code>.  This helps to keep user-created repos separate, and avoid name clashes in some far-fetched scenarios).</p>"},{"location":"odds-and-ends.html#administering-gitolite-directly-on-the-server","title":"administering gitolite directly on the server","text":"<p>The main use of managing gitolite via the admin repo is that you get to version control the access rules.  But for large sites, there's another use: you can share the admin load with more people, without having to give all of them shell access on the server.</p> <p>However, people who use puppet and similar systems already have a conf versioning and management system.  And they'd like to continue to use that to manage gitolite repos and users, rather than be forced to do it through the gitolite-admin repo.</p> <p>Such sites don't really need the admin repo at all, so here's how to get rid of it and run things directly on the server (which you can script into your puppet or similar software quite easily).</p> <p>First the one-time stuff:</p> <ul> <li> <p>install the software as normal</p> </li> <li> <p>run <code>gitolite setup -a dummy</code> instead of the normal setup     command</p> </li> <li> <p>delete (or move away) <code>~/repositories/gitolite-admin.git</code></p> </li> <li> <p>edit <code>~/.gitolite/conf/gitolite.conf</code> and remove the gitolite-admin repo     and its access line.</p> </li> <li> <p><code>mkdir ~/.gitolite/keydir</code> (because \"setup -a\" does not create it, but you     will need it later to add keys).</p> </li> <li> <p>run <code>gitolite compile; gitolite trigger POST_COMPILE</code></p> </li> </ul> <p>To manage gitolite, you can directly edit files in <code>~/.gitolite</code> (or cause puppet to place files there), and then run the commands in the last step above.  For example:</p> <ul> <li>copy someone's pubkey file to <code>~/.gitolite/keydir</code></li> <li>edit <code>~/.gitolite/conf/gitolite.conf</code> and add a repo or three, giving     access to some user(s)</li> <li>run <code>gitolite compile; gitolite trigger POST_COMPILE</code></li> </ul> <p>That's it.</p>"},{"location":"options.html","title":"gitolite options","text":"<p>Some gitolite features are enabled, or gitolite's behaviour changed, by setting \"options\".</p> <p>A line like <code>option foo = 1</code> is really just syntactic sugar for <code>config gitolite-options.foo = 1</code>, so everything in the git-config page also applies here (especially the bit about overriding config values.</p> <p>However, these values are not written into git's own <code>config</code> file, so git (or other programs running <code>git config</code>) will not see them.  You can only query them using <code>gitolite git-config</code>, where they will appear in full in the output.</p> <p>Options are set by repo.  The syntax is very simple:</p> <pre><code>option  foo.bar     =   baz\n</code></pre> <p>Of course this is useless if some other part of gitolite, or some external command, is not querying for the option key 'foo.bar'!</p> <p>Options are therefore documented in the section/page they belong in, not here. Here are some examples, although this list is not exhaustive:</p> <ul> <li> <p>Ask gitolite to honor deny rules  during the pre-git check     also.</p> </li> <li> <p>Options related to mirroring -- tell gitolite who is the master server,     and who are the copies, for each repo.</p> </li> <li> <p>The optional post-compile trigger <code>update-gitweb-daemon-from-options</code>     allows you to use options instead of special usernames gitweb and daemon     to determine access for those tools.</p> </li> <li> <p>You can set repo-specific environment variables for triggers and     hooks to test, which is very useful.</p> </li> </ul> <p>Here's how to disable an option from a single repo if it was enabled earlier in a group (which you might guess from reading the git-config page):</p> <pre>\n@g = r1 r2 r3\n\nrepo @g\n    option gitweb = 1\n\n# but repo r2 should not be accessible by gitweb\nrepo r2\n    option gitweb = \"\"\n</pre>"},{"location":"overview.html","title":"gitolite overview","text":"<p>Gitolite allows you to setup git hosting on a central server, with fine-grained access control and many more powerful features.</p>"},{"location":"overview.html#what-is-gitolite","title":"what is gitolite?","text":"<p>Gitolite is an access control layer on top of git.  Here are the features that most people see:</p> <ul> <li>Use a single unix user (\"real\" user) on the server.</li> <li>Provide access to many gitolite users:<ul> <li>they are not \"real\" users,</li> <li>so they do not get shell access.</li> </ul> </li> <li>Control access to many git repositories:<ul> <li>read access controlled at the repo level,</li> <li>write access controlled at the branch/tag/file/directory level,     including who can rewind, create, and delete branches/tags.</li> </ul> </li> <li>Can be installed without root access, assuming git and perl are already     installed.</li> <li>Authentication is most commonly done using sshd, but you can also use     \"smart http\" mode if you prefer (this may require root access for the     initial setup).</li> </ul>"},{"location":"overview.html#why-might-you-need-it","title":"why might you need it?","text":""},{"location":"overview.html#access-control","title":"access control","text":"<p>Git by itself does not do any access control -- it relies on the transport medium to do authentication (\"who are you?\"), and on OS file permissions to do authorisation (\"what are you allowed to do?\").</p> <p>Git also comes with a program called \"git-shell\" which can act as a restricted login shell if you don't want users getting a proper shell.  Using this and judicious use of Unix groups, you can allow some people read-only access while others get read-write access, etc.  This is probably sufficient if your needs are simple and don't change too often.</p> <p>However, gitolite does this much better, and offers many more features.</p>"},{"location":"overview.html#basic-use-case","title":"basic use case","text":"<p>Gitolite is useful in any server that is going to host multiple git repositories, each with many developers, where \"anyone can do anything to any repo\" is not a good idea.  Here're two examples to illustrate.</p> <p>This first example has 3 repos and 3 developers with different levels of access to each repo.  It's a very simple, readable, syntax, and makes it easy to answer questions like \"what repos can bob push to\" (answer: only 'bar').</p> <pre>\nrepo foo\n    RW+     =   alice\n    RW      =   carol\n\nrepo bar\n    RW+     =   bob\n    R       =   alice\n\nrepo baz\n    RW+     =   carol\n    R       =   alice bob\n</pre> <p>This second example allows different levels of access to different branches and tags for different developers:</p> <pre>\nrepo foo\n    RW+                         =   alice\n    RW  master                  =   bob\n    RW+ dev/                    =   bob\n    RW  refs/heads/tags/v[0-9]  =   ashok\n</pre>"},{"location":"overview.html#other-features","title":"other features","text":"<p>Gitolite has many more features, as you might guess from the amount of documentation (see links in the nav bar at the top).  Here's a quick sample:</p> <ul> <li>Very powerful rule language (rules most often based on branch/tag name, or     files/directories touched, but many other factors can be used, such as     size of changed files, number of changed files, etc.).</li> <li>Convenience features for writing the rules (repo groups, user groups, get     user group info from LDAP, include files, macros...)</li> <li>Highly customisable and scriptable, especially custom commands for users.     Many built-in commands and options.</li> <li>Powerful and flexible mirroring system.</li> <li>Users can create their own repos and set access rights (if you allow     them).</li> </ul>"},{"location":"overview.html#alternatives-to-gitolite","title":"alternatives to gitolite","text":""},{"location":"overview.html#unix-permissions-and-acls","title":"unix permissions and ACLs","text":"<p>If you're a masochist, you could probably do example 1 with Unix permissions and facls.  But you can't do example 2 -- git is not designed to allow that!</p> <p>Here are some other disadvantages of the Unix ACL method:</p> <ul> <li>Every user needs a userid and password on the server.</li> <li>Changing access rights involves complex <code>usermod -G ...</code> mumblings     (I.e., the \"pain\" mentioned above is not a one-time pain!)</li> <li>Viewing the current set of permissions requires running multiple     commands to list directories and their permissions/ownerships, users and     their group memberships, and then correlating all these manually.</li> <li>Auditing historical permissions or permission changes is impossible.</li> </ul>"},{"location":"overview.html#gerrit-code-review","title":"Gerrit Code Review","text":"<p>The best real alternative to gitolite is Gerrit Code Review.  If code review is an essential part of your workflow, you should use Gerrit.</p> <p>Here're some high level differences between gitolite and Gerrit (as of about mid-2012 or so):</p> <p>Size: 3000+ lines of perl versus of 56,000+ lines of Java</p> <p>Architecture: Gitolite sits on top of \"standard\" git and openssh, which are assumed to already be installed.  Gerrit includes its own git stack (jgit) and sshd (Apache Mina).  In Java tradition, they all come bundled together.</p> <p>(Corollary: As far as I know jgit does not support the same hooks that 'man githooks' talks about).</p> <p>Gitolite uses a plain text config file; gerrit uses a database.</p> <p>User view: Gitolite is invisible to users except when access is denied. Gerrit is much more visible to devs because of its role in enforcing code review, approvals, and workflow.</p> <p>On a related note, gitolite does not do anything special with signed or annotated tags, nor does it check author/committer identity.  However, it is trivial to add your own code to do either (or if someone contributes it, to just \"enable\" what ships with gitolite in a disabled state).</p>"},{"location":"overview.html#gitlab-gogs-gitblit-and-others","title":"gitlab, gogs, gitblit, and others","text":"<p>There are several alternatives which offer a full web-based GUI, for administrators or users or both.  They also offer a lot of enterprise features (for example LDAP integration), and social coding features (issue trackers, discussions, comments on code, pull requests, etc.)</p> <p>However, they are unlikely to be as customisable as gitolite is, if you care about that sort of thing.</p>"},{"location":"overview.html#how-does-it-work","title":"how does it work?","text":"<p>At a very high level, gitolite relies on sshd (or httpd if you're using the smart http mode) to authenticate the user and supply the username. Based on this, and the command given, it decides whether to allow or deny the request.</p> <p>Consider a push command in ssh mode.  Normally (i.e., without gitolite) this would invoke <code>git-receive-pack</code> on the server, and the flow would be somewhat like this (left side is client, right side is server):</p> <p></p> <p>When you install gitolite and setup the user, gitolite sets up ssh to force the <code>gitolite-shell</code> command to run first, instead of the command requested:</p> <p>The <code>gitolite-shell</code> program uses the username supplied by ssh, and the repo name in the command, to decide if the user has write access to the repo or not.</p> <p>If he does have some write access, git-receive-pack is called, but that's not the end of the story.  The branch/tag/file(s) he is pushing also need to be checked, and gitolite sets up the update hook on the repo to do that.</p> <p></p> <p>A more detailed explanation, with figures, is here.</p>"},{"location":"overview.html#who-uses-it","title":"who uses it?","text":"<p>If you're using gitolite and find it very useful in some way, I would love to describe your use of it or add a link to your own description of it here.  Of course, you can anonymise it as much as you need to.</p> <p>NOTE: some of the links below may be outdated/bit-rotted.  As I find new links or someone points me to them I'll post them here with an approximate date.  (I'll keep the old text/links as-is for now).</p> <p>Update 2021 July</p> <ul> <li> <p>Operating Systems</p> <ul> <li>Linux https://korg.docs.kernel.org/gitolite/index.html; they moved to gitolite after kernel.org was compromised via a developer workstation in 2011 https://lkml.org/lkml/2011/9/23/357</li> <li>FreeBSD (unable to find a proper link, I only found out when they asked a question on the gitolite mailing list: https://groups.google.com/g/gitolite/c/6qdyDDBjJ30/m/e0RndHSQAQAJ)</li> </ul> </li> <li> <p>Linux distributions:</p> <ul> <li>Fedora https://fedoraproject.org/wiki/Package_Source_Control#Authorization</li> <li>KDE Neon https://community.kde.org/Neon/Git</li> <li>Gentoo (can't find a decent link, but https://wiki.gentoo.org/wiki/User:Robbat2 has made several commits to gitolite over the years, e.g., https://github.com/gitolite/gitolite/commit/766fd7d46ebb82f9d0134886a3fc5228b4df3936)</li> <li>Mageia https://wiki.mageia.org/en/Git_Migration#Git_Authentication</li> </ul> </li> </ul> <p>Older text follows: (TODO: curate this properly and remove dead links)</p> <p>The Fedora Project controls access to over 10,000 package management repositories accessed by over 1,000 package maintainers using gitolite.  This is probably the largest confirmed gitolite installation anywhere.  The whole \"big-config\" option back in v2 (in v3 this is the default!) was initially done for them (their config file was so big that without the big-config changes gitolite would just run out of memory and die!).</p> <p>The KDE project uses gitolite (in combination with redmine for issue tracking and reviewboard for code review).  Apart from the usual access control, the KDE folks are heavy users of the \"ad hoc repo creation\" features enabled by wildrepos and the accompanying commands.  Several of the changes to the \"admin defined commands\" were also inspired by KDE's needs.  See section 5 and section 6 of the above linked page for details.</p> <p>Prof. Hiren Patel of the University of Waterloo is responsible for the existence of the fairly popular \"wildrepos\" feature.  The documentation was pretty much written with his use case in mind, but of course it turns out to be useful for a lot of people, as you can see from the previous para on KDE's use of gitolite.</p> <p>In fact, he surprised the heck out of me once by saying that if it hadn't been for this feature, he might not have used git itself -- which is a pretty serious compliment if you think about the magnitude of the git project and my little one-man show!</p> <p>He explains his use of it here.</p> <p>Gentoo Linux has just moved their git repositories from gitosis to gitolite. There are about 200 repositories, some of them are the so called overlays, official and unofficial/user overlays, plus several developer and project repositories, used by more than 1000 people. That number will be increased in the near future, as they are going to migrate some of their CVS/SVN repositories there, plus they are offering overlays hosting for users as well.</p> <p>kernel.org, the official distribution point for the Linux kernel, is the latest (as of 2011-10) high-visibility installation.  According to this email to the lkml, kernel.org decided to use gitolite for access controlling their git repos.</p> <p>This move also prompted the first ever security audit of gitolite by an outside party.  Gitolite did great; see here for details.  [NOTE: v3 has not had such an audit yet; if you did one, please let me know what you found.  If you want to do one and need clarifications on anything or general background let me know].</p> <p>In addition, kernel.org was responsible for a serious rethink of a few rough edges in gitolite, and smoothing them out was fun (the \"playing with gitolite\" stuff, making the test suite simpler, \"deny\" rules for the entire repo).</p> <p>The Mageia Project is using gitolite 3 to manage its git repositories and access control. The repositories are defined in yaml files. A tool called mgagit has been created and is repsonsible for the generation of the gitolite configuration from the yaml repos definitions, and the extraction of users' ssh keys from an ldap directory into the gitolite configuration.</p> <p>Gitolite and mgagit are installed using rpm packages and a puppet module.</p> <p>A general note: if you see the list of high-profile users above, you will see that gitolite benefits as much as they do; possibly more.</p> <p>Note:</p> <p>GIT is a trademark of Software Freedom Conservancy and my use of \"Gitolite\" is under license.</p>"},{"location":"package.html","title":"packaging gitolite","text":"<p>Gitolite has broad similarities to git in terms of packaging requirements.</p> <ul> <li> <p>Git has 150 executables to marshal and put somewhere.  Gitolite has the     directories <code>commands</code>, <code>lib</code>, <code>syntactic-sugar</code>, <code>triggers</code>, and <code>VREF</code>.</p> <p>It doesn't matter what this directory is.  As an example, Fedora keeps git's 150 executables in /usr/libexec/git-core, so /usr/libexec/gitolite may be a good choice; it's upto you.</p> <p>The rest of this section will assume you chose /usr/libexec/gitolite as the location, and that this location contains the 5 directories named above.</p> </li> <li> <p>Git has the <code>GIT_EXEC_PATH</code> env var to point to this directory.  Gitolite     has <code>GL_BINDIR</code>.  However, in git, the \"make\" process embeds a suitable     default into the binary, making the env var optional.</p> </li> </ul> <p>With that said, here's one way to package gitolite:</p> <ul> <li> <p>Put the executable <code>gitolite</code> somewhere in PATH.  Put the executable     <code>gitolite-shell</code> in /usr/libexec/gitolite (along with those 5 directories).</p> <p>Change the 2 assignments to <code>$ENV{GL_BINDIR}</code>, one in 'gitolite', one in 'gitolite-shell', to \"/usr/libexec/gitolite\" from <code>$FindBin::RealBin</code>. This is equivalent to \"make\" embedding the exec-path into the executable.</p> <p>OR</p> <p>Put both executables <code>gitolite</code> and <code>gitolite-shell</code> also into /usr/libexec/gitolite (i.e., as siblings to the 5 directories mentioned above).  Then symlink <code>/usr/libexec/gitolite/gitolite</code> to some directory in the PATH.  Do not copy it; it must be a symlink.</p> <p>Gitolite will find the exec-path by following the symlink.</p> </li> <li> <p>The <code>Gitolite</code> subdirectory in <code>/usr/libexec/gitolite/lib</code> can stay right     there, OR, if your distro policies don't allow that, can be put in any     directory in perl's <code>@INC</code> path (such as <code>/usr/share/perl5/vendor_perl</code>).</p> </li> <li> <p>Finally, a file called <code>/usr/libexec/gitolite/VERSION</code> must contain a     suitable version string.</p> </li> </ul>"},{"location":"perf.html","title":"gitolite performance","text":"<p>TOP TIP: If you have more than 2000 or so repos, then you should be using v3.2 or later; there was a bit of code that went in there that makes a huge difference for really large sites.</p>"},{"location":"perf.html#factors-affecting-gitolite-performance","title":"factors affecting gitolite performance","text":"<p>A lot of the following discussion involves understanding these factors:</p> <ul> <li> <p>the number of lines in gitolite.conf (plus all its \"include\" files, if     any).</p> </li> <li> <p>the number of normal repos in the conf.  A normal repo is one that is     directly named in a <code>repo ...</code> line.</p> <p><pre>\nrepo foo bar\n    # ...rules...\n</pre></p> <p>The rules for a normal repo is compiled into a file called <code>gl-conf</code> in the repo directory (i.e., one <code>gl-conf</code> file per normal repo).</p> </li> <li> <p>the number of group repos -- repos that are part of repo groups:</p> <p><pre>\n@foss = git gitolite linux\nrepo @foss\n    # ...rules...\n</pre></p> <p>The rules for group repos are compiled into a \"common\" compiled rules file which resides in <code>~/.gitolite/conf</code>.</p> </li> <li> <p>the number of wild repos -- repos that match a wild repo pattern and     were created by a user.</p> <p><pre>\nrepo dev/CREATOR/..*\n    C   =   @team\n    # ...rules...\n# actual repos created by users using git clone/push commands\n</pre></p> <p>The compiled rules for wild repos also go into the \"common\" compiled rules file.  However, these rules often consist of just \"role names\", not actual user names.  The user who owns the repo will map other users to various roles by running the perms command.</p> <p>This mapping is saved in a file called <code>gl-perms</code> in the repo directory.</p> </li> </ul>"},{"location":"perf.html#types-of-performance-issues","title":"types of performance issues","text":"<p>Gitolite performance can be discussed in four different scenarios:</p>"},{"location":"perf.html#normal-git-activity","title":"normal git activity","text":"<p>A user accesses a git repo using git clone, fetch, push, etc.</p> <p>Gitolite is heavily optimised for the day to day \"developer\" activity by users.  You should never have any issues with this, regardless of what mix of factors (affecting performance; see above) you have.</p>"},{"location":"perf.html#admin-push","title":"admin push","text":"<p>An admin does a \"push\" to the \"gitolite-admin\" repo (or does the equivalent when administering gitolite directly on the server).</p> <p>What happens then can be divided into two distinct parts.</p>"},{"location":"perf.html#gitolite-compile","title":"<code>gitolite compile</code>","text":"<p>The first part is <code>gitolite compile</code>.  This is influenced by the conf file size as well as the number of normal repos.  For each normal repo, gitolite has to write the <code>gl-conf</code> file in that repo's directory.</p> <p>That's a whole bunch of small-file writes.</p> <p>Over the past few weeks (as of Oct 2017), mainly driven by Fedora's mammoth 560,000+ line conf file containing 42,000 or so repos, there have been a couple of attempts to mitigate this.</p> <ol> <li> <p>Extend the wild repos concept:</p> <p>See the templates document for details on this.  The section that is directly relevant to the topic of performance is the one dealing with \"bypassing gitolite.conf for huge sites\", but really, you should read the whole document in order to understand what is happening there.</p> <p>Note</p> <p>Although the templates feature was inspired by performance issues, I now realise it's a much nicer way to organise repos and rules, and -- on my comparatively puny production setup -- I have reorganised all the rules to use templates instead.  The result is much easier to maintain, because I can farm out the maintenance to folks who are less gitolite-savvy.  See the \"advantages\" section in that page for more.</p> </li> <li> <p>Compile repo rules separately:</p> <p>A much less interesting, probably even somewhat kludgey, outcome of the Fedora exercise was the <code>compile-1</code> command.</p> <p>It's in <code>contrib</code> because I do not encourage its use unless you really really (really!) need it.  Instructions and caveats are in the source file itself.</p> </li> </ol>"},{"location":"perf.html#gitolite-trigger-post_compile","title":"<code>gitolite trigger POST_COMPILE</code>","text":"<p>The second part runs all the <code>POST_COMPILE</code> triggers scripts.  On a default installation, this includes maintaining <code>~/.ssh/authorised_keys</code>, updating gitweb and daemon permissions, and updating \"config\" values.</p> <p>This is influenced by the total number of repos in the system (normal and other repos), and what options are enabled in your <code>~/.gitolite.rc</code> file.</p> <p>Many of these these require scanning all the repositories and doing something to each of them (see \"scan ALL repos\" section later).  For example, the trigger script that updates the \"projects.list\" file for gitweb needs to check every repo to see if the user <code>gitweb</code> is allowed <code>R</code>ead access to it.</p>"},{"location":"perf.html#new-wild-repo","title":"new wild repo","text":"<p>A user creates a brand new \"wild\" repo.</p> <p>If you use only the default set of options enabled in the rc file, this should be pretty fast, though some of the non-default options may still be slow.</p> <p>However, the commit that finally fixed this issue for the default options is pretty recent as of the time of writing.  In tag terms, you should see it in 3.6.8.  If you're really affected by this, bug me on the mailing list to make a release, and then bug your package maintainers :-) Or just upgrade from github!</p> <p>How can you tell which program is slowing you down?  Look in the log file after a user runs a wild repo create -- any subtask of that 'create' that takes more than a second is a problem.  Send details to the mailing list so we can discuss and fix whatever can be fixed.</p>"},{"location":"perf.html#scan-all-repos","title":"scan ALL repos","text":"<p>There are a few activities that scan all repos, looking for a given user's permission on each of them:</p> <ul> <li>a user runs the <code>info</code> command</li> <li>a user accesses gitweb on a site where repo specific authorisation is in place</li> <li>the <code>POST_COMPILE</code> triggers in an \"admin push\" are invoked (as briefly     explained above).</li> </ul> <p>In general, this is the slowest part of gitolite.  It's work load is influenced by two things: the number of normal repos, and the number of wild repos, because (as we saw up above) those are the two types of repos for which certain individual files in the repo directory need to be read.</p> <p>So, on a system with lots of of normal and/or wild repos, this operation needs to read lots of small files (one in each repo directory)... which takes time.  And depends on how fast your disk is, too.</p> <p>The appendix has a solution for this, using a perl module called Memoize (comes standard with perl); check down there for details.</p>"},{"location":"perf.html#appendix-1-using-memoize","title":"appendix 1: using <code>memoize</code>","text":"<p>It seems that perl's Memoize module does a great job at helping with the \"scan ALL repos\" use case, at least after the first time a user accesses gitweb or runs the 'info' command.</p>"},{"location":"perf.html#gitweb","title":"gitweb","text":"<p>To start with, here's tested code to add into gitweb.conf:</p> <pre>\n# ----------------------------------------------------------------------\n# caching section\n\nuse Fcntl;\nuse DB_File;\nuse Memoize;\n\n# the actual file on disk\nmy $dbf = \"$rc{GL_ADMIN_BASE}/$ENV{GL_USER}-canread.db\";\n# set up persistence\ntie(%disk_cache, 'DB_File', $dbf, O_RDWR|O_CREAT, 0666)\n    or die \"Tie '$dbf' failed: $!\";\nmemoize 'can_read', SCALAR_CACHE =&gt; [ HASH =&gt; \\%disk_cache ];\n\n# ----------------------------------------------------------------------\n</pre> <p>You can add this at the end of the code linked from the repo specific authorisation section.</p> <p>The maintenance of these cache files is tricky.  I suggest:</p> <ul> <li> <p>delete all of them when a gitolite-admin push happens (easy enough to add     a new <code>POST_COMPILE</code> trigger for it -- a simple 1-line shell script will     do)</p> </li> <li> <p>run a cron job at midnight that also does the same thing</p> </li> <li> <p>create a gitolite command (maybe \"flush-canread-cache\"?) to allow a user     to flush his/her own cache file.  The basic code is pretty simple (you can     embellish it with proper error messages etc., if you like):</p> <p><pre>\n#!/bin/sh\n<p>[ -n \"$GL_USER\" ] &amp;&amp; rm -vf $GL_ADMIN_BASE/$GL_USER-canread.db\n</p>\n\n\n<p>The biggest complication is \"wild\" repos and users running the \"perms\"\ncommand.  That gets a little messy (you'd have to add code to the perms\ncommand to delete just this repo, from all user's cache files!), so I\nsuggest ignoring this.  The worst that can happen is that, until the next\nmorning (when your cron job fires) (a) he retains access to a repo that he\nhas been removed from, and (b) he does not get access to a repo to which he\nhas been just added.</p>\n<p>The first issue is unlikely to generate any complaints from the users, though\nyou may have to run it by your security team (but remember these are\nuser-assigned privileges, so just pretend the user did not get around to\nremoving the permission till the next morning!)</p>\n<p>The second is easily solved by asking them to run that command we created.</p>\n<p>That's it.</p>"},{"location":"perf.html#the-info-command","title":"the <code>info</code> command","text":"<p>TODO: see if the info command can also benefit from something similar!</p>"},{"location":"quick_install.html","title":"quick install and setup","text":"<p>If your Unix-fu and ssh-fu are good, this will work for you.  Otherwise, please click the \"next\" button up there on the right for a more leisurely, detailed, drive through the install process.</p>"},{"location":"quick_install.html#distro-package-install","title":"distro package install","text":"<p>Tip: look for packages called 'gitolite3' before you look for 'gitolite'.</p>"},{"location":"quick_install.html#install-from-source","title":"install from source","text":"<p>If you're comfortable with Unix and ssh, just copy your ssh public key from your workstation to the hosting user, then do something like this:</p> <pre>\nsu - git\nmkdir -p ~/bin\n\ngit clone https://github.com/sitaramc/gitolite\ngitolite/install -ln ~/bin          # please use absolute path here\ngitolite setup -pk yourname.pub\n</pre> <p>Please be sure to read any messages produced by these steps, especially the last one, to make sure things went OK.</p> <p>Notes:</p> <ol> <li>If your hosting user is not 'git', substitute accordingly.</li> <li>Make sure <code>~/bin</code> is in <code>$PATH</code>.  If it is not, add something to your     shell startup files to make it so.  If some other writable directory is in     the path, you can use that if you like.</li> <li>Substitute your name for \"yourname\" :-)</li> </ol>"},{"location":"rc-33.html","title":"the v3.0 to v3.3 \"rc\" file (<code>$HOME/.gitolite.rc</code>)","text":"<p>NOTE 1: if you're using v3.4 and above, see this.</p> <p>NOTE 2: if you're migrating from v2, there are some settings that MUST be dealt with before running <code>gitolite setup</code>; please read the migration page and linked pages, and especially the one on \"presetting the rc file\"</p> <p>The rc file for v3 is quite different from that of v2.</p> <p>As before, it is designed to be the only thing unique to your site for most setups.  What is new is that it is easy to extend it when new needs come up, without having to touch core gitolite.</p> <p>The rc file is perl code, but you do NOT need to know perl to edit it.  Just mind the commas, use single quotes unless you know what you're doing, and make sure the brackets and braces stay matched up!</p> <p>Please look at the <code>~/.gitolite.rc</code> file that gets installed when you setup gitolite.  As you can see there are 3 types of variables in it:</p> <ul> <li>simple variables (like <code>UMASK</code>)</li> <li>lists (like <code>POST_COMPILE</code>, <code>POST_CREATE</code>)</li> <li>hashes (like <code>ROLES</code>, <code>COMMANDS</code>)</li> </ul> <p>While some of the variables are documented in this file, many of them are not. Their purposes are to be found in each of their individual documentation files around; start with \"non-core\" gitolite.  If a setting is used by a command then running that command with '-h' may give you additional information.</p>"},{"location":"rc-33.html#specific-variables","title":"specific variables","text":"<ul> <li> <p><code>$UMASK</code>, octal, default <code>0077</code></p> <p>The default UMASK that gitolite uses makes all the repos and their contents have <code>rwx------</code> permissions.  People who want to run gitweb realise that this will not do.</p> <p>The correct way to deal with this is to give this variable a value like <code>0027</code> (note the syntax: the leading 0 is required), and then make the user running the webserver (apache, www-data, whatever) a member of the 'git' group.</p> <p>If you've already installed gitolite then existing files will have to be fixed up manually (for a umask or 0027, that would be <code>chmod -R g+rX</code>). This is because umask only affects permissions on newly created files, not existing ones.</p> </li> <li> <p><code>$GIT_CONFIG_KEYS</code>, string, default empty</p> <p>This setting allows the repo admin to define acceptable gitconfig keys.</p> <p>Gitolite allows you to set git config values using the \"config\" keyword; see here for details and syntax.</p> <p>However, if you are in an installation where the repo admin does not (and should not) have shell access to the server, then allowing him to set arbitrary repo config options may be a security risk -- some config settings allow executing arbitrary commands!</p> <p>You have 3 choices.  By default <code>$GIT_CONFIG_KEYS</code> is left empty, which completely disables this feature (meaning you cannot set git configs via the repo config).</p> <p>The second choice is to give it a space separated list of settings you consider safe.  (These are actually treated as a set of regular expressions, and any one of them must match).</p> <p>For example:</p> <pre><code>$GIT_CONFIG_KEYS = 'core\\.logAllRefUpdates core\\..*compression';\n</code></pre> <p>Each regex should match the whole key (in other words, there is an implicit <code>^</code> at the start of each regex, and a <code>$</code> at the end).</p> <p>The third choice (which you may have guessed already if you're familiar with regular expressions) is to allow anything and everything: <code>$GIT_CONFIG_KEYS = '.*';</code></p> </li> <li> <p><code>ROLES</code>, hash, default keys 'READERS' and 'WRITERS'</p> <p>This specifies the role names allowed to be used by users running the perms command.  The wild repos doc has more info on roles.</p> </li> <li> <p><code>DEFAULT_ROLE_PERMS</code>, string, default undef</p> <p>This sets default wildcard permissions for newly created wildcard repos.</p> <p>If set, this value will be used as the default role permissions for new wildcard repositories. The user can change this value with the perms command as desired after repository creation; it is only a default.</p> <p>Please be aware this is potentially a multi-line variable.  In most setups, it will be left undefined.  Some installations may benefit from setting it to <code>READERS @all</code>.</p> <p>If you want multiple roles to be assigned by default, here is how.  Note double quotes this time, due to the embedded newline, which in turn require the '@' to be escaped:</p> <pre><code>DEFAULT_ROLE_PERMS  =&gt;  \"READERS \\@all\\nWRITERS \\@senior_devs\",\n</code></pre> </li> <li> <p><code>LOCAL_CODE</code>, string</p> <p>This is described in more detail here.  Please be aware this must be a FULL path, not a relative path.</p> </li> </ul>"},{"location":"rc.html","title":"the \"rc\" file (<code>$HOME/.gitolite.rc</code>)","text":"<p>IMPORTANT: if you have a v3.0-v3.3 rc file it is documented here, and it will still work.  Please see appendix A below for details.</p> <p>The rc file is designed to be the only thing unique to your site for most setups.</p> <p>The rc file is well commented.  Please look at the <code>~/.gitolite.rc</code> file that gets installed when you setup gitolite.  You can always get a default copy for your current version by running <code>gitolite print-default-rc</code>.  (Please see appendix A for upgrade instructions.)</p>"},{"location":"rc.html#structure-of-the-rc-file","title":"structure of the rc file","text":"<p>The rc file is perl code, but you do NOT need to know perl to edit it.  Just mind the commas, use single quotes unless you know what you're doing, and make sure the brackets and braces stay matched up!</p> <p>As you can see there are 3 types of variables in it:</p> <ul> <li>A lot of simple variables (like <code>UMASK</code>, <code>GIT_CONFIG_KEYS</code>, etc.).</li> <li>A hash or two (like <code>ROLES</code>).</li> <li>And one large list of features to be enabled (<code>ENABLE</code>).</li> </ul> <p>This page documents only some of them; for most of them it's best to look in the actual rc file or in each of their individual documentation files around; start with \"non-core\" gitolite.  If a setting is used by a command then running that command with '-h' may give you additional information.</p>"},{"location":"rc.html#specific-variables","title":"specific variables","text":"<ul> <li> <p><code>$UMASK</code>, octal, default <code>0077</code></p> <p>The default UMASK that gitolite uses gives <code>rwx------</code> permissions to all the repos and their contents.  People who want to run gitweb (or cgit, redmine, etc) realise that this will not do.</p> <p>The correct way to deal with this is to give this variable a value like <code>0027</code> (note the syntax: the leading 0 is required), and then make the user running the webserver (apache, www-data, whatever) a member of the 'git' group.</p> <p>If you've already installed gitolite then existing files will have to be fixed up manually (for a umask or 0027, that would be <code>chmod -R g+rX</code>). This is because umask only affects permissions on newly created files, not existing ones.</p> </li> <li> <p><code>$GIT_CONFIG_KEYS</code>, string, default empty</p> <p>See the security note at the end of this page for why we do this.</p> <p>This setting allows the repo admin to define acceptable gitconfig keys.</p> <p>Gitolite allows you to set git config values using the \"config\" keyword; see here for details and syntax.</p> <p>You have 3 choices.  By default <code>$GIT_CONFIG_KEYS</code> is left empty, which completely disables this feature (meaning you cannot set git configs via the repo config).</p> <p>The second choice is to give it a space separated list of settings you consider safe.  (These are actually treated as a set of regular expressions, and any one of them must match).</p> <p>For example:</p> <pre><code>$GIT_CONFIG_KEYS = 'core\\.logAllRefUpdates core\\..*compression';\n</code></pre> <p>Each regex should match the whole key (in other words, there is an implicit <code>^</code> at the start of each regex, and a <code>$</code> at the end).</p> <p>The third choice (which you may have guessed already if you're familiar with regular expressions) is to allow anything and everything: <code>$GIT_CONFIG_KEYS = '.*';</code></p> </li> <li> <p><code>ROLES</code>, hash, default keys 'READERS' and 'WRITERS'</p> <p>This specifies the role names allowed to be used by users running the perms command.  The wild repos doc has more info on roles.</p> </li> <li> <p><code>OWNER_ROLENAME</code>, string, default undef</p> <p>(requires v3.5 or later)</p> <p>By default, permissions on a wild repo can only be set by the creator of the repo (using the perms command).  But some sites want to allow other people to do this as well.</p> <p>To enable this behaviour, the server admin must first set this variable to some string, say 'OWNERS'.  (He must also add 'OWNERS' to the ROLES hash described in the previous bullet).</p> <p>The creator of the repo can then add other users to the OWNERS role using the perms command.</p> <p>The perms command, the new \"owns\" command, and possibly other commands in future, will then give these users the same privileges that they give to the creator of the repo.</p> <p>(Also see the full documentation on roles).</p> </li> <li> <p><code>LOCAL_CODE</code>, string</p> <p>This is described in more detail here.  Please be aware this must be a FULL path, not a relative path.</p> </li> </ul>"},{"location":"rc.html#security-note-gitolite-admin-and-shell-access","title":"security note: gitolite admin and shell access","text":"<p>People sometimes ask why this file is also not revision controlled.  Here's why.</p> <p>Gitolite maintains a clear distinction between</p> <ul> <li>people who can push to the gitolite-admin repo, and</li> <li>people who can get a shell or run arbitrary commands on the server.</li> </ul> <p>This may not matter to many (small) sites, but in large installations, the former is often a much larger set of people that you really don't want to give shell access to.</p> <p>Therefore, gitolite tries very hard to make sure that people in the first set are not allowed to do anything that gets them into the second set.</p> <p>If you must revision control it, you can.  Just add it to your admin repo, push the change, then replace <code>~/.gitolite.rc</code> with a symlink to <code>~/.gitolite/.gitolite.rc</code>.</p>"},{"location":"rc.html#appendix-a-upgrading-the-rc-file","title":"appendix A: upgrading the rc file","text":"<p>First, note that upgrading the rc file is always optional.  However, it may help if you want to use any of the new features available in later gitolite releases, in the sense that the lines you need to add may already be present (commented out) in the rc file, so you just need to uncomment them instead of typing them in yourself.</p> <p>If you have a v3.0-v3.3 rc file it is documented here, and it will still work.  In fact internally the v3.4 rc file data gets converted to the v3.3 format.  There's a simple program to help you upgrade a v3.3 (or prior) rc file (in v3.6.1+, see contrib/utils/rc-format-v3.4), but it has probably not seen too much testing; please tread carefully and report any problems you find.</p> <p>Upgrading from any v3.4+ rc file to any later gitolite is fairly easy, though still manual.  One useful aid is that, as of v3.6.4, you can run <code>gitolite query-rc -d</code> to dump the entire rc structure to STDOUT.  This only requires that gitolite be v3.6.4+; your rc file can still be the old one.  You can use this to confirm you did not miss something during the manual rc upgrade.</p> <ul> <li> <p>dump the current rc by running <code>gitolite query-rc -d &gt; old.dump</code> (assuming     you upgraded to v3.6.4 or higher)</p> </li> <li> <p>save your old rc file: <code>mv ~/.gitolite.rc ~/old.gitolite.rc</code></p> </li> <li> <p>get a \"default\" rc for your current gitolite by running</p> <pre><code>gitolite print-default-rc &gt; ~/.gitolite.rc\n</code></pre> </li> <li> <p>use your favourite diff-ing editor on the old and the new files and figure     out what to carry over from the old rc file to the new one.</p> <pre><code>vimdiff ~/old.gitolite.rc ~/.gitolite.rc\n# or maybe kdiff3 or whatever\n</code></pre> <p>This is the tricky part of course!  Watch out for configs that got moved around, or in some cases removed completely, not just new config items.</p> </li> <li> <p>dump the new rc by running <code>gitolite query-rc -d &gt; new.dump</code></p> </li> <li> <p>compare the 2 rc dumps to make sure you've got everything covered.</p> </li> </ul>"},{"location":"rc.html#appendix-b-making-a-trigger-run-after-the-built-in-ones","title":"appendix B: making a trigger run after the built-in ones","text":"<p>For most purposes, the section on adding your own scripts to a trigger works fine.</p> <p>But triggers added that way, run before the built-in triggers, which you can also confirm by running <code>gitolite query-rc -d</code> and looking for your trigger in the output.</p> <p>If you need your trigger to run after the built-in ones, it is possible, it's a wee bit more work.</p> <p>Let's say you have a post-compile script called \"my-custom-config\", and you want it to run after the shipped post-compile scripts. Here's what you do:</p> <ul> <li> <p>add something like 'my-cust' (could be anything you like, as long as     it matches the next step) to the ENABLE list in the rc file. Dont     forget the trailing comma if it's not the last element (and in perl     you can add a trailing comma even if it is the last element)</p> </li> <li> <p>after the ENABLE list, but still within the RC hash, add this:</p> <pre><code>NON_CORE =&gt; \"\nmy-cust POST_COMPILE post-compile/my-custom-config\n\",\n</code></pre> <p>The words in caps are fixed. The others you know, and as you can see the \"my-cust\" here matches the \"my-cust\" in the ENABLE list.</p> </li> </ul> <p>After you do this, you can test whether it worked or not:</p> <pre><code>gitolite query-rc POST_COMPILE\n</code></pre> <p>and it should show you what it thinks are the items in that list, in the order it has them.</p>"},{"location":"rc.html#appendix-c-overriding-safety-net-patterns","title":"appendix C: overriding safety-net patterns","text":"<p>Apart from <code>UNSAFE_PATT</code>, there are other patterns that gitolite uses to prevent various attacks.  They're all defined in <code>Rc.pm</code> in the source, but you can override any of them in <code>~/.gitolite.rc</code> if needed.</p> <p>DANGER!</p> <p>Overriding any of these regexes may impact the security of the installation severly if you are not careful.  You have been warned!</p> <p>The patterns are:</p> <pre><code>$REMOTE_COMMAND_PATT  =                qr(^[-0-9a-zA-Z._\\@/+ :,\\%=]*$);\n$REF_OR_FILENAME_PATT =     qr(^[0-9a-zA-Z][-0-9a-zA-Z._\\@/+ :,]*$);\n$REPONAME_PATT        =  qr(^\\@?[0-9a-zA-Z][-0-9a-zA-Z._\\@/+]*$);\n$REPOPATT_PATT        = qr(^\\@?[[0-9a-zA-Z][-0-9a-zA-Z._\\@/+\\\\^$|()[\\]*?{},]*$);\n$USERNAME_PATT        =  qr(^\\@?[0-9a-zA-Z][-0-9a-zA-Z._\\@+]*$);\n</code></pre> <p>To override any of them, just add a new definition for the pattern at the very end of your rc file, just before the <code>1;</code> line.  E.g., to allow usernames to have a leading underscore, you might add:</p> <pre><code>$USERNAME_PATT        =  qr(^\\@?[_0-9a-zA-Z][-0-9a-zA-Z._\\@+]*$);\n</code></pre> <p>Needless to say you should be very comfortable with regexes to attempt this :)</p>"},{"location":"regex.html","title":"extremely brief regex overview","text":"<p>Regexes are powerful.  Gitolite uses that power as much as it can.  If you can't handle that power, hire someone who can and become a manager ;-)</p> <p>That said, here's a very quick overview of the highlights.</p> <p><code>^</code> and <code>$</code> are called \"anchors\".  They anchor the match to the beginning and end of the string respectively.</p> <pre>\n^foo    matches any string starting with 'foo'\nfoo$    matches any string ending with 'foo'\n^foo$   matches exact string 'foo'.\n</pre> <p>To be precise, the last one is \"any string starting and ending with the same 'foo'\"; \"foofoo\" does not match.</p> <p><code>[0-9]</code> is an example of a character class; it matches any single digit. <code>[a-z]</code> matches any lower case alpha, and <code>[0-9a-f]</code> is the range of hex characters.  You should now guess what <code>[a-zA-Z0-9_]</code> does.</p> <p><code>.</code> (the period) is special -- it matches any character.  If you want to match an actual period, you need to say <code>\\.</code>.</p> <p><code>*</code>, <code>?</code>, and <code>+</code> are quantifiers.  They apply to the previous token.  <code>a*</code> means \"zero or more 'a' characters\".  Similarly <code>a+</code> means \"one or more\", and <code>a?</code> means \"zero or one\".</p> <p>As a result, <code>.*</code> means \"any number (including zero) of any character\".</p> <p>The previous token need not be a single character; you can use parens to make it longer.  <code>(foo)+</code> matches one or more \"foo\", (like \"foo\", \"foofoo\", \"foofoofoo\", etc.)</p>"},{"location":"ssh.html","title":"ssh","text":"<p>If you're installing gitolite, you're a \"system admin\", like it or not.  If you're using the default ssh mode (i.e., not http mode), ssh is a necessary skill.  Please take the time to learn at least enough to get passwordless access working.</p> <p>You must read both these pages before asking for help:</p> <ul> <li> <p>Gitolite and ssh explains how gitolite uses openssh features to     create any number of virtual users over just one actual (unix) user, and     distinguish between them by their public keys.</p> </li> <li> <p>Ssh troubleshooting is a rather long page that, as far as I know,     covers almost every known ssh related issue.  If you find something     missing, send me an email with details so I can update it.</p> </li> </ul>"},{"location":"ssh.html#ssh-related-features","title":"ssh related features","text":"<p>This section will explain why an \"ssh issue\" is almost never a \"gitolite issue\", and, indirectly, why I dont get too excited about the former.</p> <p>To start with, as this section of the concepts page explained, Gitolite does not do authentication.  It only does authorisation.</p> <p>Let's recap the definition of those words:</p> <p>Authentication is the process of verifying that you are who you claim   to be.  An authentication system will establish that I am the user   \"sitaram\" on my work system.  The one behind gmail will similarly   establish that I am \"sitaramc\".  And so on...</p> <p>Authorisation is the process of asking what you want to do and   deciding if you're allowed to do it or not.</p> <p>Now, if you managed to read the gitolite and ssh link above, you know that gitolite is meant to be invoked as:</p> <pre><code>/full/path/to/gitolite-shell some-authenticated-gitolite-username\n</code></pre> <p>(where the \"gitolite username\" is a \"virtual\" username; it does not have to be, and usually isn't, an actual unix username).</p> <p>As you can see, authentication happens before gitolite is called.</p>"},{"location":"ssh.html#but-but-you-have-all-that-ssh-stuff-in-gitolite","title":"but... but... you have all that ssh stuff in gitolite!","text":"<p>No I don't.  Not in \"core\" gitolite from v3 onwards :-)</p> <p>The default setup does use ssh keys, but it's only helping you setup ssh-based authentication as a convenience to you.  But in fact it is a completely separate program that you can disable (in the rc file) or replace with something else of your choice.</p> <p>For example, in both smart http and ldap-backed sshd, gitolite has no role to play in creating users, setting up their passwords/keys, etc.</p>"},{"location":"ssh.html#so-youre-basically-saying-you-wont-support-x","title":"so you're basically saying you won't support \"X\"","text":"<p>(where \"X\" is some ssh related behaviour change or feature)</p> <p>Well, if it's not a security issue I won't.  But since it's no longer part of \"core\" gitolite, I can be much more relaxed about taking patches, or even alternative implementations.</p> <p>While we're on the subject, locking someone out is not a security issue. Even if you lost the admin key, the docs tell you how to recover from such errors.  You do need some password based method to get a shell command line on the server, of course.</p>"},{"location":"ssh.html#using-other-authentication-systems-with-gitolite","title":"using other authentication systems with gitolite","text":"<p>The bottom line in terms of how to invoke gitolite has been described above, and as long as you manage to do that gitolite won't even know how the authentication was done.  Which in turn means you can use whatever authentication scheme you want.</p> <p>It also expects the <code>SSH_ORIGINAL_COMMAND</code> environment variable to contain the full command (typically starting with git-receive-pack or git-upload-pack) that the client sent.  Also, when using smart http, things are somewhat different: gitolite uses certain environment variables that it expects httpd to have set up.  Even the user name comes from the <code>REMOTE_USER</code> environment variable instead of as a command line argument in this case.</p> <p>However, it has to be an authentication system that is compatible with sshd or httpd in some form.  Why?  Because the git client accessing the server only knows those 2 protocols to \"speak git\".  (Well, the <code>git://</code> protocol is unauthenticated, and <code>file://</code> doesn't really apply to this discussion, so we're ignoring those).</p> <p>For example, let's say you have an LDAP-based authentication system somewhere. It is possible to make apache use that to authenticate users, so when a user accesses a git url using <code>https://sitaram:password@git.example.com/repo</code>, it is LDAP that does the actual authentication.  [I wouldn't know how to do it but I know it is possible.  Patches to this doc explaining how are welcome!]</p> <p>There are also ssh daemons that use LDAP to store the authorised keys (instead of putting them all in <code>~/.ssh/authorized_keys</code>).  The clients will still need to generate keypairs and send them to the admin, but they can be more centrally stored and perhaps used by other programs or tools simultaneously, which can be useful.</p>"},{"location":"sts.html","title":"ssh troubleshooting and tips","text":"<p>This page must be read in full the first time.  If you start from some nice looking section in the middle it may not help you unless you're already an expert at ssh.</p> <p>This page should help you troubleshoot ssh-related problems in installing and accessing gitolite.  It also has a section of random ssh-related tips and tricks that gitolite can do.</p>"},{"location":"sts.html#important-read-this-first","title":"IMPORTANT -- READ THIS FIRST","text":""},{"location":"sts.html#caveats","title":"caveats","text":"<ul> <li> <p>Before reading this page, it is mandatory to read and completely     understand this, which is a very detailed look at how gitolite     uses ssh's features on the server side.  Don't assume you know all that;     if you did, you wouldn't be needing this page either!</p> </li> <li> <p>This page, and others linked from this, together comprise all the help I     can give you in terms of the ssh aspect of using gitolite.  If you're     installing gitolite, you're a \"system admin\", like it or not.  Ssh is     therefore a necessary skill.  Please take the time to learn at least     enough to get passwordless access working.</p> </li> <li> <p>Please note that authentication is not really gitolite's job at all.  I'd     rather spend time on actual gitolite features, code, and documentation     than authentication (i.e., ssh, in the common case).</p> <p>Surprised?  This might help explain better.</p> </li> </ul>"},{"location":"sts.html#naming-conventions-used","title":"naming conventions used","text":"<ul> <li> <p>Your workstation is the client.  Your userid on the client does not     matter, and it has no relation to your gitolite username.</p> </li> <li> <p>The server is called server and the \"hosting user\" is git.  If     this is an RPM/DEB install, the hosting user is probably called     \"gitolite\", however we will use \"git\" in this page.</p> </li> </ul>"},{"location":"sts.html#taking-stock-relevant-files-and-directories","title":"taking stock -- relevant files and directories","text":"<ul> <li> <p>The client has a <code>~/.ssh</code> containing a few keypairs.  It may also have a     <code>config</code> file.</p> </li> <li> <p>The client also has a clone of the \"gitolite-admin\" repo, which contains a     bunch of <code>*.pub</code> files in <code>keydir</code>.  We assume this clone is in <code>$HOME</code>;     if it is not, adjust instructions accordingly when needed.</p> </li> <li> <p>The git user on the server has a <code>~/.ssh/authorized_keys</code> file that the     ssh daemon uses to authenticate incoming users.  We often call this file     authkeys to save typing, and it always means the one on the server     (we're not interested in this file on the client side).</p> </li> <li> <p>The server also has a <code>~/.gitolite/keydir</code> which contains a bunch of     <code>*.pub</code> files.</p> </li> </ul>"},{"location":"sts.html#normal-gitolite-key-handling","title":"normal gitolite key handling","text":"<p>Here's how normal gitolite key handling works:</p> <ul> <li> <p>(On client) pub key changes like adding new ones, deleting old ones, etc.,     are done in the <code>keydir</code> directory in the gitolite-admin repo clone.  Then     the admin <code>git add</code>s and <code>git commit</code>s those changes, then <code>git push</code>es     them to the server.</p> </li> <li> <p>(On server) a successful push from the client makes git invoke the     post-update hook in the gitolite-admin repo.  This hook is installed by     gitolite, and it does a bunch of things which are quite transparent to     the admin, but we'll describe briefly here:</p> <ul> <li> <p>The pubkey files from this push are checked-out into     <code>~/.gitolite/keydir</code> (and similarly the config files into     <code>~/.gitolite/conf</code>).</p> </li> <li> <p>The \"compile\" script then runs, which uses these files to populate     <code>~/.ssh/authorized_keys</code> on the server.</p> <p>The authkeys file may have other, (non-gitolite) keys also.  Those lines are preserved.  Gitolite only touches lines that are found between gitolite's \"marker\" lines (<code># gitolite start</code> and <code># gitolite end</code>).</p> </li> </ul> </li> </ul>"},{"location":"sts.html#common-ssh-problems","title":"common ssh problems","text":"<p>Since I'm pretty sure at least some of you didn't bother to read the \"IMPORTANT: PLEASE READ FIRST\" section above, let me take a minute to point you there again.  Especially the first bullet.</p> <p>Done?  OK, read on...</p> <p>The following problem(s) indicate that pubkey access is not working at all, so you should start with appendix 1.  If that doesn't fix the problem, continue with the other appendices in sequence.</p> <ul> <li>Running any git clone/fetch/ls-remote or just <code>ssh git@server info</code> asks     you for a password.  (Or, if your sshd is set to use keys only, it just     disconnects without doing anything).</li> </ul> <p>The following problem(s) indicate that your pubkey is bypassing gitolite and going straight to a shell.  You should start with appendix 2 and continue with the rest in sequence.  Appendix 5 has some background info.</p> <ul> <li> <p>Running <code>ssh git@server info</code> gets you the output of the GNU 'info'     command instead of gitolite's version and access info.</p> </li> <li> <p>Running <code>git clone git@server:repositories/reponame</code> (note presence of     <code>repositories/</code> in URL) works.</p> <p>[A proper gitolite key will only let you <code>git clone git@server:reponame</code> (note absence of <code>repositories/</code>)]</p> </li> <li> <p>You are able to clone repositories but are unable to push changes back     (the error complains about the <code>GL_BINDIR</code> environment variable not being     set or about not being able to locate <code>Gitolite/Hooks/Update.pm</code>, and the     <code>hooks/update</code> failing in some way).</p> <p>[If you run <code>git remote -v</code> you will find that your clone URL included the <code>repositories/</code> described above!]</p> </li> <li> <p>Conversely, using the correct syntax, <code>git clone git@server:reponame</code>     (note absence of <code>repositories/</code> in the URL), gets you     <code>fatal: 'reponame' does not appear to be a git repository</code>, and yet     you are sure 'reponame' exists, you haven't mis-spelled it, etc.</p> </li> </ul>"},{"location":"sts.html#step-by-step","title":"step by step","text":"<p>Since I'm pretty sure at least some of you didn't bother to read the \"IMPORTANT: PLEASE READ FIRST\" section above, let me take a minute to point you there again.  Especially the first bullet.</p> <p>Done?  OK, now the general outline for ssh troubleshooting is this:</p> <ul> <li> <p>Make sure the server's overall setup even allows pubkey based login.     I.e., check that git fetch/clone/ls-remote commands or a plain     <code>ssh git@server info</code> do NOT ask for a password.  If you do get asked for     a password, see appendix 1.</p> </li> <li> <p>Match client-side pubkeys (<code>~/.ssh/*.pub</code>) with the server's authkeys     file.  To do this, run <code>sshkeys-lint</code>, which tells you in detail what key     has what access.  See appendix 2.</p> </li> <li> <p>At this point, we know that we have the right key, and that if sshd     receives that key, things will work.  But we're not done yet.  We still     need to make sure that this specific key is being offered/sent by the     client, instead of the default key.  See appendix 3 and     appendix 4.</p> </li> </ul>"},{"location":"sts.html#random-tips-tricks-and-notes","title":"random tips, tricks, and notes","text":""},{"location":"sts.html#giving-shell-access-to-gitolite-users","title":"giving shell access to gitolite users","text":"<p>Thanks to an idea from Jesse Keating, a single key can allow both gitolite access and shell access.</p> <p>(v3.6.1+) There are two ways to do this, both require uncommenting and editing the 'Shell' line in the ENABLE list in the rc file.</p> <p>If you have only a few users who need to get shell access, edit the line to look like this (note the trailing comma!):</p> <pre><code>'Shell alice bob',\n</code></pre> <p>If you have lots of users, add them to some file accessible to gitolite, (one per line, no extra whitespace), then specify the full path of the file.  For example:</p> <pre><code>\"Shell $ENV{HOME}/.gitolite.shell-users\",\n</code></pre> <p>(Note in this case we have to use double quotes since we are using a variable that needs to be interpolated into the value).</p> <p>Then run <code>gitolite compile; gitolite trigger POST_COMPILE</code> or push a dummy change to the admin repo.</p>"},{"location":"sts.html#the-shell_users_list","title":"the SHELL_USERS_LIST","text":"<p>If you're using gitolite v3.6 or below, it's slightly different.  You have to enable the trigger by uncommenting the 'Shell' line in the ENABLE list, but you cannot list the users directly on the 'Shell' line in the rc file, nor can you put the file name on that line. Instead, you have to go to the variables section in the rc file and set the SHELL_USERS_LIST variable to the filename.  For example:</p> <pre><code>SHELL_USERS_LIST        =&gt;  \"$ENV{HOME}/.gitolite.shell-users\",\n</code></pre> <p>Then run <code>gitolite compile; gitolite trigger POST_COMPILE</code> or push a dummy change to the admin repo.</p> <p>NOTE: to maintain backward compatibility, this method will continue to work in 3.6.*, but when 3.7 is released (whenever that may be), it will not work, and you will have to use the new syntax described above.</p>"},{"location":"sts.html#distinguishing-one-key-from-another","title":"distinguishing one key from another","text":"<p>Since a user can have more than one key, it is sometimes useful to distinguish one key from another.  Sshd does not tell you even the fingerprint of the key that finally matched, so normally all you have is the <code>GL_USER</code> env var.</p> <p>However, if you replace</p> <pre><code>'ssh-authkeys',\n</code></pre> <p>in the ENABLE list with</p> <pre><code>'ssh-authkeys --key-file-name',\n</code></pre> <p>then an extra argument is added after the username in the \"command\" variable of the authkeys file.  That is, instead of this:</p> <pre><code>command=\"/home/g3/gitolite/src/gitolite-shell u3\",no-port-forwarding,...\n</code></pre> <p>you get this:</p> <pre><code>command=\"/home/g3/gitolite/src/gitolite-shell u3 keydir/u3.pub\",no-port-forwarding,...\n</code></pre> <p>You can then write an INPUT trigger to do whatever you need with the file name, which is in <code>$ARGV[1]</code> (the second argument).  The actual file is available at <code>$ENV{GL_ADMIN_BASE}/$ARGV[1]</code> if you need its contents.</p>"},{"location":"sts.html#customising-the-authorized-key-options","title":"customising the authorized key options","text":"<p>By default, the options used in the <code>authorized_keys</code> file, to restrict remote users, are:</p> <pre><code>no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty\n</code></pre> <p>However, sometimes people want to add some other option, or remove one of the above restrictions, etc.  The way to do this is to define a new variable in the RC file:</p> <pre><code># add this just before the ENABLE list\nAUTH_OPTIONS =&gt; \"...your option list...\",\n# (note the trailing \",\" there!)\n</code></pre> <p>Warning</p> <p>The value you supply completely replaces the default, it is not in addition to it.  You must include all the options you need, even those that are in the default list, if you use this feature.</p>"},{"location":"sts.html#simulating-ssh-copy-id","title":"simulating ssh-copy-id","text":"<p>don't have <code>ssh-copy-id</code>?  This is broadly what that command does, if you want to replicate it manually.  The input is your pubkey, typically <code>~/.ssh/id_rsa.pub</code> from your client/workstation.</p> <ul> <li> <p>It copies it to the server as some file.</p> </li> <li> <p>It appends that file to <code>~/.ssh/authorized_keys</code> on the server     (creating it if it doesn't already exist).</p> </li> <li> <p>It then makes sure that all these files/directories have go-w perms     set (assuming user is \"git\"):</p> <pre><code>/home/git/.ssh/authorized_keys\n/home/git/.ssh\n/home/git\n</code></pre> </li> </ul> <p>[Actually, <code>sshd</code> requires that even directories above <code>~</code> (<code>/</code>, <code>/home</code>, typically) also must be <code>go-w</code>, but that needs root.  And typically they're already set that way anyway.  (Or if they're not, you've got bigger problems than gitolite install not working!)]</p>"},{"location":"sts.html#problems-with-using-non-openssh-public-keys","title":"problems with using non-openssh public keys","text":"<p>Gitolite accepts public keys only in openssh format.  Trying to use an \"ssh2\" key (used by proprietary SSH software) will not be a happy experience. src/triggers/post-compile/ssh-authkeys can be made to detect non-openssh formats and automatically convert them; patches welcome!</p> <p>The actual conversion command, if you want to just do it manually for now and be done with it, is:</p> <pre><code>ssh-keygen -i -f /tmp/ssh2/YourName.pub &gt; /tmp/openssh/YourName.pub\n</code></pre> <p>then use the resulting pubkey as you normally would in gitolite.</p>"},{"location":"sts.html#windows-issues","title":"windows issues","text":"<p>On windows, I have only used msysgit, and the openssh that comes with it. Over time, I have grown to distrust putty/plink due to the number of people who seem to have trouble when those beasts are involved (I myself have never used them for any kind of git access).  If you have unusual ssh problems that just don't seem to have any explanation, try removing all traces of putty/plink, including environment variables, etc., and then try again.</p> <p>Thankfully, someone contributed this.</p>"},{"location":"sts.html#appendix-1-ssh-daemon-asks-for-a-password","title":"appendix 1: ssh daemon asks for a password","text":"<p>NOTE: This section should be useful to anyone trying to get   password-less access working.  It is not necessarily specific to gitolite,   so keep that in mind if the wording feels a little more general than you   were expecting.</p> <p>You have generated a keypair on your workstation (<code>ssh-keygen</code>) and copied the public part of it (<code>~/.ssh/id_rsa.pub</code>, by default) to the server.</p> <p>On the server you have appended this file to <code>~/.ssh/authorized_keys</code>.  Or you ran something, like the <code>gitolite setup</code> step during a gitolite install, which should have done that for you.</p> <p>You now expect to log in without having to type in a password, but when you try, you are being asked for a password.</p> <p>This is a quick checklist:</p> <ul> <li> <p>Make sure you're being asked for a password and not a passphrase.  Do     not confuse or mistake a prompt saying     <code>Enter passphrase for key '/home/sitaram/.ssh/id_rsa':</code> for a password     prompt from the remote server!</p> <p>When you create an ssh keypair using <code>ssh-keygen</code>, you have the option of protecting it with a passphrase.  When you subsequently use that keypair to access a remote host, your local ssh client needs to unlock the corresponding private key, and ssh will probably ask for the passphrase you set when you created the keypair.</p> <p>You have two choices to avoid this prompt every time you try to use the private key.  The first is to create keypairs without a passphrase (just hit enter when prompted for one).  Be sure to add a passphrase later, once everything is working, using <code>ssh-keygen -p</code>.</p> <p>The second is to use <code>ssh-agent</code> (or <code>keychain</code>, which in turn uses <code>ssh-agent</code>) or something like that to manage your keys.  Other than discussing one more potential trouble-spot with ssh-agent (see below), further discussion of ssh-agent/keychain is out of scope of this page.</p> </li> <li> <p>Ssh is very sensitive to permissions.  An extremely conservative setup is     given below, but be sure to do this on both the client and the server:</p> <pre><code>cd $HOME\nchmod go-rwx .\nchmod -R go-rwx .ssh\n</code></pre> </li> <li> <p>Actually, every component of the path to <code>~/.ssh/authorized_keys</code> all the     way upto the root directory must be at least <code>chmod go-w</code>.  So be sure to     check <code>/</code> and <code>/home</code> also.</p> </li> <li> <p>While you're doing this, make sure the owner and group info for each of     these components are correct.  <code>ls -ald ~ ~/.ssh ~/.ssh/authorized_keys</code>     will tell you what they are.</p> </li> <li> <p>You may also want to check <code>/etc/ssh/sshd_config</code> to see if the \"git\" user     is allowed to login at all.  For example, if that file contains an     <code>AllowUsers</code> config entry, then only users mentioned in that line are     allowed to log in!</p> </li> <li> <p>While you're in there, check that file does NOT have a setting for     <code>AuthorizedKeysFile</code>.  See <code>man sshd_config</code> for details.  This setting is     a show stopper for gitolite to use ssh.</p> </li> <li> <p>Some OSs/distributions require that the \"git\" user should have a password     and/or not be a locked account.  You may want to check that as well.</p> </li> <li> <p>If your server is running SELinux, and you install gitolite to     <code>/var/gitolite</code> or another location unsupported by default SELinux     policies, then SELinux will prevent sshd from reading     <code>.ssh/authorized_keys</code>. Consider installing gitolite to     <code>/var/lib/gitolite</code>, which is a supported location by default SELinux     policies.</p> </li> <li> <p>If all that fails, log onto the server as root, <code>cd /var/log</code>, and look     for a file called <code>auth.log</code> or <code>secure</code> or some such name.  Look inside     this file for messages matching the approximate time of your last attempt     to login, to see if they tell you what is the problem.</p> </li> </ul>"},{"location":"sts.html#appendix-2-which-key-is-which-running-sshkeys-lint","title":"appendix 2: which key is which -- running sshkeys-lint","text":"<p>The sshkeys-lint program can be run on the server or the client.  Run it with '-h' to get a help message.</p> <p>On the server you can run <code>gitolite sshkeys-lint</code> and it will tell you, for each key in the admin directory's keydir, what access is available.  This is especially good at finding duplicate keys and such.</p> <p>To run it on the client you have to copy the file src/commands/sshkeys-lint from some gitolite clone, then follow these steps:</p> <ul> <li> <p>Get a copy of <code>~/.ssh/authorized_keys</code> from the server and put it in     <code>/tmp/foo</code> or something.</p> </li> <li> <p>cd to <code>~/.ssh</code>.</p> </li> <li> <p>Run <code>/path/to/sshkeys-lint *.pub &lt; /tmp/foo</code>.</p> </li> </ul> <p>Note that it is not trying to log in or anything -- it's just comparing fingerprints as computed by <code>ssh-keygen -l</code>.</p> <p>If the pubkey file you're interested in appears to have the correct access to the server, you're done with this step.</p> <p>Otherwise you have to rename some keypairs and try again to get the effect you need.  Be careful:</p> <ul> <li> <p>Do not just rename the \".pub\" file; you will have to rename the     corresponding private key also (the one with the same basename but without     an extension).</p> </li> <li> <p>If you're running ssh-agent, you may have to delete (using <code>ssh-add -D</code>)     and re-add identities for it to pick up the renamed ones correctly.</p> </li> </ul>"},{"location":"sts.html#typical-causes","title":"typical cause(s)","text":"<p>The admin often has passwordless shell access to <code>git@server</code> already, and then used that same key to get access to gitolite (i.e., copied that same pubkey as YourName.pub and ran <code>gitolite setup</code> on it).</p> <p>As a result, the same key appears twice in the authkeys file now, and since the ssh server will always use the first match, the second occurrence (which invokes gitolite) is ignored.</p> <p>To fix this, you have to use a different keypair for gitolite access.  The best way to do this is to create a new keypair, copy the pubkey to the server as YourName.pub, then run <code>gitolite setup -pk YourName.pub</code> on the server. Remember to adjust your agent identities using ssh-add -D and ssh-add if you're using ssh-agent, otherwise these new keys may not work.</p>"},{"location":"sts.html#appendix-3-ssh-client-may-not-be-offering-the-right-key","title":"appendix 3: ssh client may not be offering the right key","text":"<ul> <li> <p>Make sure the right private key is being offered.  Run ssh in very     verbose mode and look for the word \"Offering\", like so:</p> <pre><code>ssh -vvv user@host pwd 2&gt; &gt;(grep -i offer)\n</code></pre> <p>If some keys are being offered, but not the key that was supposed to be used, you may be using ssh-agent (next bullet).  You may also need to create some host aliases in <code>~/.ssh/config</code> (appendix 4).</p> </li> <li> <p>(ssh-agent issues) If <code>ssh-add -l</code> responds with either \"The agent has no     identities.\" or \"Could not open a connection to your authentication     agent.\", then you can skip this bullet.</p> <p>However, if <code>ssh-add -l</code> lists any keys at all, then something weird happens.  Due to a quirk in ssh-agent, ssh will now only use one of those keys, even if you explicitly ask for some other key to be used.</p> <p>In that case, add the key you want using <code>ssh-add ~/.ssh/YourName</code> and try the access again.</p> <p>(Long overdue update: A better solution is to add <code>IdentitiesOnly yes</code> to the host entry in your <code>~/.ssh/config</code> file.  This setting fixes the weird quirk described above.)</p> </li> </ul>"},{"location":"sts.html#appendix-4-ssh-host-aliases","title":"appendix 4: ssh host aliases","text":"<p>(or \"making git use the right options for ssh\")</p> <p>The ssh command has several options for non-default items to be specified. Two common examples are <code>-p</code> for the port number if it is not 22, and <code>-i</code> for the public key file if you do not want to use just <code>~/.ssh/id_rsa</code> or such.</p> <p>Git has two ssh-based URL syntaxes, but neither allows specifying a non-default public key file.  And a port number is only allowed in one of them.  (See <code>man git-clone</code> for details).  Finally, hosts often have to be referred with IP addresses (such is life), or the name is very long, or hard to remember.</p> <p>Using a \"host\" para in <code>~/.ssh/config</code> lets you nicely encapsulate all this within ssh and give it a short, easy-to-remember, name.  Example:</p> <pre>\nhost gitolite\n    user git\n    hostname a.long.server.name.or.annoying.IP.address\n    port 22\n    identityfile ~/.ssh/id_rsa\n</pre> <p>Now you can simply use the one word <code>gitolite</code> (which is the host alias we defined here) and ssh will infer all those details defined under it -- just say <code>ssh gitolite</code> and <code>git clone gitolite:reponame</code> and things will work.</p> <p>(By the way, the 'port' and 'identityfile' lines are needed only if you have non-default values, although I put them in anyway just to be complete).</p>"},{"location":"sts.html#more-than-one-keypair","title":"more than one keypair","text":"<p>If you have more than one pubkey with access to the same server, you must use this method to make git pick up the right key.  There is no other way to do this, as far as I know.</p> <p>A typical example would be if you wanted shell access to the gitolite server using one keypair, and gitolite-mediated access using another.  Here's how I do that, where my \"id_rsa\" keypair has shell access, and my \"sitaram\" keypair has gitolite access:</p> <pre>\nhost gitolite\n    user git\n    hostname gitolite.mydomain.com\n    port 22\n    identityfile ~/.ssh/sitaram\n\nhost gitolite-sh\n    user git\n    hostname gitolite.mydomain.com\n    port 22\n    identityfile ~/.ssh/id_rsa\n</pre> <p>Then I would use \"ssh gitolite-sh\" to get a command line, and use the host alias \"gitolite\" in git clone and other commands, as well as for gitolite commands (like \"ssh gitolite info\").</p> <p>Just to be clear, please note that this assumes the authorized keys file on the gitolite hosting user has my \"id_rsa.pub\" line, without the gitolite related forced command and options.</p>"},{"location":"sts.html#appendix-5-why-bypassing-gitolite-causes-a-problem","title":"appendix 5: why bypassing gitolite causes a problem","text":"<p>When you bypass gitolite, you end up running your normal shell instead of the special gitolite entry point script <code>gitolite-shell</code>.</p> <p>This means commands (like 'info') are interpreted by the shell instead of gitolite.</p> <p>It also means git operations look for repos in <code>$HOME</code>.</p> <p>However, gitolite places all your repos in <code>~/repositories</code>, and internally prefixes this before calling the actual git command you invoked.  Thus, the pathname of the repo that you use on the client is almost never the correct pathname on the server.  (This is by design.  Don't argue...)</p> <p>This means that, you get 2 kinds of errors if you bypass gitolite</p> <ul> <li> <p>When you use <code>git@server:reponame</code> with a key that bypasses gitolite     (i.e., gets you a shell), this prefixing does not happen, and so the repo     is not found.  Neither a clone/fetch nor a push will work.</p> </li> <li> <p>Conversely, consider <code>git@server:repositories/reponame.git</code>.  The clone     operation will work -- you're using the full Unix path, and so the shell     finds the repo where you said it would be.  However, when you push,     gitolite's update hook kicks in, and fails to run because some of the     environment variables it is expecting are not present.</p> </li> </ul>"},{"location":"templates.html","title":"setting up and using templates","text":"<p>This feature was added late September 2017, after 3.6.7.  In terms of versioning, it will be part of 3.6.8, or you could just grab the latest from github.</p>"},{"location":"templates.html#overview","title":"overview","text":"<p>This feature describes a new method of specifying gitolite rules.</p> <p>A \"template\" is a set of gitolite access rules with a name.  A gitolite \"expert\" can setup a suitable set of templates, and then actual repos can use one or more of these templates, according to their need.</p> <p>A simple example will illustrate.  It's split into two parts.</p> <p>First, the template definitions, where the rules comprising each template are defined:</p> <pre>\n# (obligatory warning: the order of the following lines matters!)\n\nrepo @is_public\n    R                           =   @all\n\nrepo @is_suspended\n    -                           =   @all\n\nrepo @has_personal_refs\n    RW+     dev/USER/           =   teamleads team\n    -       dev/                =   @all\n    RW+     refs/tags/dev/USER/ =   teamleads team\n    -       refs/tags/dev/      =   @all\n\nrepo @has_releases\n    RW      refs/tags/v[0-9]    =   release_managers\n    -       refs/tags/v[0-9]    =   @all\n\nrepo @base\n    RW+                         =   teamleads\n    RW                          =   team\n    R                           =   READERS\n</pre> <p>Next, you have the template data section (i.e., the lines between the <code>begin</code> and <code>end</code> lines you see in the example below).  This is where you declare actual repos (<code>foo</code> and <code>bar</code> below), giving each a set of one or more templates it will use, and map users to any roles that the template may require.</p> <pre>\n=begin template-data\n\nrepo foo = base is_public has_releases\n    teamleads           =   sitaram\n    team                =   dilbert wally\n    READERS             =   ashok\n    release_managers    =   alice\n\nrepo bar = base has_personal_refs\n    teamleads           =   han\n    team                =   luke chewie\n\n=end\n</pre> <p>Notice that <code>foo</code> and <code>bar</code> use different sets of templates: <code>foo</code> is a public-readable repo that controls who can push versioned tags (releases), while <code>bar</code> is a basic repo which supports personal branches.</p>"},{"location":"templates.html#advantages","title":"advantages","text":"<p>There are a few advantages with this approach:</p> <ol> <li> <p>Maintaining access rules is much simpler.  Just choose an appropriate set     of \"template names\", assign people to roles, and you're done.</p> <p>There's no need to understand the intricacies of gitolite's ruleset.  (The person who wrote the templates needs to, but not the person who is maintaining dozens of repos by merely using those templates).</p> <p>Heck you can probably roll a nice GUI around this.  Finally!</p> </li> <li> <p>Reduces boilerplate.  A good example is the \"personal branches\" one above     -- why have each of those 4 lines in every repo if you can instead refer     to the feature by name somehow</p> <p>A conf using this is often smaller, and definitely cleaner.</p> </li> <li> <p>Reduces possible errors.  This should follow from the previous point.  It     is easy to make mistakes when changing something due to some new     requirement.  Did you remember to put in the two \"deny\" rules in the     personal branches example above?</p> <p>What if management decides to suspend pushes to one particular repo, and you best choice was to add a catch-all \"deny everyone\" rule.  Did you remember to put it at the top?  (If the templates are written as above (including the order in which you see them), all you have to do is add the word <code>is_suspended</code> somewhere in the list of templates that apply to repo <code>bar</code>.)</p> </li> <li> <p>Makes gitolite compile much faster, especially if you have thousands (or     tens of thousands) of repos.</p> </li> </ol>"},{"location":"templates.html#how-does-it-work","title":"how does it work?","text":""},{"location":"templates.html#a-repo-and-its-users","title":"a repo and its users","text":"<p>The wildcard repos feature already has a way to dissociate the actual user names from the rule set in gitolite.conf.  For example, you can say</p> <pre>\nrepo foo/..*\n    C       =   @managers\n    RW+     =   WRITERS\n    R       =   READERS\n    ...(etc.)...\n</pre> <p>This lets any \"manager\" create a repo whose name matches the pattern, then assign arbitrary users to WRITERS and other roles using the <code>perms</code> command.  These role assignments are stored in a simple text file within the repository's bare directory (i.e., <code>~/repositories/$REPO.git</code>), so they are specific to that repo, not common to all the repos matching that pattern (as they would be if you listed the users in gitolite.conf directly).</p> <p>In other words, we've taken the actual users (say alice, bob, etc) out of the gitolite.conf file, and thus any changes to the users/roles no longer need to involve gitolite.conf.</p>"},{"location":"templates.html#a-repo-and-its-rules","title":"a repo and its rules","text":"<p>In a \"duh! Why didn't I think of this till now\" moment, I realised I can do the same for the rules that apply to a repo -- take that association out of gitolite.conf.  That is what the <code>repo foo = [...list of templates...]</code> lines are doing.</p> <p>This list of templates is also stored in a plain text file just like the one that contains the user/role mappings, and in the same directory.</p>"},{"location":"templates.html#usage-and-syntax","title":"usage and syntax","text":"<p>First, you have to add all the new \"roles\" to the <code>ROLES</code> hash in <code>~/.gitolite.rc</code>.  If you edit that file, you'll see two pre-created roles <code>READERS</code> and <code>WRITERS</code>.  Using the same syntax (including the trailing comma), add any other roles you would like to use.  In our example up at the top, the role names are <code>team</code>, <code>teamleads</code>, and <code>release_managers</code>.</p> <p>Rolenames must start with a letter, and be made up of only alphanumeric characters and the underscore -- basically the same rules as a shell variable.</p> <p>Next, you define the templates, in the right order.  This is the only order that matters (not the order in which the templates are used in any particular repo in the template-data section).</p> <p>Thus, this is also the part that requires gitolite rules expertise, but it's hopefully a one-time or once-in-a-while thing.  (Or you can ask on the mailing list!)</p> <p>Finally, you define actual repos in gitolite.conf as shown in the example above (including the <code>=begin template-data</code> and <code>=end</code> lines).  For each repo, you specify what templates it will use, and then you map actual users to the role names from those templates.</p> <p>A few additional points:</p> <ol> <li> <p>Not all role names need to be mapped to users (for example, we did not     assign any <code>READERS</code> to repo <code>bar</code>, even though the <code>base</code> template     specifies that role).</p> </li> <li> <p>Within the gitolite.conf file, the placement of the template-data section     does not matter.  (It's not even parsed by the conf compiler, which     completely skips it.  It's processed by a new program that is run     internally, and directly manipulates the gl-repo-groups and gl-perms     files).</p> </li> <li> <p>You can even have multiple template-data sections, with normal     gitolite.conf rules, group definitions, <code>config</code> and <code>option</code> lines, etc.,     in between.  (That's why there's a begin and an end!)</p> <p>If you use <code>include</code> files, I strongly suggest -- in the interest of sanity -- that you do not let a template-data section cross over a file boundary (i.e., define the <code>begin</code> in one file, and the <code>end</code> in another). It will work, if you understand what order the files are picked up, but I'd still avoid such tricks if I were you!</p> </li> <li> <p>If you want to insert some rules for a repo that is defined in a     template-data section, you need to be careful where you place it.</p> <p>Rules defined by templates are deemed to occur exactly where the template definition is.  So, speaking of repo foo, pretend that the line <code>repo @is_public</code> was replaced by <code>repo foo</code>, and similarly for <code>repo @has_releases</code> and <code>repo @base</code>.</p> <p>While we're on the subject, you can also pretend the role names on the right hand side of the rules are replaced by the actual user names you supplied in the template-data section.</p> <p>In the example above, say you wanted to insert a new rule for repo foo, which says that no one can rewind <code>master</code>, not even <code>teamleads</code>.</p> <p>Clearly, the rules you need are:</p> <p><pre>\nrepo foo\n    RW  master      =   sitaram\n    # notice we had to expand 'teamleads' from foo's definition in the\n    # template-data section\n    -   master      =   @all\n</pre></p> <p>But where do you place them?  The answer is, at least before the <code>base</code> template is defined.  Otherwise, the <code>RW+</code> in the base template will kick in, and this restriction will fail to take effect.</p> <p>Having said that, I would rather add a new template to deal with this, placing it just before <code>repo @base</code>):</p> <p><pre>\nrepo @limits_master\n    RW  master      =   teamleads\n    -   master      =   @all\n</pre></p> <p>and then add <code>limits_master</code> to the list of templates that <code>foo</code> uses.</p> <p>This has the advantages of being able to reuse that logic for other repos, but even more important, you're avoiding repeating the actual teamleads name(s) in more than one place!  (Potentially a huge future inconsistency if someone forgot to update both places when the teamleads change!)</p> </li> <li> <p>You can also do multiple repos in one shot, as well as repo groups:</p> <p><pre>\n# before the '=begin' line\n@repogroup1 = r1 r2 r3\n...\n...\n...\n<p>=begin template-data\nrepo foo bar @repogroup1 = base is_public has_releases\n    ...\n    ...\n    ...\n=end\n</p>"},{"location":"templates.html#bypassing-gitoliteconf-for-huge-sites","title":"bypassing gitolite.conf for huge sites","text":"<p>Some sites have all their access control information in a web-based system,\nand generate gitolite.conf as needed.  If they have tens of thousands of\nrepos, this \"generated\" gitolite.conf becomes humongous, and slows down\ncompiles.  Worse, the more repos you have, the more churn you have in terms of\nchanges to users accesses, so you do more compiles per hour than a smaller\nsite, which only makes things worse!</p>\n<p>With this feature, you can bypass gitolite.conf and directly create/update\nthose text files to change the users and rule-sets for a given repo.  It\ndoesn't even have to touch gitolite or gitolite.conf (assuming the templates\nand roles are already defined in gitolite.conf and <code>~/.gitolite.rc</code> of\ncourse!)</p>"},{"location":"templates.html#generating-the-text-files-externally","title":"generating the text files externally","text":"<p>The actual text files involved are very simple.  Remember these files go into\n<code>~/repositories/$REPO.git</code> (or more accurately, <code>$(gitolite query-rc GL_REPO_BASE)/$REPO.git</code>).</p>\n<p>For the example above, here's the file <code>gl-repo-groups</code> in repo foo:</p>\n<pre><code>$ cat ~/repositories/foo.git/gl-repo-groups\nbase is_public has_releases\n</code></pre>\n<p>As you can see, this text is just what is after the <code>=</code> sign in the <code>repo</code>\nline in the template data section of gitolite.conf.</p>\n<p>and the file <code>gl-perms</code> is:</p>\n<pre><code>$ cat ~/repositories/foo.git/gl-perms\nteamleads           =   sitaram\nteam                =   dilbert wally\nREADERS             =   ashok\nrelease_managers    =   alice\n</code></pre>\n<p>Again, this text is exactly the same as in the gitolite.conf!</p>"},{"location":"templates.html#creating-new-repos","title":"creating new repos","text":"<p>Gitolite has no mechanism to create repos out of thin air, so if you don't\nwant to go via gitolite.conf, one way to do this is to add the following lines\nto the conf file (one-time):</p>\n<pre>\nrepo [a-zA-Z0-9].*\n    C   =   gitolite-admin\n</pre>\n\n<p>and then, at the server, run this:</p>\n<pre><code>GL_USER=gitolite-admin gitolite create foo/bar\n</code></pre>\n<p>That creates the repo, and you can now populate its <code>gl-perms</code> and\n<code>gl-repo-groups</code> files.</p>"},{"location":"templates.html#thanks-to","title":"thanks to...","text":"<p>...pingou on irc, and the Fedora project, for having 42,000 repos in a conf\nfile over 560,000 lines long.  Which made me think about this real hard for\ndays, including two false starts (one of which I published and have just now\nreverted, and one which was so kludgey I refuse to acknowledge it exists --\nthank God I did not publish that!)</p>"},{"location":"templates.html#miscellanea","title":"miscellanea","text":"<p>This feature is not the same as wild repos; repos here are created by the\ngitolite admin or a server-side backend, not by a gitolite user.  (However,\nthis feature piggy-backs on a lot of the code for wild repos, adding just a\nwee bit -- the \"duh\" comment earlier in this document -- to complete it).</p>"},{"location":"testing.html","title":"testing gitolite","text":"<p>WARNING: this will clobber these files and directories in your <code>$HOME</code>.  Ideally, you should use a throwaway userid.</p> <p>Running gitolite's test suite is really just a superset of trying it out safely.</p> <p>To run the full test suite, create a throw-away userid, log in to it, then run these commands:</p> <pre><code>git config --global include.path ~/.gitconfig.local\ngit clone https://github.com/sitaramc/gitolite\ncd gitolite\nprove\n</code></pre> <p>You will get an error that forces you to read <code>t/README</code> and set an env var before the test can proceed.  This is intentional; I've had people who don't pay attention to the \"data loss\" warning, and then complain that it was not prominent enough.  Forcing them to read a much smaller page appears to focus their attention better!</p> <p>The test suite should run fine on most recent Linuxes and Unixes.  Although gitolite itself should work fine with any git after 1.6.6 or so, the test suite generally requires a more recent git.</p> <p>Make sure:</p> <ul> <li><code>$HOME/bin</code> is in <code>$PATH</code></li> <li>sshd allows incoming ssh to this userid, at least from localhost</li> </ul> <p>Gitolite's test suite is mostly written using tsh -- the \"testing shell\". Take a look at some of the scripts and you will see what it looks like.  It has a few quirks and nuances, but it's fine for what I need here.</p> <p>The tests also use a somewhat convoluted system of environment variables in order to run entirely as a local user, without going through ssh at all. This lets a complete test suite run in about a lot less time than it would otherwise take.</p> <p>If you think that defeats the purpose of the testing, you haven't read this yet.</p>"},{"location":"testing.html#appendix-1-the-clobber-list","title":"appendix 1 -- the clobber list","text":"<p>When you try out gitolite or run the test suite, the following files and directories in your \\$HOME are potentially clobbered.</p> <pre><code>.gitconfig\n.gitolite/\n.gitolite.rc\nprojects.list\nrepositories/\n.ssh/\n</code></pre>"},{"location":"triggers.html","title":"gitolite triggers","text":"<p>Gitolite runs trigger code at several different times.  The features you enable in the rc file determine what commands to run (or functions in perl modules to call) at each trigger point.  Example of trigger points are <code>INPUT</code>, <code>PRE_GIT</code>, <code>POST_COMPILE</code>, etc.; the full list is examined later in this page.</p> <p>Quick tip: triggers are to gitolite what hooks are to git; we simply use a different name to avoid constantly having to clarify which hooks we mean! The other difference in gitolite is that each trigger runs multiple pieces of code, not just one program with the same name as the hook, like git does.</p>"},{"location":"triggers.html#types-of-trigger-programs","title":"types of trigger programs","text":"<p>There are two types of trigger programs.  Standalone scripts are placed in triggers or its subdirectories.  Such scripts are quick and easy to write in any language of your choice.</p> <p>Triggers written as perl modules are placed in lib/Gitolite/Triggers.  Perl modules have to follow some conventions (see some of the shipped modules for ideas) but the advantage is that they can set environment variables and change the argument list of the gitolite-shell program that invokes them.</p> <p>If you intend to write your own triggers, it's a good idea to examine a default install of gitolite, paying attention to:</p> <ul> <li>the path names in various trigger lists in the rc file,</li> <li>corresponding path names in the src/ directory in gitolite source,</li> <li>and for perl modules, the package names and function names within.</li> </ul>"},{"location":"triggers.html#manually-firing-triggers","title":"manually firing triggers","text":"<p>It's easy to manually fire triggers from the server command line.  For example:</p> <pre><code>gitolite trigger POST_COMPILE\n</code></pre> <p>However if the triggered code depends on arguments (see next section) this won't work.  (The <code>POST_COMPILE</code> trigger programs all just happen to not require any arguments, so it works).</p>"},{"location":"triggers.html#common-arguments","title":"common arguments","text":"<p>Triggers receive the following arguments:</p> <ol> <li> <p>Any arguments mentioned in the rc file (for an example, see the renice     command).</p> </li> <li> <p>The name of the trigger as a string (example, <code>\"POST_COMPILE\"</code>), so you     can call the same program from multiple triggers and it can know where it     was called from.</p> </li> <li> <p>And finally, zero or more arguments specific to the trigger, as given in     the next section.</p> </li> </ol>"},{"location":"triggers.html#trigger-specific-arguments-and-other-details","title":"trigger-specific arguments and other details","text":"<p>Here are the rest of the arguments for each trigger, plus a brief description of when the trigger runs.  (Note that when the repo name is passed in as an argument, it is without the '.git' suffix).</p> <ul> <li> <p><code>INPUT</code> runs before pretty much anything else.  INPUT trigger scripts     must be in perl, since they manipulate the arguments and the environment     of the 'gitolite-shell' program itself.  Most commonly they will     read/change <code>@ARGV</code>, and/or <code>$ENV{SSH_ORIGINAL_COMMAND}</code>.</p> <p>There are certain conventions to adhere to; please see some of the shipped samples or ask me if you need help writing your own.</p> </li> <li> <p><code>ACCESS_1</code> runs after the first access check.  Extra arguments:</p> <ul> <li>repo</li> <li>user</li> <li>'R' or 'W'</li> <li>'any'</li> <li>result (see notes below)</li> </ul> <p>'result' is the return value of the access() function.  If it contains the uppercase word \"DENIED\", the access was rejected.  Otherwise it is the refex that caused the access to succeed.</p> <p>Note that if access is rejected, gitolite-shell will die as soon as it returns from the trigger.</p> </li> <li> <p><code>ACCESS_2</code> runs after the second access check, which is invoked by the     update hook to check the ref.  Extra arguments:</p> <ul> <li>repo</li> <li>user</li> <li>any of W, +, C, D, WM, +M, CM, DM</li> <li>the ref being updated (e.g., 'refs/heads/master')</li> <li>result</li> <li>old SHA</li> <li>new SHA</li> </ul> <p><code>ACCESS_2</code> also runs on each VREF that gets checked.  In this case the \"ref\" argument will start with \"VREF/\", and the last two arguments won't be passed.</p> <p>'result' is similar to <code>ACCESS_1</code>, except that it is the update hook which dies as soon as access is rejected for the ref or any of the VREFs. Control then returns to git, and then to gitolite-shell, so the <code>POST_GIT</code> trigger will run.</p> </li> <li> <p><code>PRE_GIT</code> and <code>POST_GIT</code> run just before and after the git command.     Extra arguments:</p> <ul> <li>repo</li> <li>user</li> <li>'R' or 'W'</li> <li>'any'</li> <li>the git command ('git-receive-pack', 'git-upload-pack', or     'git-upload-archive') being invoked.</li> </ul> <p>Note that the <code>POST_GIT</code> trigger has no way of knowing if the push succeeded, because 'git-shell' (or maybe 'git-receive-pack', I don't know) exits cleanly even if the update hook died.</p> </li> <li> <p><code>PRE_CREATE</code> and <code>POST_CREATE</code> run just before and after a new repo is     created.  In addition, any command that creates a repo (like 'fork') or     potentially changes permissions (like 'perms') may choose to run     <code>POST_CREATE</code>.</p> <p>Extra arguments for normal repo creation (i.e., by adding a \"repo foo\" line to the conf file):</p> <ul> <li>repo</li> </ul> <p>Extra arguments for wild repo creation:</p> <ul> <li>repo</li> <li>user</li> <li>invoking operation<ul> <li>'R' for fetch/clone/ls-remote, 'W' for push</li> <li>can also be anything set by the command running the trigger (e.g.,     see the perms and fork commands).  This lets the trigger code know     how it was invoked.</li> </ul> </li> </ul> </li> <li> <p><code>POST_COMPILE</code> runs after an admin push has successfully \"compiled\" the     config file.  By default, the next thing is to update the ssh authkeys     file, then all the 'git-config's, gitweb access, and daemon access.</p> <p>No extra arguments.</p> </li> </ul>"},{"location":"triggers.html#adding-your-own-scripts-to-a-trigger","title":"adding your own scripts to a trigger","text":"<p>Note: for gitolite v3.3 or less, adding your own scripts to a trigger list was simply a matter of finding the trigger name in the rc file and adding an entry to it.  Even for gitolite v3.4 or higher, if your rc file was created before v3.4, it will continue to work, and you can continue to add triggers to it the same way as before.</p> <p>The rc file (from v3.4 on) does not have trigger lists; it has a simple list of \"features\" within a list called \"ENABLE\" in the rc file.  Simply comment out or uncomment appropriate entries, and gitolite will internally create the trigger lists correctly.</p> <p>This is fine for triggers that are shipped with gitolite, but does present a problem when you want to add your own.</p> <p>Here's how to do that: Let's say you wrote yourself a trigger script called 'foo', to be invoked from the <code>POST_CREATE</code> trigger list.  To do that, just add the following to the rc file, just before the ENABLE section:</p> <pre><code>POST_CREATE                 =&gt;\n    [\n        'foo'\n    ],\n</code></pre> <p>Since the ENABLE list pulls in the rest of the trigger entries, this will be effectively as if you had done this in a v3.3 rc file:</p> <pre><code>POST_CREATE                 =&gt;\n    [\n        'foo',\n        'post-compile/update-git-configs',\n        'post-compile/update-gitweb-access-list',\n        'post-compile/update-git-daemon-access-list',\n    ],\n</code></pre> <p>As you can see, the 'foo' gets added to the top of the list.</p>"},{"location":"triggers.html#adding-a-perl-module-as-a-trigger","title":"adding a perl module as a trigger","text":"<p>If your trigger is a perl module, as opposed to a standalone script or executable, the process is almost the same as above, except what you add to the rc file it looks like this:</p> <pre><code>POST_CREATE                 =&gt;\n    [\n        'Foo::post_create'\n    ],\n</code></pre> <p>Gitolite will add the <code>Gitolite::Triggers::</code> prefix to the name given there.</p> <p>The subroutine to be run (in this example, <code>post_create</code>) is looked for in the <code>Gitolite::Triggers::Foo</code> package, so this requires that the perl module start with a package header like this:</p> <pre><code>package Gitolite::Triggers::Foo;\n</code></pre>"},{"location":"triggers.html#displaying-the-resulting-trigger-list","title":"displaying the resulting trigger list","text":"<p>You can use the 'gitolite query-rc' command to see what the trigger list actually looks like.  For example:</p> <pre><code>gitolite query-rc POST_CREATE\n</code></pre>"},{"location":"triggers.html#tips-and-examples","title":"tips and examples","text":"<ol> <li> <p>If you have code that latches onto more than one trigger, collecting data     (such as for logging), then the outputs may be intermixed.  You can record     the value of the environment variable <code>GL_TID</code> to tie together related     entries.</p> <p>The documentation on the log file format has more on this.</p> </li> <li> <p>If you look at CpuTime.pm, you'll see that it's <code>input()</code> function doesn't     set or change anything, but does set a package variable to record the     start time.  Later, when the same module's <code>post_git()</code> function is     invoked, it uses this variable to determine elapsed time.</p> <p>(This is a very nice and simple example of how you can implement features by latching onto multiple events and sharing data to do something).</p> </li> <li> <p>You can even change the reponame the user sees, behind his back.  Alias.pm     handles that.</p> </li> <li> <p>Finally, as an exercise for the reader, consider how you would create a     brand new env var that contains the comment field of the ssh pubkey that     was used to gain access, using the information here.</p> </li> </ol>"},{"location":"user.html","title":"the users' view","text":"<p>This page talks about what gitolite looks like to non-admins, and the commands and features available to them.</p>"},{"location":"user.html#accessing-gitolite","title":"accessing gitolite","text":"<p>The most common setup is based on ssh, where your admin asks you to send him your public key, and uses that to setup your access.</p> <p>Your actual access is either a git command (like <code>git clone git@server:reponame</code>, or an ssh command (like <code>ssh git@server info</code>).</p> <p>Note that you do not get a shell on the server -- the whole point of gitolite is to prevent that!</p> <p>Note to people who think gitolite requires or can only handle a specific syntax for the URL: Gitolite is designed in such a way that, unless there is an access violation, the client need not even know that something called gitolite is sitting between it and git on the server.  In particular, this means any URL syntax listed in 'man git-clone' for ssh and/or http will work.  The only things to note are:</p> <ul> <li>In ssh mode, you must use key-based authentication (i.e., passwords     won't work; see the two pages linked from the ssh page for why).</li> <li>The path of the repo is what you put into the conf file (e.g., \"testing\",     and not \"repositories/testing\" or \"/home/git/repositories/testing\" or     such).  A good rule of thumb is to use the exact name the <code>info</code> command     (see below) shows you.</li> <li>The \".git\" at the end is optional for git commands (i.e., you can use     \"testing.git\" instead of \"testing\" for clone, fetch, push, etc., if you     like) but gitolite commands in general (see below) will not like the     additional \".git\" at the end.</li> </ul>"},{"location":"user.html#the-info-command","title":"the info command","text":"<p>The only command that is always available to every user is the <code>info</code> command (run <code>ssh git@host info -h</code> for help), which tells you what version of gitolite and git are on the server, and what repositories you have access to. The list of repos is very useful if you have doubts about the spelling of some new repo that you know was setup.</p>"},{"location":"user.html#normal-and-wild-repos","title":"normal and wild repos","text":"<p>Gitolite has two kinds of repos.  Normal repos are specified by their full names in the config file.  \"Wildcard\" repos are specified by a regex in the config file.  Try the <code>info</code> command and see if it shows any lines that look like regex patterns, (with a \"C\" permission).</p> <p>If you see any, it means you are allowed to create brand new repos whose names fit that regex.  Normally, you create such repos simply by cloning them or pushing to them -- gitolite automatically creates the repo on the server side. (If your site is different, your admin will tell you).</p> <p>When you create such a repo, your \"ownership\" of it (as far as gitolite is concerned) is automatically recorded by gitolite.</p>"},{"location":"user.html#other-commands","title":"other commands","text":""},{"location":"user.html#setget-additional-permissions-for-repos-you-created","title":"set/get additional permissions for repos you created","text":"<p>The gitolite config may have several permissions lines for your repo, like so:</p> <pre>\nrepo pub/CREATOR/..*\n    C       =   ...some list of users allowed to create repos...\n    RW+     =   CREATOR\n    RW      =   user1 user2\n    R       =   user3\n</pre> <p>If that's all it had, you really can't do much.  Any changes to access must be done by the administrator.  (Note that \"CREATOR\" is a reserved word that gets expanded to your userid in some way, so the admin can literally add just the first three lines, and every user listed in the second line (or every authenticated user, if you specified <code>@all</code> there) has his own personal repo namespace, starting with <code>pub/&lt;username&gt;/</code>).</p> <p>To give some flexibility to users, the admin could add rules like this:</p> <pre>\n    RW      =   WRITERS\n    R       =   READERS\n</pre> <p>(he could also add other roles but then he needs to read the documentation).</p> <p>Once he does this, you can then use the <code>perms</code> command (run <code>ssh git@host perms -h</code> for help) to set permissions for other users by specifying which users are in the list of \"READERS\", and which in \"WRITERS\".</p> <p>If you think of READERS and WRITERS as \"roles\", it will help.  You can't change what access a role has, but you can say which users have that role.</p> <p>Note:</p> <p>There isn't a way for you to see the actual rule list unless you're given read access to the special 'gitolite-admin' repo.  Sorry.  The idea is that your admin will tell you what \"roles\" he added into rules for your repos, and what permissions those roles have.</p>"},{"location":"user.html#adding-a-description-to-repos-you-created","title":"adding a description to repos you created","text":"<p>The <code>desc</code> command is extremely simple.  Run <code>ssh git@host desc -h</code> for help.</p>"},{"location":"user.html#site-local-commands","title":"\"site-local\" commands","text":"<p>The main purpose of gitolite is to prevent you from getting a shell.  But there are commands that you often need to run on the server (i.e., cannot be done by pushing something to a repo).</p> <p>To enable this, gitolite allows the admin to setup scripts in a special directory that users can then run.  Gitolite comes with a set of working scripts that your admin may install, or may use as a starting point for his own, if he chooses.</p> <p>Think of these commands as equivalent to those in <code>COMMAND_DIR</code> in <code>man git-shell</code>.</p> <p>You can get a list of available commands by running <code>ssh git@host help</code>.</p>"},{"location":"user.html#personal-branches","title":"\"personal\" branches","text":"<p>\"personal\" branches are great for environments where developers need to share work but can't directly pull from each other (usually due to either a networking or authentication related reason, both common in corporate setups).</p> <p>Personal branches exist in a sub-tree of the <code>ref/heads/[...]</code> hierarchy. The syntax is</p> <pre>\n    RW+ personal/USER/  =   @userlist\n</pre> <p>where (a) the \"personal\" can be anything you like, but cannot be empty, (b) the \"/USER/\" part is necessary (including both slashes), and (c) the trailing slash can be optionally followed by additional restrictions on the ref name.</p> <p>A user \"alice\" (if she's in the userlist) can then push any branches inside <code>personal/alice/</code> (i.e., she can push <code>personal/alice/foo</code> and <code>personal/alice/bar</code>, but NOT <code>personal/alice</code>).  As another example <code>personal/USER/[a-zA-Z0-9_]+$</code> would mean that alice can create <code>personal/alice/foo</code>, but not <code>personal/alice/foo/bar</code>, because a <code>/</code> is not allowed by the expression following the <code>/USER/</code>.</p> <p>(Background: at runtime the \"USER\" component will be replaced by the name of the invoking user.  Access is determined by the right hand side, as usual).</p> <p>Compared to using arbitrary branch names on the same server, this:</p> <ul> <li>Reduces namespace pollution by corralling all these ad hoc branches into     the \"personal/\" namespace.</li> <li>Reduces branch name collision by giving each developer her own     sub-hierarchy within that.</li> <li>Removes the need to think about access control, because a user can push     only to his own sub-hierarchy.</li> </ul>"},{"location":"vref-2.html","title":"virtual refs","text":"(part 2)"},{"location":"vref-2.html#vref-makers-shipped-with-gitolite","title":"VREF-makers shipped with gitolite","text":""},{"location":"vref-2.html#restricting-pushes-by-dirfile-name","title":"restricting pushes by dir/file name","text":"<p>The \"NAME\" VREF allows you to restrict pushes by the names of dirs and files changed.  (Side note: the NAME VREF is the only one directly implemented within the update hook, so you won't find it in the VREF directory).</p> <p>Here's an example.  Say you don't want junior developers pushing changes to the Makefile, because it's quite complex:</p> <pre>\nrepo foo\n        RW+                             =   @senior_devs\n        RW                              =   @junior_devs\n\n        -   VREF/NAME/Makefile          =   @junior_devs\n</pre> <p>When a senior dev pushes, the VREF is not invoked at all.  But when a junior dev pushes, the VREF is invoked, and it returns a list of files changed as virtual refs, looking like this:</p> <pre><code>VREF/NAME/file-1\nVREF/NAME/dir-2/file-3\n...etc...\n</code></pre> <p>Each of these refs is matched against the access rules.  If one of them happens to be the Makefile, then the ref returned (<code>VREF/NAME/Makefile</code>) will match the deny rule and kill the push.</p> <p>Another way to use this is when you know what is allowed instead of what is not allowed.  Let's say the QA person is only allowed to touch a file called CHANGELOG and any files in a directory called ReleaseNotes:</p> <pre>\nrepo foo\n        RW+                             =   @senior_devs\n        RW                              =   @junior_devs\n        RW+                             =   QA-guy\n\n        RW+ VREF/NAME/CHANGELOG         =   QA-guy\n        RW+ VREF/NAME/ReleaseNotes/     =   QA-guy\n        -   VREF/NAME/                  =   QA-guy\n</pre>"},{"location":"vref-2.html#number-of-changed-or-new-files","title":"number of changed or new files","text":"<p>The COUNT VREF is used like this:</p> <pre>\n    -   VREF/COUNT/9                    =   @junior-developers\n</pre> <p>In response, if anyone in the user list pushes a commit series that changes more than 9 files, a virtual ref of <code>VREF/COUNT/9</code> is returned. Gitolite uses that as a \"ref\" to match against all the rules, hits the same rule that invoked it, and denies the request.</p> <p>If the user did not push more than 9 files, the VREF code returns nothing, and nothing happens.</p> <p>COUNT can take one more argument:</p> <pre>\n    -   VREF/COUNT/9/NEWFILES           =   @junior-developers\n</pre> <p>This is the same as before, but have to be more than 9 new files not just changed files.</p>"},{"location":"vref-2.html#advanced-filetype-detection","title":"advanced filetype detection","text":"<p>Note: this is more for illustration than use; it's rather specific to one of the projects I manage but the idea is the important thing.</p> <p>Sometimes a file has a standard extension (that cannot be 'gitignore'd), but it is actually automatically generated.  Here's one way to catch it:</p> <pre>\n     -   VREF/FILETYPE/AUTOGENERATED     =   @all\n</pre> <p>You can look at <code>src/VREF/FILETYPE</code> to see how it handles the 'AUTOGENERATED' option.  You could also have a more generic option, like perhaps BINARY, and handle that in the FILETYPE vref too.</p>"},{"location":"vref-2.html#checking-author-email","title":"checking author email","text":"<p>Some people want to ensure that \"you can only push your own commits\".</p> <p>If you force it on everyone, this is a very silly idea (see \"Philosophical Notes\" section of <code>src/VREF/EMAIL-CHECK</code>).</p> <p>But there may be value in enforcing it just for the junior developers.</p> <p>The neat thing is that the existing <code>contrib/update.email-check</code> was just copied to <code>src/VREF/EMAIL-CHECK</code> and it works, because VREFs get the same first 3 arguments and those are all that it cares about.  (Note: you have to change one subroutine in that script if you want to use it)</p>"},{"location":"vref-2.html#voting-on-commits","title":"voting on commits","text":"<p>Although gitolite can't/won't do the whole \"code review + workflow enforcement\" thing that Gerrit Code Review does, a basic implementation of voting on a commit is surprisingly easy.  See <code>src/VREF/VOTES</code> for details (and note that the actual code is just 2-3 lines; the rest is inline documentation).</p>"},{"location":"vref-2.html#other-ideas-code-welcome","title":"other ideas -- code welcome!","text":""},{"location":"vref-2.html#no-non-merge-first-parents","title":"\"no non-merge first-parents\"","text":"<p>Shruggar on #gitolite wanted this.  Possible code to implement it would be something like this (untested)</p> <pre><code>[ -z \"$(git rev-list --first-parent --no-merges $2..$3)\" ]\n</code></pre> <p>This can be implemented using <code>src/VREF/MERGE-CHECK</code> as a model.  That script does what the 'M' qualifier does in access rules (see last part of this), although the syntax to be used in conf/gitolite will be quite different.</p>"},{"location":"vref-2.html#other-ideas-for-vrefs","title":"other ideas for VREFs","text":"<p>Here are some more ideas:</p> <ul> <li>Number of commits (<code>git rev-list --count $old $new</code>).</li> <li>Number of binary files in commit (currently I only know to count     occurrences of <code>Bin</code> in the output of <code>git diff --stat</code>.</li> <li>Number of new binary files (count <code>Bin 0 -&gt;</code> in <code>git diff --stat</code>     output).</li> <li>Time of day/day of week (see example snippet somewhere above).</li> <li>IP address.</li> <li>Phase of the moon.</li> </ul> <p>Note that pretty much anything that involves <code>$oldsha..$newsha</code> will have to deal with the issue that when you push a new tag or branch, the \"old\" part is all 0's, and unless you consider <code>--all</code> existing branches and tags it becomes meaningless in terms of \"number of new files\" etc.</p>"},{"location":"vref.html","title":"virtual refs","text":"(part 1) <p>VREFs are a mechanism to add additional constraints to a push.</p> <p>They are also the simplest way to add your old update hooks to gitolite -- they'll just work, no coding changes needed.  If that's all you need, you should head over to the cookbook and look for the section on \"adding your own update hooks\".</p> <p>IMPORTANT:</p> <p>Fallthru is success in VREFs, unlike for normal refs.  That won't make sense until you read further, but I had to put it up here for folks who stop reading halfway!</p>"},{"location":"vref.html#quick-introexample","title":"quick intro/example","text":"<p>Here's an example to start you off.</p> <p>To disallow junior developers from changing more than five files, or from touching the Makefile, you can do this:</p> <pre>\nrepo foo\n    RW+                     =   @all-devs\n\n    -   VREF/COUNT/5        =   @junior-devs\n    -   VREF/NAME/Makefile  =   @junior-devs\n</pre> <p>Here's a pictorial representation of what happens, at a very high level, based on the <code>VREF/COUNT/5</code> rule in the rule list above.</p> <p></p> <ol> <li> <p>To start with, git-receive-pack calls the update hook with what we will     call a \"real\" ref, something like \"refs/heads/master\", or     \"refs/tags/v1.0\" -- in general, something that starts with \"refs/\".</p> <p>This ref is sent through \"check #2\" (please click to refresh your memory if needed).</p> <p>Any rules that specify a refex starting with \"VREF/\" clearly won't match and are ignored in this check.</p> </li> <li> <p>Assuming that check did not fail, the gitolite code in the update hook     then starts looking at each \"VREF\" rule in the rule list that applies to     that repo accessed by that user.  For each one, it runs the actual VREF     program whose name is given in the word after <code>VREF/</code>. (The rest of the     words, if any, along with all sorts of other information, are supplied as     arguments).</p> </li> <li> <p>The STDOUT of the called program is captured and any line that starts with     the characters <code>VREF/</code> is taken as a \"virtual\" ref, and is run through     the same \"check #2\". The only difference is that, unlike     for a regular ref, fallthru does not result in failure, but     success.</p> </li> </ol>"},{"location":"vref.html#basic-use-and-understanding","title":"basic use and understanding","text":"<p>Normally, rules deal with branches and tags (which git collectively calls \"refs\").  The \"ref\" is a property of the push which gitolite checks against the set of rules.</p> <p>\"Virtual refs\" are other properties of a push that gitolite can be told to check, in addition to the normal ref.  For example, \"this push has more than 5 changed files\" could be one property.  Or \"this push changed the file called Makefile\" could be another.  These properties are represented as \"virtual refs\" that start with <code>VREF/</code>.  (Recall that \"normal\" refs start with <code>refs/</code>).</p> <p>The simplest way to use them is as additional \"deny\" rules to fail a push that might otherwise have passed.  This is what the example at the top shows.</p> <p>It helps to separate VREF rules from normal rules, since no access rule can match both a normal ref and a virtual ref. Here's a good way to structure your rules:</p> <ul> <li> <p>Put your normal ref rules first.  These apply to the branch name or tag     name that git itself knows about and sends to gitolite's update hook.</p> <p>Fallthru is failure here, which means the ref being pushed must match some rule in this set for the push to succeed.</p> </li> <li> <p>Put your VREF rules next.  These apply to the virtual refs you want to     use as additional checks for the push.</p> <p>Fallthru is success here, which means the (virtual) ref must be explicitly denied in order for the push to fail.</p> </li> </ul>"},{"location":"vref.html#advanced-use","title":"advanced use","text":"<p>More complex uses are possible, but may be harder to understand.  You may want to experiment with the rules to solidify your understanding as you read this.</p>"},{"location":"vref.html#differences-from-normal-refs","title":"differences from normal refs","text":"<p>We know where normal refs (like <code>refs/heads/master</code> or <code>refs/tags/v1.0</code>) come from -- they are supplied by git itself when it calls the update hook.</p> <p>Virtual refs have two differences with normal refs:</p> <ul> <li>Gitolite has to generate them somehow.</li> <li>Fallthru is success, not failure.</li> </ul> <p>Here's how it works.</p> <ul> <li> <p>First, the normal (\"real\") ref is checked.</p> <p>As you already know, the push dies if the ref hits a deny rule or it falls through without hitting an allow rule.</p> </li> <li> <p>Next, virtual refs are generated and checked one by one.</p> <p>We'll talk about the generaton later, but for the check, a virtual ref kills the push only if it meets an explicit deny rule (\"-\"); fallthru does not cause failure.  Other than that, the checking is done the same way as for a normal ref, viz., as described in the flow for check #2.</p> </li> </ul>"},{"location":"vref.html#generating-virtual-refs","title":"generating virtual refs","text":"<p>Gitolite uses the VREF rules themselves to help it generate the virtual refs.</p> <p>Specifically, it looks at each rule that contains a VREF (there are 2 in the above example) and calls a VREF-maker for each of them.</p> <p>We'll take the COUNT example rule above.</p> <p>When gitolite sees that rule, it calls the \"COUNT\" VREF-maker.  Specifically, this is the <code>VREF/COUNT</code> program (See here for actual locations on disk).</p> <p>Gitolite passes it the string \"5\" as an argument (actually, as the eighth argument; details later).</p> <p>The program (which can be written in any language) is expected to do one of two things:</p> <ul> <li> <p>If the condition is satisfied (i.e., there are more than 5 files in this     push), it should print <code>VREF/COUNT/5</code> to STDOUT.</p> <p>You can see that when this virtual ref is processed through the rules, it will encounter the \"deny\" rule, and thus kill the push.</p> </li> <li> <p>Otherwise it should print nothing.  That is, there is no virtual ref to     run through \"check #2\", so nothing happens.</p> </li> </ul> <p>It should exit with an exit code of zero in either case.</p> <p>If it exits with a non-zero, the push dies regardless of what is printed (see \"mimicking a plain old update hook\" for why this is useful).</p>"},{"location":"vref.html#more-details-and-nuances","title":"more details and nuances","text":""},{"location":"vref.html#mimicking-a-plain-old-update-hook","title":"mimicking a plain old update hook","text":"<p>If the VREF maker exits with a non-zero exit code, then regardless of what it prints or does not, the push dies.</p> <p>This is just like a plain 'update' hook.  Since the first 3 arguments (see later) are also the same that a plain 'update' hook receives, you can actually use any existing update hook as a VREF-maker.</p> <p>To repurpose an existing update hook as a VREF-maker, just copy it to the VREF directory (again, see here for actual locations on disk).  Then add this rule to your repos:</p> <pre>\nrepo foo    # or maybe even 'repo @all'\n    -   VREF/my-update-hook     =   @all\n</pre> <p>That's it.</p>"},{"location":"vref.html#what-if-the-vref-maker-prints-a-different-virtual-ref","title":"what if the VREF-maker prints a different virtual ref?","text":"<p>Unless you know what you're upto, don't do that.</p> <p>But it's allowed and the behaviour is defined.  The VREF-maker for the NAME VREF is a good example.  It ignores the arguments and just makes VREFs out of the name of every file that was changed in the push.</p> <p>Here's another example.  Consider the problem of not allowing pushes at specific times.  Let's say repo 'foo' cannot be pushed between 4 and 7pm, and repo 'bar' can only be pushed before 9am.  And of course all this only applies to the junior developers, the poor guys!</p> <p>In this example, we write the \"Hour\" VREF-maker to ignore the argument passed and just print <code>VREF/Hour/NN</code> where NN can be between 00 to 23 inclusive and of course represents the current hour.</p> <p>If foo is pushed at 6:30pm, the VREF-maker prints VREF/Hour/18, which satisfies the third rule and is rejected.</p> <p>If bar is pushed at, say, 7:20am, the vref printed is VREF/Hour/07, which does not match any of the rules.  And fallthru is success so it passes.</p> <pre>\nrepo foo\n    RW+                         =   @all\n\n    -   VREF/Hour/16            =   @junior-devs\n    -   VREF/Hour/17            =   @junior-devs\n    -   VREF/Hour/18            =   @junior-devs\n\nrepo bar\n    RW+                         =   @all\n\n    -   VREF/Hour/09            =   @junior-devs\n    -   VREF/Hour/1[0-9]        =   @junior-devs\n    -   VREF/Hour/2[0-9]        =   @junior-devs\n</pre>"},{"location":"vref.html#why-is-fallthru-considered-success-with-vrefs","title":"why is fallthru considered success with VREFs","text":"<p>Virtual refs are best used (1) as additional \"deny\" rules, performing extra checks that core gitolite cannot.  You usually want such extra checks only for some people.</p> <p>When fallthru is success, you can simply ignore all the other users (for whom such additional checks are not needed).</p> <p>If fallthru were to be considered 'failure', you'd be forced to add a \"success rule\" like this for every virtual ref you used in this repo, in each case listing every user who was not already mentioned in the context of that vref:</p> <pre>\n    RW+ VREF/VREFNAME   =   @userlist   # uggh! what a pain!\n</pre> <p>Worse, since every virtual ref involves calling an external program, many of these calls may be wasted.</p> <p>(1) \"best used as...\" does not mean \"only used as...\".  For example it's perfectly easy to turn this around if, instead of having a list of people who do need extra checks, all you have is the complementary list: <pre>\n    RW+ VREF/NAME/Makefile      =   @senior-devs\n    -   VREF/NAME/Makefile      =   @all\n</pre> <p></p>"},{"location":"vref.html#what-if-the-vref-maker-prints-something-thats-not-even-a-virtual-ref","title":"what if the VREF-maker prints something that's not even a virtual ref?","text":"<p>The VREF-maker can print anything it wants to STDOUT.  Lines not starting with <code>VREF/</code> are printed as is (so your VREF-maker can do mostly-normal printing to STDOUT).  This is especially useful if you've turned an existing update hook into a VREF-maker, and it prints stuff meant for the user, but you don't want to touch the code.</p> <p>For lines starting with <code>VREF/</code>, the first word in each such line will be treated as a virtual ref, while the rest, if any, is a message to be added to the standard \"...DENIED...\" message that gitolite will print if that refex matches and the rule is a deny rule.</p>"},{"location":"vref.html#in-what-order-are-vref-makers-called","title":"in what order are VREF-makers called?","text":"<p>VREF-makers are called in the sequence in which they appear in the conf file.</p> <p>There are some optimisations to prevent calling the same VREF-maker with the same arguments more than once, and the VREF-maker code for the NAME VREF (which is special) is called only once regardless of how many times it appears but these details should not concern anyone but a developer.</p>"},{"location":"vref.html#what-arguments-are-passed-to-the-vref-maker","title":"what arguments are passed to the vref-maker?","text":"<ul> <li> <p>Arguments 1, 2, 3: the <code>ref</code>, <code>oldsha</code>, and <code>newsha</code> that git passed     to the update hook (see <code>man githooks</code>).</p> <p>This, combined with the fact that non-zero exits are detected, mean that you can simply use an existing update.secondary as a VREF-maker as-is, no changes needed.</p> </li> <li> <p>Arguments 4 and 5: the 'oldtree' and 'newtree' SHAs.  These are the     same as the oldsha and newsha values, except if one of them is all-0.     (indicating a ref creation or deletion).  In that case the corresponding     'tree' SHA is set (by gitolite, as a courtesy) to the special SHA     <code>4b825dc642cb6eb9a060e54bf8d69288fbee4904</code>, which is the hash of an empty     tree.</p> <p>(None of these shenanigans would have been needed if <code>git diff $oldsha $newsha</code> would not error out when passed an all-0 SHA.)</p> </li> <li> <p>Argument 6: the attempted access flag.  Typically <code>W</code> or <code>+</code>, but     could also be <code>C</code>, <code>D</code>, or any of these 4 followed by <code>M</code>.  If you have to     ask what they mean, you haven't read enough gitolite documentation to be     able to make virtual refs work.</p> </li> <li> <p>Argument 7: is the entire refex; say <code>VREF/COUNT/3/NEWFILES</code>.</p> </li> <li> <p>Arguments 8 onward: are the split out (by <code>/</code>) portions of the refex,     excluding the first two components.  In our example they would be <code>3</code>     followed by <code>NEWFILES</code>.</p> </li> </ul> <p>Yes, argument 7 is redundant if you have 8 and 9.  It's just more convenient for scripts to have both available, without having to split/join.</p>"},{"location":"wild.html","title":"\"wild\" repos (user created repos)","text":"<p>The wildrepos feature allows you to specify access control rules using regular expression patterns, so you can have many actual repos being served by a single set of rules in the config file.  The regex can also include the word <code>CREATOR</code> in it, allowing you to parametrise the name of the user creating the repo.</p>"},{"location":"wild.html#quick-introexample","title":"quick intro/example","text":"<p>If you're curious about the feature but you aren't sure if you want to read the whole page, here's a very simple example.</p> <p>This is what the admin added to the conf file:</p> <pre>\n@users = u1 u2 u3\n\nrepo foo/CREATOR/[a-z]..*\n    C   =   u1 u2 u3\n    RW+ =   CREATOR\n    RW  =   WRITERS\n    R   =   READERS\n</pre> <p>User 'u1' then runs <code>git clone git@host:foo/u1/bar</code>, creating the repo. Notice the repo name matches the regex, if you substitute the user's name for the word CREATOR.</p> <p>This is the effective rule list for 'foo/u1/bar' immediately after the user creates it:</p> <pre>\nrepo foo/u1/bar\n    RW+ =   u1\n    RW  =   WRITERS\n    R   =   READERS\n</pre> <p>Most of this is fixed, but the creator (user 'u1') can use the perms command to add other users as 'READERS' or 'WRITERS'.  For example he could add 'u2' as a writer and 'u3' and 'u5' as readers:</p> <p>This is the effective rule list that applies to the repo if he does that:</p> <pre>\nrepo foo/u1/bar\n    RW+ =   u1\n    RW  =   u2\n    R   =   u3 u5\n</pre> <p>Note that both these \"effective rule lists\" were created without touching the actual conf file or any admin intervention.</p> <p>And that's it for our quick intro example.  The rest of this page will explain all this in much more detail.</p>"},{"location":"wild.html#declaring-wild-repos-in-the-conf-file","title":"declaring wild repos in the conf file","text":"<p>Here's a slightly more detailed example, starting with what the admin puts in the conf file:</p> <pre>\n@prof       =   u1\n@TAs        =   u2 u3\n@students   =   u4 u5 u6\n\nrepo    assignments/CREATOR/a[0-9][0-9]\n    C   =   @students\n    RW+ =   CREATOR\n    RW  =   WRITERS @TAs\n    R   =   READERS @prof\n</pre> <p>Note the \"C\" permission.  This is a standalone \"C\", which gives the named users the right to create a repo.  This is not to be confused with the \"RWC\" permission or its variants described elsewhere, which are about creating branches, not repos.</p>"},{"location":"wild.html#user-creating-a-specific-repo","title":"(user) creating a specific repo","text":"<p>For now, ignore the special usernames READERS and WRITERS, and just create a new repo, as user \"u4\" (a student):</p> <pre><code>$ git clone git@server:assignments/u4/a12\nInitialized empty Git repository in /home/git/repositories/assignments/u4/a12.git/\nwarning: You appear to have cloned an empty repository.\n</code></pre>"},{"location":"wild.html#a-slightly-different-example","title":"a slightly different example","text":"<p>Here's how the same example would look if you did not want the CREATOR's name to be part of the actual repo name.</p> <pre>\nrepo    assignments/a[0-9][0-9]\n    C   =   @students\n    RW+ =   CREATOR\n    RW  =   WRITERS @TAs\n    R   =   READERS @prof\n</pre> <p>We haven't changed anything except the repo name regex.  This means that the first student that creates, say, <code>assignments/a12</code> becomes the owner. Mistakes (such as claiming a12 instead of a13) need to be rectified by an admin logging on to the back end, though it's not too difficult.</p> <p>You could also replace the C line like this:</p> <pre><code>    C   =   @TAs\n</code></pre> <p>and have a TA create the repos in advance.</p>"},{"location":"wild.html#repo-regex-patterns","title":"repo regex patterns","text":""},{"location":"wild.html#regex-pattern-versus-normal-repo","title":"regex pattern versus normal repo","text":"<p>Due to projects like <code>gtk+</code>, the <code>+</code> character is now considered a valid character for an ordinary repo.  Therefore, a regex like <code>foo/.+</code> does not look like a regex to gitolite.  Use <code>foo/..*</code> if you want that.</p> <p>Also, <code>..*</code> by itself is not considered a valid repo regex.  Try <code>[a-zA-Z0-9].*</code>.  <code>CREATOR/..*</code> will also work.</p>"},{"location":"wild.html#line-anchored-regexes","title":"line-anchored regexes","text":"<p>A regex like</p> <pre><code>repo assignments/S[0-9]+/A[0-9]+\n</code></pre> <p>would match <code>assignments/S02/A37</code>.  It will not match <code>assignments/S02/ABC</code>, or <code>assignments/S02/a37</code>, obviously.</p> <p>But you may be surprised to find that it does not match even <code>assignments/S02/A37/B99</code>.  This is because internally, gitolite line-anchors the given regex; so that regex actually becomes <code>^assignments/S[0-9]+/A[0-9]+$</code> -- notice the line beginning and ending metacharacters.</p> <p>Side-note: contrast with refexes</p> <p>Just for interest, note that this is in contrast to the refexes for the normal \"branch\" permissions. Refexes are only anchored at the start; a regex like <code>refs/heads/master</code> actually can match <code>refs/heads/master01/bar</code> as well, even if no one will actually push such a branch!  You can anchor both sides if you really care, by using <code>master$</code> instead of <code>master</code>, but that is not the default for refexes.</p>"},{"location":"wild.html#roles","title":"roles","text":"<p>The words READERS and WRITERS are called \"role\" names.  The access rules in the conf file decide what permissions these roles have, but they don't say what users are in each of these roles.</p> <p>That needs to be done by the creator of the repo, using the <code>perms</code> command. You can run <code>ssh git@host perms -h</code> for detailed help, but in brief, that command lets you give and take away roles to users.  This has some more detail.</p>"},{"location":"wild.html#adding-other-roles","title":"adding other roles","text":"<p>If you want to have more than just the 2 default roles, say something like:</p> <p>You can add the new names to the ROLES hash in the rc file; see comments in that file for how to do that.  Be sure to run the 2 commands mentioned there after you have added the roles.</p> <pre>\nrepo foo/..*\n  C                 =   u1\n  RW    refs/tags/  =   TESTERS\n  -     refs/tags/  =   @all\n  RW+               =   WRITERS\n  RW                =   INTERNS\n  R                 =   READERS\n  RW+D              =   MANAGERS\n</pre>"},{"location":"wild.html#important-warning-about-this-feature","title":"IMPORTANT WARNING ABOUT THIS FEATURE","text":"<p>Please make sure that none of the role names conflict with any of the user names or group names in the system.  For example, if you have a user called \"foo\" or a group called \"@foo\", make sure you do not include \"foo\" as a valid role in the ROLES hash.</p> <p>You can keep things sane by using UPPERCASE names for roles, while keeping all your user and group names lowercase; then you don't have to worry about this problem.</p>"},{"location":"wild.html#setting-default-roles","title":"setting default roles","text":"<p>You can setup some default role assignments as soon as a new wild repo is created.</p> <p>Here's how:</p> <ul> <li> <p>Enable the 'set-default-roles' feature in the rc file by uncommenting it     if it is already present or adding it to the ENABLE list if it is not.</p> </li> <li> <p>Supply a set of default role assignments for a wild repo regex by adding     lines like this to the repo config para:</p> <pre><code>option default.roles-1  =   READERS @all\noption default.roles-2  =   WRITERS @senior-devs\n</code></pre> </li> </ul> <p>This will then behave as if the perms command was used immediately after the repo was created to add those two role assignments.</p> <p>If you want to simulate the old (pre v3.5) <code>DEFAULT_ROLE_PERMS</code> rc file variable, just add them under a <code>repo @all</code> line.  (Remember that this only affects newly created wild repos, despite the '@all' name).</p>"},{"location":"wild.html#specifying-owners","title":"specifying owners","text":"<p>See the section on <code>OWNER_ROLENAME</code> in the rc file page.</p>"},{"location":"wild.html#listing-wild-repos","title":"listing wild repos","text":"<p>In order to see what repositories were created from a wildcard, use the 'info' command.  Try <code>ssh git@host info -h</code> to get help on the info command.</p>"},{"location":"wild.html#deleting-a-wild-repo","title":"deleting a wild repo","text":"<p>Run the whimsically named \"D\" command -- try <code>ssh git@host D -h</code> for more info on how to delete a wild repo.  (Yes the command is \"D\"; it's meant to be a counterpart to the \"C\" permission that allowed you to create the repo in the first place).  Of course this only works if your admin has enabled the command (gitolite ships with the command disabled for remote use).</p>"},{"location":"wild.html#appendix-1-owner-and-creator","title":"appendix 1: owner and creator","text":"<p>A wild repo is created by one specific user.  This user is usually called the creator of the repo: his username is placed in a file called gl-creator in the (bare) repo directory, any permissions given in the gitolite.conf file to \"CREATOR\" will be applicable to this user, he is the only person who can give permissions to other users (by running the 'perms' command), etc.</p> <p>But, as I said in this mail:</p> <pre>\n    Until about a year ago, Gitolite only knew the concept of a \"creator\", and\n    there was only one.\n\n    But then people started seeing the need for more than one \"owner\", because\n    wild repos may be *created* by one person, but they often needed to be\n    *administered* by one of several people.\n\n    So now, even though large parts of the documentation probably conflate\n    \"creator\" and \"owner\", you can see wild.html ([wild]) and rc.html ([rc])\n    to actually understand how this larger group become the \"owner\".\n</pre>"},{"location":"contrib/README-emacs.html","title":"Emacs major mode for gitolite.conf","text":"<p>Emacs major mode for <code>gitolite.conf</code> can be found here:</p> <ul> <li>GitHub</li> </ul>"},{"location":"contrib/putty.html","title":"putty and msysgit","text":"<p>Copyright: Thomas Berezansky (tsbere (at) mvlc (dot) org).  Licensed under CC-BY-SA unported 3.0, https://creativecommons.org/licenses/by-sa/3.0/</p> <p>This document is intended for those who wish to use Putty/Plink with msysgit.</p> <p>If you need more help with putty or component programs I suggest looking at the official putty documentation.</p> <p>If you are not already using Putty for SSH it is recommended you do NOT use it with msysgit.</p> <p>Please note that this only covers the client side of things, and does not involve server side components to troubleshooting. For that, please see the ssh-troubleshooting document.</p> <p></p>"},{"location":"contrib/putty.html#msysgit-setup","title":"msysgit setup","text":"<p>Provided you have putty sessions msysgit should give you the option of specifying a location to plink. If it did not then you will need to add an environment variable named \"GIT_SSH\" to point at plink.exe, wherever you have that sitting.</p> <p>How to do that on your version of windows will likely vary, and is not covered here. For purposes of example, on a 64 bit Windows Vista machine the GIT_SSH value could be:</p> <pre><code>C:\\Program Files (x86)\\PuTTY\\plink.exe\n</code></pre> <p>Note the lack of quotes.</p> <p>Testing that msysgit is properly configured can be done from the git bash shell. Simply type (case sensitive, include the quotes):</p> <pre><code>\"$GIT_SSH\" -V\n</code></pre> <p>You should get a response similar to this:</p> <pre><code>plink: Release 0.60\n</code></pre> <p>If instead you get a \"command not found\" type error you likely have a typo in your environment variable.</p> <p></p>"},{"location":"contrib/putty.html#going-back-to-openssh","title":"Going back to OpenSSH","text":"<p>If you wish to go back to OpenSSH all you need to do is delete the GIT_SSH environment variable. This will vary by your version of windows and thus is not covered here.</p> <p></p>"},{"location":"contrib/putty.html#putty-keys","title":"Putty keys","text":"<p>If you do not already have putty private key files (.ppk) you will need to make at least one. You can either make a new one or convert an existing key to putty private key format.</p> <p>Either way, you will want to use puttygen. Note that you can go the other way if you want to stop using putty but keep the key by exporting the key to OpenSSH format.</p> <p></p>"},{"location":"contrib/putty.html#creating-a-new-key","title":"Creating a new key","text":"<p>To make it simple, I suggest SSH-2 RSA and a bit size of at least 1024. Larger keys will take longer to generate and will take longer to authenticate you on most systems. Making the key is as simple at hitting \"Generate\".</p> <p>It is recommended to give the key a meaningful comment.</p> <p></p>"},{"location":"contrib/putty.html#importing-an-existing-key","title":"Importing an existing key","text":"<p>If you already have an OpenSSH or ssh.com key you can import it using the \"Import\" option on the \"Conversions\" menu.</p> <p>If the key does not have a meaningful comment I would suggest adding one at this point.</p> <p></p>"},{"location":"contrib/putty.html#loading-an-existing-key","title":"Loading an existing key","text":"<p>If you need to load an existing key to edit or view it you can do so from the File menu.</p> <p></p>"},{"location":"contrib/putty.html#public-key","title":"Public key","text":"<p>To get your public key for use with gitolite, load (or generate, or import) your key into puttygen. There is a box labeled \"Public key for pasting into OpenSSH <code>authorized_keys</code> file\" there. Copy the text into your preferred text editor and save.</p> <p></p>"},{"location":"contrib/putty.html#putty-ageant","title":"Putty ageant","text":"<p>Though not required in all cases you may wish to use the putty ageant, pageant, to load your key(s). This will allow for your key(s) to be passphrase protected but not have to enter the passphrase when you go to use them, provided you have already loaded the key into the ageant.</p> <p></p>"},{"location":"contrib/putty.html#sessionless-or-raw-hostname-usage","title":"Sessionless or raw hostname usage","text":"<p>When using plink without a putty session you pretty much have to load your keys with putty ageant, if only so that plink can find them.</p> <p></p>"},{"location":"contrib/putty.html#putty-sessions","title":"Putty sessions","text":"<p>In addition to hostnames msysgit can, when using putty, use putty sessions. This works in a manner similar to definitions in OpenSSH's <code>ssh_config</code> file. All settings in the session that apply to plink usage will be loaded, including the key file to use and even the username to connect to. Thus, instead of:</p> <pre><code>ssh://user@host.example.ext:port/repo\n</code></pre> <p>You can use:</p> <pre><code>ssh://session_name/repo\n</code></pre> <p></p>"},{"location":"contrib/putty.html#host-key-authentication","title":"Host key authentication","text":"<p>Whether you are using hostnames or sessions you still run into one potential problem. Plink currently wants to validate the server's SSH host key before allowing you to connect, and when git calls plink there is no way to tell it yes. Thus, you may get something like this:</p> <pre><code>The server's host key is not cached in the registry. You\nhave no guarantee that the server is the computer you\nthink it is.\nThe server's rsa2 key fingerprint is:\nssh-rsa 2048 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00\nConnection abandoned.\nfatal: The remote end hung up unexpectedly\n</code></pre> <p>Or, in the case of the host key changing, something like this:</p> <pre><code>WARNING - POTENTIAL SECURITY BREACH!\nThe server's host key does not match the one PuTTY has\ncached in the registry. This means that either the\nserver administrator has changed the host key, or you\nhave actually connected to another computer pretending\nto be the server.\nThe new rsa2 key fingerprint is:\nssh-rsa 2048 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00\nConnection abandoned.\nfatal: The remote end hung up unexpectedly\n</code></pre> <p>The solution is to call plink directly, or start putty and connect with it first. To use plink, open the Git Bash shell and enter:</p> <pre><code>\"$GIT_SSH\" hostname_or_session_name\n</code></pre> <p>When you do you will see something like this:</p> <pre><code>The server's host key is not cached in the registry. You\nhave no guarantee that the server is the computer you\nthink it is.\nThe server's rsa2 key fingerprint is:\nssh-rsa 2048 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00\nIf you trust this host, enter \"y\" to add the key to\nPuTTY's cache and carry on connecting.\nIf you want to carry on connecting just once, without\nadding the key to the cache, enter \"n\".\nIf you do not trust this host, press Return to abandon the\nconnection.\nStore key in cache? (y/n)\n</code></pre> <p>Or, in the case of a changed key, a response like this:</p> <pre><code>WARNING - POTENTIAL SECURITY BREACH!\nThe server's host key does not match the one PuTTY has\ncached in the registry. This means that either the\nserver administrator has changed the host key, or you\nhave actually connected to another computer pretending\nto be the server.\nThe new rsa2 key fingerprint is:\nssh-rsa 2048 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00\nIf you were expecting this change and trust the new key,\nenter \"y\" to update PuTTY's cache and continue connecting.\nIf you want to carry on connecting but without updating\nthe cache, enter \"n\".\nIf you want to abandon the connection completely, press\nReturn to cancel. Pressing Return is the ONLY guaranteed\nsafe choice.\nUpdate cached key? (y/n, Return cancels connection)\n</code></pre> <p>In either case hit y and the key will be stored.</p> <p></p>"},{"location":"contrib/putty.html#debugging-multiple-putty-ageant-keys","title":"Debugging multiple putty ageant keys","text":"<p>In the event you are using putty ageant with multiple keys loaded you may see the wrong key being used. In general, pageant keys are tried in the order they were loaded into the ageant. If you have descriptive comment on each of your keys you can try connecting with plink in verbose mode to see what keys are being tried. Simply open the Git bash shell and run:</p> <pre><code>\"$GIT_SSH\" -v user@hostname\n</code></pre> <p>Or, if using sessions with a pre-entered username:</p> <pre><code>\"$GIT_SSH\" -v session_name\n</code></pre> <p>In either case, you should look for lines like:</p> <pre><code>Trying Pageant key #0\nAuthenticating with public key \"My Key\" from agent\n</code></pre> <p>The first says which (numerical) key the ageant is trying. The second tells you the key comment for the authenticating key. To my knowledge the second line should only show up once, for the valid key.</p> <p></p>"},{"location":"contrib/putty.html#setperms-and-other-commands","title":"Setperms and other commands","text":"<p>When using wildcard repos the setperms command is very important, and other commands can come in handy as well. See their documentation for how to use them, but where they use:</p> <pre><code>ssh user@host command etc etc\n</code></pre> <p>You will want to use:</p> <pre><code>\"$GIT_SSH\" user@host command etc etc\n</code></pre> <p>Otherwise everything should be identical.</p> <p></p>"},{"location":"contrib/putty.html#about-this-document","title":"About this document","text":"<p>This document was written by Thomas Berezansky (tsbere (at) mvlc (dot) org) in the hopes that it would be useful to those using putty on windows and wishing to use git/gitolite with their putty keys and sessions.</p>"},{"location":"contrib/ssh-and-http.html","title":"Making repositories available to both ssh and http mode clients","text":"<p>Copyright Thomas Hager (duke at sigsegv dot at).  Licensed under CC-BY-NC-SA unported 3.0, https://creativecommons.org/licenses/by-nc-sa/3.0/</p> <p>Assumptions:</p> <ul> <li>Apache 2.x with CGI and Suexec support installed.</li> <li>Git and Gitolite installed with user \"git\" and group \"git\", and pubkey SSH     access configured and working.</li> <li>Git plumbing installed to /usr/libexec/git-core</li> <li>Gitolite base located at /opt/git</li> <li>Apache <code>DOCUMENT_ROOT</code> set to /var/www</li> <li>Apache runs with user www and group www</li> </ul> <p>Please adjust the instructions below to reflect your setup (users and paths).</p> <p>Edit your .gitolite.rc and add</p> <pre><code>$ENV{PATH} .= \":/opt/git/bin\";\n</code></pre> <p>at the very top (as described in <code>t/smart-http.root-setup</code>).</p> <p>Next, check which document root your Apache's suexec accepts:</p> <pre><code># suexec -V\n -D AP_DOC_ROOT=\"/var/www\"\n -D AP_GID_MIN=100\n -D AP_HTTPD_USER=\"www\"\n -D AP_LOG_EXEC=\"/var/log/apache/suexec.log\"\n -D AP_SAFE_PATH=\"/usr/local/bin:/usr/bin:/bin\"\n -D AP_UID_MIN=100\n -D AP_USERDIR_SUFFIX=\"public_html\"\n</code></pre> <p>We're interested in <code>AP_DOC_ROOT</code>, which is set to <code>/var/www</code> in our case.</p> <p>Create a <code>bin</code> and a <code>git</code> directory in <code>AP_DOC_ROOT</code>:</p> <pre><code>install -d -m 0755 -o git -g git /var/www/bin\ninstall -d -m 0755 -o www -g www /var/www/git\n</code></pre> <p><code>/var/www/git</code> is just a dummy directory used as Apache's document root (see below).</p> <p>Next, create a shell script inside <code>/var/www/bin</code> named <code>gitolite-suexec-wrapper.sh</code>, with mode 0700 and owned by user and group git. Add the following content:</p> <pre><code>#!/bin/bash\n#\n# Suexec wrapper for gitolite-shell\n#\n\nexport GIT_PROJECT_ROOT=\"/opt/git/repositories\"\nexport GITOLITE_HTTP_HOME=\"/opt/git\"\n# WARNING: do not add a trailing slash to the value of GITOLITE_HTTP_HOME\n\nexec ${GITOLITE_HTTP_HOME}/gitolite-source/src/gitolite-shell\n</code></pre> <p>Edit your Apache's config to add http pull/push support, preferably in a dedicated <code>VirtualHost</code> section:</p> <pre><code>&lt;VirtualHost *:80&gt;\n    ServerName        git.example.com\n    ServerAlias       git\n    ServerAdmin       you@example.com\n\n    DocumentRoot /var/www/git\n    &lt;Directory /var/www/git&gt;\n        Options       None\n        AllowOverride none\n        Order         allow,deny\n        Allow         from all\n    &lt;/Directory&gt;\n\n    SuexecUserGroup git git\n    ScriptAlias /git/ /var/www/bin/gitolite-suexec-wrapper.sh/\n    ScriptAlias /gitmob/ /var/www/bin/gitolite-suexec-wrapper.sh/\n\n    &lt;Location /git&gt;\n        AuthType Basic\n        AuthName \"Git Access\"\n        Require valid-user\n        AuthUserFile /etc/apache/git.passwd\n    &lt;/Location&gt;\n&lt;/VirtualHost&gt;\n</code></pre> <p>This Apache config is just an example, you probably should adapt the authentication section and use https instead of http!</p> <p>Finally, add an <code>R = daemon</code> access rule to all repositories you want to make available via http.</p>"},{"location":"contrib/sskm.html","title":"changing keys -- self service key management","text":"<p>Copyright: Jeff Mitchell (jmitchell@kde.org).  Licensed under CC-BY-NC-SA unported 3.0, https://creativecommons.org/licenses/by-nc-sa/3.0/</p> <p>[Note on v3 version: this has been manually spot-tested; there is no test suite.  Changes from v2 version are minimal so it should all work fine but please report errors!]</p> <p>Follow this guide to add keys to or remove keys from your account. Note that you cannot use this method to add your first key to the account; you must still email your initial key to your admin.</p> <p>The key management is done using a command called <code>sskm</code>.  This command must be enabled for remote use by the admin (see here for more on this).</p>"},{"location":"contrib/sskm.html#important","title":"Important!","text":"<p>There are a few things that you should know before using the key management system. Please do not ignore this section!</p>"},{"location":"contrib/sskm.html#key-fingerprints","title":"Key fingerprints","text":"<p>Keys are identified in some of these subcommands by their fingerprints. To see the fingerprint for a public key on your computer, use the following syntax:</p> <pre><code>ssh-keygen -l -f &lt;path_to_public_key.pub&gt;\n</code></pre> <p>You'll get output like:</p> <pre><code>jeff@baklava ~  $  ssh-keygen -l -f .ssh/jeffskey.pub \n2048 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44 .ssh/jeffskey.pub (RSA)\n</code></pre>"},{"location":"contrib/sskm.html#active-keys","title":"Active keys","text":"<p>Any keys that you can use to interact with the system are active keys. (Inactive keys are keys that are, for instance, scheduled to be added or removed.) Keys are identified with their <code>keyid</code>; see the section below on listing keys.</p> <p>If you have no current active keys, you will be locked out of the system (in which case email your admin for help). Therefore, be sure that you are never removing your only active key!</p>"},{"location":"contrib/sskm.html#selecting-which-key-to-use","title":"Selecting which key to use","text":"<p>Although you can identify yourself to the Gitolite system with any of your active keys on the server, at times it is necessary to specifically pick which key you are identifying with. To pick the key to use, pass the <code>-i</code> flag into <code>ssh</code>:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git info\nhello jeff, the gitolite version here is v2.0.1-11-g1cd3414\nthe gitolite config gives you the following access:\n @C  R   W      [a-zA-Z0-9][a-zA-Z0-9_\\-\\.]+[a-zA-Z0-9]\n....\n</code></pre> <p>N.B.: If you have any keys loaded into <code>ssh-agent</code> (i.e., <code>ssh-add -l</code> shows at least one key), then this may not work properly.  <code>ssh</code> has a bug which makes it ignore <code>-i</code> values when that key has not been loaded into the agent. One solution is to add the key you want to use (e.g., <code>ssh-add .ssh/jeffskey</code>).  The other is to remove all the keys from the agent or disable the agent, using one of these commands:</p> <ul> <li>Terminate <code>ssh-agent</code> or use <code>ssh-add -D</code> flag to remove identities from it</li> <li>If using <code>keychain</code>, run <code>keychain --clear</code> to remove identities</li> <li>Unset the <code>SSH_AUTH_SOCK</code> and <code>SSH_AGENT_PID</code> variables in the current shell</li> </ul>"},{"location":"contrib/sskm.html#public-vs-private-keys","title":"Public vs. private keys","text":"<p>In this guide, all keys are using their full suffix. In other words, if you see a <code>.pub</code> at the end of a key, it's the public key; if you don't, it's the private key. For instance, when using the <code>-i</code> flag with <code>ssh</code>, you are specifying private keys to use. When you are submitting a key for addition to the system, you are using the public key.</p>"},{"location":"contrib/sskm.html#listing-your-existing-keys","title":"Listing your existing keys","text":"<p>To see a list of your existing keys, use the <code>list</code> argument to <code>sskm</code>:</p> <pre><code>jeff@baklava ~  $  ssh git@git sskm list\nhello jeff, you are currently using a normal (\"active\") key\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n</code></pre> <p>Notice the <code>@</code> sign in each key's name? That sign and the text after that up until the <code>.pub</code> is the <code>keyid</code>. This is what you will use when identifying keys to the system. Above, for instance, one of my keys has the <code>keyid</code> of <code>@key3</code>.</p> <p>A keyid may be empty; in fact to start with you may only have a single <code>jeff.pub</code> key, depending on how your admin added your initial key.  You can use any keyid you wish when adding keys (like <code>@home</code>, <code>@laptop</code>, ...); the only rules are that it must start with the <code>@</code> character and after that contain only digits, letters, or underscores.</p>"},{"location":"contrib/sskm.html#adding-or-replacing-a-key","title":"Adding or Replacing a key","text":""},{"location":"contrib/sskm.html#step-1-adding-the-key","title":"Step 1: Adding the Key","text":"<p>Adding and replacing a key is the same process. What matters is the <code>keyid</code>. When adding a new key, use a new <code>keyid</code>; when replacing a key, pass in the <code>keyid</code> of the key you want to replace, as found by using the <code>list</code> subcommand. Pretty simple!</p> <p>To add a key, pipe in the text of your new key using <code>cat</code> to the <code>add</code> subcommand. In the example below, I explicitly select which existing, active pubkey to identify with for the command (using the <code>-i</code> parameter to ssh) for clarity:</p> <pre><code>jeff@baklava ~  $  cat .ssh/newkey.pub | ssh -i .ssh/jeffskey git@git sskm add @key4\nhello jeff, you are currently using a normal (\"active\") key\nplease supply the new key on STDIN.  (I recommend you\n        don't try to do this interactively, but use a pipe)\n</code></pre> <p>If you now run the <code>list</code> command you'll see that it's scheduled for addition:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm list\nhello jeff, you are currently using a normal (\"active\") key\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n== keys marked for addition/replacement ==\n1: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub\n</code></pre>"},{"location":"contrib/sskm.html#step-2-confirming-the-addition","title":"Step 2: Confirming the addition","text":"<p>Gitolite uses Git internally to store the keys. Just like with Git, where you commit locally before <code>push</code>-ing up to the server, you need to confirm the key addition (see the next section if you made a mistake). We use the <code>confirm-add</code> subcommand to do this, but: to verify that you truly have ownership of the corresponding private key, you must use the key you are adding itself to do the confirmation! (Inconvenient like most security, but very necessary from a security perspective.) This is where using the <code>-i</code> flag of <code>ssh</code> comes in handy:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm confirm-add @key4\nhello jeff, you are currently using a key in the 'marked for add' state\n</code></pre> <p>Listing keys again shows that all four keys are now active:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list\nhello jeff, you are currently using a normal (\"active\") key\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n4: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub\n</code></pre>"},{"location":"contrib/sskm.html#optional-undoing-a-mistaken-add-before-confirmation","title":"Optional: Undoing a mistaken add (before confirmation)","text":"<p>Another advantage of Gitolite using Git internally is that that if we mistakenly add the wrong key, we can undo it before it's confirmed by passing in the <code>keyid</code> we want to remove into the <code>undo-add</code> subcommand:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm undo-add @key4\nhello jeff, you are currently using a normal (\"active\") key\n</code></pre> <p>Listing the keys shows that that new key has been removed:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm list\nhello jeff, you are currently using a normal (\"active\") key\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n</code></pre>"},{"location":"contrib/sskm.html#removing-a-key","title":"Removing a key","text":""},{"location":"contrib/sskm.html#step-1-mark-the-key-for-deletion","title":"Step 1: Mark the key for deletion","text":"<p>Deleting a key works very similarly to adding a key, with <code>del</code> substituted for <code>add</code>.</p> <p>Let's say that I have my four keys from the example above:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list\nhello jeff, you are currently using a normal (\"active\") key\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n4: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub\n</code></pre> <p>I would like to remove the key that on my box is called <code>newkey</code> and in the Gitolite system is known as <code>@key4</code>.</p> <p>I simply pass in the identifier to the <code>del</code> subcommand of <code>sskm</code>:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm del @key4\nhello jeff, you are currently using a normal (\"active\") key\n</code></pre> <p>Listing the keys now shows that it is marked for deletion:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list\nhello jeff, you are currently using a key in the 'marked for del' state\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n== keys marked for deletion ==\n1: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub\n</code></pre>"},{"location":"contrib/sskm.html#step-2-confirming-the-deletion","title":"Step 2: Confirming the deletion","text":"<p>Just like with Git, where you commit locally before <code>push</code>-ing up to the server, you need to confirm the key addition (see the next section if you made a mistake). We use the <code>confirm-del</code> subcommand to do this, but: unlike the <code>confirm-add</code> subcommand, you must use a different key than the key you are deleting to do the confirmation! This prevents you from accidentally locking yourself out of the system by removing all active keys:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm confirm-del @key4\nhello jeff, you are currently using a normal (\"active\") key\n</code></pre> <p>Listing keys again shows that the fourth key has been removed:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm list\nhello jeff, you are currently using a normal (\"active\") key\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n</code></pre>"},{"location":"contrib/sskm.html#optional-undoing-a-mistaken-delete-before-confirmation","title":"Optional: Undoing a mistaken delete (before confirmation)","text":"<p>Another advantage of Gitolite using Git internally is that that if we mistakenly delete the wrong key, we can undo it before it's confirmed by passing in the <code>keyid</code> we want to keep into the <code>undo-del</code> subcommand. Note that this operation must be performed using the private key that corresponds to the key you are trying to keep! (Security reasons, similar to the reason that you must confirm an addition this way; it prevents anyone from undoing a deletion, and therefore keeping in the system, a key that they cannot prove (by having the corresponding private key) should stay in the system):</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm undo-del @key4\nhello jeff, you are currently using a key in the 'marked for del' state\n\nYou're undeleting a key that is currently marked for deletion.\n    Hit ENTER to undelete this key\n    Hit Ctrl-C to cancel the undelete\nPlease see documentation for caveats on the undelete process as well as how to\nactually delete it.\n</code></pre> <p>(Go ahead and hit ENTER there; the caveats are really only on the administrative side of things.)</p> <p>Listing the keys shows that that new key is now marked active again:</p> <pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list\nhello jeff, you are currently using a normal (\"active\") key\nyou have the following keys:\n== active keys ==\n1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub\n2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub\n3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub\n4: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub\n</code></pre>"},{"location":"contrib/sskm.html#important-notes-for-the-admin","title":"important notes for the admin","text":"<p>These are the things that can break if you allow your users to use this command:</p> <ul> <li> <p>\"sskm\" clones, changes, and pushes back the gitolite-admin repo.  This     means, even if you're the only administrator, you should never 'git push     -f', in case you end up overwriting something sskm did.</p> </li> <li> <p>There is no way to distinguish <code>foo/alice.pub</code> from <code>bar/alice.pub</code> using     this command.  You can distinguish <code>foo/alice.pub</code> from     <code>bar/alice@home.pub</code>, but that's not because of the foo and bar, it's     because the two files have different keyids.</p> <p>In other words, sskm only works with the older style, not with the \"subdirectory\" style of multi-key management.</p> </li> <li> <p>Keys placed in specific folders (for whatever reasons), will probably not     stay in those folders if this command is used.  Even a key delete, followed     by undoing the delete, will cause the key to effectively move to the root     of the key store (i.e., the <code>keydir</code> directory in the gitolite-admin repo).</p> </li> </ul>"},{"location":"contrib/ukm.html","title":"user key management","text":"<p>Copyright 2012-2013  Ralf Hemmecke ralf@hemmecke.org.</p> <p>Licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</p> <p>User key management allows certain users to add and remove keys.</p> <p>The key management is done using a command called <code>ukm</code>. This command must be enabled for remote use by both the sysadmin and the gitolite-admin (see here for more on this) or look below.</p>"},{"location":"contrib/ukm.html#important-warning","title":"Important Warning!","text":"<p>User key management undermines the fundamental principle of gitolite (see authentication versus authorisation) by allowing certain users to juggle with ssh public keys. Make sure someone (sysadmin?) can login to the server with a password, just in case something breaks and the <code>.ssh/authorized_keys</code> file for the user running gitolite on the server is messed up.</p>"},{"location":"contrib/ukm.html#general-note","title":"General note","text":"<p>Although gitolite deals in its core only with authorisation, by default it uses ssh as its authentication mechanism. Sure, ssh is not at all part of gitolite and it can be replaced by other means, but still there is a directory <code>gitolite-admin/keydir</code> that is reserved for public ssh keys.</p> <p>In fact, management of users and multiple keys per user is not actually a gitolite administration stuff. It's external to gitolite. In a future version, <code>ukm</code> could be used as an equivalent of the <code>keydir/</code> directory from the <code>gitolite-admin</code> repo (currently it just manages that directory) and thus <code>ukm</code> could be seen as such an external tool that does what its name suggests: user (key) management.</p> <p>In the following description we assume that there is an entry like</p> <pre><code>Host gitserver\n     IdentityFile ~/.ssh/id_rsa    # choose your gitolite key here\n     HostName gitolite.example.org # location where gitolite is installed\n     User git                      # user that runs gitolite\n</code></pre> <p>in the client's <code>~/.ssh/config</code> file.</p>"},{"location":"contrib/ukm.html#who-might-be-interested","title":"Who might be interested?","text":""},{"location":"contrib/ukm.html#the-gitolite-admin","title":"The gitolite admin","text":"<p>Adding a new public key to the system means to copy the key into <code>gitolite/keydir</code> commit and push.</p> <p>With <code>ukm</code> it would be</p> <pre><code>cat FOO.PUB | ssh gitserver ukm add KEYID\n</code></pre> <p>This would be a setup where only the gitolite administrator uses <code>ukm</code>. Not a big benefit, but <code>ukm</code> prevents adding identical keys under different userids. This consistency check might be an advantage. Furthermore, <code>ukm</code> does not allow the gitolite administrator to remove his/her last, i.e., it prevents the administrator from locking him-/herself out of the system. (Note, we assume that the gitolite administrator has no shell access to the server; only the sysadmin has shell access.)</p>"},{"location":"contrib/ukm.html#users-that-want-more-control-over-who-can-access-their-repositories","title":"Users that want more control over who can access their repositories","text":"<p>Suppose the gitolite administrator of a research institute has set up gitolite to provide wild repositories for example with a <code>gitolite.conf</code> like this.</p> <pre><code>repo gitolite-admin\n    RW+ = gitadmin\n\n# These people are allowed to create wild repositories.\n@creators = alice bob ...\n\n# wildcard repositories for the users\nrepo CREATOR/..*\n    C   = @creators\n    RW+ = CREATOR\n    RW  = WRITERS\n    R   = READERS\n</code></pre> <p>Researchers Alice and Bob want to write an article together. Alice creates a wild repository <code>alice/article</code> and adds Bob via the perms command to the WRITERS of her repository. After a while they realize that Otto from another institute would be a reasonable third author. However, if they cannot give him write access to the repository, they would have to exchange the article via email. Back to the stone age? Better, Alice asks Otto to send her his public ssh key. Alice then forwards that key to the gitolite administrator and asks him to include that key into the system. (Hopefully, all that didn't happen on a holiday or on the weekend.) After 3 days the gitolite administrater finds some time. Since he doesn't know Otto, he simply trusts Alice and adds the public key into the system.</p> <p>With <code>ukm</code> Alice can save bothering the gitolite administrator and is perhaps even faster in saying:</p> <pre><code>cat otto.pub | ssh gitserver ukm add otto@other.institute.edu\nssh gitserver perms alice/article + WRITERS otto@other.institute.edu\n</code></pre> <p>The effect would be the same.</p>"},{"location":"contrib/ukm.html#users-that-want-to-manage-multiple-keys","title":"Users that want to manage multiple keys","text":"<p>Suppose, you have different computers and a different ssh key for each of them. You would like to tell gitolite that all these different keys belong to just one gitolite identity.</p> <p>Your gitolite administrator creates your gitolite identity with one of your keys as your initial key. This key can only be managed by the gitolite administrator, not by you. It basically determines under which name you are known to gitolite.</p> <p>You can add new keys to this identity and remove them at your will.</p>"},{"location":"contrib/ukm.html#how-to-enable-user-key-management","title":"How to enable user key management?","text":"<p>The <code>ukm</code> command is contributed code and lives under <code>contrib/commands/ukm</code> in the gitolite source tree. A sysadmin of the gitserver has to copy or link this script to the right location.</p> <pre><code>cd src/commands\nln -s ../../contrib/commands/ukm .\n</code></pre> <p>Furthermore, a sysadmin must add the string <code>'ukm'</code> to the <code>ENABLE</code> array, i.e.,</p> <pre><code>ENABLE =&gt; [ ..., 'ukm', ... ],\n</code></pre> <p>in .gitolite.rc. (That's the preferred way for gitolite starting with version v3.4.)</p> <p>Instead of the above (in particular in gitolite v3.0-v3.3), add <code>'ukm' =&gt; 1</code> to the <code>COMMANDS</code> hash.</p> <pre><code>COMMANDS =&gt; {..., 'ukm' =&gt; 1, ... },\n</code></pre>"},{"location":"contrib/ukm.html#how-to-configure-user-key-management-and-who-can-use-it","title":"How to configure user key management and who can use it?","text":"<p>As described above there are three main use cases for <code>ukm</code>. Each of them requires different values in the respective config files.</p> <p>There are two files where <code>ukm</code> must be configured.</p> <ul> <li>.gitolite.rc (managed by a sysadmin of the gitserver)</li> <li><code>gitolite-admin/conf/gitolite.conf</code> (managed by a     gitolite administrator)</li> </ul> <p>Besides sysadmin and gitolite administrator, <code>ukm</code> knows 3 roles.</p> <ul> <li>super key manager</li> <li>guest key manager</li> <li>self key manager</li> </ul>"},{"location":"contrib/ukm.html#super-key-managers","title":"Super key managers","text":"<p>When <code>ukm</code> is enabled, nothing else must be configured.</p>"},{"location":"contrib/ukm.html#guest-key-managers","title":"Guest key managers","text":"<p>The gitolite administrator defines guest key managers by creating a group <code>@guest-key-managers</code> in <code>gitolite-admin/conf/gitolite.conf</code> and adding (trusted) users to this group.</p> <p>WARNING: If the gitolite administrator includes <code>@all</code> into this list, it allows guests to add new public keys. If, additionally, there is <code>@creators=@all</code>, it basically allows the initial guest key managers to start a hierarchy of new users with the same rights as the initial users.</p> <p>The system administrator must configure <code>ukm</code> for guest key managers in .gitolite.rc by adding something like</p> <pre><code>UKM_CONFIG =&gt; { FORBIDDEN_GUEST_PATTERN =&gt; qr(FORBIDDEN-PATTERN), },\n</code></pre> <p>to the <code>%RC</code> hash.</p> <p>If <code>FORBIDDEN_GUEST_PATTERN</code> is missing, it defaults to the following.</p> <pre><code>FORBIDDEN_GUEST_PATTERN =&gt; qr(.)\n</code></pre> <p>Any KEYID that matches this pattern is rejected, i.e., the default value basically allows only the super key managers to add/del keys.</p> <p>If <code>ukm</code> is supposed to work for guest key managers, <code>FORBIDDEN_GUEST_PATTERN</code> must be set to some reasonable value.</p> <p>If your company has email addresses of the form <code>first.last@company.com</code> you might want to write something like this</p> <pre><code>UKM_CONFIG =&gt; { FORBIDDEN_GUEST_PATTERN =&gt; qr(@company.com$) },\n</code></pre> <p>which would only allow KEYIDs in the form of email addresses that do not come from your company.</p> <p>For the very brave only!!!</p> <p>The variable <code>REQUIRED_GUEST_PATTERN</code> is optional. It is strongly discouraged to set it. However, if you know, what you are doing, it allows for a bit more flexibility.</p> <p>Don't complain if you modify the default value!!!</p> <p><code>REQUIRED_GUEST_PATTERN</code> defaults to a regular expression that only allows KEYIDs in the form of email addresses (see the source code if you want to see this regular expression).</p> <p>You can write</p> <pre><code>UKM_CONFIG =&gt; {\n    REQUIRED_GUEST_PATTERN  =&gt; qr(REQUIRED-PATTERN),\n    FORBIDDEN_GUEST_PATTERN =&gt; qr(FORBIDDEN-PATTERN),\n},\n</code></pre> <p>with the meaning that the KEYID must match</p> <pre><code>qr(^(REQUIRED-PATTERN)$)\n</code></pre> <p>(note that <code>^</code> and <code>$</code> are automatically added to the pattern) and must not match</p> <pre><code>qr(FORBIDDEN-PATTERN)\n</code></pre> <p>in order for <code>ukm</code> to proceed with this KEYID for a guest key manager.</p> <p>Gitolite's namespace for USERIDs is flat. The <code>REQUIRED_GUEST_PATTERN</code> and <code>FORBIDDEN_GUEST_PATTERN</code> serve two purposes.</p> <ol> <li> <p>Restrict permissions for what guest key managers can      do.</p> </li> <li> <p>Patterns that cannot be used for guests can still be used by      super key managers. In other words, those patterns are      reserved for in-house USERIDs.</p> </li> </ol>"},{"location":"contrib/ukm.html#self-key-managers","title":"Self key managers","text":"<p>The gitolite administrator defines self key managers by creating a group <code>@self-key-managers</code> in <code>gitolite-admin/conf/gitolite.conf</code> and adding (trusted) users to this group.</p> <p>WARNING: A gitolite administrator shouldn't include <code>@all</code> into this list. If guest key management is enabled, then also guests would be allowed to add their own keys. Since guest key managers would have no access to those keys, only gitolite administrators would be able to remove those additional keys. In fact, <code>ukm</code> was designed to allow only one key per guest. Don't complain, if you enable a setup where guests can have multiple keys. It's a security issue. (Suppose Alice has added a guest <code>foo@example.org</code> and MrBad generates a new ssh key and adds it under <code>foo@example.org@attacker</code> to the list of his guests. That would give MrBad all the permissions that <code>foo@example.org</code> has.)</p> <p>The system administrator must enable <code>ukm</code> for self key managers in .gitolite.rc by adding</p> <pre><code>UKM_CONGFIG =&gt; { SELFKEY_MANAGEMENT =&gt; 1, },\n</code></pre> <p>to the <code>%RC</code> hash.</p> <p>Since by design self keys start with an <code>@</code> sign, and thus cannot conflict with guest keys (which are not allowed to start with an <code>@</code>), there is no problem to enable self key and guest key management at the same time.</p> <pre><code>UKM_CONFIG =&gt; {\n    FORBIDDEN_GUEST_PATTERN =&gt; qr(FORBIDDEN-PATTERN),\n    SELFKEY_MANAGEMENT =&gt; 1,\n},\n</code></pre>"},{"location":"contrib/ukm.html#how-to-use-user-key-management","title":"How to use user key management?","text":"<p>There are three subcommands of <code>ukm</code>, namely <code>list</code> (the default),<code>add</code>, and <code>del</code>.</p> <p>Depending on whether or not the respective KEYID starts with an <code>@</code> sign, <code>ukm</code> distinguishes between guest and self key management. Self keys start with <code>@</code> and are followed by letters and/or digits.</p> <p>For super key managers there is not such a distinction. Rather, the KEYID is the full path of the actual public key file relative to <code>gitolite-admin/keydir/</code> with the <code>.pub</code> file extension removed.</p> <p>By convention, take as guest key the proper email address of the guest. That not only makes for a unique ID, it also gives you a hint to whom this key belongs.</p>"},{"location":"contrib/ukm.html#list-managed-keys","title":"List managed keys","text":"<p>A guest key manager and self key manager can list all their personally managed keys via:</p> <pre><code>ssh gitserver ukm\n</code></pre> <p>or</p> <pre><code>ssh gitserver ukm list\n</code></pre> <p>If this command is issued by a super key manager, it lists all keys that are stored under <code>keydir/</code>.</p> <p>The result will show the fingerprints of the keys, the corresponding USERID and the KEYID by which one can refer to the key on the commandline.</p>"},{"location":"contrib/ukm.html#add-a-new-public-key","title":"Add a new public key","text":""},{"location":"contrib/ukm.html#add-a-new-key-as-a-super-key-manager","title":"Add a new key as a super key manager","text":"<p>A super key manager can nearly add any key, but <code>ukm</code> does not accept a different key, i.e., different fingerprint, for the same KEYID. Also a double dot is not allowed in the KEYID.</p>"},{"location":"contrib/ukm.html#add-a-new-key-as-a-guest-key-manager","title":"Add a new key as a guest key manager","text":"<p>The command for this is:</p> <pre><code>cat foo.pub | ssh gitserver ukm add foo@example.com\n</code></pre> <p>There are several situations when the above command fails, i.e., rejects to add the key.</p> <ul> <li> <p>The KEYID <code>foo@example.com</code> does not match the pattern     given by <code>REQUIRED_GUEST_PATTERN</code> in <code>.gitolite.rc</code>.</p> </li> <li> <p>The KEYID <code>foo@example.com</code> matches the pattern given by     <code>FORBIDDEN_GUEST_PATTERN</code> in <code>.gitolite.rc</code>.</p> </li> <li> <p>The public key <code>foo.pub</code> is already known to the system and does     not belong to the USERID <code>foo@example.com</code>.</p> </li> <li> <p>The KEYID <code>foo@example.com</code> is already in use and it     corresponds to a key with another public key. In other words,     <code>ukm</code> will not simply override a key. One has to delete the old     key first and then add a new one.</p> </li> <li> <p>The KEYID contains a <code>/</code> character or two <code>@</code>     characters, i.e., guest key managers are not allowed to add     multiple keys for one user.</p> </li> </ul>"},{"location":"contrib/ukm.html#add-a-new-key-as-a-self-key-manager","title":"Add a new key as a self key manager","text":"<p>Adding a self key is a bit more complicated, since the user must confirm that he/she is in possession of the corresponding private key. The command sequence is as follows. Note that the second call of ssh is done with the key <code>foo</code> and not the default ssh key.</p> <pre><code>cat foo.pub | ssh gitserver ukm add @two &gt; session\ncat session | ssh -i foo gitserver ukm\n</code></pre> <p>If you don't want to create an intermediate file call it like this:</p> <pre><code>cat foo.pub | ssh gitserver ukm add @two | (sleep 2; ssh -i foo gitserver ukm)\n</code></pre> <p>Make sure that the second ssh call only happens after the fist one has done its job. Otherwise you might be asked for a password of the <code>git</code> user on the <code>gitserver</code>.</p> <p>After successfully completing the first ssh call, the new key is scheduled for addition and a session key is returned on stdin. That session key must be used to confirm the addition of the new public key as shown above.</p>"},{"location":"contrib/ukm.html#delete-a-key","title":"Delete a key","text":"<p>A super key manager can delete any key by simply giving its KEYID in a command like this</p> <pre><code>ssh gitserver ukm del some/dir/foo@example.com\n</code></pre> <p>The <code>ukm</code> command, however, prevents a super key manager from removing his/her last key.</p>"},{"location":"contrib/ukm.html#delete-a-guest-key","title":"Delete a guest key","text":"<p>The command for this is:</p> <pre><code>ssh gitserver ukm del foo@example.com\n</code></pre> <p>If the given KEYID is not among the managed keys of the user who issues the <code>del</code> command, the command will fail.</p> <p>IMPORTANT! You should not forget to remove from all of your repositories all the permissions you gave to <code>foo@example.com</code>, because this key might still be managed by another guest key manager.</p> <p>You might want to run</p> <pre><code>ssh gitserver info -lc \\\n| perl -e 'chomp($u=&lt;&gt;);$u=~s/hello //;$u=~s/,.*$//;' \\\n       -e 'while(&lt;&gt;){if(/\\s(\\S+)\\s+$u$/){print \"$1\\n\"}}' \\\n| while read r; do ssh gitserver perms $r - WRITERS foo@example.com; done\n</code></pre> <p>Repeat this for other roles such as <code>READERS</code> instead of <code>WRITERS</code>.</p>"},{"location":"contrib/ukm.html#delete-a-self-key","title":"Delete a self key","text":"<p>The command for this is:</p> <pre><code>ssh gitserver ukm del @two\nssh gitserver ukm del @two\n</code></pre> <p>Yes, you have to give that command twice. The first call will bring the key <code>@two</code> into a \"pending-del\" state. The second time, the command will only delete the key <code>@two</code>, if the login was not done with exactly that key. If logging in with the key corresponding to <code>@two</code>, it will bring back the <code>@two</code> key from its \"pending-del\" state to a non-pending state.</p> <p>Note: This safety net is not absolutely necessary, since a self key manager is not allowed to delete his/her initial key (added by the gitolite administrator). The command <code>ukm</code> wants to make sure that the user still has a key that can be used for login. (Think about having lost the passphrase for the initial key. -- Maybe this over complication will be simplified in the future. Losing a passphrase is not a good excuse and should result in removal of the corresponding key from the system, i.e., contacting the gitolite administrator.)</p>"},{"location":"contrib/ukm.html#generic-errors","title":"Generic Errors","text":"<p>Key management is done via creating a temporary clone of the <code>gitolite-admin</code> repository, changing, committing, and pushing back. In cases where two people are trying to modify the <code>gitolite-admin</code> repository at the same time, one of the push commands will most probably fail. Then simply redo the command after a while.</p>"},{"location":"contrib/ukm.html#glossary","title":"Glossary","text":"<ul> <li> <p>sysadmin:   A person who is able to edit the .gitolite.rc file on   the server machine.</p> </li> <li> <p>gitolite administrator:   A user with write access to the <code>gitolite-admin</code> repositoriy.</p> </li> <li> <p>super key manager:   A user who has write access to the <code>keydir/</code> inside the   <code>gitolite-admin</code> repository.   A gitolite administrator is always a super key manager.</p> </li> </ul> <p>Super key managers have no restriction on how KEYIDs must   look like. They can do (nearly) everything inside <code>keydir/</code> that a   gitolite administrator can do when pushing to the   <code>gitolite-admin</code> repository directly.</p> <ul> <li>guest key manager:   A user who is a member of the <code>@guest-key-managers</code> group.</li> </ul> <p>A guest key manager can manage a set of guest keys.</p> <ul> <li>self key manager:   A user who is a member of the <code>@self-key-managers</code> group.</li> </ul> <p>A self key manager can manage a set of his/her own keys.</p> <ul> <li>KEYID:   an identifier for a key given on the command line</li> </ul> <p>The KEYID is normalized to lowercase letters.</p> <p>If the script is called by one of the super key managers, then the   KEYID is the path to the pubkey file relative to the <code>keydir/</code>   without the <code>.pub</code> extension.</p> <p>If called by a guest key manager it's an email address and if called   by a self key manager, it's an alphanumeric identifier with an <code>@</code>   prepended.</p> <ul> <li>USERID:   The KEYID given on the command line will be translated   into a USERID which is used inside <code>conf/gitolite.conf</code> or for the   perms command of gitolite.</li> </ul>"},{"location":"contrib/ukm.html#security-note","title":"Security note","text":"<p> Super key managers can basically add any key. Guest key managers are not allowed to add multiple keys and this restriction is hardcoded.</p> <p>Suppose Alice adds <code>bob.pub</code> as <code>bob@example.org</code> and David adds <code>eve.pub</code> under the keyid <code>bob@example.org@foo</code>. (Of course, only Eve and not Bob has the private key correspoinding to <code>eve.pub</code>.) This basically gives Eve the same rights as Bob.</p>"},{"location":"contrib/ukm.html#important-notes-for-the-admin","title":"Important notes for the admin","text":"<p>Note that <code>ukm</code> clones, changes, and pushes back the <code>gitolite-admin</code> repo. This means, even if you are the only administrator, you should never <code>git push -f</code>, because that might override something <code>ukm</code> did.</p>"},{"location":"contrib/ukm.html#ideas","title":"Ideas","text":"<p>The command <code>ukm</code> has been created with also having the <code>keysubdirs-as-groups</code> syntactic sugar in mind. If a super key manager manages the respective keys in sub-directories with names <code>guest-key-managers/</code> and <code>self-key-managers/</code>, respectively, he/she can use the <code>ukm</code> command to control who is allowed to manage keys.</p>"}]}
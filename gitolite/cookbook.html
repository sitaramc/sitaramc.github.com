<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>gitolite cookbook</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style>
      body        { background: #fff; text-color: #000; margin-left:  40px;   font-size:  0.9em;  font-family: arial; }
  
      code        { font-size:    1.1em;  background:  #ddf; text-color: #000; }
      pre         { margin-left:  2em;    background:  #ddf; text-color: #000; }
      pre code    { font-size:    1.1em;  background:  #ddf; text-color: #000; }
  
      td          { vertical-align: top }
  
      .red        { color: red }
      .blue       { color: blue }
      .green      { color: green }
      .gray       { color: gray }
      .pink       { color: pink }
  
      .box        { background-color:#e0e0e0 }
      .bg-red     { background-color:#ffe0e0 }
      .bg-green   { background-color:#e0ffe0 }
      .bg-blue    { background-color:#e0e0ff }
  
      /* couldn't resist the name! */
      .wd40       { width: 40% !important }
  
      .box-l      { float: left;  padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-right: 4px; }
      .box-r      { float: right; padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-left:  4px; }
  
      .fl-l       { float: left;  padding: 0px 0.5em;                                       margin-right: 4px; }
      .fl-r       { float: right; padding: 0px 0.5em;                                       margin-left:  4px; }
  
      .sidebar {
          margin-left: 4px;
          width: 25%;
          float: right;
          border: 4px solid #fff;
      }
  
  </style>
  <style>
      h1          { background: #ffb; text-color: #000; margin-left: -30px;   border-top:    5px  solid #ccc; }
      h2          { background: #ffb; text-color: #000; margin-left: -20px;   border-top:    3px  solid #ddd; }
      h3          { background: #ffb; text-color: #000; margin-left: -10px; }
      h4          { background: #ffb; text-color: #000; }
  </style>
</head>
<body>
<!--
    generated by gvim then munged a fair bit.  The following command
        vim -E -c "TOhtml" -c "w" -c 'qa!' \-\- conf/gitolite.conf
    may or may not produce the same thing
-->

<style type="text/css">
<!--
.WarningMsg { color: #ff0000; }
.Constant { color: #ffa0a0; }
.Statement { color: #ffff60; font-weight: bold; }
.PreProc { color: #ff80ff; }
.LineNr { color: #ffff00; }
.Comment { color: #80a0ff; }
.Type { color: #60ff60; font-weight: bold; }
.Special { color: #ffa500; }
.Identifier { color: #40ffff; }
.Error { color: #ffffff; background-color: #ff0000; padding-bottom: 1px; }
.Todo { color: #0000ff; background-color: #ffff00; padding-bottom: 1px; }
-->
</style>
<div id="header">
<h1 class="title">gitolite cookbook</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#cb-admin"><span class="toc-section-number">1</span> administration</a><ul>
<li><a href="#separating-key-admin-from-repo-admin"><span class="toc-section-number">1.1</span> separating &quot;key admin&quot; from &quot;repo admin&quot;</a></li>
</ul></li>
<li><a href="#cb-access"><span class="toc-section-number">2</span> access</a><ul>
<li><a href="#looking-up-repo-access-from-external-tools"><span class="toc-section-number">2.1</span> looking up repo access from external tools</a></li>
<li><a href="#allowing-access-by-other-programs"><span class="toc-section-number">2.2</span> allowing access by other programs</a></li>
</ul></li>
<li><a href="#cb-commands"><span class="toc-section-number">3</span> commands</a><ul>
<li><a href="#adding-your-own-commands"><span class="toc-section-number">3.1</span> adding your own commands</a></li>
<li><a href="#making-commands-available-to-remote-users"><span class="toc-section-number">3.2</span> making commands available to remote users</a></li>
</ul></li>
<li><a href="#cb-hooks"><span class="toc-section-number">4</span> hooks</a><ul>
<li><a href="#adding-your-own-update-hooks"><span class="toc-section-number">4.1</span> adding your own update hooks</a></li>
<li><a href="#adding-other-non-update-hooks"><span class="toc-section-number">4.2</span> adding other (non-update) hooks</a></li>
<li><a href="#variation-maintain-these-hooks-in-the-gitolite-admin-repo"><span class="toc-section-number">4.3</span> variation: maintain these hooks in the gitolite-admin repo</a></li>
<li><a href="#v3.6-variation-repo-specific-hooks"><span class="toc-section-number">4.4</span> <span class="gray">(v3.6+)</span> variation: repo-specific hooks</a></li>
</ul></li>
<li><a href="#triggers"><span class="toc-section-number">5</span> triggers</a><ul>
<li><a href="#adding-your-own-triggers"><span class="toc-section-number">5.1</span> adding your own triggers</a></li>
</ul></li>
<li><a href="#cb-vrefs"><span class="toc-section-number">6</span> VREFs</a><ul>
<li><a href="#adding-your-own-vrefs"><span class="toc-section-number">6.1</span> adding your own VREFs</a></li>
<li><a href="#example-vrefs"><span class="toc-section-number">6.2</span> example VREFs</a><ul>
<li><a href="#example-1-restricting-by-day-of-week"><span class="toc-section-number">6.2.1</span> example 1: restricting by day of week</a></li>
<li><a href="#example-2-restricting-by-source-ip-address"><span class="toc-section-number">6.2.2</span> example 2: restricting by source IP address</a></li>
</ul></li>
</ul></li>
<li><a href="#wild-repos"><span class="toc-section-number">7</span> wild repos</a><ul>
<li><a href="#making-exceptions-for-specific-instances-of-a-wild-repo"><span class="toc-section-number">7.1</span> making exceptions for <em>specific</em> instances of a wild repo</a></li>
</ul></li>
<li><a href="#cb-move"><span class="toc-section-number">8</span> moving stuff around</a><ul>
<li><a href="#moving-a-gitolite-install-from-one-machine-to-another"><span class="toc-section-number">8.1</span> moving a gitolite install from one machine to another</a></li>
</ul></li>
</ul>
</div>
<blockquote>
<p><span class="gray">(a.k.a. &quot;shut up with all the rambling and just tell me the bare minimum I need to finish this!&quot;)</span></p>
</blockquote>
<script type="text/javascript">
<!--
    function hide_show(id) {
        var e = document.getElementById(id);
        if(e == null)
            return;
        if(e.style.display != 'none')
            e.style.display = 'none';
        else
            e.style.display = 'block';
    }

    window.onload = function() {
        var t = document.getElementById('TOC');
        var sbt = document.getElementById('SBTOC');
        var h = '<div id="PTOC">'
        var h2 = '<p><strong><span class="red">Page TOC</span></strong></p>'
        var h3 = '</div>'
        var h4 = '<div id="GTOC">'
        var h5 = '</div>'
        var hst = '<div style="background: white; color: green; border: 2px solid green"><center><font size=-1><strong>Hide/Show Table of Contents</strong><br />'
        var pd = '<a href="#" onclick="hide_show(\'PTOC\');">Page TOC</a> | '
        var gt = '<a href="#" onclick="hide_show(\'GTOC\');">Gitolite TOC</a></font></center></div>'

        if(t == null)
            sbt.innerHTML = hst + gt + h4 + sbt.innerHTML + h5;
        else {
            sbt.innerHTML = hst + pd + gt + h + h2 + t.innerHTML + h3 + h4 + sbt.innerHTML + h5;
            t.style.display = 'none';   // hide the TOC that pandoc placed
        }
    }
-->
</script>
<style>
    #PTOC ul {
        list-style: none;
        margin-left: 0;
        padding-left: 2em;
        text-indent: -2em;
        padding-bottom: 2em;
    }
    #PTOC ul li {
        padding-bottom: 10px;
    }
    #PTOC ul li ul {
        padding-bottom: 0px;
    }
    #PTOC ul li ul li {
        padding-bottom: 0px;
    }

    .sidebar-toc a:hover {
        background-color: white;
    }

    .sidebar-toc {
        margin-left: 4px;
        width: 25%;
        float: right;
        color: gray;
        background: lightgray;
        border: 4px solid #fff;
        font-size: 0.90em;
    }

    .sidebar-toc ul {
        padding-left: 2em;
    }

</style>
<div id="SBTOC" class="sidebar-toc">
<p><strong><span class="red">Gitolite TOC</span></strong></p>
<hr />
<center>
<span class="red"><strong>Background</strong></span>
</center>
<hr />
<p><a href="index.html">Main page</a></p>
<ul>
<li><a href="index.html#dl">download</a></li>
<li><a href="index.html#rtfm">documentation</a>
<ul>
<li><a href="gitolite.html"><strong>all-in-one</strong></a> page</li>
</ul></li>
<li><a href="index.html#trouble"><strong>troubleshooting</strong></a></li>
<li><a href="index.html#contact"><strong>contact and support</strong></a></li>
<li><a href="index.html#license">license</a></li>
</ul>
<p><a href="overview.html">Overview</a></p>
<ul>
<li>what is Gitolite?</li>
<li>why might you need it?</li>
<li>how does it work?</li>
<li>who uses it?</li>
</ul>
<p><a href="concepts.html">Concepts, conventions, and terminology</a></p>
<ul>
<li>authentication and authorisation</li>
<li>ssh mode and http mode</li>
<li>the &quot;hosting user&quot;</li>
<li>the &quot;logical repo name&quot;</li>
<li>the special gitolite-admin repo</li>
</ul>
<p><a href="req.html">Before you start...</a></p>
<ul>
<li>your skills</li>
<li>your server</li>
<li>your and your users' clients</li>
<li><strong>cautions and caveats</strong></li>
<li><a href="req.html#trying">trying</a> out gitolite safely</li>
</ul>
<hr />
<center>
<span class="red"><strong>Basics</strong></span>
</center>
<hr />
<p><a href="install.html">install and setup</a></p>
<ul>
<li><a href="install.html#qi">quick install+setup</a> (for experts)</li>
<li>the long way around</li>
<li><a href="install.html#upgrading">upgrading</a></li>
<li><a href="install.html#moving">moving servers</a></li>
</ul>
<p><a href="basic-admin.html">Basic Administration</a></p>
<ul>
<li>clone the gitolite-admin repo</li>
<li>add/remove users</li>
<li>add/remove/rename repos</li>
<li>bringing existing repos into gitolite</li>
</ul>
<p><a href="conf.html">The conf file (<code>conf/gitolite.conf</code>)</a></p>
<ul>
<li>basic <a href="conf.html#syntax">syntax</a></li>
<li><a href="conf.html#include">include</a> files</li>
<li><a href="conf.html#groups">group definitions</a></li>
<li><a href="conf.html#rules"><strong><span class="red">access rules</span></strong></a></li>
</ul>
<p><a href="rc.html">the rc file (<code>~/.gitolite.rc</code>)</a></p>
<p><a href="user.html">Your users' view</a> of gitolite</p>
<p>Troubleshooting</p>
<ul>
<li>help for <a href="emergencies.html">emergencies</a></li>
<li>the <a href="ips.html">fool-proof install guide</a></li>
<li>the gitolite &quot;<a href="cookbook.html">cookbook</a>&quot;</li>
</ul>
<hr />
<center>
<span class="red"><strong>Advanced</strong></span>
</center>
<hr />
<p>Advanced &quot;conf file&quot; use</p>
<ul>
<li>specifying <a href="git-config.html">git-config</a> keys and values</li>
<li>gitolite <a href="options.html">options</a></li>
<li><a href="wild.html"><strong>wild repos</strong></a> (user created repos)</li>
<li><a href="vref.html">virtual refs</a></li>
<li><a href="deleg.html">delegation</a> of admin duties</li>
<li><a href="gitweb-daemon.html">gitweb and git-daemon</a></li>
</ul>
<p>Special features/setups</p>
<ul>
<li><strong><a href="mirroring.html">mirroring</a></strong></li>
<li><a href="http.html">http</a> mode</li>
<li>using a <a href="cache.html">cache</a></li>
<li>(<a href="namespaces.html">namespaces</a>)</li>
<li><a href="locking.html">locking</a> binary files</li>
<li><a href="package.html">packaging</a> gitolite</li>
</ul>
<p>Customising gitolite</p>
<ul>
<li>core and <a href="non-core.html">non-core</a> gitolite</li>
<li><a href="dev-notes.html">writing your own</a> non-core programs</li>
<li>gitolite <a href="triggers.html">triggers</a></li>
<li><a href="list-non-core.html">list of non-core programs</a> shipped with gitolite</li>
</ul>
<hr />
<center>
<span class="red"><strong>Extras</strong></span>
</center>
<hr />
<p><a href="odds-and-ends.html">Odds and Ends</a></p>
<ul>
<li><a href="odds-and-ends.html#writable">disabling pushes</a> to take backups</li>
<li><a href="odds-and-ends.html#elsewhere">putting 'repositories' and '.gitolite' elsewhere</a></li>
<li><a href="odds-and-ends.html#keysonly">using pubkeys obtained from elsewhere</a></li>
<li><a href="odds-and-ends.html#gh">giving users their own repos</a></li>
<li><a href="odds-and-ends.html#server-side-admin">administering gitolite directly on the server</a></li>
</ul>
<p>Additional information/discussion</p>
<ul>
<li><a href="ssh.html">all about ssh and gitolite</a></li>
<li>Running the <a href="testing.html">test suite</a></li>
<li><a href="files.html">gitolite files and directories</a></li>
<li><a href="perf.html">gitolite performance</a></li>
<li><a href="migr.html">Migration</a></li>
<li><a href="http://sitaramc.github.com/gitolite/g2/master-toc.html">documentation for gitolite v2</a></li>
<li><a href="regex.html">regular expressions</a></li>
<li><a href="no-way.html">no way!</a></li>
</ul>
<hr />
<center>
<span class="red"><strong>Contributed docs</strong></span>
</center>
<hr />
<p>Contributed software, tools, and documentation</p>
<ul>
<li><a href="ssh-and-http.html">combining ssh and http mode</a></li>
<li><a href="putty.html">putty and msysgit</a></li>
<li><a href="sskm.html">changing keys -- self service key management</a></li>
<li><a href="ukm.html">user key management</a></li>
<li><a href="README-emacs.html">emacs</a> &quot;major mode&quot;</li>
</ul>
</div>
<p><span class="box-r">Note: This page has several <a href="index.html#fr">forward references</a>. Skip it, or maybe skim through it, on a first reading. It's more of a &quot;look at it when I have a specific need&quot; page anyway.</span></p>
<p>Documentation is meant to be as complete as possible, which means it attempts to cover all situations and scenarios. That makes it harder to read.</p>
<p>However, if you make some assumptions, remove the rationale, justification, exceptions and special cases, etc., and generally just say <em>what</em> is to be done rather than explain <em>why</em>, many tasks can be described very easily.</p>
<p>Or, if the main documentation already does that, a cookbook may help you find it faster, simply because it's organised differently.</p>
<p>Maybe this will help. If you run into problems, please check the main documentation before asking for help.</p>
<h1 id="cb-admin"><span class="header-section-number">1</span> administration</h1>
<h2 id="separating-key-admin-from-repo-admin"><span class="header-section-number">1.1</span> separating &quot;key admin&quot; from &quot;repo admin&quot;</h2>
<p>In gitolite, the person who controls the keys is the most critical in terms of security -- because he can always add his own key in your name :-)</p>
<table>
<tr>
<td>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>gitolite-admin
<span class="Statement">    RW+</span><span class="Constant"> </span>= key-manager repo-manager

<span class="Statement">    RW+</span><span class="Constant"> VREF/NAME/                    </span>= key-manager
<span class="Statement">    -</span><span class="Constant">   VREF/NAME/keydir/             </span>=<span class="WarningMsg"> @all</span>
<span class="Statement">    -</span><span class="Constant">   VREF/NAME/conf/gitolite.conf  </span>=<span class="WarningMsg"> @all</span>

<span class="PreProc">include </span><span class="Constant">&quot;actual.conf&quot;</span>
</pre>
</td>
<td>
<p>Traditionally, the same person also administers repos and permissions. But sometimes you want to separate them.</p>
<p>To separate those roles, put the following in conf/gitolite.conf, and let the repo-manager manage everything through &quot;actual.conf&quot;:</p>
</td>
</tr>
</table>
<h1 id="cb-access"><span class="header-section-number">2</span> access</h1>
<h2 id="looking-up-repo-access-from-external-tools"><span class="header-section-number">2.1</span> looking up repo access from external tools</h2>
<p>There are two supported interfaces for this, one in perl and one in shell. Other languages should probably use the shell mode. (The shell mode has a very convenient &quot;batch&quot; mode if you need to check many repos at once).</p>
<p><strong>Perl interface</strong>: A good intro to this, including a link to code, using gitweb as an example can be found by looking for 'repo-specific authorisation in gitweb' in the page on <a href="gitweb-daemon.html">allowing access to gitweb and git-daemon</a>. Some notes:</p>
<ul>
<li>be sure to read the comments in the code to learn exactly how to adapt it to your needs</li>
<li>in place of the <code>can_read</code> function in that code, you can of course use <code>can_write</code>. In fact, reading the comments in &quot;Easy.pm&quot; (look for it in the source) shows you several other interesting tests you can make, like <code>is_admin</code>, <code>in_group</code>, and <code>owns</code>.</li>
</ul>
<p><strong>Shell interface</strong>: If you want to do this from shell, it's even easier. The same &quot;Easy.pm&quot; source contains comments that show shell equivalents for each of the functions it exports, but here's a sample:</p>
<pre><code>if gitolite access -q reponame username W
then
    ...</code></pre>
<p>You can even test for access to specific branches:</p>
<pre><code>if gitolite access -q reponame username W master
then
    ...</code></pre>
<p><span class="gray">If your gitolite is older than v3.6, you must use the full ref name; just 'master' won't do.</span></p>
<h2 id="allowing-access-by-other-programs"><span class="header-section-number">2.2</span> allowing access by other programs</h2>
<p>Giving external tools (like apache) access to gitolite repositories involves making sure that the unix owner/group and permissions settings allow this. This is all described in the UMASK section in the page on the <a href="rc.html">rc file</a>, because that's the only setting that gitolite controls; every thing else is pure Unix.</p>
<h1 id="cb-commands"><span class="header-section-number">3</span> commands</h1>
<h2 id="adding-your-own-commands"><span class="header-section-number">3.1</span> adding your own commands</h2>
<p>To add a command, say <code>foo</code>, do this:</p>
<ol style="list-style-type: decimal">
<li><p>add this line in the rc file, within the <code>%RC</code> block, if it's not already present, or uncomment it if it's already present and commented out:</p>
<pre><code>LOCAL_CODE =&gt; &quot;$ENV{HOME}/local&quot;,</code></pre></li>
<li><p>copy the program <code>foo</code> into <code>$HOME/local/commands</code>. (Don't forget the <code>chmod +x</code>!)</p></li>
</ol>
<h2 id="making-commands-available-to-remote-users"><span class="header-section-number">3.2</span> making commands available to remote users</h2>
<p>Once you do the above, <code>foo</code> is available as <code>gitolite foo</code>. To make it available to remote users (as <code>ssh git@host foo</code>), add the line:</p>
<pre><code>`foo`,</code></pre>
<p>(including the comma at the end) to the ENABLE list in the rc file.</p>
<h1 id="cb-hooks"><span class="header-section-number">4</span> hooks</h1>
<p>The main documentation for this feature starts <a href="non-core.html#hooks">here</a>.</p>
<h2 id="adding-your-own-update-hooks"><span class="header-section-number">4.1</span> adding your own update hooks</h2>
<p>You have some update hooks (for example crlf checking) that you want to include in gitolite. Assuming the hook itself is tested and works as a normal <strong>git</strong> update hook does (i.e., conforms to what <code>man githooks</code> says an update hook should do), here's how to do this:</p>
<ol style="list-style-type: decimal">
<li><p>add this line in the rc file, within the <code>%RC</code> block, if it's not already present, or uncomment it if it's already present and commented out:</p>
<pre><code>LOCAL_CODE =&gt; &quot;$ENV{HOME}/local&quot;,</code></pre></li>
<li><p>copy your update hook to a subdirectory called VREF under this directory, giving it a suitable name (let's say &quot;crlf&quot;):</p>
<pre><code># log on to server
cd $HOME
mkdir -p local/VREF
cp your-crlf-update-hook local/VREF/crlf
chmod +x local/VREF/crlf</code></pre></li>
<li><p>in your gitolite-admin clone, edit conf/gitolite.conf and add lines like this:</p>
<pre><code>    -   VREF/crlf       =   @all</code></pre>
<p>to each repo that should have that &quot;update&quot; hook.</p>
Alternatively, you can simply add this at the end of the gitolite.conf file:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">    repo </span><span class="Identifier">@all</span>
<span class="Statement">        -</span><span class="Constant">   VREF/crlf       </span>=<span class="WarningMsg">   @all</span>
</pre>
<p>Either way, add/commit/push the change to the gitolite-admin repo.</p></li>
</ol>
<h2 id="adding-other-non-update-hooks"><span class="header-section-number">4.2</span> adding other (non-update) hooks</h2>
<p>Say you want other hooks, like a post-receive hook. Here's how:</p>
<ol style="list-style-type: decimal">
<li><p>add this line in the rc file, within the <code>%RC</code> block, if it's not already present, or uncomment it if it's already present and commented out:</p>
<pre><code>LOCAL_CODE =&gt; &quot;$ENV{HOME}/local&quot;,</code></pre></li>
<li><p>put your hooks into that directory, in a sub-sub-directory called &quot;hooks/common&quot;:</p>
<pre><code># log on to server
cd $HOME
mkdir -p local/hooks/common
cp your-post-receive-hook local/hooks/common/post-receive
chmod +x local/hooks/common/post-receive</code></pre></li>
<li><p>run <code>gitolite setup</code> to have the hooks propagate to existing repos (repos created after this will get them anyway).</p></li>
</ol>
<h2 id="variation-maintain-these-hooks-in-the-gitolite-admin-repo"><span class="header-section-number">4.3</span> variation: maintain these hooks in the gitolite-admin repo</h2>
<p>If you want to maintain these update hooks (VREFs) or non-update hooks (post-update, pre-receive, post-receive) in the gitolite-admin repo, instead of having to log on to the server and make changes, the procedure is almost the same except for the following differences:</p>
<ol style="list-style-type: decimal">
<li><p>add this line in the rc file, within the <code>%RC</code> block, if it's not already present, or uncomment it if it's already present and commented out:</p>
<pre><code>LOCAL_CODE =&gt; &quot;$rc{GL_ADMIN_BASE}/local&quot;,</code></pre>
<p>Notice &quot;local&quot; is <em>not</em> in $HOME like in the previous examples!</p></li>
<li><p>the hooks/scripts are to be added inside your gitolite-admin clone, not on the server. That is, whereever the above two sections say &quot;cd $HOME&quot;, you should read it as &quot;cd /path/to/your/gitolite-admin-clone&quot;.</p></li>
<li><p>add/commit/push as usual.</p></li>
</ol>
<p>For update hooks, you will of course need to add VREF rule lines to appropriate repos in the conf file. For non-update hooks, you <strong>don't</strong> need to run 'gitolite setup' on the server; the push takes care of that.</p>
<h2 id="v3.6-variation-repo-specific-hooks"><span class="header-section-number">4.4</span> <span class="gray">(v3.6+)</span> variation: repo-specific hooks</h2>
<p>Until now, the non-update hooks you specified apply to all repos. Here's how to apply them only to certain repos:</p>
<ol style="list-style-type: decimal">
<li><p>add this line in the rc file, within the <code>%RC</code> block, if it's not already present, or uncomment it if it's already present and commented out:</p>
<pre><code>LOCAL_CODE =&gt; &quot;$rc{GL_ADMIN_BASE}/local&quot;,</code></pre></li>
<li><p>uncomment the 'repo-specific-hooks' line in the rc file or add it to the ENABLE list if it doesn't exist.</p>
<p>If your rc file does not have an ENABLE list, you need to add this to the POST_COMPILE and the POST_CREATE lists. Click <a href="triggers.html#addtrig">here</a> for more on all this.</p></li>
<li><p>put your hooks into your gitolite-admin clone, as follows:</p>
<pre><code># on your workstation
cd /path/to/your/gitolite-admin-clone
mkdir -p local/hooks/repo-specific</code></pre>
<p>Now add your hooks to that directory, but instead of using the git &quot;standard&quot; names (pre-receive, post-receive, post-update), you use descriptive names (e.g. &quot;deploy&quot;, &quot;RSS-post&quot;, etc).</p>
<p><strong>For pre-receive or pre-auto-gc you should not use more than one hook. If you really need more than one, ask on the mailing list.</strong></p></li>
<li><p>add them to the repos you want them to be active in, in your conf file. For example:</p>
<pre><code>repo foo
    option hook.post-update     =   jenkins
repo bar @baz
    option hook.post-update     =   deploy RSS-post</code></pre></li>
<li><p>add, commit, and push the admin repo.</p></li>
</ol>
<h1 id="triggers"><span class="header-section-number">5</span> triggers</h1>
<h2 id="adding-your-own-triggers"><span class="header-section-number">5.1</span> adding your own triggers</h2>
<p>First, write your trigger code, using the documentation <a href="triggers.html">here</a>. Note especially the sections &quot;common arguments&quot; and &quot;trigger-specific arguments&quot;. Look in the shipped triggers for ideas.</p>
<p>Let's say your trigger is called <code>foo</code>, and it will be a <code>PRE_GIT</code> trigger.</p>
<ol style="list-style-type: decimal">
<li><p>add this line in the rc file, within the <code>%RC</code> block, if it's not already present, or uncomment it if it's already present and commented out:</p>
<pre><code>LOCAL_CODE =&gt; &quot;$ENV{HOME}/local&quot;,</code></pre></li>
<li><p>copy the program <code>foo</code> into <code>$HOME/local/triggers</code>. (Don't forget the <code>chmod +x</code>!)</p></li>
<li><p>edit <code>~/.gitolite.rc</code> again, and look for a <code>PRE_GIT</code> section. If it exists, add <code>'foo',</code> (note the trailing comma!) to it. If it does not exist, add this block just before the <code>ENABLE</code> section:</p>
<pre><code>PRE_GIT =&gt;
[
    'foo'
],</code></pre>
<p>(again, note the trailing comma at the end of the block!)</p>
<p>After saving the file test that this went through by running <code>gitolite query-rc PRE_GIT</code>; your <code>foo</code> should be in the output list. If it's not, back up and double check your work.</p></li>
</ol>
<p>That should be it.</p>
<h1 id="cb-vrefs"><span class="header-section-number">6</span> VREFs</h1>
<h2 id="adding-your-own-vrefs"><span class="header-section-number">6.1</span> adding your own VREFs</h2>
<p>Adding VREFs is the same as adding the update hook, so please see the section on &quot;adding your own update hooks&quot; above.</p>
<h2 id="example-vrefs"><span class="header-section-number">6.2</span> example VREFs</h2>
<p>However, <em>writing</em> a proper VREF is not the same as writing a normal git &quot;update hook&quot;. A proper VREF does more than just take 3 arguments, do something, and exit with a non-zero exit code for failure.</p>
<p>A VREF is called with at least 4 more arguments after the 3 that git itself defines for an update hook, plus usually at least one or two more. It also returns a lot more meaningful results via STDOUT.</p>
<p>Here are some examples. I also advise you to keep a browser tab open to the doc on <a href="vref.html#vref-args">VREF arguments</a> as you look at these.</p>
<h3 id="example-1-restricting-by-day-of-week"><span class="header-section-number">6.2.1</span> example 1: restricting by day of week</h3>
<p>Here's the conf extract to say &quot;junior devs can only push on weekdays&quot;:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>foo
<span class="Statement">    -</span><span class="Constant">   VREF/DAY/Sat    </span>=<span class="WarningMsg">   @junior-devs</span>
<span class="Statement">    -</span><span class="Constant">   VREF/DAY/Sun    </span>=<span class="WarningMsg">   @junior-devs</span>
</pre>
<p>The code for this VREF is ridiculously simple:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Comment">#!/bin/bash</span>
echo VREF/DAY/`date +%a`
</pre>
<p>On encountering the VREF rules (i.e., when a junior dev tries to access this repo), gitolite calls the &quot;DAY&quot; VREF-maker. The code within the VREF maker simply echoes something like &quot;VREF/DAY/Mon&quot;, where the last part is whatever the actual day of the week happens to be.</p>
<p>This output is then treated as a virtual ref and matched against the rules. On a Monday to Friday, nothing happens, because the VREFs generated do not match any deny rules (or indeed any rules at all). On weekends, they do match, and the access is denied.</p>
<h3 id="example-2-restricting-by-source-ip-address"><span class="header-section-number">6.2.2</span> example 2: restricting by source IP address</h3>
<p>This one restricts junior developers to access this repo only from a specific network block. The conf file here is slightly different. We know that the VREF-maker will return with <em>some</em> network address (as you'll see in the code later), so we set it up so that the correct network block is allowed and anything else is disallowed:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>foo
<span class="Statement">    RW+</span><span class="Constant"> VREF/FROM/192.168.48.0/23   </span>=   <span class="Identifier">@junior-devs</span>
<span class="Statement">    -</span><span class="Constant">   VREF/FROM                   </span>=<span class="WarningMsg">   @junior-devs</span>
</pre>
<p>The code is not that complex. We take the user's actual IP address (this is available as the first word in <code>$SSH_CONNECTION</code> for ssh users, and for smart-http users, gitolite fakes it and creates that variable!). We then treat the &quot;23&quot; in the VREF rule, which appears to the code as <code>$9</code>, as the number of bits in the network address, then compute the network address for the users IP with that number of bits.</p>
<p>This network address is then sent back. (The <code>$9</code> is added back at the end, but this is only to enable it to match the VREF rule).</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Comment">#!/bin/bash</span>

<span class="Comment"># exit if no arguments were supplied to the VREF.  This covers the</span>
<span class="Comment"># second VREF rule in the conf above</span>
[ -n <span class="Constant">&quot;$8&quot;</span> ] || exit 0

from=${SSH_CONNECTION%% *}

eval `ipcalc -n $from/$9`      <span class="Comment"> # sets env var &quot;NETWORK&quot;</span>

echo VREF/FROM/$NETWORK/$9
</pre>
<p>For a source IP of 192.168.49.97, this runs <code>ipcalc -n 192.168.49.97/23</code>, which gives the network address 192.168.48.0. The echo then just sends back VREF/FROM/192.168.48.0/23. This VREF matches the RW+ line.</p>
<p>But if the IP is, say, 192.168.45.67, running <code>ipcalc -n 192.168.45.67/23</code> gives you 192.168.44.0. The echo then send back VREF/FROM/192.18.44.0/23, which won't match the RW+ line, but will match the next one and thus deny access.</p>
<p>(One thing that may not be obvious in this specific example is that you have to be careful when constructing the VREF rule. For any VREF/FROM/A/B, the result of running <code>ipcalc -n A/B</code> must be A, otherwise this won't work. That is, the bits of the network address after the network bits must be zero).</p>
<h1 id="wild-repos"><span class="header-section-number">7</span> wild repos</h1>
<h2 id="making-exceptions-for-specific-instances-of-a-wild-repo"><span class="header-section-number">7.1</span> making exceptions for <em>specific</em> instances of a wild repo</h2>
<p>Sometimes you want to specify rules or config for specific instances of a wild repo, while still leaving it to be created by a user in the normal way.</p>
<p>This <strong>will not</strong> work:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span><span class="Special">foo/..*</span>
<span class="Statement">    C</span><span class="Constant">                   </span>=   blah blah
<span class="Statement">    RW+</span><span class="Constant">                 </span>=   <span class="PreProc">CREATOR</span>
<span class="Statement">    RW</span><span class="Constant">                  </span>=   <span class="PreProc">WRITERS</span>
<span class="Statement">    R</span><span class="Constant">                   </span>=   <span class="PreProc">READERS</span>

<span class="Comment"># this does </span><span class="Todo">NOT</span><span class="Comment"> work</span>
<span class="Type">repo </span>foo/special-1
<span class="Statement">    RW+</span><span class="Constant">                 </span>=   sitaram
    option  foo.bar     =   baz
</pre>
<p>The repo will be created as a <strong>normal</strong> (not wild) repo as soon as you push, which means you can't run the <a href="user.html#perms">perms</a> command on it to add people to the READERS and WRITERS <a href="wild.html#roles">roles</a>, or do other things that wild repos allow.</p>
<p>The mental nudge you need to deal with this is to think what you would do if you had to write the same rule for more than one repo, say, any repo starting with &quot;foo/special-&quot; followed by a number. You'd use a pattern. And a pattern prevents an ordinary repo from being created.</p>
<p>So do this:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Comment"># this will work</span>
<span class="Type">repo </span><span class="Special">foo/special-[1]</span>
<span class="Statement">    RW+</span><span class="Constant">                 </span>=   sitaram
    option  foo.bar     =   baz
</pre>
<p>Using a pattern for just one repo might sound like a kludge, but it's perfectly valid and supported.</p>
<p>Note that you do NOT need a &quot;C&quot; rule in there, since the pattern is a subset of the previous one (<code>foo/..*</code>), everything there applies to this repo also. If you're not sure why that is, you may need to read up on <a href="conf.html#accum">rule accumulation</a>.</p>
<h1 id="cb-move"><span class="header-section-number">8</span> moving stuff around</h1>
<h2 id="moving-a-gitolite-install-from-one-machine-to-another"><span class="header-section-number">8.1</span> moving a gitolite install from one machine to another</h2>
<p>See <a href="install.html#moving">moving servers</a>.</p>
</body>
</html>

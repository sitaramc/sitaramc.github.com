<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>locking binary files - Gitolite</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="css/gitolite.css" rel="stylesheet">

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="index.html">Gitolite</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="index.html" class="nav-link">home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">what/why <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="overview.html" class="dropdown-item">overview</a>
</li>
                                    
<li>
    <a href="concepts.html" class="dropdown-item">concepts, conventions, terminology</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">install and setup <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="quick_install.html" class="dropdown-item">(unix/ssh experts) quick install and setup</a>
</li>
                                    
<li>
    <a href="install.html" class="dropdown-item">normal ssh mode install and setup</a>
</li>
                                    
<li>
    <a href="fool_proof_setup.html" class="dropdown-item">(if all else fails) fool-proof, step-by-step, install and setup</a>
</li>
                                    
<li>
    <a href="http.html" class="dropdown-item">HTTP mode install</a>
</li>
                                    
<li>
    <a href="migr.html" class="dropdown-item">migrating from v2</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">use <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">basic</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="basic-admin.html" class="dropdown-item">basic administration</a>
</li>
            
<li>
    <a href="conf.html" class="dropdown-item">the "conf" file (part 1)</a>
</li>
            
<li>
    <a href="conf-2.html" class="dropdown-item">the "conf" file (part 2)</a>
</li>
            
<li>
    <a href="rc.html" class="dropdown-item">the "rc" file</a>
</li>
            
<li>
    <a href="user.html" class="dropdown-item">your users' view</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">advanced</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="git-config.html" class="dropdown-item">setting git-config values</a>
</li>
            
<li>
    <a href="options.html" class="dropdown-item">gitolite options</a>
</li>
            
<li>
    <a href="wild.html" class="dropdown-item">ad hoc user-created ("wild") repos</a>
</li>
            
<li>
    <a href="templates.html" class="dropdown-item">using templates</a>
</li>
            
<li>
    <a href="vref.html" class="dropdown-item">virtual refs (part 1)</a>
</li>
            
<li>
    <a href="vref-2.html" class="dropdown-item">virtual refs (part 2)</a>
</li>
            
<li>
    <a href="deleg.html" class="dropdown-item">delegation of admin duties</a>
</li>
            
<li>
    <a href="gitweb-daemon.html" class="dropdown-item">gitweb and git-daemon</a>
</li>
            
<li>
    <a href="mirroring.html" class="dropdown-item">mirroring</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">customise</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="non-core.html" class="dropdown-item">core and "non-core" gitolite</a>
</li>
            
<li>
    <a href="dev-notes.html" class="dropdown-item">writing your own non-core code</a>
</li>
            
<li>
    <a href="triggers.html" class="dropdown-item">gitolite triggers</a>
</li>
            
<li>
    <a href="list-non-core.html" class="dropdown-item">list of non-core programs shipped with gitolite</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="cookbook.html" class="dropdown-item">(quick! how do I...) the cookbook</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">HELP! <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="emergencies.html" class="dropdown-item">emergency!!</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">ssh</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="ssh.html" class="dropdown-item">ssh</a>
</li>
            
<li>
    <a href="glssh.html" class="dropdown-item">how gitolite uses ssh</a>
</li>
            
<li>
    <a href="sts.html" class="dropdown-item">ssh troubleshooting</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="regex.html" class="dropdown-item">regular expressions</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">other docs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="odds-and-ends.html" class="dropdown-item">miscellaneous features</a>
</li>
                                    
<li>
    <a href="namespaces.html" class="dropdown-item">using git namespaces</a>
</li>
                                    
<li>
    <a href="locking.html" class="dropdown-item active">locking binary files</a>
</li>
                                    
<li>
    <a href="testing.html" class="dropdown-item">testing gitolite</a>
</li>
                                    
<li>
    <a href="package.html" class="dropdown-item">packaging gitolite</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">more about gitolite</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="files.html" class="dropdown-item">gitolite files & directories</a>
</li>
            
<li>
    <a href="rc-33.html" class="dropdown-item">the 3.3 format rc file</a>
</li>
            
<li>
    <a href="perf.html" class="dropdown-item">performance</a>
</li>
            
<li>
    <a href="internals.html" class="dropdown-item">internals</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">contrib</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="contrib/ssh-and-http.html" class="dropdown-item">Using both ssh and http</a>
</li>
            
<li>
    <a href="contrib/putty.html" class="dropdown-item">Putty and Msysgit</a>
</li>
            
<li>
    <a href="contrib/sskm.html" class="dropdown-item">Self-service key management</a>
</li>
            
<li>
    <a href="contrib/ukm.html" class="dropdown-item">User key management</a>
</li>
            
<li>
    <a href="contrib/README-emacs.html" class="dropdown-item">Emacs major mode</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="no-way.html" class="dropdown-item">no way!</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="namespaces.html" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="testing.html" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#locking-binary-files" class="nav-link">locking binary files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#problem-description" class="nav-link">problem description</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#adminsetup" class="nav-link">admin/setup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#user-view" class="nav-link">user view</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#detailed-example" class="nav-link">detailed example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="locking-binary-files">locking binary files<a class="headerlink" href="#locking-binary-files" title="Permanent link"></a></h1>
<hr />
<p>Locking is useful to make sure that binary files (office docs, images, ...)
don't get into a merge state.  (<font color="gray">If you think it's not a big
deal, you have never manually merged independent changes to an ODT or
something!</font>)</p>
<p><strong>When git is used in a truly distributed fashion, locking is impossible.</strong>
However, in most corporate setups, there is a single central server acting as
the canonical source of truth and collaboration point for all developers.  In
this situation it should be possible to at least prevent commits from being
pushed that contains changes to files locked by someone else.</p>
<p>The two "lock" programs (one a command that a user uses, and one a VREF that
the admin adds to a repo's access rules) together attempt to achieve this.</p>
<p>Of course, locking by itself is not quite enough.  You may still get into
merge situations if you make changes in branches.  For best results you should
actually keep all the binary files in their own branch, separate from the ones
containing source code.</p>
<hr />
<h1 id="problem-description">problem description<a class="headerlink" href="#problem-description" title="Permanent link"></a></h1>
<p>Our users are alice, bob, and carol.  Our repo is foo.  It has some "odt"
files in the "doc/" directory.  We want to make sure these odt files never get
into a "merge" situation.</p>
<h1 id="adminsetup">admin/setup<a class="headerlink" href="#adminsetup" title="Permanent link"></a></h1>
<p>First, someone with shell access to the server must add 'lock' to the ENABLE
list in the rc file.</p>
<p>Next, the gitolite.conf file should have something like this:</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">repo</span> foo
    ...other rules...
    <span class="Statement">-</span>   <span class="Constant">VREF/lock</span>      =   <span class="WarningMsg">@all</span>
</pre>

<p>However, see below for the difference between "RW" and "RW+" from the point of
view of this feature and adjust permissions accordingly.</p>
<h1 id="user-view">user view<a class="headerlink" href="#user-view" title="Permanent link"></a></h1>
<p>Here's a summary:</p>
<ul>
<li>Any user with "W" permissions to any branch in the repo can "lock" any
    file.  Once locked, no other user can push changes to that file, <em>in any
    branch</em>, until it is unlocked.</li>
<li>Any user with "+" permissions to any branch in the repo can "break" a lock
    held by someone else if needed.</li>
</ul>
<p>For best results, everyone on the team should:</p>
<ul>
<li>Switch to the branch containing the binary files when wanting to make a
    change.</li>
<li>Run 'git pull' or eqvt, then lock the binary file(s) before editing them.</li>
<li>Finish the editing task as quickly as possible, then commit, push, and
    unlock the file(s) so others are not needlessly blocked.</li>
<li>Understand that breaking a lock require additional, (out of band)
    communication.  It is upto the team's policies what that entails.</li>
</ul>
<h1 id="detailed-example">detailed example<a class="headerlink" href="#detailed-example" title="Permanent link"></a></h1>
<p>Alice declares her intent to work on "d1.odt":</p>
<pre><code>$ git pull
$ ssh git@host lock -l foo doc/d1.odt
</code></pre>
<p>Similarly Bob starts on "d2.odt"</p>
<pre><code>$ git pull
$ ssh git@host lock -l foo doc/d2.odt
</code></pre>
<p>Carol makes some changes to d2.odt (<strong>without attempting to lock the file or
checking to see if it is already locked</strong>) and pushes:</p>
<pre><code>$ ooffice doc/d2.odt
$ git add doc/d2.odt
$ git commit -m 'added footnotes to d2 in klingon'
$ git push
&lt;...normal push progress output...&gt;
remote: FATAL: W VREF/lock testing carol DENIED by VREF/lock
remote: 'doc/d2.odt' locked by 'bob'
remote: error: hook declined to update refs/heads/master
To u2:testing
 ! [remote rejected] master -&gt; master (hook declined)
error: failed to push some refs to 'carol:foo'
</code></pre>
<p>Carol backs out her changes, but saves them away for a "manual merge" later.</p>
<pre><code>git reset HEAD^
git stash save 'klingon changes to d2.odt saved for possible manual merge later'
</code></pre>
<p>Note that this still represents wasted work in some sense, because Carol would
have to somehow re-apply the same changes to the new version of d2.odt after
pulling it down.  <strong>This is because she did not lock the file before making
changes on her local repo.  Educating users in doing this is important if this
scheme is to help you.</strong></p>
<p>She now decides to work on "d1.odt".  However, she has learned her lesson and
decides to follow the protocol described above:</p>
<pre><code>$ git pull
$ ssh git@host lock -l foo doc/d1.odt
FATAL: 'doc/d1.odt' locked by 'alice' since Sun May 27 17:59:59 2012
</code></pre>
<p>Oh damn; can't work on that either.</p>
<p>Carol now decides to see what else there may be.  Instead of checking each
file to see if she can lock it, she starts with a list of what is already
locked:</p>
<pre><code>$ ssh git@host lock -ls foo

# locks held:

alice   doc/d1.odt      (Sun May 27 17:59:59 2012)
bob     doc/d2.odt      (Sun May 27 18:00:06 2012)

# locks broken:
</code></pre>
<p>Aha, looks like only d1 and d2 are locked.  She picks d3.odt to work on.  This
time, she starts by locking it:</p>
<pre><code>$ ssh git@host lock -l foo doc/d3.odt
$ ooffice doc/d3.odt
&lt;...etc...&gt;
</code></pre>
<p>Meanwhile, in a parallel universe where d3.odt doesn't exist, and Alice has
gone on vacation while keeping d1.odt locked, Carol breaks the lock.  Carol
can do this because she has RW+ permissions for the repository itself.</p>
<p>However, protocol in this team requires that she get email approval from the
team lead before doing this and that Alice be in CC in those emails, so she
does that first, and <em>then</em> she breaks the lock:</p>
<pre><code>$ git pull
$ ssh git@host lock --break foo doc/d1.odt
</code></pre>
<p>She then locks d1.odt for herself:</p>
<pre><code>$ ssh git@host lock -l foo doc/d1.odt
</code></pre>
<p>When Alice comes back, she can tell who broke her lock and when:</p>
<pre><code>$ ssh git@host lock -ls foo

# locks held:

carol   doc/d1.odt      (Sun May 27 18:17:29 2012)
bob     doc/d2.odt      (Sun May 27 18:00:06 2012)

# locks broken:

carol   doc/d1.odt      (Sun May 27 18:17:03 2012)      (locked by alice at Sun May 27 17:59:59 2012)
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

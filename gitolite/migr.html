<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>migrating</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style>
      body        { background: #fff; text-color: #000; margin-left:  40px;   font-size:  0.9em;  font-family: arial; }
  
      code        { font-size:    1.1em;  background:  #ddf; text-color: #000; }
      pre         { margin-left:  2em;    background:  #ddf; text-color: #000; }
      pre code    { font-size:    1.1em;  background:  #ddf; text-color: #000; }
  
      td          { vertical-align: top }
  
      .red        { color: red }
      .blue       { color: blue }
      .green      { color: green }
      .gray       { color: gray }
      .pink       { color: pink }
  
      .box        { background-color:#e0e0e0 }
      .bg-red     { background-color:#ffe0e0 }
      .bg-green   { background-color:#e0ffe0 }
      .bg-blue    { background-color:#e0e0ff }
  
      /* couldn't resist the name! */
      .wd40       { width: 40% !important }
  
      .box-l      { float: left;  padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-right: 4px; }
      .box-r      { float: right; padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-left:  4px; }
  
      .fl-l       { float: left;  padding: 0px 0.5em;                                       margin-right: 4px; }
      .fl-r       { float: right; padding: 0px 0.5em;                                       margin-left:  4px; }
  
      .sidebar {
          margin-left: 4px;
          width: 25%;
          float: right;
          border: 4px solid #fff;
      }
  
  </style>
  <style>
      h1          { background: #ffb; text-color: #000; margin-left: -30px;   border-top:    5px  solid #ccc; }
      h2          { background: #ffb; text-color: #000; margin-left: -20px;   border-top:    3px  solid #ddd; }
      h3          { background: #ffb; text-color: #000; margin-left: -10px; }
      h4          { background: #ffb; text-color: #000; }
  </style>
</head>
<body>
<!--
    generated by gvim then munged a fair bit.  The following command
        vim -E -c "TOhtml" -c "w" -c 'qa!' \-\- conf/gitolite.conf
    may or may not produce the same thing
-->

<style type="text/css">
<!--
.WarningMsg { color: #ff0000; }
.Constant { color: #ffa0a0; }
.Statement { color: #ffff60; font-weight: bold; }
.PreProc { color: #ff80ff; }
.LineNr { color: #ffff00; }
.Comment { color: #80a0ff; }
.Type { color: #60ff60; font-weight: bold; }
.Special { color: #ffa500; }
.Identifier { color: #40ffff; }
.Error { color: #ffffff; background-color: #ff0000; padding-bottom: 1px; }
.Todo { color: #0000ff; background-color: #ffff00; padding-bottom: 1px; }
-->
</style>
<div id="header">
<h1 class="title">migrating</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#pre-migration-checklist"><span class="toc-section-number">1</span> pre-migration checklist</a><ul>
<li><a href="#incompatible-features"><span class="toc-section-number">1.1</span> incompatible features</a><ul>
<li><a href="#high-impact"><span class="toc-section-number">1.1.1</span> high impact</a></li>
<li><a href="#medium-impact"><span class="toc-section-number">1.1.2</span> medium impact</a></li>
<li><a href="#low-impact"><span class="toc-section-number">1.1.3</span> low impact</a></li>
</ul></li>
<li><a href="#cg2c"><span class="toc-section-number">1.2</span> using the &quot;check-g2-compat&quot; program</a></li>
<li><a href="#rc-preset"><span class="toc-section-number">1.3</span> presetting the rc file</a></li>
</ul></li>
<li><a href="#the-actual-migration"><span class="toc-section-number">2</span> the actual migration</a></li>
<li><a href="#g2incompat"><span class="toc-section-number">3</span> appendix 1: v2-v3 incompatibilities</a><ul>
<li><a href="#g2i-name"><span class="toc-section-number">3.1</span> NAME rules</a></li>
<li><a href="#g2i-subconf"><span class="toc-section-number">3.2</span> subconf command in admin repo</a></li>
<li><a href="#g2i-gl-time"><span class="toc-section-number">3.3</span> gl-time for performance measurement</a></li>
<li><a href="#g2i-mirroring"><span class="toc-section-number">3.4</span> changes in mirroring setup</a></li>
</ul></li>
</ul>
</div>
<script type="text/javascript">
<!--
    function hide_show(id) {
        var e = document.getElementById(id);
        if(e == null)
            return;
        if(e.style.display != 'none')
            e.style.display = 'none';
        else
            e.style.display = 'block';
    }

    window.onload = function() {
        var t = document.getElementById('TOC');
        var sbt = document.getElementById('SBTOC');
        var h = '<div id="PTOC">'
        var h2 = '<p><strong><span class="red">Page TOC</span></strong></p>'
        var h3 = '</div>'
        var h4 = '<div id="GTOC">'
        var h5 = '</div>'
        var hst = '<div style="background: white; color: green; border: 2px solid green"><center><font size=-1><strong>Hide/Show Table of Contents</strong><br />'
        var pd = '<a href="#" onclick="hide_show(\'PTOC\');">Page TOC</a> | '
        var gt = '<a href="#" onclick="hide_show(\'GTOC\');">Gitolite TOC</a></font></center></div>'

        if(t == null)
            sbt.innerHTML = hst + gt + h4 + sbt.innerHTML + h5;
        else {
            sbt.innerHTML = hst + pd + gt + h + h2 + t.innerHTML + h3 + h4 + sbt.innerHTML + h5;
            t.style.display = 'none';   // hide the TOC that pandoc placed
        }
    }
-->
</script>

<style>
    #PTOC ul {
        list-style: none;
        margin-left: 0;
        padding-left: 2em;
        text-indent: -2em;
        padding-bottom: 2em;
    }
    #PTOC ul li {
        padding-bottom: 10px;
    }
    #PTOC ul li ul {
        padding-bottom: 0px;
    }
    #PTOC ul li ul li {
        padding-bottom: 0px;
    }

    .sidebar-toc a:hover {
        background-color: white;
    }

    .sidebar-toc {
        margin-left: 4px;
        width: 25%;
        float: right;
        color: gray;
        background: lightgray;
        border: 4px solid #fff;
        font-size: 0.90em;
    }

    .sidebar-toc ul {
        padding-left: 2em;
    }

</style>

<div id="SBTOC" class="sidebar-toc">

<p><strong><span class="red">Gitolite TOC</span></strong></p>
<hr />
<center>
<span class="red"><strong>Background</strong></span>
</center>

<hr />
<p><a href="index.html">Main page</a></p>
<ul>
<li><a href="index.html#dl">download</a></li>
<li><a href="index.html#rtfm">documentation</a></li>
<li><a href="index.html#trouble"><strong>troubleshooting</strong></a></li>
<li><a href="index.html#contact"><strong>contact and support</strong></a></li>
<li><a href="index.html#license">license</a></li>
</ul>
<p><a href="overview.html">Overview</a></p>
<ul>
<li>what is Gitolite?</li>
<li>why might you need it?</li>
<li>how does it work?</li>
<li>who uses it?</li>
</ul>
<p><a href="concepts.html">Concepts and terminology</a></p>
<ul>
<li>authentication and authorisation</li>
<li>the &quot;hosting user&quot;</li>
<li>ssh mode and http mode</li>
<li>the special gitolite-admin repo</li>
</ul>
<p><a href="req.html">Before you start...</a></p>
<ul>
<li>your skills</li>
<li>your server</li>
<li>your and your users' clients</li>
<li><strong>cautions and caveats</strong></li>
<li><a href="req.html#trying">trying</a> out gitolite safely</li>
</ul>
<hr />
<center>
<span class="red"><strong>Basics</strong></span>
</center>

<hr />
<p><a href="install.html">install and setup</a></p>
<ul>
<li><a href="install.html#qi">quick install+setup</a> (for experts)</li>
<li>the long way around</li>
<li><a href="install.html#upgrading">upgrading</a></li>
<li><a href="install.html#moving">moving servers</a></li>
</ul>
<p><a href="basic-admin.html">Basic Administration</a></p>
<ul>
<li>clone the gitolite-admin repo</li>
<li>add/remove users</li>
<li>add/remove/rename repos</li>
<li>bringing existing repos into gitolite</li>
</ul>
<p><a href="conf.html">The conf file (<code>conf/gitolite.conf</code>)</a></p>
<ul>
<li>basic <a href="conf.html#syntax">syntax</a></li>
<li><a href="conf.html#include">include</a> files</li>
<li><a href="conf.html#groups">group definitions</a></li>
<li><a href="conf.html#rules"><strong><span class="red">access rules</span></strong></a></li>
</ul>
<p><a href="rc.html">the rc file (<code>~/.gitolite.rc</code>)</a></p>
<p><a href="user.html">Your users' view</a> of gitolite</p>
<p>Troubleshooting</p>
<ul>
<li>help for <a href="emergencies.html">emergencies</a></li>
<li>the <a href="ips.html">fool-proof install guide</a></li>
<li>the gitolite &quot;<a href="cookbook.html">cookbook</a>&quot;</li>
</ul>
<hr />
<center>
<span class="red"><strong>Advanced</strong></span>
</center>

<hr />
<p>Advanced &quot;conf file&quot; use</p>
<ul>
<li>specifying <a href="git-config.html">git-config</a> keys and values</li>
<li>gitolite <a href="options.html">options</a></li>
<li><a href="wild.html"><strong>wild repos</strong></a> (user created repos)</li>
<li><a href="vref.html">virtual refs</a></li>
<li><a href="deleg.html">delegation</a> of admin duties</li>
<li><a href="gitweb-daemon.html">gitweb and git-daemon</a></li>
</ul>
<p>Special features/setups</p>
<ul>
<li><strong><a href="mirroring.html">mirroring</a></strong></li>
<li><a href="http.html">http</a> mode</li>
<li>using a <a href="cache.html">cache</a></li>
<li>(<a href="namespaces.html">namespaces</a>)</li>
<li><a href="locking.html">locking</a> binary files</li>
<li><a href="package.html">packaging</a> gitolite</li>
</ul>
<p>Customising gitolite</p>
<ul>
<li>core and <a href="non-core.html">non-core</a> gitolite</li>
<li><a href="dev-notes.html">writing your own</a> non-core programs</li>
<li>gitolite <a href="triggers.html">triggers</a></li>
<li><a href="list-non-core.html">list of non-core programs</a> shipped with gitolite</li>
</ul>
<hr />
<center>
<span class="red"><strong>Extras</strong></span>
</center>

<hr />
<p><a href="odds-and-ends.html">Odds and Ends</a></p>
<ul>
<li><a href="odds-and-ends.html#writable">disabling pushes</a> to take backups</li>
<li><a href="odds-and-ends.html#elsewhere">putting 'repositories' and '.gitolite' elsewhere</a></li>
<li><a href="odds-and-ends.html#keysonly">using pubkeys obtained from elsewhere</a></li>
<li><a href="odds-and-ends.html#gh">giving users their own repos</a></li>
<li><a href="odds-and-ends.html#server-side-admin">administering gitolite directly on the server</a></li>
</ul>
<p>Additional information/discussion</p>
<ul>
<li><a href="ssh.html">all about ssh and gitolite</a></li>
<li>Running the <a href="testing.html">test suite</a></li>
<li><a href="files.html">gitolite files and directories</a></li>
<li><a href="perf.html">gitolite performance</a></li>
<li><a href="migr.html">Migration</a></li>
<li><a href="http://sitaramc.github.com/gitolite/g2/master-toc.html">documentation for gitolite v2</a></li>
<li><a href="regex.html">regular expressions</a></li>
<li><a href="no-way.html">no way!</a></li>
</ul>
<hr />
<center>
<span class="red"><strong>Contributed docs</strong></span>
</center>

<hr />
<p>Contributed software, tools, and documentation</p>
<ul>
<li><a href="ssh-and-http.html">combining ssh and http mode</a></li>
<li><a href="putty.html">putty and msysgit</a></li>
<li><a href="sskm.html">changing keys -- self service key management</a></li>
<li><a href="ukm.html">user key management</a></li>
<li><a href="README-emacs.html">emacs</a> &quot;major mode&quot;</li>
</ul>
</div>

<p><span class="box-r">If you're curious why I wrote v3, and what was wrong with v2, read <a href="why-v3.html">this</a>.</span></p>
<p>First things first: v3 came out in April 2012. v2 will continue to be supported for critical bugs, although enhancements and new features won't happen. v1 is not supported anymore.</p>
<p>That said, if you're an existing (gitolite v1.x or v2.x) user, and wish to migrate, here are the steps:</p>
<p><span class="gray">This page is about migrating from older gitolite to &quot;v3&quot;. If you're migrating from <em>gitosis</em>, let me first welcome you to the 21st century, and then point you <a href="gsmigr.html">here</a>.</span></p>
<h1 id="pre-migration-checklist"><span class="header-section-number">1</span> pre-migration checklist</h1>
<p><span class="box-r">Both Fedora/RH and Debian use 'gitolite3' as the package name for this version, because it is not auto-upgradable from v2. You may need to uninstall 'gitolite' then install 'gitolite3' in that case. Please take a backup of at least <code>~/repositories/gitolite-admin.git</code>, <code>~/.gitolite.rc</code>, and <code>~/.gitolite</code> before doing that. You may need more specific help if you're using any of the settings marked as &quot;requires presetting&quot; in the &quot;high impact&quot; subsection below; please <a href="index.html#contact">contact</a> me if needed.)</p>
<p>This section tells you what changes affect you and your users. The closer you were to a default install of the old gitolite, the less time a migration will take.</p>
<p><strong>Note</strong>: as you read this section, and run the <code>check-g2-compat</code> program, be sure to make a note of any variables you have used which the pre-migration checklist describes as &quot;requires presetting&quot;.</p>
<hr />
<p>First things first: v2 will be supported for a good long time for critical bugs, although enhancements and new features won't happen.</p>
<p>Migration should be straightforward, but it is not automatic. The biggest differences are in the rc file, mirroring, &quot;NAME/&quot; rules, and delegation.</p>
<blockquote>
<hr />
</blockquote>
<blockquote>
<p><strong>Presetting the rc file</strong></p>
</blockquote>
<blockquote>
<p>Some rc settings in the older gitolite are such that you cannot directly run <code>gitolite setup</code> when you're ready to migrate. <strong>Doing that will clobber something important</strong>. See <a href="#rc-preset">presetting the rc file</a> for details.</p>
</blockquote>
<blockquote>
<hr />
</blockquote>
<p>The <code>check-g2-compat</code> program attempts to identify any <em>big</em> issues you will be facing; run that first. See <a href="#cg2c">later</a> in this page for what its messages mean. If it does not report any issues, your migrate will probably go quickly. I still suggest you go through the links below in case that program missed something.</p>
<h2 id="incompatible-features"><span class="header-section-number">1.1</span> incompatible features</h2>
<p>Here's a list of incompatible features and what you need to do to migrate. Some of them have links where there is more detail than I want to put here.</p>
<h3 id="high-impact"><span class="header-section-number">1.1.1</span> high impact</h3>
<p>(serious loss of functionality and/or access control compromised)</p>
<ul>
<li><p><a href="#g2i-name"><code>NAME/</code></a> rules: thes need to change to <code>VREF/NAME/</code>, and you need to add a deny rule at the end because fallthru is &quot;success&quot; for all <a href="vref.html">VREFs</a> now, including the &quot;NAME&quot; VREF.</p></li>
<li><p><a href="#g2i-subconf">subconf</a>: if you're using <a href="deleg.html">delegation</a>, there is no implicit &quot;subconf&quot; at the end; you'll have to add it in.</p></li>
<li><p>There are several important differences in mirroring. You can start from scratch by reading the new <a href="mirroring.html">mirroring</a> doc or <a href="#g2i-mirroring">migrate</a> (carefully!).</p></li>
<li><p><code>ADMIN_POST_UPDATE_CHAINS_TO</code> -- <strong>dropped</strong>. Add your script to the <code>POST_COMPILE</code> trigger chain. Your script won't be getting the arguments that <em>git</em> sends to the post-update hook, but for the admin repo the only argument that even comes in (or is significant) is &quot;refs/heads/master&quot; anyway.</p></li>
<li><p><code>GL_ALL_INCLUDES_SPECIAL</code> -- <strong>dropped</strong>, <strong>requires presetting</strong>.</p>
<p><span class="citation">@all</span> always includes gitweb and daemon now. Use <a href="conf.html#deny-rules">deny-rules</a> if you want to say <code>R = @all</code> but not have the repo(s) be visible to gitweb or daemon.</p></li>
<li><p><code>GL_NO_CREATE_REPOS</code> -- <strong>dropped</strong>. If you think you need this, email me. I know one group who does need this so I will be putting it in eventually but not right away. It's almost certain to be renamed anyway.</p></li>
<li><p><code>GL_NO_DAEMON_NO_GITWEB</code> <strong>dropped</strong>, <strong>requires presetting</strong>. Default will clobber your projects.list file and git-daemon-export-ok files.</p>
<p>Comment out the 'daemon' and 'gitweb' lines in the ENABLE list in the rc file. As you can see, gitweb and daemon can now be separately disabled, instead of both being tied to the same setting.</p></li>
<li><p><code>GL_NO_SETUP_AUTHKEYS</code> <strong>dropped</strong>, <strong>requires presetting</strong>. Default will clobber your authkeys file.</p>
<p>Comment out all the line(s) that call ssh-authkeys in the rc file.</p></li>
<li><p><code>UPDATE_CHAINS_TO</code> <strong>dropped</strong>, <strong>requires presetting</strong>. Default will fail to run this extra check when users push.</p>
<p>Use a <a href="vref.html">vref</a> instead. You can directly use any existing chained-to script as a VREF; they'll work. Don't forget to add a rule that references the new VREF!</p></li>
<li><p><code>GIT_PATH</code> <strong>dropped</strong>, <strong>requires presetting</strong>.</p>
<p>If you need this, manipulate the PATH environment variable directly. Just put something like this at the end of the rc file:</p>
<pre><code>$ENV{PATH} = &quot;/some/non-standard/path:$ENV{PATH}&quot;;
1;</code></pre></li>
</ul>
<h3 id="medium-impact"><span class="header-section-number">1.1.2</span> medium impact</h3>
<p>(important functionality lost, but access control not compromised)</p>
<ul>
<li><p><code>GL_ADMINDIR</code> -- <strong>dropped</strong>, is now at a fixed location: <code>~/.gitolite</code>. If you want it somewhere else go ahead and move it, then place a symlink from the assumed location to the real one.</p></li>
<li><p><code>GL_GET_MEMBERSHIPS_PGM</code> -- is now <code>GROUPLIST_PGM</code>, see <a href="conf.html#ldap">here</a>.</p></li>
<li><p><code>GL_WILDREPOS_DEFPERMS</code> -- is gone; see <a href="wild.html#roles">roles</a> for how to do this.</p></li>
<li><p><code>REPO_BASE</code> -- <strong>dropped</strong>, is now at a fixed location: <code>~/repositories</code>. If you want it somewhere else go ahead and move it, then place a symlink from the assumed location to the real one.</p></li>
</ul>
<h3 id="low-impact"><span class="header-section-number">1.1.3</span> low impact</h3>
<p>(ancillary, non-core, or minor functionality lost)</p>
<ul>
<li><p>'git-config' values have new restrictions. See <a href="git-config.html#unsafe-patt">compensating for UNSAFE_PATT</a> for more on these restrictions and how to get around them.</p></li>
<li><p>Built-in command <code>expand</code> -- <strong>dropped</strong>. The 'info' command shows you both normal and wild repos now. The output format is also much simpler.</p></li>
<li><p>Built-in commands 'getperms', 'setperms' -- <strong>merged</strong> into command 'perms'. Run <code>ssh git@host perms -h</code> for details.</p>
<p>Similarly, 'getdesc' and 'setdesc' have been merged into 'desc'.</p></li>
<li><p>Several 'ADC's -- please ask on the mailing list if you're using any that you don't see in the new</p></li>
<li><p><a href="#g2i-gl-time">gl-time</a>: the CpuTime module replaces gl-time.</p></li>
<li><p><code>BIG_INFO_CAP</code> -- <strong>dropped</strong>. If you think you must have this, try it without and see if there's a difference. If you <em>know</em> you need this, convince me.</p></li>
<li><p><code>GL_ADC_PATH</code> -- <strong>dropped</strong>. It is obsolete; use <a href="non-core.html#commands">commands</a> or add <a href="dev-notes.html">your own</a>.</p></li>
<li><p><code>GL_ALL_READ_ALL</code> -- <strong>dropped</strong>. If you think you must have this, try it without and see if there's a difference. If you <em>know</em> you need this, convince me.</p></li>
<li><p><code>GL_BIG_CONFIG</code> -- <strong>dropped</strong>. This feature is default now.</p></li>
<li><p><code>GL_CONF</code>, <code>GL_CONF_COMPILED</code>, and <code>GL_KEYDIR</code> -- <strong>dropped</strong>. You had no business touching these anyway; if you did, move them into the expected default locations before attempting to run <code>gitolite setup</code></p></li>
<li><p><code>GL_GITCONFIG_KEYS</code> -- is now <code>GIT_CONFIG_KEYS</code>.</p></li>
<li><p><code>GL_LOGT</code> -- now has a fixed value; email me if this is a problem.</p></li>
<li><p><code>GL_PACKAGE_CONF</code> and <code>GL_PACKAGE_HOOKS</code> -- <strong>dropped</strong>. They are not needed anymore, but check if you had any custom hooks set in the latter location and copy them across.</p></li>
<li><p><code>GL_PERFLOGT</code> -- <strong>dropped</strong>. See <a href="#g2i-gl-time">gl-time</a>.</p></li>
<li><p><code>GL_SITE_INFO</code> -- is now <code>SITE_INFO</code>.</p></li>
<li><p><code>GL_WILDREPOS</code> -- <strong>dropped</strong>. This feature is default now.</p></li>
<li><p><code>GL_WILDREPOS_PERM_CATS</code> -- is now the ROLES hash in the rc file.</p></li>
<li><p><code>RSYNC_BASE</code> -- needs work. Email me if you are using this.</p></li>
<li><p><code>NICE_VALUE</code> -- <strong>dropped</strong>. Uncomment the 'renice 10' line in the rc file. You can also change the 10 to something else if you wish.</p></li>
<li><p><code>PROJECTS_LIST</code> -- is now <code>GITWEB_PROJECTS_LIST</code>. More importantly, it is only used by update-gitweb-access-list in src/commands/post-compile. This variable now has nothing to do with gitolite core, and the rc is just helping to store settings for non-core programs like that one.</p></li>
<li><p><code>REPO_UMASK</code> -- is now <code>UMASK</code>.</p></li>
<li><p><code>WEB_INTERFACE</code> and <code>GITWEB_URI_ESCAPE</code> -- <strong>dropped</strong>. Patches to the update program to directly do those things are welcome. Personally, I think people who use spaces and other funky characters in dir/file names should be shot but no one listens to me anyway.</p></li>
</ul>
<h2 id="cg2c"><span class="header-section-number">1.2</span> using the &quot;check-g2-compat&quot; program</h2>
<p>This program checks a few things only, not everything. In particular, it looks for settings and status that might:</p>
<ul>
<li>make v3 unusable for lots of users</li>
<li>make v3 give <em>more</em> access than v2 under some conditions</li>
</ul>
<p>It does NOT look for or warn about anything else; you're expected to read (and act upon, if needed) the rest of the migration guide links given a few paras above to cover everything else.</p>
<p>Here's an explanation of those messages that the check-g2-compat program may put that contain the words &quot;see docs&quot;:</p>
<ul>
<li><p><code>GL_ADMINDIR in the wrong place -- aborting</code></p>
<p>It expects to find <code>GL_ADMINDIR</code> and <code>REPO_BASE</code> pointing to the right places. It aborts if these conditions are not met and does not scan further since that sort of guesswork is not good. If you are in that position, make a symlink from the real location to the expected location, change the RC accordingly, and re-try.</p></li>
<li><p><code>REPO_BASE in the wrong place -- aborting</code></p>
<p>same as above</p></li>
<li><p><code>NAME rules</code></p>
<p><strong>This is a significant difference and affects access badly (gives access that would otherwise not be given)</strong>. Please see the <a href="#g2incompat">list of non-RC incompatibilities</a>.</p></li>
<li><p><code>subconf command in admin repo</code></p>
<p>This is not so bad security wise but it might <em>reduce</em> access by not processing files you intended to. Again, see the same link as in the previous bullet.</p></li>
<li><p><code>mirroring used</code></p>
<p>There have been quite a few changes to mirroring. You can start from scratch by reading the new <a href="mirroring.html">mirroring</a> doc or <a href="#g2i-mirroring">migrate</a> (carefully!).</p></li>
<li><p><code>found N gl-creater files</code></p>
<p>These need to be renamed to <code>gl-creator</code> (the correct spelling at last, hooray!). Suggested command sequence:</p>
<pre><code>cd $HOME/repositories
find . -type d -name &quot;*.git&quot; -prune | while read r
do
    mv $r/gl-creater $r/gl-creator
done 2&gt;/dev/null</code></pre>
<p>Once you do this, v2 will not work completely unless you change them back.</p></li>
<li><p><code>found N gl-perms files with R or RW</code></p>
<p>Setting perms of R and RW will no longer work; you have to say READERS and WRITERS now. Suggested command:</p>
<pre><code>find `gitolite query-rc GL_REPO_BASE` -name gl-perms |
    xargs perl -pi -e 's/\bR\b/READERS/;s/\bRW\b/WRITERS/'</code></pre></li>
</ul>
<h2 id="rc-preset"><span class="header-section-number">1.3</span> presetting the rc file</h2>
<p>Some rc settings in the older gitolite are such that you cannot directly run <code>gitolite setup</code> when you're ready to migrate. <strong>Doing that will clobber something important</strong>. You have to create a default rc file, edit it appropriately, and <em>then</em> run <code>gitolite setup</code>.</p>
<p>The most serious example of this is <code>GL_NO_SETUP_AUTHKEYS</code>, which tells the (old) gitolite that you want to manage <code>~/.ssh/authorized_keys</code> yourself and it should not fiddle with it.</p>
<p>If you don't preset the rc (in this case, by commenting out the 'ssh-authkeys' line) <strong>before</strong> running <code>gitolite setup</code>, <strong>your <code>~/.ssh/authorized_keys</code> file will get clobbered</strong>.</p>
<p>The actual rc settings that require presetting are listed in the &quot;high impact&quot; section above. This section tells you how to do the presetting.</p>
<ul>
<li><p>rename (not just copy) your old (v2) rc file to something else</p></li>
<li><p>run</p>
<pre><code>gitolite print-default-rc &gt; $HOME/.gitolite.rc</code></pre></li>
<li><p>edit the file</p>
<pre><code>${EDITOR:-vim} $HOME/.gitolite.rc</code></pre>
<p>make appropriate changes as described elsewhere in this migration guide, and save it.</p></li>
<li><p><em>then</em> you can run <a href="install.html#setup">gitolite setup</a>.</p></li>
</ul>
<h1 id="the-actual-migration"><span class="header-section-number">2</span> the actual migration</h1>
<p>(Note: You may also like the <a href="g2migr-example.html">example migration</a> page).</p>
<p><strong>Note</strong>: nothing in any of the gitolite install/setup/etc will ever touch the <em>data</em> in any repository except the gitolite-admin repo. The only thing it will normally touch in normal repos is the <code>update</code> hook.</p>
<p><strong>Note: all migration happens on the server; you do not need your workstation</strong>.</p>
<ol style="list-style-type: decimal">
<li><p>Carefully wipe out the old gitolite:</p>
<ul>
<li><p>The <strong>code</strong></p>
<ul>
<li><p>Delete or move away all the old gitolite scripts. Check the path to the gl-auth-command in <code>~/.ssh/authorized_keys</code> if you forgot where you put them.</p></li>
<li><p>Delete or move away the two directories named in the two variables <code>GL_PACKAGE_CONF</code> and <code>GL_PACKAGE_HOOKS</code> in <code>~/.gitolite.rc</code>.</p></li>
</ul></li>
<li><p>The <strong>rc file</strong></p>
<ul>
<li>Rename <code>~/.gitolite.rc</code> to something else.</li>
</ul></li>
<li><p>The <strong>admin repo</strong></p>
<ul>
<li>clone <code>~/repositories/gitolite-admin.git</code> to someplace safe</li>
<li>then delete <code>~/repositories/gitolite-admin.git</code></li>
</ul>
<p>(Make sure you do not delete any other repos!)</p></li>
<li><p>The <strong>admin directory</strong>.</p>
<ul>
<li><p>If you need to preserve logs, move the ~/.gitolite/logs` directory somewhere else.</p></li>
<li><p>If you added any custom hooks and wish to preserve them, move the ~/.gitolite/hooks` directory somewhere else.</p></li>
<li><p>Delete <code>~/.gitolite</code>.</p></li>
</ul></li>
</ul></li>
<li><p>Install gitolite v3; see <a href="install.html">install</a>.</p></li>
<li><p>If you're using any rc variables that the pre-migration checklist said would &quot;require presetting&quot;, then read about <a href="#rc-preset">presetting</a> the rc file, and follow those instructions to create your new rc file.</p></li>
<li><p>Setup gitolite; see <a href="install.html#setup">setup</a>. However, the 'setup' step need not supply a private key. You can run it as <code>gitolite setup -a admin</code>.</p>
<p>NOTE: ignore any 'split conf not set, gl-conf present...' errors at this time. You may see none, some, or many. It does not matter right now.</p></li>
<li><p>Make sure your gitolite-admin clone has the correct pubkey for the administrator in its <code>keydir</code> directory, then run <a href="emergencies.html#bypass"><code>gitolite push     -f</code></a> to overwrite the &quot;default&quot; admin repo created by the install.</p>
<p><strong>NOTE that is <code>gitolite push</code> not <code>git push</code>!</strong></p></li>
<li><p>Handle any errors, look for migration issues, etc., as described in the links at the top of this page.</p>
<p>This also includes building up your new <code>~/.gitolite.rc</code> file.</p></li>
</ol>
<p>You're done.</p>
<h1 id="g2incompat"><span class="header-section-number">3</span> appendix 1: v2-v3 incompatibilities</h1>
<p>This page expands on some incompatibilities that were only briefly mentioned in the pre-migration section earlier.</p>
<h2 id="g2i-name"><span class="header-section-number">3.1</span> NAME rules</h2>
<ol style="list-style-type: decimal">
<li><p>NAME/ rules must be changed to VREF/NAME/</p></li>
<li>Fallthru on all VREFs is &quot;success&quot; now, so any NAME/ rules you have <strong>MUST</strong> change the rule list in some way to maintain the same restrictions. The simplest is to add the following line to the end of each repo's rule list:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Statement">    -</span><span class="Constant">   VREF/NAME/       </span>=<span class="WarningMsg">   @all</span>
</pre>
</li>
</ol>
<h2 id="g2i-subconf"><span class="header-section-number">3.2</span> subconf command in admin repo</h2>
<p>(This is also affected by the previous issue, 'NAME rules'; please read that as well).</p>
<p>If you're using delegation in your admin conf setup, please add the following lines to the end of the gitolite-admin rules in your conf/gitolite.conf file:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>gitolite-admin
<span class="Statement">    -</span><span class="Constant">   VREF/NAME/       </span>=<span class="WarningMsg">   @all</span>

<span class="PreProc">subconf </span><span class="Constant">&quot;fragments/*.conf&quot;</span>
</pre>

<p>The first part compensates for fallthru now being a success when processing <a href="vref.html">VREF</a> rules (NAME rules are just one specific VREF). Although, <strong>ideally</strong>, you should change your rule list so that you no longer require that line. As the <a href="vref.html">vref page</a> says:</p>
<blockquote>
<p><strong>Virtual refs are best used as additional &quot;deny&quot; rules</strong>, performing extra checks that core gitolite cannot.</p>
</blockquote>
<p>The second part explicitly says when and where to include the subconf files. (Before subconf was invented, this used to happen implicitly at the end of the main conf file, and was hardcoded to that specific glob.)</p>
<h2 id="g2i-gl-time"><span class="header-section-number">3.3</span> gl-time for performance measurement</h2>
<p>If you've been using gl-time for performance measurement, there's a much better system available now.</p>
<p>gl-time used to only log elapsed time. The new 'CpuTime' trigger module shipped with gitolite, if enabled in the rc file, can also report CPU times using perl's 'times()' function. See comments within that file and in the default rc file that contain the word &quot;cpu&quot;, for more details.</p>
<p>Further, you can copy that module with a different name, add your own functionality, and invoke <em>that</em> from the rc file instead.</p>
<h2 id="g2i-mirroring"><span class="header-section-number">3.4</span> changes in mirroring setup</h2>
<p>There are several changes with regard to mirroring:</p>
<ul>
<li><p>There is no 'post-receive' hook to be installed. Mirroring is handled by v3's <a href="triggers.html">triggers</a> mechanism. Gitolite triggers are enabled by adding (or uncommenting, in this case) appropriate lines in the rc file.</p>
<p>You need to either remove these files (actually symlinks) from each repo's 'hooks' directory, or remove the old (v2) sources so they become broken symlinks.</p></li>
<li><p>The <code>GL_HOSTNAME</code> variable is now <code>HOSTNAME</code>. (Note that the rc file syntax itself has changed quite a bit; to be accurate, HOSTNAME is not a variable but a hash key with an associated value).</p></li>
<li><p>The <code>GL_GITCONFIG_KEYS</code> variable is now <code>GIT_CONFIG_KEYS</code>, <strong>but</strong> you no longer need to set it to anything for mirroring to work.</p></li>
<li><p>The <code>gl-tool</code> program does not exist anymore. Adding keys for peer servers is done just like adding user keys, except that the pubkey file name must start with <code>server-</code>. For example, to add a peer host called frodo, you will acquire its pubkey and add it as <code>server-frodo.pub</code>.</p></li>
<li>The config variables are quite different now. The main ones now look like this:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
option mirror.master        =   sam
option mirror.slaves        =   frodo gollum
</pre>

The redirectOK looks like this:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
option mirror.redirectOK    =   frodo
</pre>

The special value &quot;true&quot; to say that all slaves are trusted is now &quot;all&quot;:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
option mirror.redirectOK    =   all
</pre>
</li>
<li>There are no more mirroring &quot;keys&quot;, (lists of servers named in config keys like 'gitolite.mirror.nightly', etc). You can certainly add lines like
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
option mirror.nightly       =   merry pippin
</pre>

<p>but they will not be processed by gitolite. Your cron jobs should use <code>gitolite git-config</code> to query this variable, grab the list of peers, and run <code>gitolite mirror</code> on each of them.</p></li>
<li><p>The command to resync mirrors is 'mirror', run just like any other <a href="non-core.html#commands">command</a>. In particular, you can run <code>gitolite mirror -h</code> to get help. It cannot be run from a slave to ask a master to push (unlike in the old system) but what's more convenient is that any user who has any access to the master can run it remotely (if you allow it) to invoke a push.</p></li>
</ul>
</body>
</html>

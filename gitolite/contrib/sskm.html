<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Self-service key management - Gitolite</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../css/gitolite.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../index.html">Gitolite</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../index.html">home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">what/why <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../overview.html">overview</a>
</li>
                                    
<li >
    <a href="../concepts.html">concepts, conventions, terminology</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">install and setup <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../quick_install.html">(unix/ssh experts) quick install and setup</a>
</li>
                                    
<li >
    <a href="../install.html">normal ssh mode install and setup</a>
</li>
                                    
<li >
    <a href="../fool_proof_setup.html">(if all else fails) fool-proof, step-by-step, install and setup</a>
</li>
                                    
<li >
    <a href="../http.html">HTTP mode install</a>
</li>
                                    
<li >
    <a href="../migr.html">migrating from v2</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">use <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">basic</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../basic-admin.html">basic administration</a>
</li>
            
<li >
    <a href="../conf.html">the "conf" file (part 1)</a>
</li>
            
<li >
    <a href="../conf-2.html">the "conf" file (part 2)</a>
</li>
            
<li >
    <a href="../rc.html">the "rc" file</a>
</li>
            
<li >
    <a href="../user.html">your users' view</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">advanced</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../git-config.html">setting git-config values</a>
</li>
            
<li >
    <a href="../options.html">gitolite options</a>
</li>
            
<li >
    <a href="../wild.html">ad hoc user-created ("wild") repos</a>
</li>
            
<li >
    <a href="../templates.html">using templates</a>
</li>
            
<li >
    <a href="../vref.html">virtual refs (part 1)</a>
</li>
            
<li >
    <a href="../vref-2.html">virtual refs (part 2)</a>
</li>
            
<li >
    <a href="../deleg.html">delegation of admin duties</a>
</li>
            
<li >
    <a href="../gitweb-daemon.html">gitweb and git-daemon</a>
</li>
            
<li >
    <a href="../mirroring.html">mirroring</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">customise</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../non-core.html">core and "non-core" gitolite</a>
</li>
            
<li >
    <a href="../dev-notes.html">writing your own non-core code</a>
</li>
            
<li >
    <a href="../triggers.html">gitolite triggers</a>
</li>
            
<li >
    <a href="../list-non-core.html">list of non-core programs shipped with gitolite</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../cookbook.html">(quick! how do I...) the cookbook</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">HELP! <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../emergencies.html">emergency!!</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">ssh</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../ssh.html">ssh</a>
</li>
            
<li >
    <a href="../glssh.html">how gitolite uses ssh</a>
</li>
            
<li >
    <a href="../sts.html">ssh troubleshooting</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../regex.html">regular expressions</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">other docs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../odds-and-ends.html">miscellaneous features</a>
</li>
                                    
<li >
    <a href="../namespaces.html">using git namespaces</a>
</li>
                                    
<li >
    <a href="../locking.html">locking binary files</a>
</li>
                                    
<li >
    <a href="../testing.html">testing gitolite</a>
</li>
                                    
<li >
    <a href="../package.html">packaging gitolite</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">more about gitolite</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../files.html">gitolite files & directories</a>
</li>
            
<li >
    <a href="../rc-33.html">the 3.3 format rc file</a>
</li>
            
<li >
    <a href="../perf.html">performance</a>
</li>
            
<li >
    <a href="../internals.html">internals</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">contrib</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="ssh-and-http.html">Using both ssh and http</a>
</li>
            
<li >
    <a href="putty.html">Putty and Msysgit</a>
</li>
            
<li class="active">
    <a href="sskm.html">Self-service key management</a>
</li>
            
<li >
    <a href="ukm.html">User key management</a>
</li>
            
<li >
    <a href="README-emacs.html">Emacs major mode</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../no-way.html">no way!</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="putty.html">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="ukm.html">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#changing-keys-self-service-key-management">changing keys -- self service key management</a></li>
        <li class="main "><a href="#important">Important!</a></li>
            <li><a href="#key-fingerprints">Key fingerprints</a></li>
            <li><a href="#active-keys">Active keys</a></li>
            <li><a href="#selecting-which-key-to-use">Selecting which key to use</a></li>
            <li><a href="#public-vs-private-keys">Public vs. private keys</a></li>
        <li class="main "><a href="#listing-your-existing-keys">Listing your existing keys</a></li>
        <li class="main "><a href="#adding-or-replacing-a-key">Adding or Replacing a key</a></li>
            <li><a href="#step-1-adding-the-key">Step 1: Adding the Key</a></li>
            <li><a href="#step-2-confirming-the-addition">Step 2: Confirming the addition</a></li>
            <li><a href="#optional-undoing-a-mistaken-add-before-confirmation">Optional: Undoing a mistaken add (before confirmation)</a></li>
        <li class="main "><a href="#removing-a-key">Removing a key</a></li>
            <li><a href="#step-1-mark-the-key-for-deletion">Step 1: Mark the key for deletion</a></li>
            <li><a href="#step-2-confirming-the-deletion">Step 2: Confirming the deletion</a></li>
            <li><a href="#optional-undoing-a-mistaken-delete-before-confirmation">Optional: Undoing a mistaken delete (before confirmation)</a></li>
        <li class="main "><a href="#important-notes-for-the-admin">important notes for the admin</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="changing-keys-self-service-key-management">changing keys -- self service key management<a class="headerlink" href="#changing-keys-self-service-key-management" title="Permanent link"></a></h1>
<p>Copyright: Jeff Mitchell (jmitchell@kde.org).  Licensed under CC-BY-NC-SA
unported 3.0, <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/">https://creativecommons.org/licenses/by-nc-sa/3.0/</a></p>
<p>[Note on v3 version: this has been manually spot-tested; there is no test suite.  Changes from v2 version are minimal so it should all work fine but please report errors!]</p>
<p>Follow this guide to add keys to or remove keys from your account. Note that you cannot use this method to add your <em>first</em> key to the account; you must still email your initial key to your admin.</p>
<p>The key management is done using a command called <code>sskm</code>.  This command must be enabled for remote use by the admin (see <a href="../non-core#gitolite-commands">here</a> for more on this).</p>
<hr />
<h1 id="important">Important!<a class="headerlink" href="#important" title="Permanent link"></a></h1>
<p>There are a few things that you should know before using the key management system. Please do not ignore this section!</p>
<h2 id="key-fingerprints">Key fingerprints<a class="headerlink" href="#key-fingerprints" title="Permanent link"></a></h2>
<p>Keys are identified in some of these subcommands by their fingerprints. To see the fingerprint for a public key on your computer, use the following syntax:</p>
<pre><code>ssh-keygen -l -f &lt;path_to_public_key.pub&gt;
</code></pre>
<p>You'll get output like:</p>
<pre><code>jeff@baklava ~  $  ssh-keygen -l -f .ssh/jeffskey.pub 
2048 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44 .ssh/jeffskey.pub (RSA)
</code></pre>
<h2 id="active-keys">Active keys<a class="headerlink" href="#active-keys" title="Permanent link"></a></h2>
<p>Any keys that you can use to interact with the system are active keys. (Inactive keys are keys that are, for instance, scheduled to be added or removed.) Keys are identified with their <code>keyid</code>; see the section below on listing keys.</p>
<p>If you have no current active keys, you will be locked out of the system (in which case email your admin for help). Therefore, be sure that you are never removing your only active key!</p>
<h2 id="selecting-which-key-to-use">Selecting which key to use<a class="headerlink" href="#selecting-which-key-to-use" title="Permanent link"></a></h2>
<p>Although you can identify yourself to the Gitolite system with any of your active keys on the server, at times it is necessary to specifically pick which key you are identifying with. To pick the key to use, pass the <code>-i</code> flag into <code>ssh</code>:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git info
hello jeff, the gitolite version here is v2.0.1-11-g1cd3414
the gitolite config gives you the following access:
 @C  R   W      [a-zA-Z0-9][a-zA-Z0-9_\-\.]+[a-zA-Z0-9]
....
</code></pre>
<p><em>N.B.</em>: If you have any keys loaded into <code>ssh-agent</code> (i.e., <code>ssh-add -l</code> shows
at least one key), then this may not work properly.  <code>ssh</code> has a bug which
makes it ignore <code>-i</code> values when that key has not been loaded into the agent.
One solution is to add the key you want to use (e.g., <code>ssh-add
.ssh/jeffskey</code>).  The other is to remove <em>all</em> the keys from the agent or
disable the agent, using one of these commands:</p>
<ul>
<li>Terminate <code>ssh-agent</code> or use <code>ssh-add -D</code> flag to remove identities from it</li>
<li>If using <code>keychain</code>, run <code>keychain --clear</code> to remove identities</li>
<li>Unset the <code>SSH_AUTH_SOCK</code> and <code>SSH_AGENT_PID</code> variables in the current shell</li>
</ul>
<h2 id="public-vs-private-keys">Public vs. private keys<a class="headerlink" href="#public-vs-private-keys" title="Permanent link"></a></h2>
<p>In this guide, all keys are using their full suffix. In other words, if you see a <code>.pub</code> at the end of a key, it's the public key; if you don't, it's the private key. For instance, when using the <code>-i</code> flag with <code>ssh</code>, you are specifying private keys to use. When you are submitting a key for addition to the system, you are using the public key.</p>
<h1 id="listing-your-existing-keys">Listing your existing keys<a class="headerlink" href="#listing-your-existing-keys" title="Permanent link"></a></h1>
<p>To see a list of your existing keys, use the <code>list</code> argument to <code>sskm</code>:</p>
<pre><code>jeff@baklava ~  $  ssh git@git sskm list
hello jeff, you are currently using a normal ("active") key
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
</code></pre>
<p>Notice the <code>@</code> sign in each key's name? That sign and the text after that up until the <code>.pub</code> is the <code>keyid</code>. This is what you will use when identifying keys to the system. Above, for instance, one of my keys has the <code>keyid</code> of <code>@key3</code>.</p>
<p>A keyid may be <em>empty</em>; in fact to start with you may only have a single
<code>jeff.pub</code> key, depending on how your admin added your initial key.  You can
use any keyid you wish when adding keys (like <code>@home</code>, <code>@laptop</code>, ...); the
only rules are that it must start with the <code>@</code> character and after that
contain only digits, letters, or underscores.</p>
<h1 id="adding-or-replacing-a-key">Adding or Replacing a key<a class="headerlink" href="#adding-or-replacing-a-key" title="Permanent link"></a></h1>
<h2 id="step-1-adding-the-key">Step 1: Adding the Key<a class="headerlink" href="#step-1-adding-the-key" title="Permanent link"></a></h2>
<p>Adding and replacing a key is the same process. What matters is the <code>keyid</code>. When adding a new key, use a new <code>keyid</code>; when replacing a key, pass in the <code>keyid</code> of the key you want to replace, as found by using the <code>list</code> subcommand. Pretty simple!</p>
<p>To add a key, pipe in the text of your new key using <code>cat</code> to the <code>add</code> subcommand. In the example below, I explicitly select which existing, active pubkey to identify with for the command (using the <code>-i</code> parameter to ssh) for clarity:</p>
<pre><code>jeff@baklava ~  $  cat .ssh/newkey.pub | ssh -i .ssh/jeffskey git@git sskm add @key4
hello jeff, you are currently using a normal ("active") key
please supply the new key on STDIN.  (I recommend you
        don't try to do this interactively, but use a pipe)
</code></pre>
<p>If you now run the <code>list</code> command you'll see that it's scheduled for addition:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm list
hello jeff, you are currently using a normal ("active") key
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
== keys marked for addition/replacement ==
1: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub
</code></pre>
<h2 id="step-2-confirming-the-addition">Step 2: Confirming the addition<a class="headerlink" href="#step-2-confirming-the-addition" title="Permanent link"></a></h2>
<p>Gitolite uses Git internally to store the keys. Just like with Git, where you commit locally before <code>push</code>-ing up to the server, you need to confirm the key addition (see the next section if you made a mistake). We use the <code>confirm-add</code> subcommand to do this, <em>but</em>: to verify that you truly have ownership of the corresponding private key, you <em>must</em> use the key you are adding itself to do the confirmation! (Inconvenient like most security, but very necessary from a security perspective.) This is where using the <code>-i</code> flag of <code>ssh</code> comes in handy:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm confirm-add @key4
hello jeff, you are currently using a key in the 'marked for add' state
</code></pre>
<p>Listing keys again shows that all four keys are now active:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list
hello jeff, you are currently using a normal ("active") key
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
4: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub
</code></pre>
<h2 id="optional-undoing-a-mistaken-add-before-confirmation">Optional: Undoing a mistaken add (before confirmation)<a class="headerlink" href="#optional-undoing-a-mistaken-add-before-confirmation" title="Permanent link"></a></h2>
<p>Another advantage of Gitolite using Git internally is that that if we mistakenly add the wrong key, we can undo it before it's confirmed by passing in the <code>keyid</code> we want to remove into the <code>undo-add</code> subcommand:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm undo-add @key4
hello jeff, you are currently using a normal ("active") key
</code></pre>
<p>Listing the keys shows that that new key has been removed:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm list
hello jeff, you are currently using a normal ("active") key
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
</code></pre>
<h1 id="removing-a-key">Removing a key<a class="headerlink" href="#removing-a-key" title="Permanent link"></a></h1>
<h2 id="step-1-mark-the-key-for-deletion">Step 1: Mark the key for deletion<a class="headerlink" href="#step-1-mark-the-key-for-deletion" title="Permanent link"></a></h2>
<p>Deleting a key works very similarly to adding a key, with <code>del</code> substituted for <code>add</code>.</p>
<p>Let's say that I have my four keys from the example above:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list
hello jeff, you are currently using a normal ("active") key
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
4: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub
</code></pre>
<p>I would like to remove the key that on my box is called <code>newkey</code> and in the Gitolite system is known as <code>@key4</code>.</p>
<p>I simply pass in the identifier to the <code>del</code> subcommand of <code>sskm</code>:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm del @key4
hello jeff, you are currently using a normal ("active") key
</code></pre>
<p>Listing the keys now shows that it is marked for deletion:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list
hello jeff, you are currently using a key in the 'marked for del' state
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
== keys marked for deletion ==
1: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub
</code></pre>
<h2 id="step-2-confirming-the-deletion">Step 2: Confirming the deletion<a class="headerlink" href="#step-2-confirming-the-deletion" title="Permanent link"></a></h2>
<p>Just like with Git, where you commit locally before <code>push</code>-ing up to the server, you need to confirm the key addition (see the next section if you made a mistake). We use the <code>confirm-del</code> subcommand to do this, <em>but</em>: unlike the <code>confirm-add</code> subcommand, you <em>must</em> use a <em>different</em> key than the key you are deleting to do the confirmation! This prevents you from accidentally locking yourself out of the system by removing all active keys:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm confirm-del @key4
hello jeff, you are currently using a normal ("active") key
</code></pre>
<p>Listing keys again shows that the fourth key has been removed:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/jeffskey git@git sskm list
hello jeff, you are currently using a normal ("active") key
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
</code></pre>
<h2 id="optional-undoing-a-mistaken-delete-before-confirmation">Optional: Undoing a mistaken delete (before confirmation)<a class="headerlink" href="#optional-undoing-a-mistaken-delete-before-confirmation" title="Permanent link"></a></h2>
<p>Another advantage of Gitolite using Git internally is that that if we mistakenly delete the wrong key, we can undo it before it's confirmed by passing in the <code>keyid</code> we want to keep into the <code>undo-del</code> subcommand. Note that this operation <em>must</em> be performed using the private key that corresponds to the key you are trying to keep! (Security reasons, similar to the reason that you must confirm an addition this way; it prevents anyone from undoing a deletion, and therefore keeping in the system, a key that they cannot prove (by having the corresponding private key) should stay in the system):</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm undo-del @key4
hello jeff, you are currently using a key in the 'marked for del' state

You're undeleting a key that is currently marked for deletion.
    Hit ENTER to undelete this key
    Hit Ctrl-C to cancel the undelete
Please see documentation for caveats on the undelete process as well as how to
actually delete it.
</code></pre>
<p>(Go ahead and hit ENTER there; the caveats are really only on the administrative side of things.)</p>
<p>Listing the keys shows that that new key is now marked active again:</p>
<pre><code>jeff@baklava ~  $  ssh -i .ssh/newkey git@git sskm list
hello jeff, you are currently using a normal ("active") key
you have the following keys:
== active keys ==
1: 72:ef:a3:e0:f5:06:f8:aa:6f:a2:88:9d:50:86:25:4e  : jeff@key1.pub
2: 61:38:a7:9f:ba:cb:99:81:4f:49:2c:8b:c8:63:8e:33  : jeff@key2.pub
3: 2d:78:d4:2c:b1:6d:9a:dc:d9:0d:94:3c:d8:c2:65:44  : jeff@key3.pub
4: ff:92:a2:20:6d:42:6b:cf:20:e8:a2:4a:3b:b0:32:3a  : jeff@key4.pub
</code></pre>
<hr />
<h1 id="important-notes-for-the-admin">important notes for the admin<a class="headerlink" href="#important-notes-for-the-admin" title="Permanent link"></a></h1>
<p>These are the things that can break if you allow your users to use this
command:</p>
<ul>
<li>
<p>"sskm" clones, changes, and pushes back the gitolite-admin repo.  This
    means, even if you're the only administrator, you should never 'git push
    -f', in case you end up overwriting something sskm did.</p>
</li>
<li>
<p>There is no way to distinguish <code>foo/alice.pub</code> from <code>bar/alice.pub</code> using
    this command.  You can distinguish <code>foo/alice.pub</code> from
    <code>bar/alice@home.pub</code>, but that's not because of the foo and bar, it's
    because the two files have different keyids.</p>
<p>In other words, sskm only works with the older style, not with the
"subdirectory" style of <a href="../basic-admin#multiple-keys-per-user">multi-key</a> management.</p>
</li>
<li>
<p>Keys placed in specific folders (for whatever reasons), will probably not
    stay in those folders if this command is used.  Even a key delete, followed
    by undoing the delete, will cause the key to effectively move to the root
    of the key store (i.e., the <code>keydir</code> directory in the gitolite-admin repo).</p>
</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

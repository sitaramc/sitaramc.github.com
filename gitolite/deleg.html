<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>delegating access control responsibilities</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style>
      body        { background: #fff; text-color: #000; margin-left:  40px;   font-size:  0.9em;  font-family: arial; }
  
      code        { font-size:    1.1em;  background:  #ddf; text-color: #000; }
      pre         { margin-left:  2em;    background:  #ddf; text-color: #000; }
      pre code    { font-size:    1.1em;  background:  #ddf; text-color: #000; }
  
      td          { vertical-align: top }
  
      .red        { color: red }
      .blue       { color: blue }
      .green      { color: green }
      .gray       { color: gray }
      .pink       { color: pink }
  
      .box        { background-color:#e0e0e0 }
      .bg-red     { background-color:#ffe0e0 }
      .bg-green   { background-color:#e0ffe0 }
      .bg-blue    { background-color:#e0e0ff }
  
      /* couldn't resist the name! */
      .wd40       { width: 40% !important }
  
      .box-l      { float: left;  padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-right: 4px; }
      .box-r      { float: right; padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-left:  4px; }
  
      .fl-l       { float: left;  padding: 0px 0.5em;                                       margin-right: 4px; }
      .fl-r       { float: right; padding: 0px 0.5em;                                       margin-left:  4px; }
  
      .sidebar {
          margin-left: 4px;
          width: 25%;
          float: right;
          border: 4px solid #fff;
      }
  
  </style>
  <style>
      h1          { background: #ffb; text-color: #000; margin-left: -30px;   border-top:    5px  solid #ccc; }
      h2          { background: #ffb; text-color: #000; margin-left: -20px;   border-top:    3px  solid #ddd; }
      h3          { background: #ffb; text-color: #000; margin-left: -10px; }
      h4          { background: #ffb; text-color: #000; }
  </style>
</head>
<body>
<!--
    generated by gvim then munged a fair bit.  The following command
        vim -E -c "TOhtml" -c "w" -c 'qa!' \-\- conf/gitolite.conf
    may or may not produce the same thing
-->

<style type="text/css">
<!--
.WarningMsg { color: #ff0000; }
.Constant { color: #ffa0a0; }
.Statement { color: #ffff60; font-weight: bold; }
.PreProc { color: #ff80ff; }
.LineNr { color: #ffff00; }
.Comment { color: #80a0ff; }
.Type { color: #60ff60; font-weight: bold; }
.Special { color: #ffa500; }
.Identifier { color: #40ffff; }
.Error { color: #ffffff; background-color: #ff0000; padding-bottom: 1px; }
.Todo { color: #0000ff; background-color: #ffff00; padding-bottom: 1px; }
-->
</style>
<div id="header">
<h1 class="title">delegating access control responsibilities</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#example"><span class="toc-section-number">1</span> example</a></li>
<li><a href="#subconf"><span class="toc-section-number">2</span> the subconf command</a><ul>
<li><a href="#how-the-subconf-name-is-derived"><span class="toc-section-number">2.1</span> how the &quot;subconf name&quot; is derived</a></li>
</ul></li>
<li><a href="#security-notes"><span class="toc-section-number">3</span> security notes</a><ul>
<li><a href="#group-names"><span class="toc-section-number">3.1</span> group names</a></li>
<li><a href="#delegating-pubkeys"><span class="toc-section-number">3.2</span> delegating pubkeys</a></li>
</ul></li>
</ul>
</div>
<script type="text/javascript">
<!--
    function hide_show(id) {
        var e = document.getElementById(id);
        if(e == null)
            return;
        if(e.style.display != 'none')
            e.style.display = 'none';
        else
            e.style.display = 'block';
    }

    window.onload = function() {
        var t = document.getElementById('TOC');
        var sbt = document.getElementById('SBTOC');
        var h = '<div id="PTOC">'
        var h2 = '<p><strong><span class="red">Page TOC</span></strong></p>'
        var h3 = '</div>'
        var h4 = '<div id="GTOC">'
        var h5 = '</div>'
        var hst = '<div style="background: white; color: green; border: 2px solid green"><center><font size=-1><strong>Hide/Show Table of Contents</strong><br />'
        var pd = '<a href="#" onclick="hide_show(\'PTOC\');">Page TOC</a> | '
        var gt = '<a href="#" onclick="hide_show(\'GTOC\');">Gitolite TOC</a></font></center></div>'

        if(t == null)
            sbt.innerHTML = hst + gt + h4 + sbt.innerHTML + h5;
        else {
            sbt.innerHTML = hst + pd + gt + h + h2 + t.innerHTML + h3 + h4 + sbt.innerHTML + h5;
            t.style.display = 'none';   // hide the TOC that pandoc placed
        }
    }
-->
</script>

<style>
    #PTOC ul {
        list-style: none;
        margin-left: 0;
        padding-left: 2em;
        text-indent: -2em;
        padding-bottom: 2em;
    }
    #PTOC ul li {
        padding-bottom: 10px;
    }
    #PTOC ul li ul {
        padding-bottom: 0px;
    }
    #PTOC ul li ul li {
        padding-bottom: 0px;
    }

    .sidebar-toc a:hover {
        background-color: white;
    }

    .sidebar-toc {
        margin-left: 4px;
        width: 25%;
        float: right;
        color: gray;
        background: lightgray;
        border: 4px solid #fff;
        font-size: 0.90em;
    }

    .sidebar-toc ul {
        padding-left: 2em;
    }

</style>

<div id="SBTOC" class="sidebar-toc">

<p><strong><span class="red">Gitolite TOC</span></strong></p>
<hr />
<center>
<span class="red"><strong>Background</strong></span>
</center>

<hr />
<p><a href="index.html">Main page</a></p>
<ul>
<li><a href="index.html#dl">download</a></li>
<li><a href="index.html#rtfm">documentation</a>
<ul>
<li><a href="gitolite.html"><strong>all-in-one</strong></a> page</li>
</ul></li>
<li><a href="index.html#trouble"><strong>troubleshooting</strong></a></li>
<li><a href="index.html#contact"><strong>contact and support</strong></a></li>
<li><a href="index.html#license">license</a></li>
</ul>
<p><a href="overview.html">Overview</a></p>
<ul>
<li>what is Gitolite?</li>
<li>why might you need it?</li>
<li>how does it work?</li>
<li>who uses it?</li>
</ul>
<p><a href="concepts.html">Concepts, conventions, and terminology</a></p>
<ul>
<li>authentication and authorisation</li>
<li>ssh mode and http mode</li>
<li>the &quot;hosting user&quot;</li>
<li>the &quot;logical repo name&quot;</li>
<li>the special gitolite-admin repo</li>
</ul>
<p><a href="req.html">Before you start...</a></p>
<ul>
<li>your skills</li>
<li>your server</li>
<li>your and your users' clients</li>
<li><strong>cautions and caveats</strong></li>
<li><a href="req.html#trying">trying</a> out gitolite safely</li>
</ul>
<hr />
<center>
<span class="red"><strong>Basics</strong></span>
</center>

<hr />
<p><a href="install.html">install and setup</a></p>
<ul>
<li><a href="install.html#qi">quick install+setup</a> (for experts)</li>
<li>the long way around</li>
<li><a href="install.html#upgrading">upgrading</a></li>
<li><a href="install.html#moving">moving servers</a></li>
</ul>
<p><a href="basic-admin.html">Basic Administration</a></p>
<ul>
<li>clone the gitolite-admin repo</li>
<li>add/remove users</li>
<li>add/remove/rename repos</li>
<li>bringing existing repos into gitolite</li>
</ul>
<p><a href="conf.html">The conf file (<code>conf/gitolite.conf</code>)</a></p>
<ul>
<li>basic <a href="conf.html#syntax">syntax</a></li>
<li><a href="conf.html#include">include</a> files</li>
<li><a href="conf.html#groups">group definitions</a></li>
<li><a href="conf.html#rules"><strong><span class="red">access rules</span></strong></a></li>
</ul>
<p><a href="rc.html">the rc file (<code>~/.gitolite.rc</code>)</a></p>
<p><a href="user.html">Your users' view</a> of gitolite</p>
<p>Troubleshooting</p>
<ul>
<li>help for <a href="emergencies.html">emergencies</a></li>
<li>the <a href="ips.html">fool-proof install guide</a></li>
<li>the gitolite &quot;<a href="cookbook.html">cookbook</a>&quot;</li>
</ul>
<hr />
<center>
<span class="red"><strong>Advanced</strong></span>
</center>

<hr />
<p>Advanced &quot;conf file&quot; use</p>
<ul>
<li>specifying <a href="git-config.html">git-config</a> keys and values</li>
<li>gitolite <a href="options.html">options</a></li>
<li><a href="wild.html"><strong>wild repos</strong></a> (user created repos)</li>
<li><a href="vref.html">virtual refs</a></li>
<li><a href="deleg.html">delegation</a> of admin duties</li>
<li><a href="gitweb-daemon.html">gitweb and git-daemon</a></li>
</ul>
<p>Special features/setups</p>
<ul>
<li><strong><a href="mirroring.html">mirroring</a></strong></li>
<li><a href="http.html">http</a> mode</li>
<li>using a <a href="cache.html">cache</a></li>
<li>(<a href="namespaces.html">namespaces</a>)</li>
<li><a href="locking.html">locking</a> binary files</li>
<li><a href="package.html">packaging</a> gitolite</li>
</ul>
<p>Customising gitolite</p>
<ul>
<li>core and <a href="non-core.html">non-core</a> gitolite</li>
<li><a href="dev-notes.html">writing your own</a> non-core programs</li>
<li>gitolite <a href="triggers.html">triggers</a></li>
<li><a href="list-non-core.html">list of non-core programs</a> shipped with gitolite</li>
</ul>
<hr />
<center>
<span class="red"><strong>Extras</strong></span>
</center>

<hr />
<p><a href="odds-and-ends.html">Odds and Ends</a></p>
<ul>
<li><a href="odds-and-ends.html#writable">disabling pushes</a> to take backups</li>
<li><a href="odds-and-ends.html#elsewhere">putting 'repositories' and '.gitolite' elsewhere</a></li>
<li><a href="odds-and-ends.html#keysonly">using pubkeys obtained from elsewhere</a></li>
<li><a href="odds-and-ends.html#gh">giving users their own repos</a></li>
<li><a href="odds-and-ends.html#server-side-admin">administering gitolite directly on the server</a></li>
</ul>
<p>Additional information/discussion</p>
<ul>
<li><a href="ssh.html">all about ssh and gitolite</a></li>
<li>Running the <a href="testing.html">test suite</a></li>
<li><a href="files.html">gitolite files and directories</a></li>
<li><a href="perf.html">gitolite performance</a></li>
<li><a href="migr.html">Migration</a></li>
<li><a href="http://sitaramc.github.com/gitolite/g2/master-toc.html">documentation for gitolite v2</a></li>
<li><a href="regex.html">regular expressions</a></li>
<li><a href="no-way.html">no way!</a></li>
</ul>
<hr />
<center>
<span class="red"><strong>Contributed docs</strong></span>
</center>

<hr />
<p>Contributed software, tools, and documentation</p>
<ul>
<li><a href="ssh-and-http.html">combining ssh and http mode</a></li>
<li><a href="putty.html">putty and msysgit</a></li>
<li><a href="sskm.html">changing keys -- self service key management</a></li>
<li><a href="ukm.html">user key management</a></li>
<li><a href="README-emacs.html">emacs</a> &quot;major mode&quot;</li>
</ul>
</div>

<p>Delegation allows you to divide up a large conf file into smaller groups of repos (called <strong>subconf</strong>s) and hand over responsibility to manage them to <strong>sub-admin</strong>s. Gitolite can prevent one sub-admin from being able to set access rules for any other sub-admin's repos.</p>
<p>Delegation is achieved by combining two gitolite features: <a href="#subconf">subconf</a> and the <a href="vref.html#NAME">NAME VREF</a>.</p>
<h1 id="example"><span class="header-section-number">1</span> example</h1>
<p>Here's a sample conf that does delegation:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Identifier">@webbrowsers</span>        = firefox lynx <span class="Special">browsers/..*</span>
<span class="Identifier">@webservers</span>         = apache nginx <span class="Special">servers/..*</span>
<span class="Identifier">@malwares</span>           = conficker storm <span class="Special">ms/..*</span>
   <span class="Comment"> # side note: if anyone objects, we claim ms stands for &quot;metasploit&quot; ;-)</span>

<span class="Comment"># the admin repo access probably had these 2 lines to start with:</span>
<span class="Type">repo </span>gitolite-admin
<span class="Statement">    RW+</span><span class="Constant">                                     </span>= sitaram
<span class="Comment"># now add these lines to the config for the admin repo</span>
<span class="Statement">    RW</span><span class="Constant">                                      </span>= alice bob mallory
<span class="Statement">    RW</span><span class="Constant">  VREF/NAME/conf/subs/webbrowsers     </span>= alice
<span class="Statement">    RW</span><span class="Constant">  VREF/NAME/conf/subs/webservers      </span>= bob
<span class="Statement">    RW</span><span class="Constant">  VREF/NAME/conf/subs/malwares        </span>= mallory
<span class="Statement">    -</span><span class="Constant">   VREF/NAME/                          </span>=<span class="WarningMsg"> alice bob mallory</span>

<span class="Comment"># pull in these files using the &quot;subconf&quot; command</span>
<span class="PreProc">subconf </span><span class="Constant">&quot;subs/*.conf&quot;</span>
</pre>

<p>If you've read the <a href="vref.html">VREF</a> part, or at least understood how <a href="vref.html#NAME">NAME VREF</a>s work, it should be clear that, in terms of changes to the gitolite-admin repo:</p>
<ul>
<li>The user sitaram has no restrictins of any kind</li>
<li>Users alice, bob, and mallory can only touch files within their assigned areas within conf/subs. If they try to change any other file (keydir, conf/gitolite.conf, or something in one of the other sub-admin's areas), then the last rule kicks in and the push gets rejected.</li>
</ul>
<p>Now all we need is to see what this &quot;subconf&quot; thing is all about.</p>
<h1 id="subconf"><span class="header-section-number">2</span> the subconf command</h1>
<p>Subconf is exactly like the include command in syntax:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="PreProc">subconf </span><span class="Constant">&quot;foo.conf&quot;</span>
</pre>

<p>but while reading the included file (as well as anything included from it), gitolite sets the &quot;current subconf name&quot; to &quot;foo&quot;.</p>
<p>A &quot;subconf&quot; imposes some restrictions on what repos can be managed.</p>
<p>For example, while the subconf name is &quot;foo&quot;, as in the above example, gitolite will only process &quot;repo&quot; lines for:</p>
<ul>
<li>A repo called &quot;foo&quot;.</li>
<li>A group called &quot;<span class="citation">@foo</span>&quot;, as long as the group is defined in the main conf file (i.e., <em>outside</em> &quot;foo.conf&quot;).</li>
<li>A member of a group called &quot;<span class="citation">@foo</span>&quot; (again, defined outside).</li>
<li>A repo that matches a member of a group called &quot;<span class="citation">@foo</span>&quot; if that member is a regular expression.</li>
</ul>
<p>Here's an example. If the main conf file contains</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Identifier">@foo</span>    =   aa bb <span class="Special">cc/..*</span>
</pre>

<p>then the subconf can only accept repo statements that refer to 'foo', '<span class="citation">@foo</span>', 'aa', 'bb', or any repo whose name starts with 'cc/'.</p>
<p><strong>Note</strong>: the subconf name &quot;master&quot; is special; it is the default subconf in effect for the main conf file and has no restrictions.</p>
<h2 id="how-the-subconf-name-is-derived"><span class="header-section-number">2.1</span> how the &quot;subconf name&quot; is derived</h2>
<p>For subconf lines that look just like include statements, i.e.,</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="PreProc">subconf </span><span class="Constant">&quot;foo/bar.conf&quot;</span>
<span class="PreProc">subconf </span><span class="Constant">&quot;frob/*.conf&quot;</span>
   <span class="Comment"> # assume frob has files aa.conf, bb.conf</span>
</pre>

<p>the subconf name as each file is being processed is the base name of the file. This means it would be &quot;bar&quot; for the first line, &quot;aa&quot; when processing &quot;frob/aa.conf&quot;, and &quot;bb&quot; when processing &quot;frob/bb.conf&quot;.</p>
<p>A variation of subconf exists that can explicitly state the subconf name:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="PreProc">subconf </span>foo <span class="Constant">&quot;frob/*.conf&quot;</span>
</pre>

<p>In this variation, regardless of what file in &quot;frob/&quot; is being read, the subconf name in effect is &quot;foo&quot;.</p>
<h1 id="security-notes"><span class="header-section-number">3</span> security notes</h1>
<h2 id="group-names"><span class="header-section-number">3.1</span> group names</h2>
<p>You can use &quot;<span class="citation">@group</span>&quot;s defined in the main config file but do not attempt to redefine or extend them in your own subconf file. If you must extend a group (say <code>@foo</code>) defined in the main config file, do this:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Identifier">@myfoo</span>  =   <span class="Identifier">@foo</span>
<span class="Comment"># now do whatever you want with @myfoo</span>
</pre>

<p>Group names you define in your subconf will not clash even if the exact same name is used in another subconf file, so you need not worry about that.</p>
<h2 id="delegating-pubkeys"><span class="header-section-number">3.2</span> delegating pubkeys</h2>
<p>Short answer: not gonna happen.</p>
<p>The delegation feature is meant only for access control rules, not pubkeys. Adding/removing pubkeys is a much more significant event than changing branch level permissions for people already on staff, and only the main admin should be allowed to do it.</p>
<p>Gitolite's &quot;userids&quot; all live in the same namespace. This is unlikely to change, so please don't ask -- it gets real complicated to do otherwise. Allowing sub-admins to add users means username collisions, which also means security problems (admin-A creates a pubkey for Admin-B, thus gaining access to all of Admin-B's stuff).</p>
<p>If you feel the need to delegate even that, please just go the whole hog and give them separate gitolite instances (i.e., running on different servers, or at least under different gitolite hosting users on the same server)!</p>
</body>
</html>

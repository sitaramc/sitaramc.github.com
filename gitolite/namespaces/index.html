<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>using git namespaces - Gitolite</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/gitolite.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Gitolite</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">what/why <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../overview/">overview</a>
</li>
                            
<li >
    <a href="../concepts/">concepts, conventions, terminology</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">install and setup <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../quick_install/">(unix/ssh experts) quick install and setup</a>
</li>
                            
<li >
    <a href="../install/">normal ssh mode install and setup</a>
</li>
                            
<li >
    <a href="../fool_proof_setup/">(if all else fails) fool-proof, step-by-step, install and setup</a>
</li>
                            
<li >
    <a href="../http/">HTTP mode install</a>
</li>
                            
<li >
    <a href="../migr/">migrating from v2</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">use <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">basic</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../basic-admin/">basic administration</a>
</li>
            
<li >
    <a href="../conf/">the "conf" file (part 1)</a>
</li>
            
<li >
    <a href="../conf-2/">the "conf" file (part 2)</a>
</li>
            
<li >
    <a href="../rc/">the "rc" file</a>
</li>
            
<li >
    <a href="../user/">your users' view</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">advanced</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../git-config/">setting git-config values</a>
</li>
            
<li >
    <a href="../options/">gitolite options</a>
</li>
            
<li >
    <a href="../wild/">ad hoc user-created ("wild") repos</a>
</li>
            
<li >
    <a href="../vref/">virtual refs (part 1)</a>
</li>
            
<li >
    <a href="../vref-2/">virtual refs (part 2)</a>
</li>
            
<li >
    <a href="../deleg/">delegation of admin duties</a>
</li>
            
<li >
    <a href="../gitweb-daemon/">gitweb and git-daemon</a>
</li>
            
<li >
    <a href="../mirroring/">mirroring</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">customise</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../non-core/">core and "non-core" gitolite</a>
</li>
            
<li >
    <a href="../dev-notes/">writing your own non-core code</a>
</li>
            
<li >
    <a href="../triggers/">gitolite triggers</a>
</li>
            
<li >
    <a href="../list-non-core/">list of non-core programs shipped with gitolite</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../cookbook/">(quick! how do I...) the cookbook</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HELP! <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../emergencies/">emergency!!</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">ssh</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../ssh/">ssh</a>
</li>
            
<li >
    <a href="../glssh/">how gitolite uses ssh</a>
</li>
            
<li >
    <a href="../sts/">ssh troubleshooting</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../regex/">regular expressions</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">other docs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../odds-and-ends/">miscellaneous features</a>
</li>
                            
<li class="active">
    <a href="./">using git namespaces</a>
</li>
                            
<li >
    <a href="../locking/">locking binary files</a>
</li>
                            
<li >
    <a href="../testing/">testing gitolite</a>
</li>
                            
<li >
    <a href="../package/">packaging gitolite</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">more about gitolite</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../files/">gitolite files & directories</a>
</li>
            
<li >
    <a href="../rc-33/">the 3.3 format rc file</a>
</li>
            
<li >
    <a href="../perf/">performance</a>
</li>
            
<li >
    <a href="../internals/">internals</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">contrib</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../contrib/ssh-and-http/">Using both ssh and http</a>
</li>
            
<li >
    <a href="../contrib/putty/">Putty and Msysgit</a>
</li>
            
<li >
    <a href="../contrib/sskm/">Self-service key management</a>
</li>
            
<li >
    <a href="../contrib/ukm/">User key management</a>
</li>
            
<li >
    <a href="../contrib/README-emacs/">Emacs major mode</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../no-way/">no way!</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../odds-and-ends/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../locking/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#namespace-support-in-gitolite">namespace support in gitolite</a></li>
        <li class="main "><a href="#background">background</a></li>
        <li class="main "><a href="#terminology">terminology</a></li>
        <li class="main "><a href="#setup">setup</a></li>
        <li class="main "><a href="#use">use</a></li>
        <li class="main "><a href="#details">details</a></li>
        <li class="main "><a href="#warnings">WARNINGS</a></li>
            <li><a href="#security">SECURITY</a></li>
            <li><a href="#gitolite-functionality">gitolite functionality</a></li>
            <li><a href="#gitolite-functionality-mirroring">gitolite functionality -- mirroring</a></li>
        <li class="main "><a href="#other-notes">other notes</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="namespace-support-in-gitolite">namespace support in gitolite<a class="headerlink" href="#namespace-support-in-gitolite" title="Permanent link"></a></h1>
<p><em>This feature is only available in the 'namespaces' branch until enough people
test it and tell me it works fine</em>.</p>
<hr />
<p><strong>AVOID NASTY SURPRISES!</strong>  Please read the entire page before attempting to
use or install this.  Most non-core features of gitolite do not work with
namespaces, and, worse, many of them will <em>fail silently</em>.  There are also
security issues you need to be aware of.</p>
<h1 id="background">background<a class="headerlink" href="#background" title="Permanent link"></a></h1>
<p>In many projects, developers need to push their work to some central place for
others to fetch.  Namespaces allow you to give each developer what looks like
her own repo or set of repos, while combining all these logical repos into one
physical repo on the server.  This saves a lot of disk space if they all share
a lot of common history.</p>
<p>The logical repos look like normal repos to a git <em>client</em>; all the magic is
on the server side.  (But see the "WARNINGS" section).</p>
<h1 id="terminology">terminology<a class="headerlink" href="#terminology" title="Permanent link"></a></h1>
<p>There is one repo that is special, and several others that depend upon it or
use it.  Depending on context, we use one of the following names:</p>
<ul>
<li>Storage context: backing repo/real repo, and logical repos</li>
<li><a href="http://git-scm.com/book/en/Distributed-Git-Distributed-Workflows#Integration-Manager-Workflow">Workflow</a> context: blessed repo and developer repos</li>
</ul>
<p><font color="gray">In addition, in the gitolite context you could say that the
blessed repo is a normal (not "wild") repo and the logical repos are <a class="wikilink" href="../wild/">wild</a>
repos, since that is the most convenient way to set this up.  However, it is
not mandatory -- you can have a wild repo as a backing repo, and/or a normal
repo as a logical repo if you wish.</font></p>
<h1 id="setup">setup<a class="headerlink" href="#setup" title="Permanent link"></a></h1>
<p>First, add the following lines to the rc file, as indicated:</p>
<pre><code># add this line as the *last* item in the PRE_GIT trigger list.  In
# particular, it should be *after* the Mirroring::pre_git line if you're
# using mirroring.
'Namespaces::pre_git',

# add this line as the *first* item in the POST_GIT trigger list.  In
# particular, it should be *before* the Mirroring::post_git line if you're
# using mirroring.
'Namespaces::post_git',
</code></pre>
<p>Then use the following example conf below as a guide and roll your own.  This
example is from a mail to the gitolite list by Javier Domingo ("Mirroring
forks", 13-11-2012), modified slightly.</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Comment"># backing repos, normal (non-wild), serving as blessed repos</span>
<span class="Type">repo </span>   linux git gitolite <span class="Special">[...other</span> <span class="Special">projects...]</span>
<span class="Statement">    RW+</span><span class="Constant">     </span>=   integration-manager
<span class="Statement">    R</span><span class="Constant">       </span>=   <span class="Identifier">@all</span>

<span class="Comment"># logical repos, wild, created by devs as needed</span>
<span class="Type">repo </span>   <span class="PreProc">CREATOR</span>/[a-zA-Z0-9].*
<span class="Statement">    C</span><span class="Constant">       </span>=   <span class="Identifier">@all</span>
<span class="Statement">    RW+</span><span class="Constant">     </span>=   <span class="PreProc">CREATOR</span>
<span class="Statement">    R</span><span class="Constant">       </span>=   <span class="PreProc">READERS</span> <span class="Identifier">@all</span>
    option namespace.pattern = %/* is @1 in @2
</pre>

<h1 id="use">use<a class="headerlink" href="#use" title="Permanent link"></a></h1>
<p>A developer doesn't have to do anything differently.  She will still run,
e.g., <code>git clone git@host:alice/linux</code> to auto-create and clone a <a class="wikilink" href="../wild/">wild</a>
repo for herself, then add a remote to the "backing" repo, fetch it, start
working, and eventually push her work to alice/linux.</p>
<p>However, she might notice some differences.  To begin with, her first push of
an enormous code base, to what she thought was an empty repo on the server,
might go surprisingly fast :)</p>
<p>Secondly, a lot of <em>gitolite</em> commands (and other features) won't work.  See
the "WARNINGS" section below for more.</p>
<h1 id="details">details<a class="headerlink" href="#details" title="Permanent link"></a></h1>
<p>The option line above has 3 parts separated by the words "is" and "in":</p>
<pre><code>&lt;pattern&gt; is &lt;namespace&gt; in &lt;backing repo&gt;
</code></pre>
<p>When a user attempts to access a logical repo (say "alice/linux"), the
namespace pattern for that repo is applied to the repo name as follows:</p>
<ul>
<li>a percent sign matches a single component in the repo name</li>
<li>an asterisk matches one or more components</li>
</ul>
<p>Once the matching is done, each "at-digit" combination is replaced by the
corresponding matched segment to derive the namespace and the backing repo
name.</p>
<p>Some examples may help:</p>
<ul>
<li>
<p>Here's a simple one that separate the first component from the rest:</p>
<p><pre style="color: #ffffff; background-color: #000000;">
    option namespace.pattern = %/* is @1 in @2
</pre></p>
<p>A reponame of 'alice/linux' gives you a namespace of 'alice' and a backing
reponame of 'linux'.  Similarly, 'alice/linux/2.2' gives you 'alice' and
'linux/2.2' (which means a repo of that name has to exist!); notice how
the asterisk grabs up all the remaining components in the repo name.</p>
</li>
<li>
<p>This one separates the first, the second, and all the rest, but combines
    them in a different order:</p>
<p><pre style="color: #ffffff; background-color: #000000;">
    option namespace.pattern = %/%/* is @1/@3 in @2
</pre></p>
<p>A reponame of 'alice/linux/2.2' gives you 'alice/2.2' and 'linux', while a
reponame of 'alice/linux/2.2/smp' gives you 'alice/2.2/smp' and 'linux'.</p>
</li>
<li>
<p>Here's another example on the same lines:</p>
<p><pre style="color: #ffffff; background-color: #000000;">
    option namespace.pattern = %/%/%/* is @3/@2/@4 in @1
</pre></p>
<p>A reponame of 'linux/kernel/torvalds/linux-2.6' gives you a namespace of
'torvalds/kernel/linux-2.6' and a backing repo name of 'linux'.</p>
</li>
<li>
<p>Here's an interesting example, given in full to explain better.  The basic
    problem is that one of our backing repos is not a simple name (like 'git'
    or 'linux'); it is 'sitaramc/gitolite'.</p>
<p>In addition, any developer-owned repo that has 3 or more components is not
a fork of anything at all, and should not be subject to namespace
processing (i.e., it's just a normal repo)</p>
<p><pre style="color: #ffffff; background-color: #000000;">
<span class="Comment"># backing repos</span>
<span class="Type">repo </span>sitaramc/gitolite linux git
    ...access rules for backing repos...
<span class="Comment"># logical repos</span>
<span class="Type">repo </span><span class="PreProc">CREATOR</span>/..<em>
<span class="Statement">    C</span><span class="Constant">   </span>=   <span class="Identifier">@team</span>
<span class="Statement">    RW+</span><span class="Constant"> </span>=   <span class="PreProc">CREATOR</span>
<span class="Statement">    R</span><span class="Constant">   </span>=   <span class="Identifier">@all</span>
    option namespace.pattern-1 = %/gitolite is @1 in sitaramc/gitolite
    option namespace.pattern-2 = %/% is @1 in @2
    option namespace.pattern-3 = %/%/</em> is none in @1/@2/@3
</pre></p>
<p>Firstly, this shows how to specify more than one namespace pattern.  Each
pattern is tried in <em>lexically</em> sorted order until a match is found.
(Warning: "lexically sorted" means 'namespace.pattern-10' sorts before
'namespace.pattern-2'!)</p>
<p>Secondly, the example shows that you can hardcode anything, like we did
for the backing reponame in pattern 1.</p>
<p>Thirdly, it shows how you can specify a pattern that disables namespacing,
like the last pattern.  When the backing repo name ends up being exactly
the same as the original repo name, gitolite notices this and treats it as
a real repo, not as a logical repo.  (If this confuses you, ignore it and
use some other pattern, say <code>CREATOR/personal/..*</code> for developers personal
repos, and don't give them namespace pattern options).</p>
<p>Here are some example results from this setup:</p>
<pre><code>alice/gitolite              -&gt;  alice, sitaramc/gitolite (pattern 1)
alice/linux                 -&gt;  alice, linux (pattern 2)
alice/linux/2.2             -&gt;  (namespace processing disabled)
alice/personal/foo          -&gt;  (namespace processing disabled)
</code></pre>
</li>
<li>
<p>Here's an example with some errors:</p>
<p><pre style="color: #ffffff; background-color: #000000;">
    option namespace.pattern-1 = %/gitolite is @1 in sitaramc/gitolite
    option namespace.pattern-2 = %/% is @1 in @2
    option namespace.pattern-3 = %/%/* is @1/@3 in @2
</pre></p>
<p>If you try 'alice/gitolite/foo' in this setup, it will only match the 3rd
pattern.  The backing repo name will be 'gitolite', which probably doesn't
exist, and git will complain.</p>
<p>Also, without rule 3, trying a repo with more than 2 components won't
work.  Gitolite will complain that no namespace options matched.  This
would indicate a discrepancy between the <code>repo [...]</code> line governing those
options and the options themselves; you need to fine tune one or the
others to fix things.</p>
</li>
</ul>
<h1 id="warnings">WARNINGS<a class="headerlink" href="#warnings" title="Permanent link"></a></h1>
<h2 id="security">SECURITY<a class="headerlink" href="#security" title="Permanent link"></a></h2>
<p><strong>First and most important</strong>, please read 'man gitnamespaces' for important
security information about namespaces.</p>
<p>Secondly, please note that gitolite's access control decisions are made based
on the repo name that the user supplies, even if that is only a logical repo.
E.g., in a sequence like this:</p>
<pre><code>git clone git@server:alice/linux                        # 1
cd alice
git remote add backing git@server:linux
git fetch backing                                       # 2
git checkout master
git push origin master                                  # 3
</code></pre>
<p>Lines 1 and 3 use the access list for the logical repo ("alice/linux") to
allow or reject a push, while line 2, which is directly contacting the
"backing" repo, use that repo's access rules.</p>
<p>In particular, Alice does <strong>not</strong> need write access to the backing repo for
the push to succeed!</p>
<h2 id="gitolite-functionality">gitolite functionality<a class="headerlink" href="#gitolite-functionality" title="Permanent link"></a></h2>
<p>Most things you're used to in gitolite won't work with logical repos.  From
the client point of view, <strong>the only features guaranteed to work on logical
repos are</strong>:</p>
<ul>
<li>normal git operations (clone, fetch, push)</li>
<li>creating a new <a class="wikilink" href="../wild/">wild</a> repo</li>
<li>the <a href="../user/#setget-additional-permissions-for-repos-you-created">perms</a> command (except the "-c" flag)</li>
</ul>
<p>From a server/admin point of view, <strong>the following will not work for logical
repos, and may even fail silently!</strong>:</p>
<ul>
<li>smart-http mode</li>
<li>the 'config' line in gitolite.conf</li>
<li>any 'option's affecting a physical repo, like RepoUmask</li>
<li>anything that expects to be recorded somewhere in the bare repo directory.</li>
<li>...and anything else not explicitly listed as "working" in this doc ;-)</li>
</ul>
<h2 id="gitolite-functionality-mirroring">gitolite functionality -- mirroring<a class="headerlink" href="#gitolite-functionality-mirroring" title="Permanent link"></a></h2>
<p>Mirroring works, but <strong>all the logical repos and the backing repo should have
the same mirroring setup</strong>.  I.e., which server is the master, who are the
slaves, are redirects allowed, if so from where, etc., etc., etc., should all
have the same values for all of them.  I cannot over-emphasise the importance
of this for proper mirroring.</p>
<h1 id="other-notes">other notes<a class="headerlink" href="#other-notes" title="Permanent link"></a></h1>
<p>The "backing repo" needs to exist.  If it is itself a <a class="wikilink" href="../wild/">wild</a> repo, it must
be auto-created <em>before</em> a logical repo that hangs off of it is accessed.</p>
<p>The logical repo must also be mentioned in the gitolite.conf file in some way,
as you saw in the example.  Access control decisions are made based on this
one, not the backing repo.</p>
<p>One <em>quirk</em> is that, if the logical repo is a wild repo, then an actual repo
with that name <em>is</em> created on disk.  Gitolite needs a place to keep its
repo-specific permissions so it has to do that.  You will find, however, that
the objects directory is pretty much empty, even after a lot of activity.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

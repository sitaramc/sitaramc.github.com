<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>&quot;non-core&quot; gitolite</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style>
      body        { background: #fff; text-color: #000; margin-left:  40px;   font-size:  0.9em;  font-family: arial; }
  
      code        { font-size:    1.1em;  background:  #ddf; text-color: #000; }
      pre         { margin-left:  2em;    background:  #ddf; text-color: #000; }
      pre code    { font-size:    1.1em;  background:  #ddf; text-color: #000; }
  
      td          { vertical-align: top }
  
      .red        { color: red }
      .blue       { color: blue }
      .green      { color: green }
      .gray       { color: gray }
      .pink       { color: pink }
  
      .box        { background-color:#e0e0e0 }
      .bg-red     { background-color:#ffe0e0 }
      .bg-green   { background-color:#e0ffe0 }
      .bg-blue    { background-color:#e0e0ff }
  
      /* couldn't resist the name! */
      .wd40       { width: 40% !important }
  
      .box-l      { float: left;  padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-right: 4px; }
      .box-r      { float: right; padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-left:  4px; }
  
      .fl-l       { float: left;  padding: 0px 0.5em;                                       margin-right: 4px; }
      .fl-r       { float: right; padding: 0px 0.5em;                                       margin-left:  4px; }
  
      .sidebar {
          margin-left: 4px;
          width: 25%;
          float: right;
          border: 4px solid #fff;
      }
  
  </style>
  <style>
      h1          { background: #ffb; text-color: #000; margin-left: -30px;   border-top:    5px  solid #ccc; }
      h2          { background: #ffb; text-color: #000; margin-left: -20px;   border-top:    3px  solid #ddd; }
      h3          { background: #ffb; text-color: #000; margin-left: -10px; }
      h4          { background: #ffb; text-color: #000; }
  </style>
</head>
<body>
<!--
    generated by gvim then munged a fair bit.  The following command
        vim -E -c "TOhtml" -c "w" -c 'qa!' \-\- conf/gitolite.conf
    may or may not produce the same thing
-->

<style type="text/css">
<!--
.WarningMsg { color: #ff0000; }
.Constant { color: #ffa0a0; }
.Statement { color: #ffff60; font-weight: bold; }
.PreProc { color: #ff80ff; }
.LineNr { color: #ffff00; }
.Comment { color: #80a0ff; }
.Type { color: #60ff60; font-weight: bold; }
.Special { color: #ffa500; }
.Identifier { color: #40ffff; }
.Error { color: #ffffff; background-color: #ff0000; padding-bottom: 1px; }
.Todo { color: #0000ff; background-color: #ffff00; padding-bottom: 1px; }
-->
</style>
<div id="header">
<h1 class="title">&quot;non-core&quot; gitolite</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#ncintro"><span class="toc-section-number">1</span> core versus non-core</a></li>
<li><a href="#ncloc"><span class="toc-section-number">2</span> locations...</a><ul>
<li><a href="#for-non-core-programs-shipped-with-gitolite"><span class="toc-section-number">2.1</span> ...for non-core programs shipped with gitolite</a></li>
<li><a href="#localcode"><span class="toc-section-number">2.2</span> ...for <em>your</em> non-core programs</a></li>
<li><a href="#pushcode"><span class="toc-section-number">2.3</span> using the gitolite-admin repo to manage non-core code</a></li>
</ul></li>
<li><a href="#nctypes"><span class="toc-section-number">3</span> types of non-core programs</a><ul>
<li><a href="#commands"><span class="toc-section-number">3.1</span> gitolite &quot;commands&quot;</a></li>
<li><a href="#hooks"><span class="toc-section-number">3.2</span> hooks and gitolite</a><ul>
<li><a href="#rsh"><span class="toc-section-number">3.2.1</span> repo-specific hooks</a></li>
</ul></li>
<li><a href="#sugar"><span class="toc-section-number">3.3</span> syntactic sugar</a></li>
<li><a href="#triggers"><span class="toc-section-number">3.4</span> triggers</a></li>
<li><a href="#vrefs"><span class="toc-section-number">3.5</span> VREFs</a></li>
</ul></li>
</ul>
</div>
<script type="text/javascript">
<!--
    function hide_show(id) {
        var e = document.getElementById(id);
        if(e == null)
            return;
        if(e.style.display != 'none')
            e.style.display = 'none';
        else
            e.style.display = 'block';
    }

    window.onload = function() {
        var t = document.getElementById('TOC');
        var sbt = document.getElementById('SBTOC');
        var h = '<div id="PTOC">'
        var h2 = '<p><strong><span class="red">Page TOC</span></strong></p>'
        var h3 = '</div>'
        var h4 = '<div id="GTOC">'
        var h5 = '</div>'
        var hst = '<div style="background: white; color: green; border: 2px solid green"><center><font size=-1><strong>Hide/Show Table of Contents</strong><br />'
        var pd = '<a href="#" onclick="hide_show(\'PTOC\');">Page TOC</a> | '
        var gt = '<a href="#" onclick="hide_show(\'GTOC\');">Gitolite TOC</a></font></center></div>'

        if(t == null)
            sbt.innerHTML = hst + gt + h4 + sbt.innerHTML + h5;
        else {
            sbt.innerHTML = hst + pd + gt + h + h2 + t.innerHTML + h3 + h4 + sbt.innerHTML + h5;
            t.style.display = 'none';   // hide the TOC that pandoc placed
        }
    }
-->
</script>

<style>
    #PTOC ul {
        list-style: none;
        margin-left: 0;
        padding-left: 2em;
        text-indent: -2em;
        padding-bottom: 2em;
    }
    #PTOC ul li {
        padding-bottom: 10px;
    }
    #PTOC ul li ul {
        padding-bottom: 0px;
    }
    #PTOC ul li ul li {
        padding-bottom: 0px;
    }

    .sidebar-toc a:hover {
        background-color: white;
    }

    .sidebar-toc {
        margin-left: 4px;
        width: 25%;
        float: right;
        color: gray;
        background: lightgray;
        border: 4px solid #fff;
        font-size: 0.90em;
    }

    .sidebar-toc ul {
        padding-left: 2em;
    }

</style>

<div id="SBTOC" class="sidebar-toc">

<p><strong><span class="red">Gitolite TOC</span></strong></p>
<hr />
<center>
<span class="red"><strong>Background</strong></span>
</center>

<hr />
<p><a href="index.html">Main page</a></p>
<ul>
<li><a href="index.html#dl">download</a></li>
<li><a href="index.html#rtfm">documentation</a></li>
<li><a href="index.html#trouble"><strong>troubleshooting</strong></a></li>
<li><a href="index.html#contact"><strong>contact and support</strong></a></li>
<li><a href="index.html#license">license</a></li>
</ul>
<p><a href="overview.html">Overview</a></p>
<ul>
<li>what is Gitolite?</li>
<li>why might you need it?</li>
<li>how does it work?</li>
<li>who uses it?</li>
</ul>
<p><a href="concepts.html">Concepts and terminology</a></p>
<ul>
<li>authentication and authorisation</li>
<li>the &quot;hosting user&quot;</li>
<li>ssh mode and http mode</li>
<li>the special gitolite-admin repo</li>
</ul>
<p><a href="req.html">Before you start...</a></p>
<ul>
<li>your skills</li>
<li>your server</li>
<li>your and your users' clients</li>
<li><strong>cautions and caveats</strong></li>
<li><a href="req.html#trying">trying</a> out gitolite safely</li>
</ul>
<hr />
<center>
<span class="red"><strong>Basics</strong></span>
</center>

<hr />
<p><a href="install.html">install and setup</a></p>
<ul>
<li><a href="install.html#qi">quick install+setup</a> (for experts)</li>
<li>the long way around</li>
<li><a href="install.html#upgrading">upgrading</a></li>
<li><a href="install.html#moving">moving servers</a></li>
</ul>
<p><a href="basic-admin.html">Basic Administration</a></p>
<ul>
<li>clone the gitolite-admin repo</li>
<li>add/remove users</li>
<li>add/remove/rename repos</li>
<li>bringing existing repos into gitolite</li>
</ul>
<p><a href="conf.html">The conf file (<code>conf/gitolite.conf</code>)</a></p>
<ul>
<li>basic <a href="conf.html#syntax">syntax</a></li>
<li><a href="conf.html#include">include</a> files</li>
<li><a href="conf.html#groups">group definitions</a></li>
<li><a href="conf.html#rules"><strong><span class="red">access rules</span></strong></a></li>
</ul>
<p><a href="rc.html">the rc file (<code>~/.gitolite.rc</code>)</a></p>
<p><a href="user.html">Your users' view</a> of gitolite</p>
<p>Troubleshooting</p>
<ul>
<li>help for <a href="emergencies.html">emergencies</a></li>
<li>the <a href="ips.html">fool-proof install guide</a></li>
<li>the gitolite &quot;<a href="cookbook.html">cookbook</a>&quot;</li>
</ul>
<hr />
<center>
<span class="red"><strong>Advanced</strong></span>
</center>

<hr />
<p>Advanced &quot;conf file&quot; use</p>
<ul>
<li>specifying <a href="git-config.html">git-config</a> keys and values</li>
<li>gitolite <a href="options.html">options</a></li>
<li><a href="wild.html"><strong>wild repos</strong></a> (user created repos)</li>
<li><a href="vref.html">virtual refs</a></li>
<li><a href="deleg.html">delegation</a> of admin duties</li>
<li><a href="gitweb-daemon.html">gitweb and git-daemon</a></li>
</ul>
<p>Special features/setups</p>
<ul>
<li><strong><a href="mirroring.html">mirroring</a></strong></li>
<li><a href="http.html">http</a> mode</li>
<li>using a <a href="cache.html">cache</a></li>
<li>(<a href="namespaces.html">namespaces</a>)</li>
<li><a href="locking.html">locking</a> binary files</li>
<li><a href="package.html">packaging</a> gitolite</li>
</ul>
<p>Customising gitolite</p>
<ul>
<li>core and <a href="non-core.html">non-core</a> gitolite</li>
<li><a href="dev-notes.html">writing your own</a> non-core programs</li>
<li>gitolite <a href="triggers.html">triggers</a></li>
<li><a href="list-non-core.html">list of non-core programs</a> shipped with gitolite</li>
</ul>
<hr />
<center>
<span class="red"><strong>Extras</strong></span>
</center>

<hr />
<p><a href="odds-and-ends.html">Odds and Ends</a></p>
<ul>
<li><a href="odds-and-ends.html#writable">disabling pushes</a> to take backups</li>
<li><a href="odds-and-ends.html#elsewhere">putting 'repositories' and '.gitolite' elsewhere</a></li>
<li><a href="odds-and-ends.html#keysonly">using pubkeys obtained from elsewhere</a></li>
<li><a href="odds-and-ends.html#gh">giving users their own repos</a></li>
<li><a href="odds-and-ends.html#server-side-admin">administering gitolite directly on the server</a></li>
</ul>
<p>Additional information/discussion</p>
<ul>
<li><a href="ssh.html">all about ssh and gitolite</a></li>
<li>Running the <a href="testing.html">test suite</a></li>
<li><a href="files.html">gitolite files and directories</a></li>
<li><a href="perf.html">gitolite performance</a></li>
<li><a href="migr.html">Migration</a></li>
<li><a href="http://sitaramc.github.com/gitolite/g2/master-toc.html">documentation for gitolite v2</a></li>
<li><a href="regex.html">regular expressions</a></li>
<li><a href="no-way.html">no way!</a></li>
</ul>
<hr />
<center>
<span class="red"><strong>Contributed docs</strong></span>
</center>

<hr />
<p>Contributed software, tools, and documentation</p>
<ul>
<li><a href="ssh-and-http.html">combining ssh and http mode</a></li>
<li><a href="putty.html">putty and msysgit</a></li>
<li><a href="sskm.html">changing keys -- self service key management</a></li>
<li><a href="ukm.html">user key management</a></li>
<li><a href="README-emacs.html">emacs</a> &quot;major mode&quot;</li>
</ul>
</div>

<p>Much of gitolite's functionality comes from programs and scripts that are not considered &quot;core&quot;. This keeps the core simpler, and allows you to enhance gitolite for your own site without too much fuss.</p>
<p>Documentation for non-core gitolite is organised as follows:</p>
<ul>
<li><p>This page describes the types of non-core programs and how/where to install code that is specific to your site.</p></li>
<li><p>The <a href="dev-notes.html">developer notes</a> page tells you how to write your own non-core programs.</p></li>
<li><p>The <a href="non-core.html">list of non-core programs</a> talks about what's already shipped with gitolite, with a brief description of each.</p></li>
</ul>
<hr />
<h1 id="ncintro"><span class="header-section-number">1</span> core versus non-core</h1>
<p>Gitolite has five types of non-core code:</p>
<ul>
<li><em>Commands</em> can be run from the shell command line. Among those, the ones in the ENABLE list in the rc file can also be run remotely.</li>
<li><em>Hooks</em> are standard git hooks.</li>
<li><em>Sugar scripts</em> change the conf language for your convenience. The word sugar comes from &quot;syntactic sugar&quot;.</li>
<li><em>Triggers</em> are to gitolite what hooks are to git. I just chose a different name to avoid confusion and constant disambiguation in the docs.</li>
<li><em>VREFs</em> are extensions to the access control check part of gitolite.</li>
</ul>
<h1 id="ncloc"><span class="header-section-number">2</span> locations...</h1>
<h2 id="for-non-core-programs-shipped-with-gitolite"><span class="header-section-number">2.1</span> ...for non-core programs shipped with gitolite</h2>
<table><tr><td>

<p><code>gitolite query-rc GL_BINDIR</code> will tell you where gitolite's code has been installed. That directory should look like this. Among these, the directories in green are considered &quot;non-core&quot;, while the ones in red are considered &quot;core&quot;. In addition, the two files &quot;gitolite&quot; and &quot;gitolite-shell&quot; in src are also considered &quot;core&quot;</p>
<p>You might notice that there are two locations for <a href="triggers.html">triggers</a>; that is simply because there are two types of them. You might also notice that there is no place for hooks -- gitolite doesn't <em>ship</em> with any hooks that are non-core.</p>
</td><td>

<pre style="font-family: 'Andale mono',monospace; margin-top: 0; font-weight: bold; padding: 4px; color: #ffffff; background-color: #000000;">

.
├──<span style="color: #00ff00">commands</span>
├── lib
│   └── Gitolite
│       ├── <span style="color: #ff0000">Conf</span>
│       ├── <span style="color: #ff0000">Hooks</span>
│       ├── <span style="color: #ff0000">Test</span>
│       └── <span style="color: #00ff00">Triggers</span>
├── <span style="color: #00ff00">syntactic-sugar</span>
├── <span style="color: #00ff00">triggers</span>
└── <span style="color: #00ff00">VREF</span>

</pre>

</td></tr></table>

<h2 id="localcode"><span class="header-section-number">2.2</span> ...for <em>your</em> non-core programs</h2>
<table><tr><td>

<p>If you want to add your own non-core programs, or even <em>override</em> the shipped ones with your own, you can.</p>
<p>Put your programs in some convenient directory and use the <code>LOCAL_CODE</code> rc variable to tell gitolite where that is. <strong>Please supply the FULL path</strong> to this variable. (You'll find the rc file already has examples lines, commented out, so it's easy to know where to put it and what syntax to use).</p>
<p>Within that directory, you can use any or all of the subdirectories shown here.</p>
<p>If you add a program in your local code directory with the same name as a shipped program, gitolite uses your version.</p>
<p><span class="gray">Notice that there are two directories related to hooks here, neither of which exist in the shipped non-core code. Also, the <code>hooks/common</code> directory is a bit special. If you add new hooks to this, you must run <code>gitolite setup</code>, or at least <code>gitolite setup --hooks-only</code>.</span></p>
</td><td>

<pre style="float: right; font-family: 'Andale mono',monospace; margin-top: 0; font-weight: bold; padding: 4px; color: #ffffff; background-color: #000000;">

.
├──<span style="color: #00ff00">commands</span>
├── hooks
│   └── <span style="color: #00ff00">common</span>
│   └── <span style="color: #00ff00">repo-specific</span>
├── lib
│   └── Gitolite
│       └── <span style="color: #00ff00">Triggers</span>
├── <span style="color: #00ff00">syntactic-sugar</span>
├── <span style="color: #00ff00">triggers</span>
└── <span style="color: #00ff00">VREF</span>

</pre>

</td></tr></table>

<h2 id="pushcode"><span class="header-section-number">2.3</span> using the gitolite-admin repo to manage non-core code</h2>
<div class="box-r" style="margin-left:4px; width: 33%">
<p><span class="red"><strong>IMPORTANT SECURITY NOTE</strong></span></p>
<p><strong>In this mode, anyone who can push changes to the admin repo will effectively be able to run any arbitrary command on the server.</strong> See <a href="rc.html#privesc">gitolite admin and shell access</a> for more background.</p>
</div>
<p>The location given in <code>LOCAL_CODE</code> could be anywhere on disk, like say <code>$ENV{HOME}/local</code>.</p>
<p>However, some administrators find it convenient to use the admin repo to manage this code as well, getting the benefits of versioning them as well as making changes to them without having to log on to the server.</p>
<p>To do this, simply point <code>LOCAL_CODE</code> to someplace inside <code>$GL_ADMIN_BASE</code> in the rc file. I <strong>strongly</strong> suggest:</p>
<pre><code>LOCAL_CODE  =&gt;  &quot;$rc{GL_ADMIN_BASE}/local&quot;,</code></pre>
<p>Then you create a directory called &quot;local&quot; in your gitolite clone, and create the directory structure (shown in the previous section) within that directory. Thus, when you push the admin repo, the files will land up, with the correct paths, in the location pointed to by LOCAL_CODE.</p>
<p>(Note: when you do this, gitolite takes care of running <code>gitolite setup --hooks-only</code> when you change any hooks and push).</p>
<h1 id="nctypes"><span class="header-section-number">3</span> types of non-core programs</h1>
<h2 id="commands"><span class="header-section-number">3.1</span> gitolite &quot;commands&quot;</h2>
<p>Gitolite comes with several commands that users can run. Remote users run commands by saying:</p>
<pre><code>ssh git@host command-name [args...]</code></pre>
<p>while on the server you can run</p>
<pre><code>gitolite command [args...]</code></pre>
<p>Very few commands are designed to be run both ways, but it can be done, by checking for the presence of env var <code>GL_USER</code>.</p>
<p>All commands respond to a single <code>-h</code> option with a suitable message.</p>
<p>You can get a <strong>list of available commands</strong> by using the <code>help</code> command. Naturally, a remote user will see a much smaller list than the server user.</p>
<p>You allow a command to be run from remote clients by adding its name to (or uncommenting it if it's already added but commented out) the ENABLE list in the <a href="rc.html">rc</a> file.</p>
<h2 id="hooks"><span class="header-section-number">3.2</span> hooks and gitolite</h2>
<p>You can install any hooks except these:</p>
<ul>
<li><p>(all repos) Gitolite reserves the <code>update</code> hook. See the &quot;update hook&quot; section in <a href="dev-notes.html">dev-notes</a> if you want additional update hook functionality.</p></li>
<li><p>(gitolite-admin repo only) Gitolite reserves the <code>post-update</code> hook.</p></li>
</ul>
<p>How/where to install them is described in detail in the &quot;locations&quot; section above, especially <a href="#localcode">this</a> and <a href="#pushcode">this</a>. The summary is that you put them in the &quot;hooks/common&quot; sub-directory within the directory whose name is given in the <code>LOCAL_CODE</code> rc variable, then run <code>gitolite setup</code>.</p>
<h3 id="rsh"><span class="header-section-number">3.2.1</span> repo-specific hooks</h3>
<p>If you want to add hooks only to specific repos, you can just do it manually if you wish -- just log on to the server and add hooks (except update hook and, for the special gitolite-admin repo, the post-update hook -- touch these and all bets on gitolite's functionality are off).</p>
<p>However, if you want to do that from within gitolite, and thus keep everything together, you can do that also. Here's how.</p>
<ul>
<li><p>Create a directory called <code>hooks/repo-specific</code> in whatever location you decided to use for your non-core code (i.e., direct on the server, or within the gitolite-admin repo).</p></li>
<li><p>Add your hooks here, with descriptive names (i.e., not &quot;post-receive&quot;, etc., but maybe &quot;jenkins&quot; or &quot;deploy&quot; or whatever).</p></li>
<li><p>Uncomment the 'repo-specific-hooks' line in the rc file or add it to the ENABLE list if it doesn't exist.</p>
<p>If your rc file does not have an ENABLE list, you need to add this to the POST_COMPILE and the POST_CREATE lists. Click <a href="triggers.html#addtrig">here</a> for more on all this.</p></li>
<li>Now add lines like this to your conf file:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">    repo </span>   foo
        option hook.post-receive    =   deploy
</pre>

<p>The syntax should be fairly obvious, but just to be clear, in this case a symlink called &quot;post-receive&quot; will be placed in foo.git/hooks, pointing to the executable called &quot;deploy&quot; in hooks/repo-specific in the local-code area.</p>
<p><strong>WARNING</strong>: if the hook already exists, it is silently overwritten.</p>
<p><strong>WARNING</strong>: once the hook is placed, you can't remove it through gitolite. That is, removing the option line won't do anything. You'll have to go to the server and remove it manually. (You could, as a simple work-around, create a &quot;no-op&quot; script that just does &quot;exit 0&quot;, and change the option line to point the hook to that, so it <em>effectively</em> gets deleted!).</p></li>
<li><span class="gray">(v3.6+)</span> You can assign multiple targets for each hook. For example, you could say
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">    repo </span>   foo
        option hook.post-receive    =   deploy mail-admins
</pre>

<p>where &quot;deploy&quot; and &quot;mail-admins&quot; are pieces of code that do whatever their names suggest, and both are, independently, candidates for being run from a post-receive hook.</p>
<p>When you do this, gitolite does whatever is needed to run each of them as independent post-receive hooks (including sending them info over their STDIN as documented in 'man githooks').</p></li>
<li><span class="gray">(v3.6+)</span> You can change these hooks by saying:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">    repo </span>   foo
        option hook.post-receive    =   deploy mail-admins
</pre>

or delete all of them by saying:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">    repo </span>   foo
    option hook.post-receive    =   <span class="Constant">&quot;&quot;</span>
</pre>
</li>
</ul>
<h2 id="sugar"><span class="header-section-number">3.3</span> syntactic sugar</h2>
<p>Sugar scripts help you change the perceived syntax of the conf language. The base syntax of the language is very simple, so sugar scripts take something <em>else</em> and convert it into that.</p>
<p>That way, the admin sees additional features (like allowing continuation lines), while the parser in the core gitolite engine does not change.</p>
<p>If you want to write your own sugar scripts, please read the &quot;your own sugar&quot; section in <a href="dev-notes.html">dev-notes</a> first then email me.</p>
<p>You enable a sugar script by uncommenting the feature name in the ENABLE list in the rc file.</p>
<h2 id="triggers"><span class="header-section-number">3.4</span> triggers</h2>
<p>Triggers have their own <a href="triggers.html">page</a>.</p>
<h2 id="vrefs"><span class="header-section-number">3.5</span> VREFs</h2>
<p>VREFs also have their own <a href="vref.html">page</a>.</p>
</body>
</html>

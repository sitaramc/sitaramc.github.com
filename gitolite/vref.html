
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="templates.html">
      
      
        <link rel="next" href="vref-2.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>virtual refs (part 1) - Gitolite</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/gitolite.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#virtual-refs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Gitolite" class="md-header__button md-logo" aria-label="Gitolite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gitolite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              virtual refs (part 1)
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Gitolite" class="md-nav__button md-logo" aria-label="Gitolite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Gitolite
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    what/why
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            what/why
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    concepts, conventions, terminology
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    install and setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            install and setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quick_install.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (unix/ssh experts) quick install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="install.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    normal ssh mode install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fool_proof_setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (if all else fails) fool-proof, step-by-step, install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP mode install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    migrating from v2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    use
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            use
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    basic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            basic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="basic-admin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    basic administration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="conf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "conf" file (part 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="conf-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "conf" file (part 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "rc" file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="user.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    your users' view
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="git-config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    setting git-config values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="options.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="wild.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ad hoc user-created ("wild") repos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    using templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    virtual refs (part 1)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="vref.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    virtual refs (part 1)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-introexample" class="md-nav__link">
    <span class="md-ellipsis">
      quick intro/example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-use-and-understanding" class="md-nav__link">
    <span class="md-ellipsis">
      basic use and understanding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-use" class="md-nav__link">
    <span class="md-ellipsis">
      advanced use
    </span>
  </a>
  
    <nav class="md-nav" aria-label="advanced use">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#differences-from-normal-refs" class="md-nav__link">
    <span class="md-ellipsis">
      differences from normal refs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-virtual-refs" class="md-nav__link">
    <span class="md-ellipsis">
      generating virtual refs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-details-and-nuances" class="md-nav__link">
    <span class="md-ellipsis">
      more details and nuances
    </span>
  </a>
  
    <nav class="md-nav" aria-label="more details and nuances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mimicking-a-plain-old-update-hook" class="md-nav__link">
    <span class="md-ellipsis">
      mimicking a plain old update hook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-if-the-vref-maker-prints-a-different-virtual-ref" class="md-nav__link">
    <span class="md-ellipsis">
      what if the VREF-maker prints a different virtual ref?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-is-fallthru-considered-success-with-vrefs" class="md-nav__link">
    <span class="md-ellipsis">
      why is fallthru considered success with VREFs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-if-the-vref-maker-prints-something-thats-not-even-a-virtual-ref" class="md-nav__link">
    <span class="md-ellipsis">
      what if the VREF-maker prints something that's not even a virtual ref?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-what-order-are-vref-makers-called" class="md-nav__link">
    <span class="md-ellipsis">
      in what order are VREF-makers called?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-arguments-are-passed-to-the-vref-maker" class="md-nav__link">
    <span class="md-ellipsis">
      what arguments are passed to the vref-maker?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vref-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    virtual refs (part 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deleg.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    delegation of admin duties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gitweb-daemon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitweb and git-daemon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mirroring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mirroring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    customise
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            customise
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="non-core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    core and "non-core" gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dev-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    writing your own non-core code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="triggers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite triggers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="list-non-core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    list of non-core programs shipped with gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cookbook.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (quick! how do I...) the cookbook
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    HELP!
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            HELP!
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="emergencies.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emergency!!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ssh
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            ssh
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ssh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ssh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="glssh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    how gitolite uses ssh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ssh troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="regex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    regular expressions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    other docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            other docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="odds-and-ends.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    miscellaneous features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="locking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    locking binary files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    testing gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="package.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    packaging gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gitolite-and-ssh-certs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite and ssh certs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    more about gitolite
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            more about gitolite
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="files.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite files & directories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rc-33.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the 3.3 format rc file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="perf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="internals.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internals
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    contrib
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            contrib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/ssh-and-http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using both ssh and http
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/putty.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Putty and Msysgit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/sskm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Self-service key management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/ukm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User key management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/README-emacs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emacs major mode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="no-way.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    no way!
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-introexample" class="md-nav__link">
    <span class="md-ellipsis">
      quick intro/example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-use-and-understanding" class="md-nav__link">
    <span class="md-ellipsis">
      basic use and understanding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-use" class="md-nav__link">
    <span class="md-ellipsis">
      advanced use
    </span>
  </a>
  
    <nav class="md-nav" aria-label="advanced use">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#differences-from-normal-refs" class="md-nav__link">
    <span class="md-ellipsis">
      differences from normal refs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-virtual-refs" class="md-nav__link">
    <span class="md-ellipsis">
      generating virtual refs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-details-and-nuances" class="md-nav__link">
    <span class="md-ellipsis">
      more details and nuances
    </span>
  </a>
  
    <nav class="md-nav" aria-label="more details and nuances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mimicking-a-plain-old-update-hook" class="md-nav__link">
    <span class="md-ellipsis">
      mimicking a plain old update hook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-if-the-vref-maker-prints-a-different-virtual-ref" class="md-nav__link">
    <span class="md-ellipsis">
      what if the VREF-maker prints a different virtual ref?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-is-fallthru-considered-success-with-vrefs" class="md-nav__link">
    <span class="md-ellipsis">
      why is fallthru considered success with VREFs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-if-the-vref-maker-prints-something-thats-not-even-a-virtual-ref" class="md-nav__link">
    <span class="md-ellipsis">
      what if the VREF-maker prints something that's not even a virtual ref?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-what-order-are-vref-makers-called" class="md-nav__link">
    <span class="md-ellipsis">
      in what order are VREF-makers called?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-arguments-are-passed-to-the-vref-maker" class="md-nav__link">
    <span class="md-ellipsis">
      what arguments are passed to the vref-maker?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="virtual-refs">virtual refs<a class="headerlink" href="#virtual-refs" title="Permanent link">#</a></h1>
<center>(part 1)</center>

<hr />
<p>VREFs are a mechanism to add additional constraints to a push.</p>
<p>They are also the simplest way to add your old update hooks to gitolite --
they'll just work, no coding changes needed.  If that's all you need, you
should head over to the <a href="cookbook.html">cookbook</a> and look for the section on "adding your
own update hooks".</p>
<div class="admonition danger">
<p class="admonition-title">IMPORTANT:</p>
<p>Fallthru is success in VREFs, unlike for normal refs.  That won't make
sense until you read further, but I had to put it up here for folks who
stop reading halfway!</p>
</div>
<h2 id="quick-introexample">quick intro/example<a class="headerlink" href="#quick-introexample" title="Permanent link">#</a></h2>
<p>Here's an example to start you off.</p>
<p>To disallow junior developers from changing more than five files, or from
touching the Makefile, you can do this:</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">repo</span> foo
    <span class="Statement">RW+</span>                     =   <span class="Identifier">@all-devs</span>

    <span class="Statement">-</span>   <span class="Constant">VREF/COUNT/5</span>        =   <span class="WarningMsg">@junior-devs</span>
    <span class="Statement">-</span>   <span class="Constant">VREF/</span><span class="PreProc">NAME/</span><span class="Constant">Makefile</span>  =   <span class="WarningMsg">@junior-devs</span>
</pre>

<p>Here's a pictorial representation of what happens, at a very high level, based
on the <code>VREF/COUNT/5</code> rule in the rule list above.</p>
<p><img alt="" src="vr-1.png" /></p>
<ol>
<li>
<p>To start with, git-receive-pack calls the update hook with what we will
    call a "real" ref, something like "refs/heads/master", or
    "refs/tags/v1.0" -- in general, something that starts with "refs/".</p>
<p>This ref is sent through "<a href="conf-2.html#putting-it-all-together">check #2</a>" (please click to refresh your
memory if needed).</p>
<p>Any rules that specify a <a href="conf.html#the-refex-field">refex</a> starting with "VREF/" clearly won't
match and are ignored in this check.</p>
</li>
<li>
<p>Assuming that check did not fail, the gitolite code in the update hook
    then starts looking at each "VREF" rule in the rule list that applies to
    that repo accessed by that user.  For each one, it runs the actual VREF
    program whose name is given in the word after <code>VREF/</code>. (The rest of the
    words, if any, along with all sorts of other information, are supplied as
    <a href="vref.html#what-arguments-are-passed-to-the-vref-maker">arguments</a>).</p>
</li>
<li>
<p>The STDOUT of the called program is captured and any line that starts with
    the characters <code>VREF/</code> is taken as a "<strong>virtual</strong>" ref, and is run through
    the same "<a href="conf-2.html#putting-it-all-together">check #2</a>". <span class="red"><strong>The only difference is that, unlike
    for a regular ref, fallthru does not result in failure, but
    success.</strong></span></p>
</li>
</ol>
<h2 id="basic-use-and-understanding">basic use and understanding<a class="headerlink" href="#basic-use-and-understanding" title="Permanent link">#</a></h2>
<p>Normally, rules deal with branches and tags (which git collectively calls
"refs").  The "ref" is a property of the push which gitolite checks against
the set of rules.</p>
<p>"Virtual refs" are other properties of a push that gitolite can be told to
check, in addition to the normal ref.  For example, "this push has more than 5
changed files" could be one property.  Or "this push changed the file called
Makefile" could be another.  These properties are represented as "virtual
refs" that start with <code>VREF/</code>.  (Recall that "normal" refs start with
<code>refs/</code>).</p>
<p>The simplest way to use them is as <em>additional</em> "deny" rules to fail a push
that might otherwise have passed.  This is what the example at the top shows.</p>
<p>It helps to separate VREF rules from normal rules, since no access rule can
match both a normal ref and a virtual ref. Here's a good way to structure your
rules:</p>
<ul>
<li>
<p>Put your normal ref rules first.  These apply to the branch name or tag
    name that git itself knows about and sends to gitolite's update hook.</p>
<p>Fallthru is failure here, which means the ref being pushed <strong>must</strong> match
some rule in this set for the push to succeed.</p>
</li>
<li>
<p>Put your VREF rules next.  These apply to the virtual refs you want to
    use as additional checks for the push.</p>
<p>Fallthru is success here, which means the (virtual) ref must be
<strong>explicitly denied</strong> in order for the push to fail.</p>
</li>
</ul>
<h2 id="advanced-use">advanced use<a class="headerlink" href="#advanced-use" title="Permanent link">#</a></h2>
<p>More complex uses are possible, but may be harder to understand.  You may want
to experiment with the rules to solidify your understanding as you read this.</p>
<h3 id="differences-from-normal-refs">differences from normal refs<a class="headerlink" href="#differences-from-normal-refs" title="Permanent link">#</a></h3>
<p>We know where normal refs (like <code>refs/heads/master</code> or <code>refs/tags/v1.0</code>) come
from -- they are supplied by git itself when it calls the update hook.</p>
<p>Virtual refs have two differences with normal refs:</p>
<ul>
<li>Gitolite has to generate them somehow.</li>
<li>Fallthru is success, not failure.</li>
</ul>
<p>Here's how it works.</p>
<ul>
<li>
<p>First, the normal ("real") ref is checked.</p>
<p>As you already know, the push dies if the ref hits a deny rule <strong>or</strong> it
falls through without hitting an allow rule.</p>
</li>
<li>
<p>Next, virtual refs are generated and checked one by one.</p>
<p>We'll talk about the generaton later, but for the check, a virtual ref
kills the push <em>only</em> if it meets an explicit deny rule ("-"); fallthru
does <em>not</em> cause failure.  Other than that, the checking is done the same
way as for a normal ref, viz., as described in the flow for <a href="conf-2.html#putting-it-all-together">check #2</a>.</p>
</li>
</ul>
<h3 id="generating-virtual-refs">generating virtual refs<a class="headerlink" href="#generating-virtual-refs" title="Permanent link">#</a></h3>
<p>Gitolite uses the VREF rules themselves to help it generate the virtual refs.</p>
<p>Specifically, it looks at each rule that contains a VREF (there are 2 in the
above example) and calls a VREF-maker for each of them.</p>
<p>We'll take the COUNT example rule above.</p>
<p>When gitolite sees that rule, it calls the "COUNT" VREF-maker.  Specifically,
this is the <code>VREF/COUNT</code> program (See <a href="non-core.html">here</a> for actual locations on
disk).</p>
<p>Gitolite passes it the string "5" as an argument (actually, as the <em>eighth</em>
argument; details later).</p>
<p>The program (which can be written in any language) is expected to do one of
two things:</p>
<ul>
<li>
<p>If the condition is satisfied (i.e., there <em>are</em> more than 5 files in this
    push), it should print <code>VREF/COUNT/5</code> to STDOUT.</p>
<p>You can see that when this virtual ref is processed through the rules, it
will encounter the "deny" rule, and thus kill the push.</p>
</li>
<li>
<p>Otherwise it should print nothing.  That is, there is no virtual ref to
    run through "<a href="conf-2.html#putting-it-all-together">check #2</a>", so nothing happens.</p>
</li>
</ul>
<p>It should exit with an exit code of zero in either case.</p>
<p>If it exits with a non-zero, the push dies regardless of what is printed (see
"mimicking a plain old update hook" for why this is useful).</p>
<h2 id="more-details-and-nuances">more details and nuances<a class="headerlink" href="#more-details-and-nuances" title="Permanent link">#</a></h2>
<h3 id="mimicking-a-plain-old-update-hook">mimicking a plain old update hook<a class="headerlink" href="#mimicking-a-plain-old-update-hook" title="Permanent link">#</a></h3>
<p>If the VREF maker exits with a non-zero exit code, then regardless of what it
prints or does not, the push dies.</p>
<p>This is just like a plain 'update' hook.  Since the first 3 arguments (see
later) are also the same that a plain 'update' hook receives, you can actually
use any existing update hook as a VREF-maker.</p>
<p>To repurpose an existing update hook as a VREF-maker, just copy it to the VREF
directory (again, see <a href="non-core.html">here</a> for actual locations on disk).  Then
add this rule to your repos:</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">repo</span> foo    <span class="Comment"># or maybe even 'repo @all'</span>
    <span class="Statement">-</span>   <span class="Constant">VREF/my-update-hook</span>     =   <span class="WarningMsg">@all</span>
</pre>

<p>That's it.</p>
<h3 id="what-if-the-vref-maker-prints-a-different-virtual-ref">what if the VREF-maker prints a different virtual ref?<a class="headerlink" href="#what-if-the-vref-maker-prints-a-different-virtual-ref" title="Permanent link">#</a></h3>
<p>Unless you know what you're upto, don't do that.</p>
<p>But it's allowed and the behaviour is defined.  The VREF-maker for the NAME
VREF is a good example.  It ignores the arguments and just makes VREFs out of
the name of every file that was changed in the push.</p>
<p>Here's another example.  Consider the problem of not allowing pushes at
specific times.  Let's say repo 'foo' cannot be pushed between 4 and 7pm, and
repo 'bar' can only be pushed before 9am.  And of course all this only applies
to the junior developers, the poor guys!</p>
<p>In this example, we write the "Hour" VREF-maker to <em>ignore the argument
passed</em> and just print <code>VREF/Hour/NN</code> where NN can be between 00 to 23
inclusive and of course represents the current hour.</p>
<p>If foo is pushed at 6:30pm, the VREF-maker prints VREF/Hour/18, which
satisfies the third rule and is rejected.</p>
<p>If bar is pushed at, say, 7:20am, the vref printed is VREF/Hour/07, which does
not match any of the rules.  And fallthru is success so it passes.</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">repo</span> foo
    <span class="Statement">RW+</span>                         =   <span class="Identifier">@all</span>

    <span class="Statement">-</span>   <span class="Constant">VREF/Hour/16</span>            =   <span class="WarningMsg">@junior-devs</span>
    <span class="Statement">-</span>   <span class="Constant">VREF/Hour/17</span>            =   <span class="WarningMsg">@junior-devs</span>
    <span class="Statement">-</span>   <span class="Constant">VREF/Hour/18</span>            =   <span class="WarningMsg">@junior-devs</span>

<span class="Statement">repo</span> bar
    <span class="Statement">RW+</span>                         =   <span class="Identifier">@all</span>

    <span class="Statement">-</span>   <span class="Constant">VREF/Hour/09</span>            =   <span class="WarningMsg">@junior-devs</span>
    <span class="Statement">-</span>   <span class="Constant">VREF/Hour/1[0-9]</span>        =   <span class="WarningMsg">@junior-devs</span>
    <span class="Statement">-</span>   <span class="Constant">VREF/Hour/2[0-9]</span>        =   <span class="WarningMsg">@junior-devs</span>
</pre>

<h3 id="why-is-fallthru-considered-success-with-vrefs">why is fallthru considered success with VREFs<a class="headerlink" href="#why-is-fallthru-considered-success-with-vrefs" title="Permanent link">#</a></h3>
<p>Virtual refs are <strong>best used</strong> (1) as <strong>additional</strong> "deny" rules, performing
extra checks that core gitolite cannot.  You usually want such extra checks
only for some people.</p>
<p>When fallthru is success, you can simply <em>ignore</em> all the other users (for
whom such additional checks are not needed).</p>
<p>If fallthru were to be considered 'failure', you'd be forced to add a "success
rule" like this for <em>every</em> virtual ref you used in this repo, in each case
listing every user who was not already mentioned in the context of that vref:</p>
<pre style="color: #ffffff; background-color: #000000;">
    <span class="Statement">RW+</span> <span class="Constant">VREF/VREFNAME</span>   =   <span class="Identifier">@userlist</span>   <span class="Comment"># uggh! what a pain!</span>
</pre>

<p>Worse, since every virtual ref involves calling an external program, many of
these calls may be wasted.</p>
<p><font color="gray">(1) "best used as..." does not mean "only used as...".  For
example it's perfectly easy to turn this around if, instead of having a list
of people who <em>do</em> need extra checks, all you have is the complementary
list:</p>
<pre style="color: #ffffff; background-color: #000000;">
    <span class="Statement">RW+</span> <span class="Constant">VREF/</span><span class="PreProc">NAME/</span><span class="Constant">Makefile</span>      =   <span class="Identifier">@senior-devs</span>
    <span class="Statement">-</span>   <span class="Constant">VREF/</span><span class="PreProc">NAME/</span><span class="Constant">Makefile</span>      =   <span class="WarningMsg">@all</span>
</pre>

<p></font></p>
<h3 id="what-if-the-vref-maker-prints-something-thats-not-even-a-virtual-ref">what if the VREF-maker prints something that's not even a virtual ref?<a class="headerlink" href="#what-if-the-vref-maker-prints-something-thats-not-even-a-virtual-ref" title="Permanent link">#</a></h3>
<p>The VREF-maker can print anything it wants to STDOUT.  Lines not starting with
<code>VREF/</code> are printed as is (so your VREF-maker can do mostly-normal printing to
STDOUT).  This is especially useful if you've turned an existing update hook
into a VREF-maker, and it prints stuff meant for the user, but you don't want
to touch the code.</p>
<p>For lines starting with <code>VREF/</code>, the first word in each such line will be
treated as a virtual ref, while the rest, if any, is a message to be added to
the standard "...DENIED..." message that gitolite will print if that refex
matches and the rule is a deny rule.</p>
<h3 id="in-what-order-are-vref-makers-called">in what order are VREF-makers called?<a class="headerlink" href="#in-what-order-are-vref-makers-called" title="Permanent link">#</a></h3>
<p>VREF-makers are called in the sequence in which they appear in the conf file.</p>
<p>There are some optimisations to prevent calling the same VREF-maker with the
same arguments more than once, and the VREF-maker code for the NAME VREF
(which is special) is called only once regardless of how many times it appears
but these details should not concern anyone but a developer.</p>
<h3 id="what-arguments-are-passed-to-the-vref-maker">what arguments are passed to the vref-maker?<a class="headerlink" href="#what-arguments-are-passed-to-the-vref-maker" title="Permanent link">#</a></h3>
<ul>
<li>
<p>Arguments <strong>1, 2, 3</strong>: the <code>ref</code>, <code>oldsha</code>, and <code>newsha</code> that git passed
    to the update hook (see <code>man githooks</code>).</p>
<p>This, combined with the fact that non-zero exits are detected, mean that
you can simply use an existing update.secondary as a VREF-maker as-is, no
changes needed.</p>
</li>
<li>
<p>Arguments <strong>4 and 5</strong>: the 'oldtree' and 'newtree' SHAs.  These are the
    same as the oldsha and newsha values, except if one of them is all-0.
    (indicating a ref creation or deletion).  In that case the corresponding
    'tree' SHA is set (by gitolite, as a courtesy) to the special SHA
    <code>4b825dc642cb6eb9a060e54bf8d69288fbee4904</code>, which is the hash of an empty
    tree.</p>
<p>(None of these shenanigans would have been needed if <code>git diff $oldsha $newsha</code>
would not error out when passed an all-0 SHA.)</p>
</li>
<li>
<p>Argument <strong>6</strong>: the attempted access flag.  Typically <code>W</code> or <code>+</code>, but
    could also be <code>C</code>, <code>D</code>, or any of these 4 followed by <code>M</code>.  If you have to
    ask what they mean, you haven't read enough gitolite documentation to be
    able to make virtual refs work.</p>
</li>
<li>
<p>Argument <strong>7</strong>: is the entire refex; say <code>VREF/COUNT/3/NEWFILES</code>.</p>
</li>
<li>
<p>Arguments <strong>8 onward</strong>: are the split out (by <code>/</code>) portions of the refex,
    excluding the first two components.  In our example they would be <code>3</code>
    followed by <code>NEWFILES</code>.</p>
</li>
</ul>
<p>Yes, argument 7 is redundant if you have 8 and 9.  It's just more convenient
for scripts to have both available, without having to split/join.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="templates.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: using templates">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                using templates
              </div>
            </div>
          </a>
        
        
          
          <a href="vref-2.html" class="md-footer__link md-footer__link--next" aria-label="Next: virtual refs (part 2)">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                virtual refs (part 2)
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.footer", "search.suggest", "search.highlight"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>virtual refs</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style>
      body        { background: #fff; text-color: #000; margin-left:  40px;   font-size:  0.9em;  font-family: arial; }
  
      code        { font-size:    1.1em;  background:  #ddf; text-color: #000; }
      pre         { margin-left:  2em;    background:  #ddf; text-color: #000; }
      pre code    { font-size:    1.1em;  background:  #ddf; text-color: #000; }
  
      td          { vertical-align: top }
  
      .red        { color: red }
      .blue       { color: blue }
      .green      { color: green }
      .gray       { color: gray }
      .pink       { color: pink }
  
      .box        { background-color:#e0e0e0 }
      .bg-red     { background-color:#ffe0e0 }
      .bg-green   { background-color:#e0ffe0 }
      .bg-blue    { background-color:#e0e0ff }
  
      /* couldn't resist the name! */
      .wd40       { width: 40% !important }
  
      .box-l      { float: left;  padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-right: 4px; }
      .box-r      { float: right; padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-left:  4px; }
  
      .fl-l       { float: left;  padding: 0px 0.5em;                                       margin-right: 4px; }
      .fl-r       { float: right; padding: 0px 0.5em;                                       margin-left:  4px; }
  
      .sidebar {
          margin-left: 4px;
          width: 25%;
          float: right;
          border: 4px solid #fff;
      }
  
  </style>
  <style>
      h1          { background: #ffb; text-color: #000; margin-left: -30px;   border-top:    5px  solid #ccc; }
      h2          { background: #ffb; text-color: #000; margin-left: -20px;   border-top:    3px  solid #ddd; }
      h3          { background: #ffb; text-color: #000; margin-left: -10px; }
      h4          { background: #ffb; text-color: #000; }
  </style>
</head>
<body>
<!--
    generated by gvim then munged a fair bit.  The following command
        vim -E -c "TOhtml" -c "w" -c 'qa!' \-\- conf/gitolite.conf
    may or may not produce the same thing
-->

<style type="text/css">
<!--
.WarningMsg { color: #ff0000; }
.Constant { color: #ffa0a0; }
.Statement { color: #ffff60; font-weight: bold; }
.PreProc { color: #ff80ff; }
.LineNr { color: #ffff00; }
.Comment { color: #80a0ff; }
.Type { color: #60ff60; font-weight: bold; }
.Special { color: #ffa500; }
.Identifier { color: #40ffff; }
.Error { color: #ffffff; background-color: #ff0000; padding-bottom: 1px; }
.Todo { color: #0000ff; background-color: #ffff00; padding-bottom: 1px; }
-->
</style>
<div id="header">
<h1 class="title">virtual refs</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#quick-introexample"><span class="toc-section-number">1</span> quick intro/example</a></li>
<li><a href="#basic-use-and-understanding"><span class="toc-section-number">2</span> basic use and understanding</a></li>
<li><a href="#advanced-use"><span class="toc-section-number">3</span> advanced use</a><ul>
<li><a href="#differences-from-normal-refs"><span class="toc-section-number">3.1</span> differences from normal refs</a></li>
<li><a href="#generating-virtual-refs"><span class="toc-section-number">3.2</span> generating virtual refs</a></li>
</ul></li>
<li><a href="#more-details-and-nuances"><span class="toc-section-number">4</span> more details and nuances</a><ul>
<li><a href="#mimicking-a-plain-old-update-hook"><span class="toc-section-number">4.1</span> mimicking a plain old update hook</a></li>
<li><a href="#what-if-the-vref-maker-prints-a-different-virtual-ref"><span class="toc-section-number">4.2</span> what if the VREF-maker prints a different virtual ref?</a></li>
<li><a href="#vref-fallthru"><span class="toc-section-number">4.3</span> why is fallthru considered success with VREFs</a></li>
<li><a href="#what-if-the-vref-maker-prints-something-thats-not-even-a-virtual-ref"><span class="toc-section-number">4.4</span> what if the VREF-maker prints something that's not even a virtual ref?</a></li>
<li><a href="#in-what-order-are-vref-makers-called"><span class="toc-section-number">4.5</span> in what order are VREF-makers called?</a></li>
<li><a href="#vref-args"><span class="toc-section-number">4.6</span> what arguments are passed to the vref-maker?</a></li>
</ul></li>
<li><a href="#vref-makers-shipped-with-gitolite"><span class="toc-section-number">5</span> VREF-makers shipped with gitolite</a><ul>
<li><a href="#NAME"><span class="toc-section-number">5.1</span> restricting pushes by dir/file name</a></li>
<li><a href="#COUNT"><span class="toc-section-number">5.2</span> number of changed or new files</a></li>
<li><a href="#advanced-filetype-detection"><span class="toc-section-number">5.3</span> advanced filetype detection</a></li>
<li><a href="#checking-author-email"><span class="toc-section-number">5.4</span> checking author email</a></li>
<li><a href="#votes"><span class="toc-section-number">5.5</span> voting on commits</a></li>
</ul></li>
<li><a href="#other-ideas----code-welcome"><span class="toc-section-number">6</span> other ideas -- code welcome!</a><ul>
<li><a href="#no-non-merge-first-parents"><span class="toc-section-number">6.1</span> &quot;no non-merge first-parents&quot;</a></li>
<li><a href="#other-ideas-for-vrefs"><span class="toc-section-number">6.2</span> other ideas for VREFs</a></li>
</ul></li>
</ul>
</div>
<script type="text/javascript">
<!--
    function hide_show(id) {
        var e = document.getElementById(id);
        if(e == null)
            return;
        if(e.style.display != 'none')
            e.style.display = 'none';
        else
            e.style.display = 'block';
    }

    window.onload = function() {
        var t = document.getElementById('TOC');
        var sbt = document.getElementById('SBTOC');
        var h = '<div id="PTOC">'
        var h2 = '<p><strong><span class="red">Page TOC</span></strong></p>'
        var h3 = '</div>'
        var h4 = '<div id="GTOC">'
        var h5 = '</div>'
        var hst = '<div style="background: white; color: green; border: 2px solid green"><center><font size=-1><strong>Hide/Show Table of Contents</strong><br />'
        var pd = '<a href="#" onclick="hide_show(\'PTOC\');">Page TOC</a> | '
        var gt = '<a href="#" onclick="hide_show(\'GTOC\');">Gitolite TOC</a></font></center></div>'

        if(t == null)
            sbt.innerHTML = hst + gt + h4 + sbt.innerHTML + h5;
        else {
            sbt.innerHTML = hst + pd + gt + h + h2 + t.innerHTML + h3 + h4 + sbt.innerHTML + h5;
            t.style.display = 'none';   // hide the TOC that pandoc placed
        }
    }
-->
</script>
<style>
    #PTOC ul {
        list-style: none;
        margin-left: 0;
        padding-left: 2em;
        text-indent: -2em;
        padding-bottom: 2em;
    }
    #PTOC ul li {
        padding-bottom: 10px;
    }
    #PTOC ul li ul {
        padding-bottom: 0px;
    }
    #PTOC ul li ul li {
        padding-bottom: 0px;
    }

    .sidebar-toc a:hover {
        background-color: white;
    }

    .sidebar-toc {
        margin-left: 4px;
        width: 25%;
        float: right;
        color: gray;
        background: lightgray;
        border: 4px solid #fff;
        font-size: 0.90em;
    }

    .sidebar-toc ul {
        padding-left: 2em;
    }

</style>
<div id="SBTOC" class="sidebar-toc">
<p><strong><span class="red">Gitolite TOC</span></strong></p>
<hr />
<center>
<span class="red"><strong>Background</strong></span>
</center>
<hr />
<p><a href="index.html">Main page</a></p>
<ul>
<li><a href="index.html#dl">download</a></li>
<li><a href="index.html#rtfm">documentation</a>
<ul>
<li><a href="gitolite.html"><strong>all-in-one</strong></a> page</li>
</ul></li>
<li><a href="index.html#trouble"><strong>troubleshooting</strong></a></li>
<li><a href="index.html#contact"><strong>contact and support</strong></a></li>
<li><a href="index.html#license">license</a></li>
</ul>
<p><a href="overview.html">Overview</a></p>
<ul>
<li>what is Gitolite?</li>
<li>why might you need it?</li>
<li>how does it work?</li>
<li>who uses it?</li>
</ul>
<p><a href="concepts.html">Concepts, conventions, and terminology</a></p>
<ul>
<li>authentication and authorisation</li>
<li>ssh mode and http mode</li>
<li>the &quot;hosting user&quot;</li>
<li>the &quot;logical repo name&quot;</li>
<li>the special gitolite-admin repo</li>
</ul>
<p><a href="req.html">Before you start...</a></p>
<ul>
<li>your skills</li>
<li>your server</li>
<li>your and your users' clients</li>
<li><strong>cautions and caveats</strong></li>
<li><a href="req.html#trying">trying</a> out gitolite safely</li>
</ul>
<hr />
<center>
<span class="red"><strong>Basics</strong></span>
</center>
<hr />
<p><a href="install.html">install and setup</a></p>
<ul>
<li><a href="install.html#qi">quick install+setup</a> (for experts)</li>
<li>the long way around</li>
<li><a href="install.html#upgrading">upgrading</a></li>
<li><a href="install.html#moving">moving servers</a></li>
</ul>
<p><a href="basic-admin.html">Basic Administration</a></p>
<ul>
<li>clone the gitolite-admin repo</li>
<li>add/remove users</li>
<li>add/remove/rename repos</li>
<li>bringing existing repos into gitolite</li>
</ul>
<p><a href="conf.html">The conf file (<code>conf/gitolite.conf</code>)</a></p>
<ul>
<li>basic <a href="conf.html#syntax">syntax</a></li>
<li><a href="conf.html#include">include</a> files</li>
<li><a href="conf.html#groups">group definitions</a></li>
<li><a href="conf.html#rules"><strong><span class="red">access rules</span></strong></a></li>
</ul>
<p><a href="rc.html">the rc file (<code>~/.gitolite.rc</code>)</a></p>
<p><a href="user.html">Your users' view</a> of gitolite</p>
<p>Troubleshooting</p>
<ul>
<li>help for <a href="emergencies.html">emergencies</a></li>
<li>the <a href="ips.html">fool-proof install guide</a></li>
<li>the gitolite &quot;<a href="cookbook.html">cookbook</a>&quot;</li>
</ul>
<hr />
<center>
<span class="red"><strong>Advanced</strong></span>
</center>
<hr />
<p>Advanced &quot;conf file&quot; use</p>
<ul>
<li>specifying <a href="git-config.html">git-config</a> keys and values</li>
<li>gitolite <a href="options.html">options</a></li>
<li><a href="wild.html"><strong>wild repos</strong></a> (user created repos)</li>
<li><a href="vref.html">virtual refs</a></li>
<li><a href="deleg.html">delegation</a> of admin duties</li>
<li><a href="gitweb-daemon.html">gitweb and git-daemon</a></li>
</ul>
<p>Special features/setups</p>
<ul>
<li><strong><a href="mirroring.html">mirroring</a></strong></li>
<li><a href="http.html">http</a> mode</li>
<li>using a <a href="cache.html">cache</a></li>
<li>(<a href="namespaces.html">namespaces</a>)</li>
<li><a href="locking.html">locking</a> binary files</li>
<li><a href="package.html">packaging</a> gitolite</li>
</ul>
<p>Customising gitolite</p>
<ul>
<li>core and <a href="non-core.html">non-core</a> gitolite</li>
<li><a href="dev-notes.html">writing your own</a> non-core programs</li>
<li>gitolite <a href="triggers.html">triggers</a></li>
<li><a href="list-non-core.html">list of non-core programs</a> shipped with gitolite</li>
</ul>
<hr />
<center>
<span class="red"><strong>Extras</strong></span>
</center>
<hr />
<p><a href="odds-and-ends.html">Odds and Ends</a></p>
<ul>
<li><a href="odds-and-ends.html#writable">disabling pushes</a> to take backups</li>
<li><a href="odds-and-ends.html#elsewhere">putting 'repositories' and '.gitolite' elsewhere</a></li>
<li><a href="odds-and-ends.html#keysonly">using pubkeys obtained from elsewhere</a></li>
<li><a href="odds-and-ends.html#gh">giving users their own repos</a></li>
<li><a href="odds-and-ends.html#server-side-admin">administering gitolite directly on the server</a></li>
</ul>
<p>Additional information/discussion</p>
<ul>
<li><a href="ssh.html">all about ssh and gitolite</a></li>
<li>Running the <a href="testing.html">test suite</a></li>
<li><a href="files.html">gitolite files and directories</a></li>
<li><a href="perf.html">gitolite performance</a></li>
<li><a href="migr.html">Migration</a></li>
<li><a href="http://sitaramc.github.com/gitolite/g2/master-toc.html">documentation for gitolite v2</a></li>
<li><a href="regex.html">regular expressions</a></li>
<li><a href="no-way.html">no way!</a></li>
</ul>
<hr />
<center>
<span class="red"><strong>Contributed docs</strong></span>
</center>
<hr />
<p>Contributed software, tools, and documentation</p>
<ul>
<li><a href="ssh-and-http.html">combining ssh and http mode</a></li>
<li><a href="putty.html">putty and msysgit</a></li>
<li><a href="sskm.html">changing keys -- self service key management</a></li>
<li><a href="ukm.html">user key management</a></li>
<li><a href="README-emacs.html">emacs</a> &quot;major mode&quot;</li>
</ul>
</div>
<p><strong>IMPORTANT</strong>: fallthru is success in VREFs, unlike the normal refs. That won't make sense until you read further, but I had to put it up here for folks who stop reading halfway!</p>
<hr />
<p>VREFs are a mechanism to add additional constraints to a push.</p>
<h1 id="quick-introexample"><span class="header-section-number">1</span> quick intro/example</h1>
<table>
<tr>
<td>
<p>Here's an example to start you off.</p>
<p>To disallow junior developers from changing more than five files, or from touching the Makefile, you can do this:</p>
</td>
<td>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>foo
<span class="Statement">    RW+</span><span class="Constant">                     </span>=   <span class="Identifier">@all-devs</span>

<span class="Statement">    -</span><span class="Constant">   VREF/COUNT/5        </span>=<span class="WarningMsg">   @junior-devs</span>
<span class="Statement">    -</span><span class="Constant">   VREF/NAME/Makefile  </span>=<span class="WarningMsg">   @junior-devs</span>
</pre>
</td>
</tr>
</table>
<table>
<tr>
<td>
<div class="figure">
<img src="data:image/png;base64,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" />

</div>
</td>
<td>
<p>Here's a pictorial representation of what happens, at a very high level, based on the <code>VREF/COUNT/5</code> rule in the rule list above.</p>
<ol style="list-style-type: decimal">
<li><p>To start with, git-receive-pack calls the update hook with what we will call a &quot;real&quot; ref, something like &quot;refs/heads/master&quot;, or &quot;refs/tags/v1.0&quot; -- in general, something that starts with &quot;refs/&quot;.</p>
<p>This ref is sent through &quot;<a href="conf.html#c1c2">check #2</a>&quot; (please click to refresh your memory if needed).</p>
<p>Any rules that specify a <a href="conf.html#refex">refex</a> starting with &quot;VREF/&quot; clearly won't match and are ignored in this check.</p></li>
<li><p>Assuming that check did not fail, the gitolite code in the update hook then starts looking at each &quot;VREF&quot; rule in the rule list that applies to that repo accessed by that user. For each one, it runs the actual VREF program whose name is given in the word after &quot;VREF/&quot;. (The rest of the words, if any, along with all sorts of other information, are supplied as <a href="#vref-args">arguments</a>).</p></li>
<li><p>The STDOUT of the called program is captured and any line that starts with the characters &quot;VREF/&quot; is taken as a &quot;<strong>virtual</strong>&quot; ref, and is run through the same &quot;<a href="conf.html#c1c2">check #2</a>&quot;. <span class="red"><strong>The only difference is that, unlike for a regular ref, fallthru does not result in failure, but success.</strong></span></p></li>
</ol>
</td>
</tr>
</table>
<h1 id="basic-use-and-understanding"><span class="header-section-number">2</span> basic use and understanding</h1>
<p>Normally, rules deal with branches and tags (which git collectively calls &quot;refs&quot;). The &quot;ref&quot; is a property of the push which gitolite checks against the set of rules.</p>
<p>&quot;Virtual refs&quot; are other properties of a push that gitolite can be told to check, in addition to the normal ref. For example, &quot;this push has more than 5 changed files&quot; could be one property. Or &quot;this push changed the file called Makefile&quot; could be another. These properties are represented as &quot;virtual refs&quot; that start with &quot;VREF/&quot;. (Recall that &quot;normal&quot; refs start with &quot;refs/&quot;).</p>
<p>The simplest way to use them is as <em>additional</em> &quot;deny&quot; rules to fail a push that might otherwise have passed. This is what the example at the top shows.</p>
<p>It helps to separate VREF rules from normal rules, since no access rule can match both a normal ref and a virtual ref. Here's a good way to structure your rules:</p>
<ul>
<li><p>Put your normal ref rules first. These apply to the branch name or tag name that git itself knows about and sends to gitolite's update hook.</p>
<p>Fallthru is failure here, which means the ref being pushed <strong>must</strong> match some rule in this set for the push to succeed.</p></li>
<li><p>Put your VREF rules next. These apply to the virtual refs you want to use as additional checks for the push.</p>
<p>Fallthru is success here, which means the (virtual) ref must be <strong>explicitly denied</strong> in order for the push to fail.</p></li>
</ul>
<h1 id="advanced-use"><span class="header-section-number">3</span> advanced use</h1>
<p>More complex uses are possible, but may be harder to understand. You may want to experiment with the rules to solidify your understanding as you read this.</p>
<h2 id="differences-from-normal-refs"><span class="header-section-number">3.1</span> differences from normal refs</h2>
<p>We know where normal refs (like &quot;refs/heads/master&quot; or &quot;refs/tags/v1.0&quot;) come from -- they are supplied by git itself when it calls the update hook.</p>
<p>Virtual refs have two differences with normal refs:</p>
<ul>
<li>Gitolite has to generate them somehow.</li>
<li>Fallthru is success, not failure.</li>
</ul>
<p>Here's some more detail on how it works.</p>
<ul>
<li><p>First, the normal (&quot;real&quot;) ref is checked.</p>
<p>As you already know, the push dies if the ref hits a deny rule <strong>or</strong> it falls through without hitting an allow rule.</p></li>
<li><p>Next, virtual refs are generated and checked one by one.</p>
<p>We'll talk about the generaton later, but for the check, a virtual ref kills the push <em>only</em> if it meets an explicit deny rule (&quot;-&quot;); fallthru does <em>not</em> cause failure. Other than that, the checking is done the same way as for a normal ref, viz., as described in the flow for <a href="conf.html#c1c2">check #2</a>.</p></li>
</ul>
<h2 id="generating-virtual-refs"><span class="header-section-number">3.2</span> generating virtual refs</h2>
<p>Gitolite uses the VREF rules themselves to help it generate the virtual refs.</p>
<p>Specifically, it looks at each rule that contains a VREF (there are 2 in the above example) and calls a VREF-maker for each of them.</p>
<p>We'll take the COUNT example rule above.</p>
<p>When gitolite sees that rule, it calls the &quot;COUNT&quot; VREF-maker. Specifically, this is the <code>VREF/COUNT</code> program (See <a href="non-core.html">here</a> for actual locations on disk).</p>
<p>Gitolite passes it the string &quot;5&quot; as an argument (actually, as the <em>eighth</em> argument; details later).</p>
<p>The program (which can be written in any language) is expected to do one of two things:</p>
<ul>
<li><p>If the condition is satisfied (i.e., there <em>are</em> more than 5 files in this push), it should print <code>VREF/COUNT/5</code> to STDOUT.</p>
<p>You can see that when this virtual ref is processed through the rules, it will encounter the &quot;deny&quot; rule, and thus kill the push.</p></li>
<li><p>Otherwise it should print nothing. That is, there is no virtual ref to run through &quot;<a href="conf.html#c1c2">check #2</a>&quot;, so nothing happens.</p></li>
</ul>
<p>It should exit with an exit code of zero in either case.</p>
<p>If it exits with a non-zero, the push dies regardless of what is printed (see &quot;mimicking a plain old update hook&quot; for why this is useful).</p>
<h1 id="more-details-and-nuances"><span class="header-section-number">4</span> more details and nuances</h1>
<h2 id="mimicking-a-plain-old-update-hook"><span class="header-section-number">4.1</span> mimicking a plain old update hook</h2>
<p>If the VREF maker exists with a non-zero exit code, then regardless of what it prints or does not, the push dies.</p>
<p>This is just like a plain 'update' hook. Since the first 3 arguments (see later) are also the same that a plain 'update' hook receives, you can actually use any existing update hook as a VREF-maker.</p>
<p>To repurpose an existing update hook as a VREF-maker, just copy it to the VREF directory (again, see <a href="non-core.html">here</a> for actual locations on disk). Then add this rule to your repos:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>foo   <span class="Comment"> # or maybe even 'repo @all'</span>
<span class="Statement">    -</span><span class="Constant">   VREF/my-update-hook     </span>=<span class="WarningMsg">   @all</span>
</pre>
<p>That's it.</p>
<h2 id="what-if-the-vref-maker-prints-a-different-virtual-ref"><span class="header-section-number">4.2</span> what if the VREF-maker prints a different virtual ref?</h2>
<p>Unless you know what you're upto, don't do that.</p>
<p>But it's allowed and the behaviour is defined. The VREF-maker for the NAME VREF is a good example. It ignores the arguments and just makes VREFs out of the name of every file that was changed in the push.</p>
<table>
<tr>
<td>
<p>Here's another example. Consider the problem of not allowing pushes at specific times. Let's say repo 'foo' cannot be pushed between 4 and 7pm, and repo 'bar' can only be pushed before 9am. And of course all this only applies to the junior developers, the poor guys!</p>
<p>In this example, we write the &quot;Hour&quot; VREF-maker to <em>ignore the argument passed</em> and just print <code>VREF/Hour/NN</code> where NN can be between 00 to 23 inclusive and of course represents the current hour.</p>
<p>If foo is pushed at 6:30pm, the VREF-maker prints VREF/Hour/18, which satisfies the third rule and is rejected.</p>
<p>If bar is pushed at, say, 7:20am, the vref printed is VREF/Hour/07, which does not match any of the rules. And fallthru is success so it passes.</p>
</td>
<td>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>foo
<span class="Statement">    RW+</span><span class="Constant">                         </span>=   <span class="Identifier">@all</span>

<span class="Statement">    -</span><span class="Constant">   VREF/Hour/16            </span>=<span class="WarningMsg">   @junior-devs</span>
<span class="Statement">    -</span><span class="Constant">   VREF/Hour/17            </span>=<span class="WarningMsg">   @junior-devs</span>
<span class="Statement">    -</span><span class="Constant">   VREF/Hour/18            </span>=<span class="WarningMsg">   @junior-devs</span>

<span class="Type">repo </span>bar
<span class="Statement">    RW+</span><span class="Constant">                         </span>=   <span class="Identifier">@all</span>

<span class="Statement">    -</span><span class="Constant">   VREF/Hour/09            </span>=<span class="WarningMsg">   @junior-devs</span>
<span class="Statement">    -</span><span class="Constant">   VREF/Hour/1[0-9]        </span>=<span class="WarningMsg">   @junior-devs</span>
<span class="Statement">    -</span><span class="Constant">   VREF/Hour/2[0-9]        </span>=<span class="WarningMsg">   @junior-devs</span>
</pre>
</td>
</tr>
</table>
<h2 id="vref-fallthru"><span class="header-section-number">4.3</span> why is fallthru considered success with VREFs</h2>
<p>Virtual refs are <strong>best used</strong> (1) as <strong>additional</strong> &quot;deny&quot; rules, performing extra checks that core gitolite cannot. You usually want such extra checks only for some people.</p>
<p>When fallthru is success, you can simply <em>ignore</em> all the other users (for whom such additional checks are not needed).</p>
<p>If fallthru were to be considered 'failure', you'd be forced to add a &quot;success rule&quot; like this for <em>every</em> virtual ref you used in this repo, in each case listing every user who was not already mentioned in the context of that vref:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Statement">RW+</span><span class="Constant"> VREF/VREFNAME   </span>=   <span class="Identifier">@userlist</span>  <span class="Comment"> # uggh! what a pain!</span>
</pre>
<p>Worse, since every virtual ref involves calling an external program, many of these calls may be wasted.</p>
<p><font color="gray">(1) &quot;best used as...&quot; does not mean &quot;only used as...&quot;. For example it's perfectly easy to turn this around if, instead of having a list of people who <em>do</em> need extra checks, all you have is the complementary list:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Statement">RW+</span><span class="Constant"> VREF/NAME/Makefile      </span>=   <span class="Identifier">@senior-devs</span>
<span class="Statement">-</span><span class="Constant">   VREF/NAME/Makefile      </span>=<span class="WarningMsg">   @all</span>
</pre>
<p></font></p>
<h2 id="what-if-the-vref-maker-prints-something-thats-not-even-a-virtual-ref"><span class="header-section-number">4.4</span> what if the VREF-maker prints something that's not even a virtual ref?</h2>
<p>The VREF-maker can print anything it wants to STDOUT. Lines not starting with <code>VREF/</code> are printed as is (so your VREF-maker can do mostly-normal printing to STDOUT). This is especially useful if you've turned an existing update hook into a VREF-maker, and it prints stuff meant for the user, but you don't want to touch the code.</p>
<p>For lines starting with <code>VREF/</code>, the first word in each such line will be treated as a virtual ref, while the rest, if any, is a message to be added to the standard &quot;...DENIED...&quot; message that gitolite will print if that refex matches and the rule is a deny rule.</p>
<h2 id="in-what-order-are-vref-makers-called"><span class="header-section-number">4.5</span> in what order are VREF-makers called?</h2>
<p>VREF-makers are called in the sequence in which they appear in the conf file.</p>
<p>There are some optimisations to prevent calling the same VREF-maker with the same arguments more than once, and the VREF-maker code for the NAME VREF (which is special) is called only once regardless of how many times it appears but these details should not concern anyone but a developer.</p>
<h2 id="vref-args"><span class="header-section-number">4.6</span> what arguments are passed to the vref-maker?</h2>
<ul>
<li><p>Arguments <strong>1, 2, 3</strong>: the 'ref', 'oldsha', and 'newsha' that git passed to the update hook (see 'man githooks').</p>
<p>This, combined with the fact that non-zero exits are detected, mean that you can simply use an existing update.secondary as a VREF-maker as-is, no changes needed.</p></li>
<li><p>Arguments <strong>4 and 5</strong>: the 'oldtree' and 'newtree' SHAs. These are the same as the oldsha and newsha values, except if one of them is all-0. (indicating a ref creation or deletion). In that case the corresponding 'tree' SHA is set (by gitolite, as a courtesy) to the special SHA <code>4b825dc642cb6eb9a060e54bf8d69288fbee4904</code>, which is the hash of an empty tree.</p>
<p>(None of these shenanigans would have been needed if <code>git diff $oldsha $newsha</code> would not error out when passed an all-0 SHA.)</p></li>
<li><p>Argument <strong>6</strong>: the attempted access flag. Typically <code>W</code> or <code>+</code>, but could also be <code>C</code>, <code>D</code>, or any of these 4 followed by <code>M</code>. If you have to ask what they mean, you haven't read enough gitolite documentation to be able to make virtual refs work.</p></li>
<li><p>Argument <strong>7</strong>: is the entire refex; say <code>VREF/COUNT/3/NEWFILES</code>.</p></li>
<li><p>Arguments <strong>8 onward</strong>: are the split out (by <code>/</code>) portions of the refex, excluding the first two components. In our example they would be <code>3</code> followed by <code>NEWFILES</code>.</p></li>
</ul>
<p>Yes, argument 7 is redundant if you have 8 and 9. It's meant to make it easy to write vref-maker scripts in any language. See script examples in source.</p>
<h1 id="vref-makers-shipped-with-gitolite"><span class="header-section-number">5</span> VREF-makers shipped with gitolite</h1>
<h2 id="NAME"><span class="header-section-number">5.1</span> restricting pushes by dir/file name</h2>
<p>The &quot;NAME&quot; VREF allows you to restrict pushes by the names of dirs and files changed. (Side note: the NAME VREF is the only one directly implemented within the update hook, so you won't find it in the VREF directory).</p>
<p>Here's an example. Say you don't want junior developers pushing changes to the Makefile, because it's quite complex:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>foo
<span class="Statement">        RW+</span><span class="Constant">                             </span>=   <span class="Identifier">@senior_devs</span>
<span class="Statement">        RW</span><span class="Constant">                              </span>=   <span class="Identifier">@junior_devs</span>

<span class="Statement">        -</span><span class="Constant">   VREF/NAME/Makefile          </span>=<span class="WarningMsg">   @junior_devs</span>
</pre>
<p>When a senior dev pushes, the VREF is not invoked at all. But when a junior dev pushes, the VREF is invoked, and it returns a list of files changed <strong>as virtual refs</strong>, looking like this:</p>
<pre><code>VREF/NAME/file-1
VREF/NAME/dir-2/file-3
...etc...</code></pre>
<p>Each of these refs is matched against the access rules. If one of them happens to be the Makefile, then the ref returned (VREF/NAME/Makefile) will match the deny rule and kill the push.</p>
<p>Another way to use this is when you know what is allowed instead of what is not allowed. Let's say the QA person is only allowed to touch a file called CHANGELOG and any files in a directory called ReleaseNotes:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Type">repo </span>foo
<span class="Statement">        RW+</span><span class="Constant">                             </span>=   <span class="Identifier">@senior_devs</span>
<span class="Statement">        RW</span><span class="Constant">                              </span>=   <span class="Identifier">@junior_devs</span>
<span class="Statement">        RW+</span><span class="Constant">                             </span>=   QA-guy

<span class="Statement">        RW+</span><span class="Constant"> VREF/NAME/CHANGELOG         </span>=   QA-guy
<span class="Statement">        RW+</span><span class="Constant"> VREF/NAME/ReleaseNotes/     </span>=   QA-guy
<span class="Statement">        -</span><span class="Constant">   VREF/NAME/                  </span>=<span class="WarningMsg">   QA-guy</span>
</pre>
<h2 id="COUNT"><span class="header-section-number">5.2</span> number of changed or new files</h2>
<p>The COUNT VREF is used like this:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Statement">-</span><span class="Constant">   VREF/COUNT/9                    </span>=<span class="WarningMsg">   @junior-developers</span>
</pre>
<p>In response, if anyone in the user list pushes a commit series that changes more than 9 files, a virtual ref of &quot;VREF/COUNT/9&quot; is returned. Gitolite uses that as a &quot;ref&quot; to match against all the rules, hits the same rule that invoked it, and denies the request.</p>
<p>If the user did not push more than 9 files, the VREF code returns nothing, and nothing happens.</p>
<p>COUNT can take one more argument:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Statement">-</span><span class="Constant">   VREF/COUNT/9/NEWFILES           </span>=<span class="WarningMsg">   @junior-developers</span>
</pre>
<p>This is the same as before, but have to be more than 9 <em>new</em> files not just changed files.</p>
<h2 id="advanced-filetype-detection"><span class="header-section-number">5.3</span> advanced filetype detection</h2>
<p>Note: this is more for illustration than use; it's rather specific to one of the projects I manage but the idea is the important thing.</p>
<p>Sometimes a file has a standard extension (that cannot be 'gitignore'd), but it is actually automatically generated. Here's one way to catch it:</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Statement"> -</span><span class="Constant">   VREF/FILETYPE/AUTOGENERATED     </span>=<span class="WarningMsg">   @all</span>
</pre>
<p>You can look at <code>src/VREF/FILETYPE</code> to see how it handles the 'AUTOGENERATED' option. You could also have a more generic option, like perhaps BINARY, and handle that in the FILETYPE vref too.</p>
<h2 id="checking-author-email"><span class="header-section-number">5.4</span> checking author email</h2>
<p>Some people want to ensure that &quot;you can only push your own commits&quot;.</p>
<p>If you force it on everyone, this is a very silly idea (see &quot;Philosophical Notes&quot; section of <code>src/VREF/EMAIL-CHECK</code>).</p>
<p>But there may be value in enforcing it just for the junior developers.</p>
<p>The neat thing is that the existing <code>contrib/update.email-check</code> was just copied to <code>src/VREF/EMAIL-CHECK</code> and it works, because VREFs get the same first 3 arguments and those are all that it cares about. (Note: you have to change one subroutine in that script if you want to use it)</p>
<h2 id="votes"><span class="header-section-number">5.5</span> voting on commits</h2>
<p>Although gitolite can't/won't do the whole &quot;code review + workflow enforcement&quot; thing that Gerrit Code Review does, a basic implementation of voting on a commit is surprisingly easy. See src/VREF/VOTES for details (and note that the actual <em>code</em> is just 2-3 lines; the rest is inline documentation).</p>
<h1 id="other-ideas----code-welcome"><span class="header-section-number">6</span> other ideas -- code welcome!</h1>
<h2 id="no-non-merge-first-parents"><span class="header-section-number">6.1</span> &quot;no non-merge first-parents&quot;</h2>
<p>Shruggar on #gitolite wanted this. Possible code to implement it would be something like this (untested)</p>
<pre><code>[ -z &quot;$(git rev-list --first-parent --no-merges $2..$3)&quot; ]</code></pre>
<p>This can be implemented using <code>src/VREF/MERGE-CHECK</code> as a model. That script does what the 'M' qualifier does in access rules (see last part of <a href="conf.html#write-types">this</a>), although the syntax to be used in conf/gitolite will be quite different.</p>
<h2 id="other-ideas-for-vrefs"><span class="header-section-number">6.2</span> other ideas for VREFs</h2>
<p>Here are some more ideas:</p>
<ul>
<li>Number of commits (<code>git rev-list --count $old $new</code>).</li>
<li>Number of binary files in commit (currently I only know to count occurrences of <code>Bin</code> in the output of <code>git diff --stat</code>.</li>
<li>Number of <em>new</em> binary files (count <code>Bin 0 -&gt;</code> in <code>git diff --stat</code> output).</li>
<li>Time of day/day of week (see example snippet somewhere above).</li>
<li>IP address.</li>
<li>Phase of the moon.</li>
</ul>
<p>Note that pretty much anything that involves <code>$oldsha..$newsha</code> will have to deal with the issue that when you push a new tag or branch, the &quot;old&quot; part is all 0's, and unless you consider <code>--all</code> existing branches and tags it becomes meaningless in terms of &quot;number of new files&quot; etc.</p>
</body>
</html>

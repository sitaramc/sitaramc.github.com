<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>migrating from v2 - Gitolite</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/gitolite.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Gitolite</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">what/why <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../overview/">overview</a>
</li>
                            
<li >
    <a href="../concepts/">concepts, conventions, terminology</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">install and setup <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../quick_install/">(unix/ssh experts) quick install and setup</a>
</li>
                            
<li >
    <a href="../install/">normal ssh mode install and setup</a>
</li>
                            
<li >
    <a href="../fool_proof_setup/">(if all else fails) fool-proof, step-by-step, install and setup</a>
</li>
                            
<li >
    <a href="../http/">HTTP mode install</a>
</li>
                            
<li class="active">
    <a href="./">migrating from v2</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">use <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">basic</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../basic-admin/">basic administration</a>
</li>
            
<li >
    <a href="../conf/">the "conf" file (part 1)</a>
</li>
            
<li >
    <a href="../conf-2/">the "conf" file (part 2)</a>
</li>
            
<li >
    <a href="../rc/">the "rc" file</a>
</li>
            
<li >
    <a href="../user/">your users' view</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">advanced</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../git-config/">setting git-config values</a>
</li>
            
<li >
    <a href="../options/">gitolite options</a>
</li>
            
<li >
    <a href="../wild/">ad hoc user-created ("wild") repos</a>
</li>
            
<li >
    <a href="../vref/">virtual refs (part 1)</a>
</li>
            
<li >
    <a href="../vref-2/">virtual refs (part 2)</a>
</li>
            
<li >
    <a href="../deleg/">delegation of admin duties</a>
</li>
            
<li >
    <a href="../gitweb-daemon/">gitweb and git-daemon</a>
</li>
            
<li >
    <a href="../mirroring/">mirroring</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">customise</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../non-core/">core and "non-core" gitolite</a>
</li>
            
<li >
    <a href="../dev-notes/">writing your own non-core code</a>
</li>
            
<li >
    <a href="../triggers/">gitolite triggers</a>
</li>
            
<li >
    <a href="../list-non-core/">list of non-core programs shipped with gitolite</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../cookbook/">(quick! how do I...) the cookbook</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HELP! <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../emergencies/">emergency!!</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">ssh</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../ssh/">ssh</a>
</li>
            
<li >
    <a href="../glssh/">how gitolite uses ssh</a>
</li>
            
<li >
    <a href="../sts/">ssh troubleshooting</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../regex/">regular expressions</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">other docs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../odds-and-ends/">miscellaneous features</a>
</li>
                            
<li >
    <a href="../namespaces/">using git namespaces</a>
</li>
                            
<li >
    <a href="../locking/">locking binary files</a>
</li>
                            
<li >
    <a href="../testing/">testing gitolite</a>
</li>
                            
<li >
    <a href="../package/">packaging gitolite</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">more about gitolite</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../files/">gitolite files & directories</a>
</li>
            
<li >
    <a href="../rc-33/">the 3.3 format rc file</a>
</li>
            
<li >
    <a href="../perf/">performance</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">contrib</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../contrib/ssh-and-http/">Using both ssh and http</a>
</li>
            
<li >
    <a href="../contrib/putty/">Putty and Msysgit</a>
</li>
            
<li >
    <a href="../contrib/sskm/">Self-service key management</a>
</li>
            
<li >
    <a href="../contrib/ukm/">User key management</a>
</li>
            
<li >
    <a href="../contrib/README-emacs/">Emacs major mode</a>
</li>
    </ul>
  </li>
                            
<li >
    <a href="../no-way/">no way!</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../http/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../basic-admin/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#migrating-from-gitolite-v2">migrating from gitolite v2</a></li>
            <li><a href="#step-1-backups">step 1: backups</a></li>
            <li><a href="#step-2-install-gitolite">step 2: install gitolite</a></li>
            <li><a href="#step-3-add-existing-repos">step 3: add existing repos</a></li>
            <li><a href="#step-4-identify-any-remaining-changes-needed">step 4: identify any remaining changes needed</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="migrating-from-gitolite-v2">migrating from gitolite v2<a class="headerlink" href="#migrating-from-gitolite-v2" title="Permanent link"></a></h1>
<hr />
<p>Gitolite v3 came out in April 2012.  Until now, my policy was that I would not
support it except for critical issues, but I think by now (I am writing this
in Feb 2017), it's time to cut it completely.</p>
<p>As such, migration is also not supported.  Please perform a clean install of
the latest gitolite and bring your existing repos into this new installation.
Details below.</p>
<p>The old, detailed, migration document is still available in the <a href="https://github.com/sitaramc/gitolite-doc/tree/master/archive">archive
directory</a> of the gitolite-doc repo, if you really need it, but you're
on your own.  After five years, it makes little sense to maintain all that in
the active document hierarchy.</p>
<p>Despite all that, this document <em>does</em> list some of the more important issues,
mainly those that cause a significant change in behaviour.</p>
<h2 id="step-1-backups">step 1: backups<a class="headerlink" href="#step-1-backups" title="Permanent link"></a></h2>
<ul>
<li>take a backup of all <code>~/repositories</code> from the v2 server</li>
<li>take an extra backup, in the form of a normal <code>git clone</code>, of the
    <code>gitolite-admin</code> repository</li>
<li>take a backup of <code>~/.gitolite.rc</code> and keep it handy</li>
<li>(<em>optional but suggested</em>) take a backup of <code>~/.gitolite</code> and <code>~/.ssh</code></li>
</ul>
<h2 id="step-2-install-gitolite">step 2: install gitolite<a class="headerlink" href="#step-2-install-gitolite" title="Permanent link"></a></h2>
<div class="admonition danger">
<p class="admonition-title">Important:</p>
<p>If you are reusing the same <a href="../concepts/#the-hosting-user">hosting user</a> on the same server, for the
new setup, you will need to clean out the old one as much as you can so
its artefacts don't interfere with the new installation.  This means all
the files and directories you backed up above, including the optional
ones.</p>
</div>
<p>To install, use one or more of the links in the "install" section in the
navigation bar at the top.</p>
<div class="admonition note">
<p class="admonition-title">Important:</p>
<p>Do <strong>NOT</strong> change the <code>gitolite.conf</code> from the minimal one that a fresh
install creates at this stage.</p>
</div>
<p>Smoke test the installation by cloning the <code>testing</code> repo and pushing some
minor change to it.</p>
<h2 id="step-3-add-existing-repos">step 3: add existing repos<a class="headerlink" href="#step-3-add-existing-repos" title="Permanent link"></a></h2>
<p>Once the install is done, follow the instructions <a href="../basic-admin/#appendix-1-bringing-existing-repos-into-gitolite">here</a> to bring in
existing repos.</p>
<p>At the point where it talks about adding repos to the gitolite.conf file, you
can copy relevant bits from your old gitolite-admin repo.</p>
<h2 id="step-4-identify-any-remaining-changes-needed">step 4: identify any remaining changes needed<a class="headerlink" href="#step-4-identify-any-remaining-changes-needed" title="Permanent link"></a></h2>
<p>If you're using any of the following features in your old (v2) setup, please
make the appropriate changes as indicated.</p>
<h3 id="name-rules">NAME rules<a class="headerlink" href="#name-rules" title="Permanent link"></a></h3>
<p><code>NAME/</code> rules must be changed to <code>VREF/NAME/</code>.  Also, fallthru on all VREFs is
"success" now, so any <code>NAME/</code> rules you have <strong>MUST</strong> change the rule list in
some way to maintain the same restrictions.  The simplest is to add the
following line to the end of each repo's rule list:</p>
<pre><code>-   VREF/NAME/       =   @all
</code></pre>
<h3 id="subconf-command"><code>subconf</code> command<a class="headerlink" href="#subconf-command" title="Permanent link"></a></h3>
<p>(This is also affected by the previous issue, 'NAME rules'; please read that
as well).</p>
<p>If you're using delegation in your admin conf setup, please add the following
lines to the end of the gitolite-admin rules in your conf/gitolite.conf file:</p>
<pre><code>repo gitolite-admin
    -   VREF/NAME/       =   @all

subconf "fragments/*.conf"
</code></pre>
<p>The first part compensates for fallthru now being a success when processing
<a href="../vref">VREF</a> rules (NAME rules are just one specific VREF).  Although,
<strong>ideally</strong>, you should change your rule list so that you no longer require
that line.</p>
<p>The second part explicitly says when and where to include the subconf files.
(Before subconf was invented, this used to happen implicitly at the end of the
main conf file, and was hardcoded to that specific glob.)</p>
<h3 id="mirroring">mirroring<a class="headerlink" href="#mirroring" title="Permanent link"></a></h3>
<!-- duplicated in mirroring.mkd with minor differences -->

<p>There are <strong>several</strong> important differences in mirroring; if you're using
mirroring <strong>please start from a clean slate on all slaves</strong>, using the v3
documentation on <a class="wikilink" href="../mirroring/">mirroring</a>.</p>
<p>If you're not willing to do that, you may be able to use the older, more
detailed, documentation <a href="https://github.com/sitaramc/gitolite-doc/tree/master/archive">here</a> to manage the migration.  However, I
cannot support that (mainly due to lack of time).</p>
<h3 id="rc-file-settings">rc file settings<a class="headerlink" href="#rc-file-settings" title="Permanent link"></a></h3>
<p>Many rc file settings have been dropped.  You should be able to get by without
most of them, but some of them cause a significant change to behaviour:</p>
<ul>
<li>
<p><code>GL_ALL_INCLUDES_SPECIAL</code>: @all always includes gitweb and daemon now.
    Use deny-rules if you want to say <code>R = @all</code> but not have the repo(s) be
    visible to gitweb or daemon.</p>
</li>
<li>
<p><code>GL_NO_DAEMON_NO_GITWEB</code>: the default will clobber your projects.list file
    and git-daemon-export-ok files.</p>
<p>Comment out the 'daemon' and 'gitweb' lines in the ENABLE list in the rc
file.  Gitweb and daemon can now be separately disabled, instead of both
being tied to the same setting.</p>
</li>
<li>
<p><code>GL_NO_SETUP_AUTHKEYS</code>:  default will clobber your authkeys file.</p>
<p>Comment out all the line(s) that call ssh-authkeys in the rc file.</p>
</li>
<li>
<p><code>ADMIN_POST_UPDATE_CHAINS_TO</code> and <code>UPDATE_CHAINS_TO</code>:</p>
<p>For the former, add your script to the <code>POST_COMPILE</code> <a href="../triggers">trigger</a>
chain.  For the latter, use a <a class="wikilink" href="../vref/">vref</a>.  Don't forget to add a rule that
references the new VREF!</p>
</li>
</ul>
<h3 id="wild-repos">wild repos<a class="headerlink" href="#wild-repos" title="Permanent link"></a></h3>
<ul>
<li>
<p><code>gl-creater</code> files: these files need to be renamed to <code>gl-creator</code> (the
    correct spelling at last, hooray!).  Suggested command sequence:</p>
<p><pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">cd</span> <span class="PreProc">$HOME</span>/repositories
<span class="Statement">find</span><span class="Statement"> . </span>-type d <span class="Special">-name</span> <span class="Statement">&quot;</span><span class="Constant">*.git</span><span class="Statement">&quot;</span> <span class="Special">-prune</span> | <span class="Statement">while </span><span class="Statement">read</span><span class="Statement"> </span><span class="Statement">r</span>
<span class="Statement">do</span>
    <span class="Statement">mv</span> <span class="PreProc">$r</span>/gl-creater <span class="PreProc">$r</span>/gl-creator
<span class="Statement">done</span> <span class="Constant">2</span><span class="Statement">&gt;</span>/dev/null
</pre></p>
</li>
<li>
<p><code>gl-perms</code> files: setting perms of R and RW will no longer work; you have
    to say READERS and WRITERS now.  Suggested command:</p>
<p><pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">find</span> <span class="Special">`</span>gitolite query-rc GL_REPO_BASE<span class="Special">`</span> <span class="Special">-name</span> gl-perms |
    xargs perl <span class="Special">-pi</span> <span class="Special">-e</span> <span class="Statement">'</span><span class="Constant">s/\bR\b/READERS/;s/\bRW\b/WRITERS/</span><span class="Statement">'</span>
</pre></p>
</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

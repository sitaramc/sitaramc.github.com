
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="gitweb-daemon.html">
      
      
        <link rel="next" href="non-core.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>mirroring - Gitolite</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/gitolite.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mirroring-using-gitolite" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Gitolite" class="md-header__button md-logo" aria-label="Gitolite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gitolite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              mirroring
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Gitolite" class="md-nav__button md-logo" aria-label="Gitolite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Gitolite
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    what/why
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            what/why
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    concepts, conventions, terminology
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    install and setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            install and setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quick_install.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (unix/ssh experts) quick install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="install.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    normal ssh mode install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fool_proof_setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (if all else fails) fool-proof, step-by-step, install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP mode install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    migrating from v2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    use
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            use
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    basic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            basic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="basic-admin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    basic administration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="conf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "conf" file (part 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="conf-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "conf" file (part 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "rc" file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="user.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    your users' view
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="git-config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    setting git-config values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="options.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="wild.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ad hoc user-created ("wild") repos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    using templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vref.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    virtual refs (part 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vref-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    virtual refs (part 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deleg.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    delegation of admin duties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gitweb-daemon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitweb and git-daemon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    mirroring
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="mirroring.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    mirroring
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-intro" class="md-nav__link">
    <span class="md-ellipsis">
      quick intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    <span class="md-ellipsis">
      caveats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-mirroring" class="md-nav__link">
    <span class="md-ellipsis">
      setting up mirroring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setting up mirroring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-initial-setup-and-the-rc-file" class="md-nav__link">
    <span class="md-ellipsis">
      the initial setup and the rc file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conf-file-settings-and-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      conf file settings and syntax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="conf file settings and syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v36-preventing-automatic-sync" class="md-nav__link">
    <span class="md-ellipsis">
      (v3.6+) preventing automatic sync
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v361-mirroring-failures" class="md-nav__link">
    <span class="md-ellipsis">
      (v3.6.1+) mirroring failures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manually-synchronising-a-copy-repo" class="md-nav__link">
    <span class="md-ellipsis">
      manually synchronising a copy repo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redirected-pushes" class="md-nav__link">
    <span class="md-ellipsis">
      redirected pushes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-a-hostname-substitution" class="md-nav__link">
    <span class="md-ellipsis">
      appendix A: HOSTNAME substitution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-b-efficiency-versus-paranoia" class="md-nav__link">
    <span class="md-ellipsis">
      appendix B: efficiency versus paranoia
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-c-moving-the-admin-repo-to-a-different-master" class="md-nav__link">
    <span class="md-ellipsis">
      appendix C: moving the admin repo to a different master
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-d-fixing-a-broken-copy" class="md-nav__link">
    <span class="md-ellipsis">
      appendix D: fixing a broken copy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    customise
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            customise
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="non-core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    core and "non-core" gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dev-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    writing your own non-core code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="triggers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite triggers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="list-non-core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    list of non-core programs shipped with gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cookbook.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (quick! how do I...) the cookbook
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    HELP!
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            HELP!
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="emergencies.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emergency!!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ssh
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            ssh
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ssh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ssh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="glssh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    how gitolite uses ssh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ssh troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="regex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    regular expressions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    other docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            other docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="odds-and-ends.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    miscellaneous features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="locking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    locking binary files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    testing gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="package.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    packaging gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gitolite-and-ssh-certs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite and ssh certs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    more about gitolite
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            more about gitolite
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="files.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite files & directories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rc-33.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the 3.3 format rc file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="perf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="internals.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internals
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    contrib
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            contrib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/ssh-and-http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using both ssh and http
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/putty.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Putty and Msysgit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/sskm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Self-service key management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/ukm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User key management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/README-emacs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emacs major mode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="no-way.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    no way!
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-intro" class="md-nav__link">
    <span class="md-ellipsis">
      quick intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    <span class="md-ellipsis">
      caveats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-mirroring" class="md-nav__link">
    <span class="md-ellipsis">
      setting up mirroring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setting up mirroring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-initial-setup-and-the-rc-file" class="md-nav__link">
    <span class="md-ellipsis">
      the initial setup and the rc file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conf-file-settings-and-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      conf file settings and syntax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="conf file settings and syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v36-preventing-automatic-sync" class="md-nav__link">
    <span class="md-ellipsis">
      (v3.6+) preventing automatic sync
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v361-mirroring-failures" class="md-nav__link">
    <span class="md-ellipsis">
      (v3.6.1+) mirroring failures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manually-synchronising-a-copy-repo" class="md-nav__link">
    <span class="md-ellipsis">
      manually synchronising a copy repo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redirected-pushes" class="md-nav__link">
    <span class="md-ellipsis">
      redirected pushes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-a-hostname-substitution" class="md-nav__link">
    <span class="md-ellipsis">
      appendix A: HOSTNAME substitution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-b-efficiency-versus-paranoia" class="md-nav__link">
    <span class="md-ellipsis">
      appendix B: efficiency versus paranoia
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-c-moving-the-admin-repo-to-a-different-master" class="md-nav__link">
    <span class="md-ellipsis">
      appendix C: moving the admin repo to a different master
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-d-fixing-a-broken-copy" class="md-nav__link">
    <span class="md-ellipsis">
      appendix D: fixing a broken copy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="mirroring-using-gitolite">mirroring using gitolite<a class="headerlink" href="#mirroring-using-gitolite" title="Permanent link">#</a></h1>
<hr />
<div class="admonition danger">
<p class="admonition-title">v2 mirroring users:</p>
<!-- duplicated in migr.md with minor differences -->
<p>There are <strong>several</strong> important differences in mirroring; it's best to
<strong>start from a clean slate on all copies</strong>, using this documentation.</p>
<p>If you're not willing to do that, you may be able to use the older, more
detailed, documentation <a href="https://github.com/sitaramc/gitolite-doc/tree/master/archive">here</a> to manage the migration.  However, I
cannot support that (mainly due to lack of time).</p>
</div>
<hr />
<div class="admonition danger">
<p class="admonition-title">terminology change</p>
<p>NOTE This documentation is current with the <em>just</em>-released (as of 2pm UTC
on 2020-08-04), v3.6.12.  For most people, until you upgrade, this
documentation will have some terminology differences.</p>
</div>
<h2 id="quick-intro">quick intro<a class="headerlink" href="#quick-intro" title="Permanent link">#</a></h2>
<p>Mirroring is simple: you have one "master" server and one or more "copy"
servers.  The copies get updates only from the master; to the rest of the
world they are at best read-only.</p>
<p>In the following picture, each box (A, B, C, ...) is a repo.  The master
server for a repo is colored red, copies are green.  Users only push to a
master server (red), and the master server then does a <code>git push --mirror</code> to
the copies.  The arrows show this mirror push.</p>
<p><img alt="" src="mi02.png" /></p>
<p>Here's a more complete description of what gitolite can do:</p>
<ul>
<li>
<p>Different masters and sets of copies for different repos.</p>
<p>This lets you do things like:</p>
<ul>
<li>Use the server closest to <em>most</em> of its developers as the master for
    that repo.</li>
<li>Mirror a repo to only some of the servers.</li>
<li>Have repos that are purely local to a server (not mirrored at all).</li>
<li>Push to a copy on demand or via cron (helps deal with bandwidth or
    connectivity constraints).</li>
</ul>
<p>All this is possible whether or not the gitolite-admin repo is mirrored --
that is, all servers have the <em>exact same</em> gitolite-admin repo or not.</p>
</li>
<li>
<p>Pushes to a copy can be transparently forwarded to the real master.</p>
<p>Your developers need not worry about where a repo's master is -- they just
write to their local mirror for <em>all</em> repos, even if their local mirror is
only a copy for some.</p>
</li>
</ul>
<h2 id="caveats">caveats<a class="headerlink" href="#caveats" title="Permanent link">#</a></h2>
<ul>
<li>
<p>Mirroring by itself will never <em>create</em> a repo on a copy; it has to exist
    and be prepared to receive updates from the master.</p>
<p>The simplest way to ensure your repos exist on the copies also is to
mirror the special gitolite-admin repo as well, and this is what most
sites do.</p>
</li>
<li>
<p>There is limited support for auto-creating wild card repos and sending
    'perms' info across, with the following caveats at present.  (Some of this
    text won't make sense unless you know what those features are).</p>
<ul>
<li>
<p><em><span class="red">WARNING</span>: it does NOT make sense to mirror
    wild repos in setups where the authentication data is not the same
    (i.e., where "alice" on the master and "alice" on a copy maybe
    totally different people)</em>.</p>
</li>
<li>
<p>This has only been minimally tested.  For example, complex setups or
    asymmetric configs on master and copy, etc. have NOT been tested.</p>
</li>
<li>
<p>Permission changes will only propagate on the next 'git push'.  Of
    course, if you know the name of the copy server, you can run</p>
<pre><code>ssh git@host mirror push copy-server-name repo-name
</code></pre>
</li>
<li>
<p>Using 'perms' on a copy is allowed but will neither propagate nor
    persist.  They will be overwritten by whatever perms the master has
    (even if it is an empty set) on the next 'git push'.</p>
</li>
<li>
<p>As with lots of extra features in gitolite, smart http support is not
    on my radar.  Don't ask.</p>
</li>
</ul>
<p>Please test it out and let me know if something surprising happens.  Be
aware that I have been known to claim bugs are features if I don't have
time to fix them immediately :-)</p>
</li>
<li>
<p>Mirroring is only for git repos.  Ancillary files like gl-creator and
    gl-perms in the repo directory are not mirrored; you must do that
    separately.  Files in the admin directory (like log files) are also not
    mirrored.</p>
</li>
<li>
<p>If you ever do a <a href="emergencies.html#bypassing-gitolite">bypass push</a>, mirroring will not work.
    Mirroring checks also will not work -- for example, you can push to a
    copy, which is not usually a good idea.  So don't bypass gitolite if the
    repo is mirrored!</p>
</li>
<li>
<p>From v3.5.3 on, gitolite uses an asynchronous push to the copies, so that
    the main push returns immediately, without waiting for the copy pushes to
    complete.  Keep this in mind if you're writing scripts that do a push, and
    then read one of the copies immediately -- you will need to add a few
    seconds of sleep in your script.</p>
</li>
</ul>
<h2 id="setting-up-mirroring">setting up mirroring<a class="headerlink" href="#setting-up-mirroring" title="Permanent link">#</a></h2>
<p>This is in two parts: the initial setup and the rc file, followed by the conf
file settings and syntax.</p>
<h3 id="the-initial-setup-and-the-rc-file">the initial setup and the <a href="rc.html">rc file</a><a class="headerlink" href="#the-initial-setup-and-the-rc-file" title="Permanent link">#</a></h3>
<p>For <strong>each</strong> server:</p>
<ul>
<li>
<p>Install gitolite normally.  Make clones of the server's 'gitolite-admin'
    repo on your workstation so you can admin them all from one place.</p>
</li>
<li>
<p>Give the server a short, simple, "hostname" and set the HOSTNAME in the
    rc file (i.e., <code>~/.gitolite.rc</code> on the server) to this name, for example
    'mars'.  <em>Note: this has nothing to do with the hostname of the server in
    networking or DNS terms, or in OS terms.  This is internal to gitolite</em>.</p>
</li>
<li>
<p>Run ssh-keygen if needed and get an ssh key pair for the server.  Copy the
    public key to a common area (accessible to your workstation for copying)
    and name it after the host, but with 'server-' prefixed.  For example, the
    pubkey for server 'mars' must be stored as 'server-mars.pub'.</p>
</li>
<li>
<p>Copy <em>all</em> these pubkeys (i.e., one from each server) to <em>all</em> the admin
    repo clones on your workstation and add them as usual.  This is an
    <code>O(N^2)</code> operation ;-)</p>
<p>Don't forget to push the changes!</p>
<p>You may have guessed that the prefix 'server-' is special, and
distinguishes a human user from a mirroring peer.</p>
</li>
<li>
<p>Create "host" aliases to refer to all other machines.  See <a href="sts.html#appendix-4-ssh-host-aliases">here</a>
    for what/how.</p>
<p>The host alias for a host (in all other machines' <code>~/.ssh/config</code> files)
MUST be the same as the <code>HOSTNAME</code> in the referred host's
<code>~/.gitolite.rc</code>.  Gitolite mirroring <strong>requires</strong> this consistency in
naming; things will NOT work otherwise.</p>
<p>Normally you should be able to build one common file and append it to all
the servers' <code>~/.ssh/config</code> files.</p>
</li>
<li>
<p>The following <strong>MUST</strong> work for <strong>each pair</strong> of servers that must talk to
    each other:</p>
<pre><code># on server mars
ssh phobos info
# the response MUST start with "hello, server-mars..."
</code></pre>
<p>Note the exact syntax used; variations like "ssh git@phobos.example.com
info" are NOT sufficient.  That is why you need the ssh host aliases.</p>
<p>Check this command from <em>everywhere to everywhere else</em>, and make sure you
get expected results.  <strong>Do NOT proceed otherwise.</strong></p>
</li>
<li>
<p>Setup the gitolite.conf file on all the servers.  If the copies are to be
    exact copies of the master, you need to do the complete configuration only
    on the master; the copies can have just this because on the first push to
    the master it will update all the copies anyway:</p>
<p><pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">repo</span> gitolite-admin
    <span class="Statement">RW+</span>     =   some-local-admin
<span class="Comment"># possibly other rules</span>
    <span class="Statement">option</span> <span class="Identifier">mirror.master</span>    =   <span class="Constant">mars</span>
    <span class="Statement">option</span> <span class="Identifier">mirror.copies</span>    =   <span class="Constant">phobos</span>
</pre></p>
</li>
<li>
<p>When that is all done and tested, <strong>enable mirroring</strong> by going through
    the rc file and uncommenting all the lines mentioning <code>Mirroring</code>.</p>
</li>
<li>
<p>If you wish to allow your users to run the mirror command remotely
    (usually <em>not</em> required), you need to enable it just like any other
    command that is not enabled by default; see <a href="non-core.html#gitolite-commands">gitolite commands</a>
    for how.</p>
</li>
</ul>
<h3 id="conf-file-settings-and-syntax">conf file settings and syntax<a class="headerlink" href="#conf-file-settings-and-syntax" title="Permanent link">#</a></h3>
<p>Mirroring is defined by the following <a href="options.html">options</a>.  You can have different
settings for different repos, and of course some repos may not have any mirror
options at all -- they are then purely local.</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">repo</span> foo
    ...access rules...

    <span class="Statement">option</span> <span class="Identifier">mirror.master</span>        =   <span class="Constant">mars</span>
    <span class="Statement">option</span> <span class="Identifier">mirror.copies</span>        =   <span class="Constant">phobos deimos</span>
    <span class="Statement">option</span> <span class="Identifier">mirror.redirectOK</span>    =   <span class="Constant">all</span>
</pre>

<p>The first line is easy, since a repo can have only one master.</p>
<p>The second is a space separated list of hosts that are all copies.  You can
have several copy lists, as long as the config key starts with
'mirror.copies' and is unique.  For example.</p>
<pre style="color: #ffffff; background-color: #000000;">
    <span class="Statement">option</span> <span class="Identifier">mirror.copies-1</span>   =   <span class="Constant">phobos deimos</span>
    <span class="Statement">option</span> <span class="Identifier">mirror.copies-2</span>   =   <span class="Constant">io europa</span>
    <span class="Statement">option</span> <span class="Identifier">mirror.copies-3</span>   =   <span class="Constant">ganymede callisto</span>
</pre>

<p>Do not repeat a key; then only the last line for that key will be effective.</p>
<h4 id="v36-preventing-automatic-sync"><span class="gray">(v3.6+)</span> preventing automatic sync<a class="headerlink" href="#v36-preventing-automatic-sync" title="Permanent link">#</a></h4>
<p>Sometimes you don't want a repo to be mirrored automatically (as soon as
someone pushes to the master) to all the copies.  For whatever reasons, you
have some copies for whom you would like to trigger the sync later (and you
don't mind the fact that those copies are out of sync until then).</p>
<p>To make that happen, use option lines like this instead of those shown above:</p>
<pre style="color: #ffffff; background-color: #000000;">
    <span class="Statement">option</span> <span class="Identifier">mirror.copies.nosync-1</span>   =   <span class="Constant">phobos deimos</span>
</pre>

<p>Except for the addition of a <code>.nosync</code> just after <code>copies</code>, all the other
rules are the same as before.</p>
<p>This setting will generate a warning that a "manual mirror push [is]
pending" for each copy that has the <code>nosync</code> option.  If you're sure you
don't need those warnings, you can upgrade to the latest gitolite, and
use <code>nosync-quiet</code> as the option instead.</p>
<pre style="color: #ffffff; background-color: #000000;">
    <span class="Statement">option</span> <span class="Identifier">mirror.copies.nosync-quiet-1</span>   =   <span class="Constant">phobos deimos</span>
</pre>

<p>(Eventually, this will appear in v3.6.14)</p>
<h2 id="v361-mirroring-failures"><span class="gray">(v3.6.1+)</span> mirroring failures<a class="headerlink" href="#v361-mirroring-failures" title="Permanent link">#</a></h2>
<p>Since mirror pushes happen asynchronously (i.e, the user who originally pushed
does not have to wait for the mirrors to be synced), any mirror push failures
are not immediately visible to a human being, although you will find them if
you look in gitolite's log files.</p>
<p><span class="box-r">Note: since only a successful push can clear the error status, it
follows that if a mirror push failed due to an invalid hostname, that status
file will need to be manually deleted from the server.  Look in the bare repo
directory on the server, for one or more files whose names start with
'gl-copy' and delete the appropriate one.</span></p>
<p>Therefore, when the output of the mirror push to some copy contains the word
"fatal", gitolite saves the output. This saved output is printed to STDERR
when any user attempts to clone/fetch/push the repo on the master server for
that repo.  The hope is that someone will alert an admin to look at the
problem.  This will continue to happen until the error condition is cleared
(i.e., a successful mirror push happens to that specific copy).</p>
<p>If you don't want these unexpected reports confusing users (or programs!),
simply create a new rc variable called HUSH_MIRROR_STATUS and set it to 1.
<span class="gray">(If you're not sure where in the rc file this should go, I suggest
putting it right after the HOSTNAME variable).</span></p>
<p>You can see the mirror status of any repo using the 'mirror status' command;
the command line help for the mirror command ('gitolite mirror -h' or 'ssh
git@host mirror -h') has details.</p>
<h2 id="manually-synchronising-a-copy-repo">manually synchronising a copy repo<a class="headerlink" href="#manually-synchronising-a-copy-repo" title="Permanent link">#</a></h2>
<p>You can use the <code>gitolite mirror push</code> command on a master to manually
synchronise any of its copies.  Try it with <code>-h</code> to get usage info.</p>
<p>Tip: if you want to do this to all the copies, try this:</p>
<pre><code>for s in `gitolite mirror list copies reponame`
do
    gitolite mirror push $s reponame
done
</code></pre>
<p>This command can also be run remotely; run <code>ssh git@host mirror -h</code> for
details.</p>
<p>Note: if your version of the mirror command does not support 'list copies',
use <code>gitolite git-config -r reponame mirror.copies | cut -f3</code> instead.</p>
<h2 id="redirected-pushes">redirected pushes<a class="headerlink" href="#redirected-pushes" title="Permanent link">#</a></h2>
<p><strong>Please read carefully; there are security implications if you enable this
for mirrors NOT under your control</strong>.</p>
<p>Normally, a master, (and <em>only</em> a master), pushes to a copy, and the copies
are "read-only" to the users.  Gitolite allows a <em>copy</em> to receive pushes
from a user and transparently redirect them to the <em>master</em>.</p>
<p>This simplifies things for users in complex setups, letting them use their
local mirror for both fetch and push access to all repos.</p>
<div class="admonition note">
<p class="admonition-title">Note:</p>
<p>Just to be clear, the actual push will still happen only on the master,
which needs to be up (the redirection is at the <strong>ssh</strong> level).  It's main
use is in geographically distributed setups, where users are encouraged to
use a nearer node as their "fetch" remote, but, without this feature,
they'd have to use the actual master node as the "push" remote.  This
allows users to use the same (nearby) node as the "push" remote also.</p>
<p>It is also useful if the master dies, and the administrator redesignates
some other node as the master.  In that situation, only users who had the
original master as a remote need to update their remote URLs.</p>
</div>
<p>The syntax for enabling this is one of these:</p>
<pre style="color: #ffffff; background-color: #000000;">
    <span class="Statement">option</span> <span class="Identifier">mirror.redirectOK</span>    =   <span class="Constant">all</span>
    <span class="Statement">option</span> <span class="Identifier">mirror.redirectOK</span>    =   <span class="Constant">phobos deimos</span>
</pre>

<p>The first syntax trusts all valid copies to redirect user pushes, while the
second one trusts only some copies.</p>
<p><strong>IMPORTANT NOTES</strong></p>
<ul>
<li>
<p>This only works for ssh-based setups; you cannot use this feature in http
    mode.</p>
</li>
<li>
<p><strong>Authentication</strong> happens on the copy, but <strong>authorisation</strong> is on the
    master.  The master is trusting the copy to authenticate the user
    correctly, even though the actual push is going to the master.  This means
    that user alice on the copy must be guaranteed to be the same as user
    alice on the master.</p>
</li>
<li>
<p>The part of the authorisation that happens before passing control to
    git-receive-pack (see <a href="conf.html#access-rules">access rules</a>) will happen on the copy as
    well.</p>
</li>
<li>
<p>You cannot redirect gitolite commands (like perms, etc).</p>
</li>
</ul>
<h2 id="appendix-a-hostname-substitution">appendix A: HOSTNAME substitution<a class="headerlink" href="#appendix-a-hostname-substitution" title="Permanent link">#</a></h2>
<p>Wherever gitolite sees the word <code>%HOSTNAME</code>, it will replace it with the
HOSTNAME supplied in the rc file, if one was supplied.  This lets you maintain
configurations for all servers in one repo, yet have them act differently on
different servers, by saying something like:</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Statement">include</span> &quot;%HOSTNAME/*.conf&quot;
</pre>

<p>(See <a href="conf.html#include-files">include</a> for more on the 'include' command).</p>
<p>You can use it in other places also, for example:</p>
<pre style="color: #ffffff; background-color: #000000;">
    <span class="Statement">RW+</span>     <span class="Constant">VREF/</span><span class="PreProc">NAME/</span><span class="Constant">subs/%HOST</span><span class="PreProc">NAME/</span>       =   <span class="Identifier">@%HOSTNAME-admins</span>
</pre>

<p>(you still have to define @mars-admins, @phobos-admins, etc., but the actual
VREF is now one line instead of one for each server!)</p>
<h2 id="appendix-b-efficiency-versus-paranoia">appendix B: efficiency versus paranoia<a class="headerlink" href="#appendix-b-efficiency-versus-paranoia" title="Permanent link">#</a></h2>
<p>If you're paranoid enough to use mirrors, you should be paranoid enough to
set this on each server, despite the possible CPU overhead:</p>
<pre><code>git config --global receive.fsckObjects true
</code></pre>
<h2 id="appendix-c-moving-the-admin-repo-to-a-different-master">appendix C: moving the admin repo to a different master<a class="headerlink" href="#appendix-c-moving-the-admin-repo-to-a-different-master" title="Permanent link">#</a></h2>
<p>Moving only some repos (other than the gitolite-admin repo) to a different
master is easy.  Just make the change in the gitolite.conf file, add, commit,
and push.</p>
<p>Even for the gitolite-admin repo, if the current master is ok, it's the same
thing; just make the change and push <em>to the current master</em>.  Subsequent
pushes will go to the new master, of course.</p>
<p>But if the current master is already dead, there's a bit of a catch-22.  You
can't push to the master because it is dead, and you can't push to any copy
because they won't accept updates from anywhere but the server they think is
the master.</p>
<p>Here's how to resolve this:</p>
<ol>
<li>
<p>On <em>each</em> copy:</p>
<ul>
<li>
<p>Edit <code>~/.gitolite/conf/gitolite.conf</code> to change the master and copy
    options for the gitolite-admin repo.</p>
</li>
<li>
<p>Run <code>gitolite setup</code>.</p>
</li>
</ul>
</li>
<li>
<p>Now clone the admin repo from the <em>new</em> master to your workstation, change
    the options for the rest of the repos (if needed), then add/commit/push.</p>
</li>
</ol>
<p>And that should be all you need to do.</p>
<!--

*   mirroring: when a redirected push fails on the master, it still does a
    push-all-copies?  yes because only the *client* knows that the push
    failed.  The actual update happens in a grandchild process and
    git-receive-pack does not propagate a non-0 exit status.  So we have no
    way of knowing, short of recording the failure in some *other* place that
    a grandparent task can inspect and act on.

-->

<h2 id="appendix-d-fixing-a-broken-copy">appendix D: fixing a broken copy<a class="headerlink" href="#appendix-d-fixing-a-broken-copy" title="Permanent link">#</a></h2>
<p>Let's say you had</p>
<pre><code>option mirror.master        =   mars
option mirror.copies        =   phobos deimos
</code></pre>
<p>and you then accidentally removed <code>phobos</code> and pushed.</p>
<p>You quickly realise your error and put the line back, then push again, only to
realise that phobos is now unreachable.  It took the previous push to heart
and updated its internal state accordingly, and any subsequent attempts to
touch the gitolite-admin repo on phobos results in the message:</p>
<pre><code>FATAL: phobos: 'gitolite-admin' is mirrored but not here
</code></pre>
<p>This is basically saying, "yes I see that repo in the config, but I (phobos)
am neither the master nor one of the copies for it, so please don't ask me
about it!".  You're basically locked out of phobos now.</p>
<p>The solution is this:</p>
<ul>
<li>
<p>log on to phobos' gitolite shell account</p>
</li>
<li>
<p>edit <code>~/.gitolite/conf/gitolite.conf</code> to fix the mirroring options for the
    gitolite-admin repo.</p>
</li>
<li>
<p>run <code>gitolite setup</code>.</p>
</li>
</ul>
<p>That should do it.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="gitweb-daemon.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: gitweb and git-daemon">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                gitweb and git-daemon
              </div>
            </div>
          </a>
        
        
          
          <a href="non-core.html" class="md-footer__link md-footer__link--next" aria-label="Next: core and &#34;non-core&#34; gitolite">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                core and "non-core" gitolite
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.footer", "search.suggest", "search.highlight"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>
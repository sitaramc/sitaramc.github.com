
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="conf.html">
      
      
        <link rel="next" href="rc.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>the "conf" file (part 2) - Gitolite</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/gitolite.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-conf-file-confgitoliteconf" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Gitolite" class="md-header__button md-logo" aria-label="Gitolite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gitolite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              the "conf" file (part 2)
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Gitolite" class="md-nav__button md-logo" aria-label="Gitolite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Gitolite
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    what/why
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            what/why
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    concepts, conventions, terminology
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    install and setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            install and setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quick_install.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (unix/ssh experts) quick install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="install.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    normal ssh mode install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fool_proof_setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (if all else fails) fool-proof, step-by-step, install and setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP mode install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    migrating from v2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    use
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            use
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    basic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            basic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="basic-admin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    basic administration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="conf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "conf" file (part 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    the "conf" file (part 2)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="conf-2.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    the "conf" file (part 2)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#access-control-rule-matching" class="md-nav__link">
    <span class="md-ellipsis">
      access control rule matching
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access control rule matching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#an-example" class="md-nav__link">
    <span class="md-ellipsis">
      an example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracing-the-access-control-decision" class="md-nav__link">
    <span class="md-ellipsis">
      tracing the access control decision
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-access-respecting-deny-rules" class="md-nav__link">
    <span class="md-ellipsis">
      read access respecting deny rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read access respecting deny rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    <span class="md-ellipsis">
      example 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2" class="md-nav__link">
    <span class="md-ellipsis">
      example 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-1-different-types-of-write-operations" class="md-nav__link">
    <span class="md-ellipsis">
      appendix 1: different types of write operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="appendix 1: different types of write operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-of-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      summary of permissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-2-gitolite-access-check-flow" class="md-nav__link">
    <span class="md-ellipsis">
      appendix 2: gitolite access check flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="appendix 2: gitolite access check flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      putting it all together
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-3-embedding-test-code-in-your-conf" class="md-nav__link">
    <span class="md-ellipsis">
      appendix 3: embedding test code in your conf
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the "rc" file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="user.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    your users' view
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="git-config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    setting git-config values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="options.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="wild.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ad hoc user-created ("wild") repos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    using templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vref.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    virtual refs (part 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vref-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    virtual refs (part 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deleg.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    delegation of admin duties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gitweb-daemon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitweb and git-daemon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mirroring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mirroring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    customise
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            customise
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="non-core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    core and "non-core" gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dev-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    writing your own non-core code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="triggers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite triggers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="list-non-core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    list of non-core programs shipped with gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cookbook.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    (quick! how do I...) the cookbook
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    HELP!
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            HELP!
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="emergencies.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emergency!!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ssh
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            ssh
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ssh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ssh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="glssh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    how gitolite uses ssh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ssh troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="regex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    regular expressions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    other docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            other docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="odds-and-ends.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    miscellaneous features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="namespaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    using git namespaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="locking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    locking binary files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    testing gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="package.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    packaging gitolite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gitolite-and-ssh-certs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite and ssh certs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    more about gitolite
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            more about gitolite
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="files.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gitolite files & directories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rc-33.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    the 3.3 format rc file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="perf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="internals.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internals
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    contrib
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            contrib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/ssh-and-http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using both ssh and http
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/putty.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Putty and Msysgit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/sskm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Self-service key management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/ukm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User key management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contrib/README-emacs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emacs major mode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="no-way.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    no way!
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#access-control-rule-matching" class="md-nav__link">
    <span class="md-ellipsis">
      access control rule matching
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access control rule matching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#an-example" class="md-nav__link">
    <span class="md-ellipsis">
      an example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracing-the-access-control-decision" class="md-nav__link">
    <span class="md-ellipsis">
      tracing the access control decision
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-access-respecting-deny-rules" class="md-nav__link">
    <span class="md-ellipsis">
      read access respecting deny rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read access respecting deny rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    <span class="md-ellipsis">
      example 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2" class="md-nav__link">
    <span class="md-ellipsis">
      example 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-1-different-types-of-write-operations" class="md-nav__link">
    <span class="md-ellipsis">
      appendix 1: different types of write operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="appendix 1: different types of write operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-of-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      summary of permissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-2-gitolite-access-check-flow" class="md-nav__link">
    <span class="md-ellipsis">
      appendix 2: gitolite access check flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="appendix 2: gitolite access check flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      putting it all together
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-3-embedding-test-code-in-your-conf" class="md-nav__link">
    <span class="md-ellipsis">
      appendix 3: embedding test code in your conf
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="the-conf-file-confgitoliteconf">the "conf" file (<code>conf/gitolite.conf</code>)<a class="headerlink" href="#the-conf-file-confgitoliteconf" title="Permanent link">#</a></h1>
<center>(part 2)</center>

<hr />
<h2 id="access-control-rule-matching">access control rule matching<a class="headerlink" href="#access-control-rule-matching" title="Permanent link">#</a></h2>
<p>Access control rule matching is pretty simple.  From the previous section,
you know what "permission", "refex", "user", and "repo" are.  Here's how the
rules are used to decide whether to allow or deny a request.</p>
<p>Access is checked once only for "read" operations, but twice for "write"s.</p>
<p>(Note that the <code>deny-rules</code> option, mentioned below, is explained in more
detail in a later section.)</p>
<p><strong>Check #1</strong>: the first check happens as soon as gitolite-shell receives
control (from sshd or httpd).  gitolite-shell will pass control to
git-upload-pack or git-receive-pack only if this check succeeds.</p>
<ul>
<li>collect all the rules pertaining to this repo <em>and</em> this user</li>
<li>ignore all the refexes; they don't apply to the first access check</li>
<li><strong>if</strong> the <code>deny-rules</code> option is <strong>not</strong> in effect for this repo, discard
    all the <code>-</code> (deny) rules</li>
<li>look at the rules <em>in sequence</em>:<ul>
<li>if you find a <code>-</code>, access is denied</li>
<li>for a "read" operation (clone, fetch, ...), if you find a rule
    containing <code>R</code>, access is allowed</li>
<li>for a "write" operation (push), if you find a rule containing <code>W</code>,
    access is allowed</li>
<li>if there are no more rules left, access is denied</li>
</ul>
</li>
</ul>
<p><strong>Check #2</strong>: the second check only happens for "push" operations.  It is
invoked by <code>git-receive-pack</code> running the gitolite-installed <code>update</code> hook.
If access is denied, the update hook fails, and git then aborts the push for
this ref.  (See <code>man githooks</code> for more.)</p>
<p>In the following description, we use the word <code>operation</code> instead of <code>W</code>,
because the actual operation could be a plain, fast-forward, push (<code>W</code>) or a
rewind/delete (<code>+</code>).  <span class="gray">Other, less commonly used, values are "C", "D",
or "M"; see <a href="conf-2.html#appendix-1-different-types-of-write-operations">here</a>.</span></p>
<ul>
<li>collect all the rules pertaining to this repo <em>and</em> this user</li>
<li>discard all the rules where the refex does not match the ref (branch or
    tag) being pushed</li>
<li>look at the rules <em>in sequence</em>:<ul>
<li>if you find a <code>-</code>, access is denied</li>
<li>if you find a rule containing the operation you are performing, access
    is allowed</li>
<li>if there are no more rules left, access is denied</li>
</ul>
</li>
</ul>
<h3 id="an-example">an example<a class="headerlink" href="#an-example" title="Permanent link">#</a></h3>
<p>Just to be clear, let's work out an example of what happens when dilbert tries
to push a branch called "xyz".</p>
<p>We'll pretend the rule list looks like this:</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Comment"># managers should be able to read any repo</span>
<span class="Statement">repo</span> <span class="Identifier">@all</span>
    <span class="Statement">R</span>                       =   <span class="Identifier">@managers</span>

<span class="Comment"># ...other rules for other repos...</span>

<span class="Statement">repo</span> foo bar

    <span class="Statement">RW+</span>                     =   alice <span class="Identifier">@teamleads</span>
    <span class="Statement">-</span>   <span class="Constant">master</span>              =   <span class="WarningMsg">dilbert @devteam</span>
    <span class="Statement">-</span>   <span class="Constant">refs/tags/v[0-9]</span>    =   <span class="WarningMsg">dilbert @devteam</span>
    <span class="Statement">RW+</span> <span class="Constant">dev/</span>                =   dilbert <span class="Identifier">@devteam</span>
    <span class="Statement">RW</span>                      =   dilbert <span class="Identifier">@devteam</span>
    <span class="Statement">R</span>                       =   <span class="Identifier">@managers</span>
</pre>

<p>After adding a default refex and expanding the supplied ones (see the
<a href="conf.html#the-refex-field">refex</a> section earlier), this is what it looks like.  We've added line
numbers for convenience; we'll see why later.</p>
<pre style="color: #ffffff; background-color: #000000;">
<span id="L1" class="LineNr"> 1 </span><span class="Comment"># managers should be able to read any repo</span>
<span id="L2" class="LineNr"> 2 </span><span class="Statement">repo</span> <span class="Identifier">@all</span>
<span id="L3" class="LineNr"> 3 </span>    <span class="Statement">R</span>                       =   <span class="Identifier">@managers</span>
<span id="L4" class="LineNr"> 4 </span>
<span id="L5" class="LineNr"> 5 </span>    <span class="Comment"># ...other rules for other repos...</span>
<span id="L6" class="LineNr"> 6 </span>
<span id="L7" class="LineNr"> 7 </span><span class="Statement">repo</span> foo bar
<span id="L8" class="LineNr"> 8 </span>
<span id="L9" class="LineNr"> 9 </span>    <span class="Statement">RW+</span> <span class="Constant">refs/.*</span>             =   alice <span class="Identifier">@teamleads</span>
<span id="L10" class="LineNr">10 </span>    <span class="Statement">-</span>   <span class="Constant">refs/heads/master</span>   =   <span class="WarningMsg">dilbert @devteam</span>
<span id="L11" class="LineNr">11 </span>    <span class="Statement">-</span>   <span class="Constant">refs/tags/v[0-9]</span>    =   <span class="WarningMsg">dilbert @devteam</span>
<span id="L12" class="LineNr">12 </span>    <span class="Statement">RW+</span> <span class="Constant">refs/heads/dev/</span>     =   dilbert <span class="Identifier">@devteam</span>
<span id="L13" class="LineNr">13 </span>    <span class="Statement">RW</span>  <span class="Constant">refs/.*</span>             =   dilbert <span class="Identifier">@devteam</span>
<span id="L14" class="LineNr">14 </span>    <span class="Statement">R</span>                       =   <span class="Identifier">@managers</span>
</pre>

<p>This represents a set of rules that are basically this:</p>
<pre><code>repo    user        perm    ref                 (from line)

 foo     @managers  R                                3
 foo     alice      RW+      refs/.*                 9
 foo     @teamleads RW+      refs/.*                 9
 foo     dilbert    -        refs/heads/master       10
 foo     @devteam   -        refs/heads/master       10
 foo     dilbert    -        refs/tags/v[0-9]        11
 foo     @devteam   -        refs/tags/v[0-9]        11
 foo     dilbert    RW+      refs/heads/dev/         12
 foo     @devteam   RW+      refs/heads/dev/         12
 foo     dilbert    RW       refs/.*                 13
 foo     @devteam   RW       refs/.*                 13
 foo     @managers  R                                14
</code></pre>
<p>Which of these rules apply for dilbert?  We'll assume he's not a team lead, as
<em>that</em> would defeat the whole purpose of this example!  We <em>know</em> he's not a
manager, as that would defeat the whole purpose of the comic! Finally, we
assume he's also not part of "@devteam", (otherwise why would you name him
separately in all those lines?).</p>
<p>So we discard all those rules, which leaves us, for repo "foo" and user
"dilbert":</p>
<pre><code>perm    ref                 (from line)

-        refs/heads/master       10
-        refs/tags/v[0-9]        11
RW+      refs/heads/dev/         12
RW       refs/.*                 13
</code></pre>
<p>So what happens when dilbert tries to push a branch called "xyz"?</p>
<p>At check #1, the data gitolite has is that "oper" is "W" (and ref of course is
unknown).  We discard lines 10 and 11 (the <code>deny-rules</code> option is off by
default, so we ignore <code>-</code> rules).  Line 12 supplies a perm of "RW+", which
contains "W" (the "oper") so access is allowed.</p>
<p>At check #2, the data gitolite has is that "oper" is "W" and ref is
<code>refs/heads/xyz</code>.  We discard the first three rules, since the ref does not
match any of those refexes.  That leaves just line 13.</p>
<p>If the push were a fast-forward push, the "oper" would be "W", and since it is
contained in the perm for rule 13, access is allowed.</p>
<p>However, if he were to try a rewind-push, then the "oper" would be "+", which
is not contained in "RW", it wouldn't match, then control would go back for
the <em>next</em> rule, and since there aren't any more, access would be denied.</p>
<hr />
<h2 id="tracing-the-access-control-decision">tracing the access control decision<a class="headerlink" href="#tracing-the-access-control-decision" title="Permanent link">#</a></h2>
<p><span class="gray">(v3.6.1)</span> Gitolite can help you trace this logic quickly and easily.
Here's one example run, with the above rules.  This one tests whether dilbert
can push to repo foo (check #1).  Note that the syntax for specifying an
unknown ref in this command is 'any'.</p>
<pre><code>$ gitolite access -s foo dilbert W any
legend:
    d =&gt; skipped deny rule due to ref unknown or 'any',
    r =&gt; skipped due to refex not matching,
    p =&gt; skipped due to perm (W, +, etc) not matching,
    D =&gt; explicitly denied,
    A =&gt; explicitly allowed,
    F =&gt; denied due to fallthru (no rules matched)

  d        gitolite.conf:10         -   refs/heads/master   =   dilbert @devteam
  d        gitolite.conf:11         -   refs/tags/v[0-9]    =   dilbert @devteam
  A        gitolite.conf:12         RW+ refs/heads/dev/     =   dilbert @devteam

refs/heads/dev/
</code></pre>
<p>Now see what happens when we try check #2 (we've omitted the legend in the
output, since it's always the same):</p>
<pre><code>$ gitolite access -s foo dilbert W xyz

  r        gitolite.conf:10         -   refs/heads/master   =   dilbert @devteam
  r        gitolite.conf:11         -   refs/tags/v[0-9]    =   dilbert @devteam
  r        gitolite.conf:12         RW+ refs/heads/dev/     =   dilbert @devteam
  A        gitolite.conf:13         RW  refs/.*             =   dilbert @devteam

refs/.*
</code></pre>
<p>And if you try a force push:</p>
<pre><code>$ gitolite access -s foo dilbert + refs/heads/xyz

  r        gitolite.conf:10         -   refs/heads/master   =   dilbert @devteam
  r        gitolite.conf:11         -   refs/tags/v[0-9]    =   dilbert @devteam
  r        gitolite.conf:12         RW+ refs/heads/dev/     =   dilbert @devteam
  p        gitolite.conf:13         RW  refs/.*             =   dilbert @devteam
  F           (fallthru)

+ refs/heads/xyz foo dilbert DENIED by fallthru
</code></pre>
<p>I hope that was useful!  Be sure you correlated the output of 'gitolite access
-s' with the rule workflow pictures and corresponding descriptions to cement
your understanding.</p>
<h2 id="read-access-respecting-deny-rules">read access respecting deny rules<a class="headerlink" href="#read-access-respecting-deny-rules" title="Permanent link">#</a></h2>
<p>Normally, deny rules are ignored by access check #1 (the one that runs
<em>before</em> git-upload-pack or git-receive-pack is called by gitolite-shell);
they apply only to check #2 (the update hook check).</p>
<p>But sometimes you want this "pre-git" access check to respect deny rules;
i.e., use the flow of check #2, not check #1.  You tell gitolite to do this by
setting the "deny-rules" option for the repo; when you do that, the flow of
check #2 is used for both stages, before git <em>and</em> in the update hook.</p>
<h3 id="example-1">example 1<a class="headerlink" href="#example-1" title="Permanent link">#</a></h3>
<p>Here's an example. Here, we have lots of repos, which should all be accessible
by gitweb or daemon, so we want the convenience provided by lines 6 and 7 (we
don't want to put line 7 in <em>each</em> repo).  However, we also have some secret
repos (maybe the gitolite-admin repo and some others that we will list), which
we want to prevent gitweb or daemon from seeing.</p>
<p>How do we do that?</p>
<p>The naive approach -- putting in a deny rule just for those repos -- doesn't
work.  In fact nothing else seems to work either; you'll have to replace the
<code>@all</code> with an exhaustive list of <em>all repos other than the secret repos</em>.</p>
<pre style="color: #ffffff; background-color: #000000;">
<span id="L1" class="LineNr">1 </span><span class="Identifier">@secret</span><span class="PreProc"> = gitolite-admin secret-repo/..*</span>
<span id="L2" class="LineNr">2 </span><span class="Statement">repo</span> <span class="Identifier">@secret</span>
<span id="L3" class="LineNr">3 </span>    <span class="Statement">-</span>   =   <span class="WarningMsg">gitweb daemon</span>
<span id="L4" class="LineNr">4 </span>
<span id="L5" class="LineNr">5 </span>
<span id="L6" class="LineNr">6 </span><span class="Statement">repo</span> <span class="Identifier">@all</span>
<span id="L7" class="LineNr">7 </span>    <span class="Statement">R</span>   =   gitweb daemon
<span id="L8" class="LineNr">8 </span>
<span id="L9" class="LineNr">9 </span><span class="Comment"># ...other repos and rules...</span>
</pre>

<p>That's... painful!</p>
<p>What you really want is for that repo to always use check #2, even when it
doesn't actually have a ref to test for.</p>
<pre style="color: #ffffff; background-color: #000000;">
<span id="L1" class="LineNr">1 </span><span class="Identifier">@secret</span><span class="PreProc"> = gitolite-admin secret-repo/..*</span>
<span id="L2" class="LineNr">2 </span><span class="Statement">repo</span> <span class="Identifier">@secret</span>
<span id="L3" class="LineNr">3 </span>    <span class="Statement">-</span>   =   <span class="WarningMsg">gitweb daemon</span>
<span id="L4" class="LineNr">4 </span>    <span class="Statement">option</span> <span class="Identifier">deny-rules</span> = <span class="Constant">1</span>
<span id="L5" class="LineNr">5 </span>
<span id="L6" class="LineNr">6 </span><span class="Statement">repo</span> <span class="Identifier">@all</span>
<span id="L7" class="LineNr">7 </span>    <span class="Statement">R</span>   =   gitweb daemon
<span id="L8" class="LineNr">8 </span>
<span id="L9" class="LineNr">9 </span><span class="Comment"># ...other repos and rules...</span>
</pre>

<p>This is done by adding <em>one</em> line, line 4 in this example.  This sets a
gitolite <a href="options.html">"option"</a> that says you want "deny rules" to be applicable
even for read access.</p>
<p>Once you do that, all you need to do is to ensure that the first rule
encountered by these two "users" for those repos is a deny rule, so that it
can take effect first.  In this example, the placement of lines 2, 3 vis-a-vis
lines 6, 7 matters -- don't switch them!</p>
<h3 id="example-2">example 2<a class="headerlink" href="#example-2" title="Permanent link">#</a></h3>
<p>In this example the "open" repos are fewer in number, so it is the opposite
situation to the above in terms of our ability to enumerate all the repos.</p>
<pre style="color: #ffffff; background-color: #000000;">
<span class="Identifier">@open</span><span class="PreProc"> = git gitolite foss/..* [...]</span>

<span class="Statement">repo</span> <span class="Identifier">@all</span>
    <span class="Statement">-</span>   =   <span class="WarningMsg">gitweb daemon</span>
    <span class="Statement">option</span> <span class="Identifier">deny-rules</span> = <span class="Constant">1</span>

<span class="Statement">repo</span> <span class="Identifier">@open</span>
    <span class="Statement">R</span>   =   gitweb daemon
    <span class="Statement">option</span> <span class="Identifier">deny-rules</span> = <span class="Constant">0</span>
</pre>

<p>To see why this works, you need to understand that for <a href="options.html">options</a> and
<a href="git-config.html">config</a> lines, a later setting <a href="git-config.html#overriding-config-values">overrides</a> earlier
ones.  So we set it to 1 for all repos, then selectively set it to 0 for some.</p>
<p>This means the "deny-rules" option applies to <em>all the repos except the "open"
repos</em>, and so the first rule encountered by gitweb and daemon is a deny rule,
so they are denied read access.  The "open" repos, on the other hand, get the
normal default behaviour, which is to ignore deny rules for read access, and
thus they only see the "R" permission.</p>
<hr />
<h2 id="appendix-1-different-types-of-write-operations">appendix 1: different types of write operations<a class="headerlink" href="#appendix-1-different-types-of-write-operations" title="Permanent link">#</a></h2>
<p>Git supplies enough information to the update hook to be able to distinguish
several types of writes.</p>
<p>The most common are:</p>
<ul>
<li><code>RW</code> -- create a ref or fast-forward push a ref.  No rewinds or deletes.</li>
<li><code>RW+</code> -- create, fast-forward push, rewind push, or delete a ref.</li>
</ul>
<p>Sometimes you want to allow people to push, but not <em>create</em> a ref.  Or
rewind, but not <em>delete</em> a ref.  The <code>C</code> and <code>D</code> qualifiers help here.</p>
<ul>
<li>
<p>If a rule specifies <code>RWC</code> or <code>RW+C</code>, then <em>rules that do NOT have the C
    qualifier will no longer permit </em><em>creating</em><em> a ref in that repo</em>.</p>
<p><font color="gray">Please do not confuse this with the standalone <code>C</code>
permission that allows someone to <a href="wild.html#user-creating-a-specific-repo">create</a> a <strong>repo</strong></font></p>
</li>
<li>
<p>If a rule specifies <code>RWD</code> or <code>RW+D</code>, then <em>rules that do NOT have the D
    qualifier will no longer permit </em><em>deleting</em><em> a ref in that repo</em>.</p>
</li>
</ul>
<p>Note: These two can be combined, so you can have <code>RWCD</code> and <code>RW+CD</code> as well.</p>
<p>One very rare need is to reject merge commits (a commit series that is not a
straight line of commits).  The <code>M</code> qualifier helps here:</p>
<ul>
<li>When a rule has <code>M</code> appended to the permissions, <em>rules that do NOT have
    it will reject a commit sequence that contains a merge commit</em> (i.e., they
    only accept a straight line series of commits).</li>
</ul>
<h3 id="summary-of-permissions">summary of permissions<a class="headerlink" href="#summary-of-permissions" title="Permanent link">#</a></h3>
<p>The full set of permissions, in regex syntax, is <code>-|R|RW+?C?D?M?</code>.  This
expands to one of <code>-</code>, <code>R</code>, <code>RW</code>, <code>RW+</code>, <code>RWC</code>, <code>RW+C</code>, <code>RWD</code>, <code>RW+D</code>, <code>RWCD</code>,
or <code>RW+CD</code>, all but the first two optionally followed by an <code>M</code>.</p>
<hr />
<h2 id="appendix-2-gitolite-access-check-flow">appendix 2: gitolite access check flow<a class="headerlink" href="#appendix-2-gitolite-access-check-flow" title="Permanent link">#</a></h2>
<p>Here's lots more detail on the access check process, with flow diagrams.</p>
<p>When do the access checks happen and what are the four pieces of data (repo,
user, operation, ref) in each case?</p>
<table>
<thead>
<tr>
<th>read</th>
<th>write</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="" src="a1.png" /></td>
<td><img alt="" src="a2.png" /></td>
</tr>
</tbody>
</table>
<p>In these pictures the access checks are marked in yellow.</p>
<p>The picture on the left is for a read (git clone, fetch, ls-remote).  There is
only one access check for a read operation.  If access is denied, the
operation aborts.  Otherwise, gitolite-shell invokes git-upload-pack.</p>
<p>Notice the information available to the access check.  The "oper" (operation)
is "R", indicating a read operation.  The "ref" is listed as "unknown",
although we could also call it "irrelevant"!</p>
<p><strong>Access check #1</strong> proceeds with those 4 bits of information, and either
passes or fails.  If it passes, gitolite passes control to "git-upload-pack"
and its job is done.</p>
<hr />
<p>The flow for a push operation (the picture on the right) is <em>very</em> similar
upto the first access check. The "oper" is "W" now, although the "ref" is
still unknown. <span class="gray">Even though this <em>is</em> a push, at this stage in the
protocol nothing on the server knows what branch or tag or combination of them
are coming down the wire, since we haven't executed git-receive-pack
yet!</span></p>
<p>If it succeeds, gitolite passes control to "git-receive-pack", but its job is
not done yet.  <em>Git</em> will eventually invoke the update hook (see 'man
githooks'). Gitolite has already grabbed this hook, which receives from git
the ref name being pushed, as well as enough information to compute whether
this push is a "fast-forward push" or a "rewind push".  Based on this,
gitolite sets the "oper" field to "W" or "+", respectively.</p>
<p><strong>Access check #2</strong> proceeds with this information.  The result is sent back
to git-receive-pack (in the form of an exit code; again, see 'man githooks'),
and the push fails or succeeds based on that.</p>
<h3 id="putting-it-all-together">putting it all together<a class="headerlink" href="#putting-it-all-together" title="Permanent link">#</a></h3>
<p>At this point, we have the following pieces of information:</p>
<ul>
<li>
<p>A set of rules, each containing 4 pieces of data: repo, user, perm, refex.
    They are in the sequence they were found in the conf file.</p>
<p>We discard all rules that do not apply to this repo and this user, which
means our set of rules have only two fields: perm, refex.</p>
<p>As a quick reminder, perm is one of R, RW, RW+, or <code>-</code>.</p>
</li>
<li>
<p>Four elements that make up the access being attempted: repo, user, oper,
    ref.</p>
<p>Again, as a reminder, the "oper" is <strong>one letter</strong>.  For "check #1" it is
either R or W, and for check #2 it can be W or +.</p>
</li>
</ul>
<p><span class="gray">Note on permissions and "oper": there are other <a href="conf-2.html#appendix-1-different-types-of-write-operations">types of
permissions</a>, but for our discussion these are enough.  The
others are rare, and anyway it is easy to extrapolate to them.</span></p>
<p>With that background, here's the flow.  The one on the left is for check #1
(ref is unknown) while the one on the right is for check #2 (ref is known).</p>
<table>
<thead>
<tr>
<th>ref unknown</th>
<th>ref known</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="" src="a3.png" /></td>
<td><img alt="" src="a4.png" /></td>
</tr>
</tbody>
</table>
<p>As you can see, deny rules are ignored by check #1 -- they're not tested in
any way.  For check #2, if there is a deny rule whose refex matched the ref,
access is denied (as you'd expect).</p>
<h2 id="appendix-3-embedding-test-code-in-your-conf">appendix 3: embedding test code in your conf<a class="headerlink" href="#appendix-3-embedding-test-code-in-your-conf" title="Permanent link">#</a></h2>
<p>As of v3.6.7, it is possible to embed test code within gitolite.conf.  This
can be useful if your conf file is complicated, and you need a way to make
sure that any changes are not messing with your most important restrictions.</p>
<p>Full details, including preparation and caveats, are in
<code>contrib/utils/testconf</code>, but here's a teaser example:</p>
<pre><code>repo foo
    RW+     =   u1
    RW      =   u2

=begin testconf
gitolite access -q foo u1 + any || echo FAILED
gitolite access -q foo u2 + any &amp;&amp; echo FAILED
gitolite access -q foo u2 W any || echo FAILED
=end
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="conf.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: the &#34;conf&#34; file (part 1)">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                the "conf" file (part 1)
              </div>
            </div>
          </a>
        
        
          
          <a href="rc.html" class="md-footer__link md-footer__link--next" aria-label="Next: the &#34;rc&#34; file">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                the "rc" file
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.footer", "search.suggest", "search.highlight"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>namespace support in gitolite</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style>
      body        { background: #fff; text-color: #000; margin-left:  40px;   font-size:  0.9em;  font-family: arial; }
  
      code        { font-size:    1.1em;  background:  #ddf; text-color: #000; }
      pre         { margin-left:  2em;    background:  #ddf; text-color: #000; }
      pre code    { font-size:    1.1em;  background:  #ddf; text-color: #000; }
  
      td          { vertical-align: top }
  
      .red        { color: red }
      .blue       { color: blue }
      .green      { color: green }
      .gray       { color: gray }
      .pink       { color: pink }
  
      .box        { background-color:#e0e0e0 }
      .bg-red     { background-color:#ffe0e0 }
      .bg-green   { background-color:#e0ffe0 }
      .bg-blue    { background-color:#e0e0ff }
  
      /* couldn't resist the name! */
      .wd40       { width: 40% !important }
  
      .box-l      { float: left;  padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-right: 4px; }
      .box-r      { float: right; padding: 0px 0.5em; background-color: #e0e0e0; width:25%; margin-left:  4px; }
  
      .fl-l       { float: left;  padding: 0px 0.5em;                                       margin-right: 4px; }
      .fl-r       { float: right; padding: 0px 0.5em;                                       margin-left:  4px; }
  
      .sidebar {
          margin-left: 4px;
          width: 25%;
          float: right;
          border: 4px solid #fff;
      }
  
  </style>
  <style>
      h1          { background: #ffb; text-color: #000; margin-left: -30px;   border-top:    5px  solid #ccc; }
      h2          { background: #ffb; text-color: #000; margin-left: -20px;   border-top:    3px  solid #ddd; }
      h3          { background: #ffb; text-color: #000; margin-left: -10px; }
      h4          { background: #ffb; text-color: #000; }
  </style>
</head>
<body>
<!--
    generated by gvim then munged a fair bit.  The following command
        vim -E -c "TOhtml" -c "w" -c 'qa!' \-\- conf/gitolite.conf
    may or may not produce the same thing
-->

<style type="text/css">
<!--
.WarningMsg { color: #ff0000; }
.Constant { color: #ffa0a0; }
.Statement { color: #ffff60; font-weight: bold; }
.PreProc { color: #ff80ff; }
.LineNr { color: #ffff00; }
.Comment { color: #80a0ff; }
.Type { color: #60ff60; font-weight: bold; }
.Special { color: #ffa500; }
.Identifier { color: #40ffff; }
.Error { color: #ffffff; background-color: #ff0000; padding-bottom: 1px; }
.Todo { color: #0000ff; background-color: #ffff00; padding-bottom: 1px; }
-->
</style>
<div id="header">
<h1 class="title">namespace support in gitolite</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#background"><span class="toc-section-number">1</span> background</a></li>
<li><a href="#terminology"><span class="toc-section-number">2</span> terminology</a></li>
<li><a href="#setup"><span class="toc-section-number">3</span> setup</a></li>
<li><a href="#use"><span class="toc-section-number">4</span> use</a></li>
<li><a href="#details"><span class="toc-section-number">5</span> details</a></li>
<li><a href="#warnings"><span class="toc-section-number">6</span> WARNINGS</a><ul>
<li><a href="#security"><span class="toc-section-number">6.1</span> SECURITY</a></li>
<li><a href="#gitolite-functionality"><span class="toc-section-number">6.2</span> gitolite functionality</a></li>
<li><a href="#gitolite-functionality----mirroring"><span class="toc-section-number">6.3</span> gitolite functionality -- mirroring</a></li>
</ul></li>
<li><a href="#other-notes"><span class="toc-section-number">7</span> other notes</a></li>
</ul>
</div>
<script type="text/javascript">
<!--
    function hide_show(id) {
        var e = document.getElementById(id);
        if(e == null)
            return;
        if(e.style.display != 'none')
            e.style.display = 'none';
        else
            e.style.display = 'block';
    }

    window.onload = function() {
        var t = document.getElementById('TOC');
        var sbt = document.getElementById('SBTOC');
        var h = '<div id="PTOC">'
        var h2 = '<p><strong><span class="red">Page TOC</span></strong></p>'
        var h3 = '</div>'
        var h4 = '<div id="GTOC">'
        var h5 = '</div>'
        var hst = '<div style="background: white; color: green; border: 2px solid green"><center><font size=-1><strong>Hide/Show Table of Contents</strong><br />'
        var pd = '<a href="#" onclick="hide_show(\'PTOC\');">Page TOC</a> | '
        var gt = '<a href="#" onclick="hide_show(\'GTOC\');">Gitolite TOC</a></font></center></div>'

        if(t == null)
            sbt.innerHTML = hst + gt + h4 + sbt.innerHTML + h5;
        else {
            sbt.innerHTML = hst + pd + gt + h + h2 + t.innerHTML + h3 + h4 + sbt.innerHTML + h5;
            t.style.display = 'none';   // hide the TOC that pandoc placed
        }
    }
-->
</script>

<style>
    #PTOC ul {
        list-style: none;
        margin-left: 0;
        padding-left: 2em;
        text-indent: -2em;
        padding-bottom: 2em;
    }
    #PTOC ul li {
        padding-bottom: 10px;
    }
    #PTOC ul li ul {
        padding-bottom: 0px;
    }
    #PTOC ul li ul li {
        padding-bottom: 0px;
    }

    .sidebar-toc a:hover {
        background-color: white;
    }

    .sidebar-toc {
        margin-left: 4px;
        width: 25%;
        float: right;
        color: gray;
        background: lightgray;
        border: 4px solid #fff;
        font-size: 0.90em;
    }

    .sidebar-toc ul {
        padding-left: 2em;
    }

</style>

<div id="SBTOC" class="sidebar-toc">

<p><strong><span class="red">Gitolite TOC</span></strong></p>
<hr />
<center>
<span class="red"><strong>Background</strong></span>
</center>

<hr />
<p><a href="index.html">Main page</a></p>
<ul>
<li><a href="index.html#dl">download</a></li>
<li><a href="index.html#rtfm">documentation</a></li>
<li><a href="index.html#trouble"><strong>troubleshooting</strong></a></li>
<li><a href="index.html#contact"><strong>contact and support</strong></a></li>
<li><a href="index.html#license">license</a></li>
</ul>
<p><a href="overview.html">Overview</a></p>
<ul>
<li>what is Gitolite?</li>
<li>why might you need it?</li>
<li>how does it work?</li>
<li>who uses it?</li>
</ul>
<p><a href="concepts.html">Concepts and terminology</a></p>
<ul>
<li>authentication and authorisation</li>
<li>the &quot;hosting user&quot;</li>
<li>ssh mode and http mode</li>
<li>the special gitolite-admin repo</li>
</ul>
<p><a href="req.html">Before you start...</a></p>
<ul>
<li>your skills</li>
<li>your server</li>
<li>your and your users' clients</li>
<li><strong>cautions and caveats</strong></li>
<li><a href="req.html#trying">trying</a> out gitolite safely</li>
</ul>
<hr />
<center>
<span class="red"><strong>Basics</strong></span>
</center>

<hr />
<p><a href="install.html">install and setup</a></p>
<ul>
<li><a href="install.html#qi">quick install+setup</a> (for experts)</li>
<li>the long way around</li>
<li><a href="install.html#upgrading">upgrading</a></li>
<li><a href="install.html#moving">moving servers</a></li>
</ul>
<p><a href="basic-admin.html">Basic Administration</a></p>
<ul>
<li>clone the gitolite-admin repo</li>
<li>add/remove users</li>
<li>add/remove/rename repos</li>
<li>bringing existing repos into gitolite</li>
</ul>
<p><a href="conf.html">The conf file (<code>conf/gitolite.conf</code>)</a></p>
<ul>
<li>basic <a href="conf.html#syntax">syntax</a></li>
<li><a href="conf.html#include">include</a> files</li>
<li><a href="conf.html#groups">group definitions</a></li>
<li><a href="conf.html#rules"><strong><span class="red">access rules</span></strong></a></li>
</ul>
<p><a href="rc.html">the rc file (<code>~/.gitolite.rc</code>)</a></p>
<p><a href="user.html">Your users' view</a> of gitolite</p>
<p>Troubleshooting</p>
<ul>
<li>help for <a href="emergencies.html">emergencies</a></li>
<li>the <a href="ips.html">fool-proof install guide</a></li>
<li>the gitolite &quot;<a href="cookbook.html">cookbook</a>&quot;</li>
</ul>
<hr />
<center>
<span class="red"><strong>Advanced</strong></span>
</center>

<hr />
<p>Advanced &quot;conf file&quot; use</p>
<ul>
<li>specifying <a href="git-config.html">git-config</a> keys and values</li>
<li>gitolite <a href="options.html">options</a></li>
<li><a href="wild.html"><strong>wild repos</strong></a> (user created repos)</li>
<li><a href="vref.html">virtual refs</a></li>
<li><a href="deleg.html">delegation</a> of admin duties</li>
<li><a href="gitweb-daemon.html">gitweb and git-daemon</a></li>
</ul>
<p>Special features/setups</p>
<ul>
<li><strong><a href="mirroring.html">mirroring</a></strong></li>
<li><a href="http.html">http</a> mode</li>
<li>using a <a href="cache.html">cache</a></li>
<li>(<a href="namespaces.html">namespaces</a>)</li>
<li><a href="locking.html">locking</a> binary files</li>
<li><a href="package.html">packaging</a> gitolite</li>
</ul>
<p>Customising gitolite</p>
<ul>
<li>core and <a href="non-core.html">non-core</a> gitolite</li>
<li><a href="dev-notes.html">writing your own</a> non-core programs</li>
<li>gitolite <a href="triggers.html">triggers</a></li>
<li><a href="list-non-core.html">list of non-core programs</a> shipped with gitolite</li>
</ul>
<hr />
<center>
<span class="red"><strong>Extras</strong></span>
</center>

<hr />
<p><a href="odds-and-ends.html">Odds and Ends</a></p>
<ul>
<li><a href="odds-and-ends.html#writable">disabling pushes</a> to take backups</li>
<li><a href="odds-and-ends.html#elsewhere">putting 'repositories' and '.gitolite' elsewhere</a></li>
<li><a href="odds-and-ends.html#keysonly">using pubkeys obtained from elsewhere</a></li>
<li><a href="odds-and-ends.html#gh">giving users their own repos</a></li>
<li><a href="odds-and-ends.html#server-side-admin">administering gitolite directly on the server</a></li>
</ul>
<p>Additional information/discussion</p>
<ul>
<li><a href="ssh.html">all about ssh and gitolite</a></li>
<li>Running the <a href="testing.html">test suite</a></li>
<li><a href="files.html">gitolite files and directories</a></li>
<li><a href="perf.html">gitolite performance</a></li>
<li><a href="migr.html">Migration</a></li>
<li><a href="http://sitaramc.github.com/gitolite/g2/master-toc.html">documentation for gitolite v2</a></li>
<li><a href="regex.html">regular expressions</a></li>
<li><a href="no-way.html">no way!</a></li>
</ul>
<p>Contributed software, tools, and documentation</p>
<ul>
<li><a href="README-emacs.html">emacs</a> &quot;major mode&quot;</li>
<li><a href="putty.html">putty and msysgit</a></li>
<li><a href="ssh-and-http.html">combining ssh and http mode</a></li>
<li><a href="sskm.html">changing keys -- self service key management</a></li>
<li><a href="ukm.html">user key management</a></li>
</ul>
</div>

<p><em>This feature is only available in the 'namespaces' branch until enough people test it and tell me it works fine</em>.</p>
<p><strong>AVOID NASTY SURPRISES!</strong> Please read the entire page before attempting to use or install this. Most non-core features of gitolite do not work with namespaces, and, worse, many of them will <em>fail silently</em>. There are also security issues you need to be aware of.</p>
<h1 id="background"><span class="header-section-number">1</span> background</h1>
<p>In many projects, developers need to push their work to some central place for others to fetch. Namespaces allow you to give each developer what looks like her own repo or set of repos, while combining all these logical repos into one physical repo on the server. This saves a lot of disk space if they all share a lot of common history.</p>
<p>The logical repos look like normal repos to a git <em>client</em>; all the magic is on the server side. (But see the &quot;WARNINGS&quot; section).</p>
<h1 id="terminology"><span class="header-section-number">2</span> terminology</h1>
<p>There is one repo that is special, and several others that depend upon it or use it. Depending on context, we use one of the following names:</p>
<ul>
<li>Storage context: backing repo/real repo, and logical repos</li>
<li><a href="http://git-scm.com/book/en/Distributed-Git-Distributed-Workflows#Integration-Manager-Workflow">Workflow</a> context: blessed repo and developer repos</li>
</ul>
<p><font color="gray">In addition, in the gitolite context you could say that the blessed repo is a normal (not &quot;wild&quot;) repo and the logical repos are <a href="wild.html">wild</a> repos, since that is the most convenient way to set this up. However, it is not mandatory -- you can have a wild repo as a backing repo, and/or a normal repo as a logical repo if you wish.</font></p>
<h1 id="setup"><span class="header-section-number">3</span> setup</h1>
<p>First, add the following lines to the rc file, as indicated:</p>
<pre><code># add this line as the *last* item in the PRE_GIT trigger list.  In
# particular, it should be *after* the Mirroring::pre_git line if you're
# using mirroring.
'Namespaces::pre_git',

# add this line as the *first* item in the POST_GIT trigger list.  In
# particular, it should be *before* the Mirroring::post_git line if you're
# using mirroring.
'Namespaces::post_git',</code></pre>
<p>Then use the following example conf below as a guide and roll your own. This example is from a mail to the gitolite list by Javier Domingo (&quot;Mirroring forks&quot;, 13-11-2012), modified slightly.</p>
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
<span class="Comment"># backing repos, normal (non-wild), serving as blessed repos</span>
<span class="Type">repo </span>   linux git gitolite <span class="Special">[...other</span> <span class="Special">projects...]</span>
<span class="Statement">    RW+</span><span class="Constant">     </span>=   integration-manager
<span class="Statement">    R</span><span class="Constant">       </span>=   <span class="Identifier">@all</span>

<span class="Comment"># logical repos, wild, created by devs as needed</span>
<span class="Type">repo </span>   <span class="PreProc">CREATOR</span>/[a-zA-Z0-9].*
<span class="Statement">    C</span><span class="Constant">       </span>=   <span class="Identifier">@all</span>
<span class="Statement">    RW+</span><span class="Constant">     </span>=   <span class="PreProc">CREATOR</span>
<span class="Statement">    R</span><span class="Constant">       </span>=   <span class="PreProc">READERS</span> <span class="Identifier">@all</span>
    option namespace.pattern = %/* is @1 in @2
</pre>

<h1 id="use"><span class="header-section-number">4</span> use</h1>
<p>A developer doesn't have to do anything differently. She will still run, e.g., <code>git clone git@host:alice/linux</code> to auto-create and clone a <a href="wild.html">wild</a> repo for herself, then add a remote to the &quot;backing&quot; repo, fetch it, start working, and eventually push her work to alice/linux.</p>
<p>However, she might notice some differences. To begin with, her first push of an enormous code base, to what she thought was an empty repo on the server, might go surprisingly fast :)</p>
<p>Secondly, a lot of <em>gitolite</em> commands (and other features) won't work. See the &quot;WARNINGS&quot; section below for more.</p>
<h1 id="details"><span class="header-section-number">5</span> details</h1>
<p>The option line above has 3 parts separated by the words &quot;is&quot; and &quot;in&quot;:</p>
<pre><code>&lt;pattern&gt; is &lt;namespace&gt; in &lt;backing repo&gt;</code></pre>
<p>When a user attempts to access a logical repo (say &quot;alice/linux&quot;), the namespace pattern for that repo is applied to the repo name as follows:</p>
<ul>
<li>a percent sign matches a single component in the repo name</li>
<li>an asterisk matches one or more components</li>
</ul>
<p>Once the matching is done, each &quot;at-digit&quot; combination is replaced by the corresponding matched segment to derive the namespace and the backing repo name.</p>
<p>Some examples may help:</p>
<ul>
<li>Here's a simple one that separate the first component from the rest:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
    option namespace.pattern = %/* is @1 in @2
</pre>

<p>A reponame of 'alice/linux' gives you a namespace of 'alice' and a backing reponame of 'linux'. Similarly, 'alice/linux/2.2' gives you 'alice' and 'linux/2.2' (which means a repo of that name has to exist!); notice how the asterisk grabs up all the remaining components in the repo name.</p></li>
<li>This one separates the first, the second, and all the rest, but combines them in a different order:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
    option namespace.pattern = %/%/* is @1/@3 in @2
</pre>

<p>A reponame of 'alice/linux/2.2' gives you 'alice/2.2' and 'linux', while a reponame of 'alice/linux/2.2/smp' gives you 'alice/2.2/smp' and 'linux'.</p></li>
<li>Here's another example on the same lines:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
    option namespace.pattern = %/%/%/* is @3/@2/@4 in @1
</pre>

<p>A reponame of 'linux/kernel/torvalds/linux-2.6' gives you a namespace of 'torvalds/kernel/linux-2.6' and a backing repo name of 'linux'.</p></li>
<li><p>Here's an interesting example, given in full to explain better. The basic problem is that one of our backing repos is not a simple name (like 'git' or 'linux'); it is 'sitaramc/gitolite'.</p>
In addition, any developer-owned repo that has 3 or more components is not a fork of anything at all, and should not be subject to namespace processing (i.e., it's just a normal repo)
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
   <span class="Comment"> # backing repos</span>
<span class="Type">    repo </span>sitaramc/gitolite linux git
    ...access rules for backing repos...
   <span class="Comment"> # logical repos</span>
<span class="Type">    repo </span><span class="PreProc">CREATOR</span>/..*
<span class="Statement">        C</span><span class="Constant">   </span>=   <span class="Identifier">@team</span>
<span class="Statement">        RW+</span><span class="Constant"> </span>=   <span class="PreProc">CREATOR</span>
<span class="Statement">        R</span><span class="Constant">   </span>=   <span class="Identifier">@all</span>
    option namespace.pattern-1 = %/gitolite is @1 in sitaramc/gitolite
    option namespace.pattern-2 = %/% is @1 in @2
    option namespace.pattern-3 = %/%/* is none in @1/@2/@3
</pre>

<p>Firstly, this shows how to specify more than one namespace pattern. Each pattern is tried in <em>lexically</em> sorted order until a match is found. (Warning: &quot;lexically sorted&quot; means 'namespace.pattern-10' sorts before 'namespace.pattern-2'!)</p>
<p>Secondly, the example shows that you can hardcode anything, like we did for the backing reponame in pattern 1.</p>
<p>Thirdly, it shows how you can specify a pattern that disables namespacing, like the last pattern. When the backing repo name ends up being exactly the same as the original repo name, gitolite notices this and treats it as a real repo, not as a logical repo. (If this confuses you, ignore it and use some other pattern, say <code>CREATOR/personal/..*</code> for developers personal repos, and don't give them namespace pattern options).</p>
<p>Here are some example results from this setup:</p>
<pre><code>alice/gitolite              -&gt;  alice, sitaramc/gitolite (pattern 1)
alice/linux                 -&gt;  alice, linux (pattern 2)
alice/linux/2.2             -&gt;  (namespace processing disabled)
alice/personal/foo          -&gt;  (namespace processing disabled)</code></pre></li>
<li>Here's an example with some errors:
<pre style="font-family: 'Andale mono',monospace; padding: 4px; color: #ffffff; background-color: #000000;">
    option namespace.pattern-1 = %/gitolite is @1 in sitaramc/gitolite
    option namespace.pattern-2 = %/% is @1 in @2
    option namespace.pattern-3 = %/%/* is @1/@3 in @2
</pre>

<p>If you try 'alice/gitolite/foo' in this setup, it will only match the 3rd pattern. The backing repo name will be 'gitolite', which probably doesn't exist, and git will complain.</p>
<p>Also, without rule 3, trying a repo with more than 2 components won't work. Gitolite will complain that no namespace options matched. This would indicate a discrepancy between the <code>repo [...]</code> line governing those options and the options themselves; you need to fine tune one or the others to fix things.</p></li>
</ul>
<h1 id="warnings"><span class="header-section-number">6</span> WARNINGS</h1>
<h2 id="security"><span class="header-section-number">6.1</span> SECURITY</h2>
<p><strong>First and most important</strong>, please read 'man gitnamespaces' for important security information about namespaces.</p>
<p>Secondly, please note that gitolite's access control decisions are made based on the repo name that the user supplies, even if that is only a logical repo. E.g., in a sequence like this:</p>
<pre><code>git clone git@server:alice/linux                        # 1
cd alice
git remote add backing git@server:linux
git fetch backing                                       # 2
git checkout master
git push origin master                                  # 3</code></pre>
<p>Lines 1 and 3 use the access list for the logical repo (&quot;alice/linux&quot;) to allow or reject a push, while line 2, which is directly contacting the &quot;backing&quot; repo, use that repo's access rules.</p>
<p>In particular, Alice does <strong>not</strong> need write access to the backing repo for the push to succeed!</p>
<h2 id="gitolite-functionality"><span class="header-section-number">6.2</span> gitolite functionality</h2>
<p>Most things you're used to in gitolite won't work with logical repos. From the client point of view, <strong>the only features guaranteed to work on logical repos are</strong>:</p>
<ul>
<li>normal git operations (clone, fetch, push)</li>
<li>creating a new <a href="wild.html">wild</a> repo</li>
<li>the <a href="user.html#perms">perms</a> command (except the &quot;-c&quot; flag)</li>
</ul>
<p>From a server/admin point of view, <strong>the following will not work for logical repos, and may even fail silently!</strong>:</p>
<ul>
<li>smart-http mode</li>
<li>the 'config' line in gitolite.conf</li>
<li>any 'option's affecting a physical repo, like RepoUmask</li>
<li>anything that expects to be recorded somewhere in the bare repo directory.</li>
<li>...and anything else not explicitly listed as &quot;working&quot; in this doc ;-)</li>
</ul>
<h2 id="gitolite-functionality----mirroring"><span class="header-section-number">6.3</span> gitolite functionality -- mirroring</h2>
<p>Mirroring works, but <strong>all the logical repos and the backing repo should have the same mirroring setup</strong>. I.e., which server is the master, who are the slaves, are redirects allowed, if so from where, etc., etc., etc., should all have the same values for all of them. I cannot over-emphasise the importance of this for proper mirroring.</p>
<h1 id="other-notes"><span class="header-section-number">7</span> other notes</h1>
<p>The &quot;backing repo&quot; needs to exist. If it is itself a <a href="wild.html">wild</a> repo, it must be auto-created <em>before</em> a logical repo that hangs off of it is accessed.</p>
<p>The logical repo must also be mentioned in the gitolite.conf file in some way, as you saw in the example. Access control decisions are made based on this one, not the backing repo.</p>
<p>One <em>quirk</em> is that, if the logical repo is a wild repo, then an actual repo with that name <em>is</em> created on disk. Gitolite needs a place to keep its repo-specific permissions so it has to do that. You will find, however, that the objects directory is pretty much empty, even after a lot of activity.</p>
</body>
</html>
